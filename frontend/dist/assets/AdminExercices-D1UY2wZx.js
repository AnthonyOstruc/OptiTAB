import{a as p,c as M,B as le,C as ne,b as s,d as t,g as h,k as v,K as g,L as V,F,p as q,j as f,t as o,w as P,h as I,o as u,n as oe,u as re}from"./vendor-D171CWhe.js";import{_ as ae}from"./index-D9PhsPPd.js";import{a as se,g as ue,l as G,c as de,m as ce,n as pe}from"./curriculum-DO8U7dOZ.js";import"./PaysNiveauxSelector.vue_vue_type_style_index_0_scoped_6652d9f9_lang-l0sNRNKZ.js";import"./PaysNiveauxDisplay.vue_vue_type_style_index_0_scoped_821033d6_lang-l0sNRNKZ.js";import{A as ve}from"./AdminActionsButtons-BTlG4wzv.js";import{E as me}from"./ExerciceQCM-DE51-I55.js";import"./ui-jaH5oyHW.js";import"./pdf-B39ievqC.js";import"./mathlive-B5k0jhbN.js";import"./exercices-_oXgMgvc.js";const fe={class:"form-group"},ye=["value"],he={key:0,class:"context-panel"},ge={key:0,class:"context-header"},we={class:"context-row"},xe={class:"context-row"},Ce={class:"context-row"},Ne={class:"context-row"},be={class:"context-row"},Ee={class:"context-row"},ke={key:1,class:"context-stats"},_e={class:"stat-item"},Ae={class:"stat-item"},De={class:"form-group"},Se={class:"form-group"},Te={class:"form-group"},Me={class:"form-group"},Ve={class:"form-group"},Fe={class:"form-actions"},qe={class:"btn-primary",type:"submit"},Be={key:0,class:"preview-section"},Ue={class:"preview-header"},je={class:"preview-item"},ze={class:"filters"},Le={class:"filter-group"},$e=["disabled"],Pe=["value"],Ie={class:"admin-table"},Ge={class:"ctx-cell"},Ke={key:0},Oe={class:"modal-description"},Qe={class:"modal-form"},He={class:"form-group"},Je=["value"],Re={class:"form-group"},We={class:"modal-actions"},Xe=["disabled"],Ye={__name:"AdminExercices",setup(Ze){const w=p([]),c=p([]),B=p([]),k=p(""),_=p("");p({});const n=p({id:null,chapitre:"",nom:"",enonce:"",etapes:"",solution:"",difficulte:"moyen",niveaux:[]}),A=p({chapitre:""}),x=p(!1),m=p(null),D=p(!1),a=p({originalExercice:null,newChapitre:"",newTitre:""}),U=M(()=>{let i=w.value;return A.value.chapitre&&(i=i.filter(e=>e.chapitre==A.value.chapitre)),i}),K=M(()=>{if(!k.value)return c.value;const i=k.value.toLowerCase();return c.value.filter(e=>T(e).toLowerCase().includes(i))}),j=M(()=>{if(!_.value)return c.value;const i=_.value.toLowerCase();return c.value.filter(e=>T(e).toLowerCase().includes(i))});async function O(){try{const[i,e]=await Promise.all([se(),ue()]);c.value=i||[],B.value=e||[],await C()}catch{}}le(O),ne(()=>n.value.chapitre,async()=>{await C()});async function C(){try{const i={};n.value.chapitre&&n.value.chapitre!=="all"&&(i.chapitre=Number(n.value.chapitre)),w.value=await de(i)}catch{w.value=[]}}function z(){n.value={id:null,chapitre:"",nom:"",type:"",enonce:"",etapes:"",solution:"",difficulte:"moyen",niveaux:[]},x.value=!1,m.value=null}async function Q(){if(!(!n.value.chapitre||!n.value.enonce))try{const i={facile:"easy",moyen:"medium",difficile:"hard"},e={chapitre:Number(n.value.chapitre),titre:n.value.nom||"Exercice",contenu:n.value.enonce,difficulty:i[n.value.difficulte]||"medium",question:n.value.enonce,reponse_correcte:n.value.solution||"",etapes:n.value.etapes||"",points:1};n.value.id?await ce(n.value.id,e):await G(e);const l=n.value.chapitre;z(),n.value.chapitre=l,await C()}catch{}}function H(i){const e=i.niveaux?i.niveaux.map(r=>r.id):[],l={easy:"facile",medium:"moyen",hard:"difficile"};n.value={id:i.id,chapitre:i.chapitre,nom:i.titre||i.nom||"",enonce:i.contenu||i.question||i.enonce||"",etapes:i.etapes||"",solution:i.reponse_correcte||i.solution||"",difficulte:l[i.difficulty]||i.difficulte||"moyen",niveaux:e},x.value=!1,m.value=null}async function J(i){try{await pe(i),await C()}catch{}}function R(i){J(i.id)}function W(i){a.value={originalExercice:i,newChapitre:"",newTitre:`${i.titre||i.nom}`},D.value=!0}async function X(){if(!a.value.newChapitre||!a.value.newTitre.trim()){alert("Veuillez sélectionner un chapitre et saisir un titre pour la copie.");return}try{const i=a.value.originalExercice,e={easy:"easy",medium:"medium",hard:"hard"},l={chapitre:Number(a.value.newChapitre),titre:a.value.newTitre.trim(),contenu:i.contenu||i.question||i.enonce||"",difficulty:i.difficulty||e[i.difficulte]||"medium",question:i.contenu||i.question||i.enonce||"",reponse_correcte:i.reponse_correcte||i.solution||"",etapes:i.etapes||"",points:i.points||1};await G(l),await C(),D.value=!1,a.value={originalExercice:null,newChapitre:"",newTitre:""},alert("Exercice dupliqué avec succès !")}catch{alert("Erreur lors de la duplication de l'exercice.")}}function L(){D.value=!1,a.value={originalExercice:null,newChapitre:"",newTitre:""}}function Y(){if(!n.value.nom||!n.value.enonce){alert("Veuillez remplir au moins le titre et l'énoncé pour prévisualiser");return}const i={facile:"easy",moyen:"medium",difficile:"hard"};m.value={titre:n.value.nom,instruction:n.value.enonce,etapes:n.value.etapes||"",solution:n.value.solution||"",difficulty:i[n.value.difficulte]||"medium"},x.value=!0}function Z(){x.value=!1,m.value=null}function ee(i){const e=c.value.find(l=>String(l.id)===String(i));return e?e.nom:i}function N(i){return B.value.find(e=>String(e.id)===String(i))}function S(i){if(!i)return null;const e=N(i.notion);if(!e)return{themeNom:"",matiereNom:"",paysNom:"",niveauNom:""};const l=e.matiere_nom||e.contexte_detail&&e.contexte_detail.matiere_nom||"",r=e.theme_nom||"",E=e.contexte_detail&&e.contexte_detail.pays?e.contexte_detail.pays.nom:"",d=e.contexte_detail&&e.contexte_detail.niveau?e.contexte_detail.niveau.nom:"";return{matiereNom:l,themeNom:r,paysNom:E,niveauNom:d}}function te(){if(c.value.length===0)return null;const i=new Set,e=new Set,l=new Set,r=new Set;return c.value.forEach(E=>{const d=N(E.notion);d&&(d.matiere_nom&&i.add(d.matiere_nom),d.theme_nom&&e.add(d.theme_nom),d.contexte_detail?.pays?.nom&&l.add(d.contexte_detail.pays.nom),d.contexte_detail?.niveau?.nom&&r.add(d.contexte_detail.niveau.nom))}),{matiereNom:i.size>0?Array.from(i).join(", "):"—",themeNom:e.size>0?Array.from(e).join(", "):"—",paysNom:l.size>0?Array.from(l).join(", "):"—",niveauNom:r.size>0?Array.from(r).join(", "):"—",isAllChapters:!0}}const y=M(()=>{if(n.value.chapitre==="all")return te();const i=c.value.find(e=>String(e.id)===String(n.value.chapitre));return i?S(i):null});function T(i){const e=N(i.notion),l=S(i);return[i.nom,e?`— ${e.nom}`:"",l&&l.matiereNom?`— ${l.matiereNom}`:"",l&&(l.paysNom||l.niveauNom)?`— ${[l.paysNom,l.niveauNom].filter(Boolean).join(" · ")}`:""].filter(Boolean).join(" ")}function b(i){return String(i||"").normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"")}function $(i){if(i==="all")return"Tous les chapitres";const e=c.value.find(d=>String(d.id)===String(i));if(!e)return"";const l=N(e.notion),r=S(e);return[r?.matiereNom,r?.themeNom,l?.nom,e.nom,r?.paysNom,r?.niveauNom].filter(Boolean).join(" › ")}function ie(i){if(i==="all")return"tous_les_chapitres";const e=c.value.find(d=>String(d.id)===String(i));if(!e)return"";const l=N(e.notion),r=S(e);return[b(l?.nom),b(r?.themeNom),b(r?.matiereNom),b(r?.paysNom),b(r?.niveauNom)].filter(Boolean).join("_")}return(i,e)=>(u(),s("div",null,[e[45]||(e[45]=t("h2",{class:"admin-title"},"Gestion des Exercices",-1)),t("form",{class:"admin-form",onSubmit:P(Q,["prevent"])},[t("div",fe,[e[14]||(e[14]=t("label",null,"Chapitre:",-1)),v(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>k.value=l),type:"text",placeholder:"Filtrer les chapitres...",class:"filter-input"},null,512),[[g,k.value]]),v(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>n.value.chapitre=l),required:""},[e[12]||(e[12]=t("option",{value:""},"Choisir un chapitre",-1)),e[13]||(e[13]=t("option",{value:"all"},"✓ Tous les chapitres",-1)),(u(!0),s(F,null,q(K.value,l=>(u(),s("option",{key:l.id,value:l.id},o(T(l)),9,ye))),128))],512),[[V,n.value.chapitre]])]),y.value?(u(),s("div",he,[y.value.isAllChapters?(u(),s("div",ge,e[15]||(e[15]=[t("h4",null,"📚 Vue d'ensemble - Tous les chapitres",-1)]))):h("",!0),t("div",we,[e[16]||(e[16]=t("strong",null,"Matière:",-1)),e[17]||(e[17]=f()),t("span",null,o(y.value.matiereNom||"—"),1)]),t("div",xe,[e[18]||(e[18]=t("strong",null,"Thème:",-1)),e[19]||(e[19]=f()),t("span",null,o(y.value.themeNom||"—"),1)]),t("div",Ce,[e[20]||(e[20]=t("strong",null,"Pays:",-1)),e[21]||(e[21]=f()),t("span",null,o(y.value.paysNom||"—"),1)]),t("div",Ne,[e[22]||(e[22]=t("strong",null,"Niveau:",-1)),e[23]||(e[23]=f()),t("span",null,o(y.value.niveauNom||"—"),1)]),t("div",be,[e[24]||(e[24]=t("strong",null,"Chemin:",-1)),e[25]||(e[25]=f()),t("span",null,o($(n.value.chapitre)),1)]),t("div",Ee,[e[26]||(e[26]=t("strong",null,"Code:",-1)),e[27]||(e[27]=f()),t("code",null,o(ie(n.value.chapitre)),1)]),y.value.isAllChapters?(u(),s("div",ke,[t("div",_e,"📖 "+o(c.value.length)+" chapitre"+o(c.value.length>1?"s":""),1),t("div",Ae,"📝 "+o(w.value.length)+" exercice"+o(w.value.length>1?"s":""),1)])):h("",!0)])):h("",!0),t("div",De,[e[28]||(e[28]=t("label",null,"Titre:",-1)),v(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>n.value.nom=l),placeholder:"Titre de l'exercice",required:""},null,512),[[g,n.value.nom]])]),t("div",Se,[e[29]||(e[29]=t("label",null,"Énoncé:",-1)),v(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=l=>n.value.enonce=l),rows:"4",required:""},null,512),[[g,n.value.enonce]])]),t("div",Te,[e[30]||(e[30]=t("label",null,"Méthode de résolution:",-1)),v(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=l=>n.value.etapes=l),rows:"4",placeholder:"Décrivez les étapes de résolution..."},null,512),[[g,n.value.etapes]])]),t("div",Me,[e[31]||(e[31]=t("label",null,"Solution:",-1)),v(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=l=>n.value.solution=l),rows:"4"},null,512),[[g,n.value.solution]])]),t("div",Ve,[e[33]||(e[33]=t("label",null,"Difficulté:",-1)),v(t("select",{"onUpdate:modelValue":e[6]||(e[6]=l=>n.value.difficulte=l),class:"difficulty-select"},e[32]||(e[32]=[t("option",{value:"facile"},"Facile",-1),t("option",{value:"moyen"},"Moyen",-1),t("option",{value:"difficile"},"Difficile",-1)]),512),[[V,n.value.difficulte]])]),t("div",Fe,[t("button",qe,o(n.value.id?"Mettre à jour":"Créer"),1),n.value.id?(u(),s("button",{key:0,class:"btn-secondary",type:"button",onClick:z},"Annuler")):h("",!0),t("button",{class:"btn-preview",type:"button",onClick:Y},"Prévisualiser")])],32),x.value&&m.value?(u(),s("div",Be,[t("div",Ue,[t("h3",null,"Aperçu de l'exercice "+o(n.value.id?"(Mode édition)":"(Mode création)"),1),t("button",{class:"btn-close-preview",onClick:Z,title:"Fermer la prévisualisation"},e[34]||(e[34]=[t("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M18 6L6 18"}),t("path",{d:"M6 6l12 12"})],-1)]))]),t("div",je,[I(me,{eid:`preview-${n.value.id||"new"}`,titre:m.value.titre,instruction:m.value.instruction,etapes:m.value.etapes,solution:m.value.solution,difficulty:m.value.difficulty},null,8,["eid","titre","instruction","etapes","solution","difficulty"])])])):h("",!0),t("div",ze,[t("div",Le,[e[36]||(e[36]=t("label",null,"Filtrer par chapitre:",-1)),v(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>_.value=l),type:"text",placeholder:"Filtrer les chapitres...",class:"filter-input"},null,512),[[g,_.value]]),v(t("select",{"onUpdate:modelValue":e[8]||(e[8]=l=>A.value.chapitre=l),disabled:j.value.length===0},[e[35]||(e[35]=t("option",{value:""},"Tous les chapitres",-1)),(u(!0),s(F,null,q(j.value,l=>(u(),s("option",{key:l.id,value:l.id},o(l.nom),9,Pe))),128))],8,$e),[[V,A.value.chapitre]])])]),t("table",Ie,[e[38]||(e[38]=t("thead",null,[t("tr",null,[t("th",null,"ID"),t("th",null,"Titre"),t("th",null,"Chapitre"),t("th",null,"Contexte"),t("th",null,"Difficulté"),t("th",null,"Actions")])],-1)),t("tbody",null,[(u(!0),s(F,null,q(U.value,l=>(u(),s("tr",{key:l.id},[t("td",null,o(l.id),1),t("td",null,o(l.titre||l.nom),1),t("td",null,o(ee(l.chapitre)),1),t("td",Ge,o($(l.chapitre)),1),t("td",null,[t("span",{class:oe(["difficulte-badge",`difficulte-${l.difficulte||l.difficulty}`])},o(l.difficulte||l.difficulty),3)]),t("td",null,[I(re(ve),{item:l,actions:["edit","duplicate","delete"],"edit-label":"Éditer","duplicate-label":"Dupliquer","confirm-message":"Êtes-vous sûr de vouloir supprimer cet exercice ?",onEdit:H,onDuplicate:W,onDelete:R},null,8,["item"])])]))),128)),U.value.length===0?(u(),s("tr",Ke,e[37]||(e[37]=[t("td",{colspan:"6",style:{"text-align":"center","font-style":"italic"}},"Aucun exercice trouvé.",-1)]))):h("",!0)])]),D.value?(u(),s("div",{key:1,class:"modal-overlay",onClick:L},[t("div",{class:"modal-content",onClick:e[11]||(e[11]=P(()=>{},["stop"]))},[e[44]||(e[44]=t("h3",null,"Dupliquer l'exercice",-1)),t("p",Oe,[e[39]||(e[39]=f(' Créer une copie de "')),t("strong",null,o(a.value.originalExercice?.titre||a.value.originalExercice?.nom),1),e[40]||(e[40]=f('" '))]),t("div",Qe,[t("div",He,[e[42]||(e[42]=t("label",null,"Nouveau chapitre:",-1)),v(t("select",{"onUpdate:modelValue":e[9]||(e[9]=l=>a.value.newChapitre=l),required:""},[e[41]||(e[41]=t("option",{value:""},"Choisir un chapitre",-1)),(u(!0),s(F,null,q(c.value,l=>(u(),s("option",{key:l.id,value:l.id},o(T(l)),9,Je))),128))],512),[[V,a.value.newChapitre]])]),t("div",Re,[e[43]||(e[43]=t("label",null,"Nouveau titre:",-1)),v(t("input",{"onUpdate:modelValue":e[10]||(e[10]=l=>a.value.newTitre=l),placeholder:"Titre de la copie",required:""},null,512),[[g,a.value.newTitre]])])]),t("div",We,[t("button",{class:"btn-secondary",onClick:L},"Annuler"),t("button",{class:"btn-primary",onClick:X,disabled:!a.value.newChapitre||!a.value.newTitre.trim()}," Dupliquer ",8,Xe)])])])):h("",!0)]))}},ct=ae(Ye,[["__scopeId","data-v-48246245"]]);export{ct as default};
