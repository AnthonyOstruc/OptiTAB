const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PDFDownloadButton-DYw0idcX.js","assets/index-C20tTf3S.js","assets/index-CNJib2To.css","assets/PDFDownloadButton-D7sfzo-M.css","assets/useDailyObjectives-B4lktBMi.js"])))=>i.map(i=>d[i]);
import{_ as oe,m as E,c as u,b as Q,o as c,a as o,F as q,e as R,j as T,t as y,q as me,M as be,h as _,p as ye,f as ee,w as xe,C as Fe,ar as Ce,i as M,k as Pe,d as te,as as W}from"./index-C20tTf3S.js";import{D as $e}from"./DashboardLayout-DmmXvv68.js";import{a as ke,c as De}from"./curriculum-C6dJwtfd.js";import{g as Ee,u as Se,c as we,d as Te}from"./exercices-D5_EwlUY.js";import{E as qe}from"./ExerciceQCM-DJualaHI.js";/* empty css                                                             */import{B as ze}from"./BackButton-B9UoO6zr.js";import{P as se}from"./PDFDownloadButton-DYw0idcX.js";import"./menuItems-zei-A9he.js";import"./matieres-Ce1WeeoH.js";const Ae={key:0,class:"pagination"},Le=["disabled"],je={key:0,class:"ellipsis"},Oe=["onClick"],Re=["disabled"],ae=2,Ne={__name:"Pagination",props:{total:{type:Number,required:!0},perPage:{type:Number,required:!0},page:{type:Number,required:!0}},emits:["update:page"],setup(G){const z=G,k=E(()=>Math.ceil(z.total/z.perPage)),C=E(()=>z.page),A=E(()=>{const d=k.value,x=C.value;if(d<=7)return[...Array(d).keys()].map(r=>r+1);const p=new Set([1,d]);for(let r=x-ae;r<=x+ae;r++)r>1&&r<d&&p.add(r);const m=Array.from(p).sort((r,B)=>r-B),L=[];let F=0;for(const r of m)F&&r-F>1&&L.push("ellipsis-"+F),L.push(r),F=r;return L});return(d,x)=>k.value>1?(c(),u("div",Ae,[o("button",{class:"nav-btn",disabled:C.value===1,onClick:x[0]||(x[0]=p=>d.$emit("update:page",C.value-1))},"Pr√©c.",8,Le),(c(!0),u(q,null,R(A.value,p=>(c(),u(q,{key:p},[typeof p=="string"?(c(),u("span",je,"‚Ä¶")):(c(),u("button",{key:1,class:T(["page-btn",{active:p===C.value}]),onClick:m=>d.$emit("update:page",p)},y(p),11,Oe))],64))),128)),o("button",{class:"nav-btn",disabled:C.value===k.value,onClick:x[1]||(x[1]=p=>d.$emit("update:page",C.value+1))},"Suiv.",8,Re)])):Q("",!0)}},Me=oe(Ne,[["__scopeId","data-v-14c2a5bd"]]),We={class:"exercices-section"},Be={class:"clean-navigation"},Ie={class:"nav-grid"},Ve=["onClick"],He={class:"nav-icon"},Ue={class:"nav-label"},Je={class:"nav-count"},Qe={class:"exercices-title",style:{"margin-top":"1.5rem","padding-top":"0.75rem"}},Ge={key:0,class:"download-section"},Ze={class:"download-actions"},Ke={class:"download-buttons"},Xe={class:"download-info"},Ye={key:1,class:"exercices-loader"},et={key:2,class:"exercices-error"},tt={key:3},st={class:"exercices-controls"},at={class:"filter-row"},ot={class:"filter-item"},it={class:"filter-buttons"},lt=["onClick"],nt={class:"filter-item"},rt={class:"filter-buttons"},ct=["onClick"],ut={key:0,class:"difficulty-text"},dt={key:1,class:"difficulty-stars"},pt={class:"filter-item"},vt={class:"filter-buttons"},gt=["title"],ft={key:0},ht={class:"filter-item"},_t={class:"filter-buttons"},mt=["disabled"],bt=["disabled"],yt={__name:"ChapterExercises",setup(G){const z=be(),k=Fe(),C=me(),A=z.params.chapitreId,d=_([]),x=[1,3,5],p=_(1),m=_(1),L=["all","easy","medium","hard"],F=_("all"),r=_(!1),B=E(()=>[{key:"all",label:"Exercices restants",shortLabel:"√Ä faire",icon:"üìù",count:d.value.filter(s=>!v.value[s.id]).length},{key:"done",label:"Exercices r√©alis√©s",shortLabel:"Fait",icon:"üìã",count:d.value.filter(s=>v.value[s.id]).length},{key:"acquired",label:"Acquis",shortLabel:"Acquis",icon:"‚úÖ",count:d.value.filter(s=>v.value[s.id]?.status==="acquired").length},{key:"not_acquired",label:"√Ä revoir",shortLabel:"√Ä revoir",icon:"‚ùå",count:d.value.filter(s=>v.value[s.id]?.status==="not_acquired").length}]),j=_("all"),ie=async()=>{try{console.log("Download all PDF clicked"),console.log("Exercices data:",f.value);const{generateExercicesListPDF:s}=await W(async()=>{const{generateExercicesListPDF:t}=await import("./PDFDownloadButton-DYw0idcX.js").then(e=>e.p);return{generateExercicesListPDF:t}},__vite__mapDeps([0,1,2,3]));await s(f.value,`Exercices_${P.value}`),alert("PDF g√©n√©r√© avec succ√®s !")}catch(s){console.error("Erreur PDF:",s),alert("Erreur lors de la g√©n√©ration du PDF: "+s.message)}},v=_({}),P=_(""),N=_(!0),O=_(""),I=_([]);ye(async()=>{N.value=!0;try{const s=await ke();I.value=Array.isArray(s)?s:[];const t=I.value.find(h=>h.id==A);P.value=t?t.nom:"Chapitre";const e=C.niveau_pays?.id,a=await De({chapitre:A,niveau:e});d.value=Array.isArray(a)?a:[],console.log(`[ChapterExercises] Exercices charg√©s pour niveau ${e}:`,d.value.length);const{data:n}=await Ee(),l=Array.isArray(n)?n:n?.results||[];v.value=Object.fromEntries(l.map(h=>[h.exercice,{status:h.est_correct?"acquired":"not_acquired",id:h.id}]));const b=t?t.notion:t?.notion_id;m.value=1,O.value=""}catch(s){console.error("[ChapterExercises] Erreur chargement:",s),O.value="Impossible de charger les exercices."}finally{N.value=!1}}),E(()=>Math.ceil(d.value.length/p.value));const f=E(()=>{let s=d.value;return F.value!=="all"&&(s=s.filter(t=>t.difficulty===F.value)),j.value==="done"?s=s.filter(t=>v.value[t.id]):j.value==="all"?s=s.filter(t=>!v.value[t.id]):s=s.filter(t=>v.value[t.id]?.status===j.value),s}),le=E(()=>{const s=(m.value-1)*p.value;return f.value.slice(s,s+p.value)});function ne(s){m.value=s,window.scrollTo({top:0,behavior:"smooth"})}async function re({exerciceId:s,status:t}){try{if(t){const e=v.value[s];if(e){if(await Se(e.id,{exercice:s,reponse_donnee:t,est_correct:t==="acquired"}),v.value[s]={status:t,id:e.id},t==="acquired"){console.log("[ChapterExercices] Exercice r√©ussi (mise √† jour) - int√©gration objectifs journaliers");const{useDailyObjectivesIntegration:a}=await W(async()=>{const{useDailyObjectivesIntegration:l}=await import("./useDailyObjectives-B4lktBMi.js");return{useDailyObjectivesIntegration:l}},__vite__mapDeps([4,1,2])),{onExerciseCompleted:n}=a();n({exerciceId:s,isSuccess:!0,status:"acquired"})}}else{const a=await we({exercice:s,reponse_donnee:t,est_correct:t==="acquired",points_obtenus:t==="acquired"?1:0,temps_seconde:0}),n=a?.data?.id||a?.id;v.value[s]={status:t,id:n}}if(t==="acquired"){console.log("[ChapterExercices] Exercice r√©ussi - int√©gration objectifs journaliers");const{useDailyObjectivesIntegration:a}=await W(async()=>{const{useDailyObjectivesIntegration:l}=await import("./useDailyObjectives-B4lktBMi.js");return{useDailyObjectivesIntegration:l}},__vite__mapDeps([4,1,2])),{onExerciseCompleted:n}=a();n({exerciceId:s,isSuccess:!0,status:"acquired"})}}else{const e=v.value[s];e&&await Te(e.id),delete v.value[s]}}catch(e){console.error("Erreur lors de la sauvegarde du statut:",e),t?v.value[s]={status:t,id:null}:delete v.value[s]}}function ce(){try{const s=I.value?.find?.(e=>e.id==A),t=s?s.notion||s.notion_id:null;t?k.push({name:"Chapitres",params:{notionId:String(t)}}):k.back()}catch{k.back()}}function ue(){r.value=!r.value}async function Z(s=!1){try{const{default:t}=await W(async()=>{const{default:g}=await import("./PDFDownloadButton-DYw0idcX.js").then(w=>w.j);return{default:g}},__vite__mapDeps([0,1,2,3])),e=new t({orientation:"p",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:16}),a=e.internal.pageSize.getWidth(),n=e.internal.pageSize.getHeight(),l=20,b=a-2*l;e.setFillColor(240,248,255),e.rect(0,0,a,40,"F"),e.setFontSize(18),e.setFont("helvetica","bold"),e.setTextColor(30,64,175);const h=s?`Exercices de ${P.value}`:`Feuille d'exercices - ${P.value}`,U=e.getTextWidth(h);e.text(h,(a-U)/2,20),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(100,116,139);const $=s?"Exercices avec corrections d√©taill√©es":"√ânonc√©s des exercices",D=e.getTextWidth($);e.text($,(a-D)/2,28),e.setTextColor(0,0,0),e.setFontSize(8);const J=new Date().toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"});e.text(`G√©n√©r√© le ${J}`,l,36),e.text(`${f.value.length} exercice(s)`,a-l-30,36);let i=50,S=1;for(const g of f.value){i>n-100&&(e.addPage(),i=l),e.setFillColor(59,130,246),e.setTextColor(255,255,255),e.roundedRect(l,i-5,15,10,2,2,"F"),e.setFontSize(10),e.setFont("helvetica","bold"),e.text(`${S}`,l+4,i+2),e.setTextColor(0,0,0),e.setFontSize(12),e.setFont("helvetica","bold"),g.titre&&e.text(g.titre,l+20,i+2),i+=15;const w=g.difficulty||"medium",he=w==="easy"?"‚òÖ‚òÜ‚òÜ Facile":w==="medium"?"‚òÖ‚òÖ‚òÜ Moyen":"‚òÖ‚òÖ‚òÖ Difficile",_e=w==="easy"?[34,197,94]:w==="medium"?[245,158,11]:[239,68,68];e.setFontSize(8),e.setFont("helvetica","normal"),e.setTextColor(..._e),e.text(he,l,i),i+=10,e.setTextColor(0,0,0);const X=g.question||g.contenu||"";if(X&&(e.setFontSize(11),e.setFont("helvetica","bold"),e.text("√ânonc√© :",l,i),i+=8,i=H(V(X),e,i,b,l),i+=10),s){g.etapes&&g.etapes.trim()&&(i>n-60&&(e.addPage(),i=l),e.setFontSize(11),e.setFont("helvetica","bold"),e.setTextColor(139,69,19),e.text("üî¢ M√©thode de r√©solution :",l,i),i+=10,e.setTextColor(0,0,0),i=H(V(g.etapes),e,i,b,l),i+=10);const Y=g.reponse_correcte||"";Y&&(i>n-40&&(e.addPage(),i=l),e.setFillColor(240,253,244),e.roundedRect(l-5,i-5,b+10,8,2,2,"F"),e.setFontSize(11),e.setFont("helvetica","bold"),e.setTextColor(21,128,61),e.text("‚úÖ R√©ponse :",l,i),i+=10,e.setTextColor(0,0,0),i=H(V(Y),e,i,b,l),i+=5)}i+=10,e.setDrawColor(229,231,235),e.setLineWidth(.5),e.line(l,i,a-l,i),i+=20,S++}const K=e.internal.getNumberOfPages();for(let g=1;g<=K;g++)e.setPage(g),e.setFontSize(8),e.setTextColor(107,114,128),e.text(`Page ${g} sur ${K}`,a-l-20,n-10),s?e.text("Document avec corrections",l,n-10):e.text("Document d'√©nonc√©s",l,n-10);const de=P.value.replace(/[^a-zA-Z0-9\s√†√¢√§√©√®√™√´√Ø√Æ√¥√∂√π√ª√º√ø√ß]/g,"").replace(/\s+/g,"_").toLowerCase(),pe=s?"_avec_corrections":"_enonces",ve=new Date().toISOString().split("T")[0],ge=`exercices_${de}${pe}_${ve}.pdf`;e.save(ge);const fe=s?"PDF avec corrections g√©n√©r√© avec succ√®s !":"PDF des √©nonc√©s g√©n√©r√© avec succ√®s !";setTimeout(()=>{alert(fe)},500)}catch(t){console.error("Erreur lors de la g√©n√©ration du PDF:",t),alert("Erreur lors de la g√©n√©ration du PDF. Veuillez v√©rifier que les donn√©es sont charg√©es et r√©essayer.")}}function V(s){return s?s.replace(/<br\s*\/?>/gi,`
`).replace(/<\/p>/gi,`

`).replace(/<p[^>]*>/gi,"").replace(/<strong[^>]*>(.*?)<\/strong>/gi,"**$1**").replace(/<em[^>]*>(.*?)<\/em>/gi,"*$1*").replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/\$\$([^$]+)\$\$/g,`
[$1]
`).replace(/\$([^$]+)\$/g,"($1)").replace(/\\ge/g,"‚â•").replace(/\\le/g,"‚â§").replace(/\\cdot/g,"¬∑").replace(/\\times/g,"√ó").replace(/\\div/g,"√∑").replace(/\\pm/g,"¬±").replace(/\\infty/g,"‚àû").replace(/\\alpha/g,"Œ±").replace(/\\beta/g,"Œ≤").replace(/\\gamma/g,"Œ≥").replace(/\\delta/g,"Œ¥").replace(/\\pi/g,"œÄ").replace(/\\theta/g,"Œ∏").replace(/\\lambda/g,"Œª").replace(/\\mu/g,"Œº").replace(/\\sigma/g,"œÉ").replace(/\\sum/g,"Œ£").replace(/\\prod/g,"Œ†").replace(/\\int/g,"‚à´").replace(/\\partial/g,"‚àÇ").replace(/\\nabla/g,"‚àá").replace(/\\sqrt/g,"‚àö").replace(/\^(\d+)/g,"‚ÅΩ$1‚Åæ").replace(/\_(\d+)/g,"‚Çç$1‚Çé").replace(/\*\*([^*]+)\*\*/g,(t,e)=>e.toUpperCase()).replace(/\*([^*]+)\*/g,"$1").replace(/\s+/g," ").replace(/\n\s*\n\s*\n/g,`

`).replace(/^\s+|\s+$/g,"").trim():""}function H(s,t,e,a,n,l=!1){if(!s)return e;const b=l?12:10,h=b*.4;t.setFontSize(b),t.setFont("helvetica",l?"bold":"normal");const U=s.split(`

`).filter(D=>D.trim());let $=e;for(const D of U)if(D.trim()){let J=D;const i=/^(üîµ|√âtape \d+|Question \d+|R√©ponse)/i.test(D);i?(t.setFont("helvetica","bold"),t.setFontSize(b)):(t.setFont("helvetica","normal"),t.setFontSize(b-1));const S=t.splitTextToSize(J,a);$+S.length*h>t.internal.pageSize.getHeight()-20&&(t.addPage(),$=n),t.text(S,n,$),$+=S.length*h+(i?8:5)}return $}return(s,t)=>{const e=Ce('else"');return c(),ee($e,null,{default:xe(()=>[o("section",We,[M(ze,{text:"Retour aux chapitres",customAction:ce,position:"top-left"}),o("div",Be,[o("div",Ie,[(c(!0),u(q,null,R(B.value,a=>(c(),u("button",{key:a.key,class:T(["nav-item",{active:a.key===j.value}]),onClick:n=>{j.value=a.key,m.value=1}},[o("span",He,y(a.icon),1),o("span",Ue,y(a.shortLabel),1),o("span",Je,y(a.count),1)],10,Ve))),128))])]),o("h2",Qe,"Exercices du "+y(P.value),1),!N.value&&!O.value&&f.value.length>0?(c(),u("div",Ge,[o("div",Ze,[t[2]||(t[2]=o("h3",{class:"download-title"},"üìÑ T√©l√©chargement en lot",-1)),o("div",Ke,[M(se,{type:"list",data:f.value,title:`Exercices_${P.value}_Enonces`,text:"üìã √ânonc√©s seuls",useMathJax:!0,includeSolution:!1,class:"pdf-btn download-enonces-btn"},null,8,["data","title"]),M(se,{type:"list",data:f.value,title:`Exercices_${P.value}_Corriges`,text:"üìù √ânonc√©s + Corrig√©s",useMathJax:!0,includeSolution:!0,class:"pdf-btn download-corriges-btn"},null,8,["data","title"])]),o("p",Xe," üìä "+y(f.value.length)+" exercice(s) disponible(s) selon vos filtres actuels ",1)])])):Q("",!0),N.value?(c(),u("div",Ye,"Chargement...")):O.value?(c(),u("div",et,y(O.value),1)):(c(),u("div",tt,[o("div",st,[o("div",at,[o("div",ot,[t[3]||(t[3]=o("span",{class:"filter-label"},"Exercices par page",-1)),o("div",it,[(c(),u(q,null,R(x,a=>o("button",{key:a,class:T(["filter-btn",{active:a===p.value}]),onClick:n=>{p.value=a,m.value=1}},y(a),11,lt)),64))])]),t[9]||(t[9]=o("div",{class:"filter-divider"},null,-1)),o("div",nt,[t[4]||(t[4]=o("span",{class:"filter-label"},"Difficult√©",-1)),o("div",rt,[(c(),u(q,null,R(L,a=>o("button",{key:a,class:T(["filter-btn",{active:a===F.value}]),onClick:n=>{F.value=a,m.value=1}},[a==="all"?(c(),u("span",ut,"Toutes")):(c(),u("span",dt,y(a==="easy"?"‚òÖ":a==="medium"?"‚òÖ‚òÖ":"‚òÖ‚òÖ‚òÖ"),1))],10,ct)),64))])]),t[10]||(t[10]=o("div",{class:"filter-divider"},null,-1)),o("div",pt,[t[6]||(t[6]=o("span",{class:"filter-label"},"Affichage",-1)),o("div",vt,[o("button",{class:T(["filter-btn","width-toggle-btn",{active:r.value}]),onClick:ue,title:r.value?"R√©duire la largeur":"Pleine largeur"},[r.value?(c(),u("span",ft,"üìê")):Q("",!0),Pe((c(),u("span",null,t[5]||(t[5]=[te("‚ÜîÔ∏è")]))),[[e]]),te(" "+y(r.value?"Normal":"Large"),1)],10,gt)])]),t[11]||(t[11]=o("div",{class:"filter-divider"},null,-1)),o("div",ht,[t[7]||(t[7]=o("span",{class:"filter-label"},"Export PDF",-1)),o("div",_t,[o("button",{class:"filter-btn pdf-btn",onClick:t[0]||(t[0]=a=>Z(!1)),disabled:f.value.length===0,title:"T√©l√©charger exercices sans correction"}," üìÑ √ânonc√©s ",8,mt),o("button",{class:"filter-btn pdf-btn",onClick:t[1]||(t[1]=a=>Z(!0)),disabled:f.value.length===0,title:"T√©l√©charger exercices avec correction"}," üìã Corrig√©s ",8,bt)])]),t[12]||(t[12]=o("div",{class:"filter-divider"},null,-1)),o("div",{class:"filter-item"},[t[8]||(t[8]=o("span",{class:"filter-label"},"Actions",-1)),o("div",{class:"filter-buttons"},[o("button",{class:"filter-btn pdf-btn",onClick:ie,title:"T√©l√©charger tous les exercices en PDF"}," üìÑ PDF ")])])])]),o("div",{class:T(["exercices-list",{"full-width":r.value}])},[(c(!0),u(q,null,R(le.value,a=>(c(),ee(qe,{key:a.id,eid:a.id,titre:a.titre||a.nom,instruction:a.instruction||a.contenu||a.question,solution:a.solution||a.reponse_correcte||"",etapes:a.etapes||"",difficulty:a.difficulty||a.difficulte||"medium",current:v.value[a.id]?.status,onStatusChanged:re},null,8,["eid","titre","instruction","solution","etapes","difficulty","current"]))),128)),M(Me,{total:f.value.length,perPage:p.value,page:m.value,"onUpdate:page":ne},null,8,["total","perPage","page"])],2)]))])]),_:1})}}},Tt=oe(yt,[["__scopeId","data-v-28842bdf"]]);export{Tt as default};
