import{a as d,c as C,B as E,b as r,d as t,g as w,k as s,K as p,L as _,F as g,p as h,t as u,w as M,o as i,h as j,u as I}from"./vendor-D171CWhe.js";import{_ as O}from"./index-D9PhsPPd.js";import{a as T,g as q,u as G,j as K,k as P}from"./curriculum-DO8U7dOZ.js";import{A as z}from"./AdminActionsButtons-BTlG4wzv.js";import"./ui-jaH5oyHW.js";import"./pdf-B39ievqC.js";import"./mathlive-B5k0jhbN.js";const H={class:"form-group"},J=["value"],Q={class:"form-group"},R={class:"form-group"},W={class:"form-group"},X={class:"btn-primary",type:"submit"},Y={class:"filters"},Z={class:"filter-group"},$=["value"],ee={class:"admin-table"},te={key:0},oe={__name:"AdminChapitres",setup(ne){const y=d([]),a=d([]),v=d(""),c=d(""),l=d({id:null,nom:"",notion:"",description:"",ordre:0}),f=d({notion:""}),x=C(()=>{let o=y.value;return f.value.notion&&(o=o.filter(e=>e.notion==f.value.notion)),o.sort((e,n)=>(e.ordre||0)-(n.ordre||0))}),F=C(()=>{if(!v.value)return a.value;const o=v.value.toLowerCase();return a.value.filter(e=>m(e).toLowerCase().includes(o))}),k=C(()=>{if(!c.value)return a.value;const o=c.value.toLowerCase();return a.value.filter(e=>m(e).toLowerCase().includes(o))});async function b(){try{const[o,e]=await Promise.all([T(),q()]);y.value=o||[],a.value=e||[]}catch{y.value=[],a.value=[]}}E(b);function N(){l.value={id:null,nom:"",notion:"",description:"",ordre:0}}async function A(){if(!(!l.value.nom||!l.value.notion))try{const o={nom:l.value.nom,notion:Number(l.value.notion),description:l.value.description,ordre:l.value.ordre,contenu:""};l.value.id?await G(l.value.id,o):await K(o);const e=l.value.notion;N(),l.value.notion=e,await b()}catch{}}function V(o){l.value={...o,notion:o.notion}}function m(o){if(!o)return"";const e=o.matiere_nom||o.contexte_detail&&o.contexte_detail.matiere_nom||"",n=o.contexte_detail&&o.contexte_detail.pays?o.contexte_detail.pays.nom:"",U=o.contexte_detail&&o.contexte_detail.niveau?o.contexte_detail.niveau.nom:"",S=o.theme_nom||"";return[o.nom,S,e,[n,U].filter(Boolean).join(" - ")].filter(Boolean).join(" — ")}function B(o){const e=a.value.find(n=>String(n.id)===String(o));return m(e)}async function D(o){try{await P(o),await b()}catch{}}function L(o){D(o.id)}return(o,e)=>(i(),r("div",null,[e[16]||(e[16]=t("h2",{class:"admin-title"},"Gestion des Chapitres",-1)),t("form",{class:"admin-form",onSubmit:M(A,["prevent"])},[t("div",H,[e[8]||(e[8]=t("label",null,"Notion (hérite du contexte via Thème):",-1)),s(t("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>v.value=n),type:"text",placeholder:"Filtrer les notions...",class:"filter-input"},null,512),[[p,v.value]]),s(t("select",{"onUpdate:modelValue":e[1]||(e[1]=n=>l.value.notion=n),required:""},[e[7]||(e[7]=t("option",{value:""},"Choisir une notion",-1)),(i(!0),r(g,null,h(F.value,n=>(i(),r("option",{key:n.id,value:n.id},u(m(n)),9,J))),128))],512),[[_,l.value.notion]])]),t("div",Q,[e[9]||(e[9]=t("label",null,"Nom du chapitre:",-1)),s(t("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>l.value.nom=n),placeholder:"Nom du chapitre",required:""},null,512),[[p,l.value.nom]])]),t("div",R,[e[10]||(e[10]=t("label",null,"Description:",-1)),s(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=n=>l.value.description=n),rows:"3"},null,512),[[p,l.value.description]])]),t("div",W,[e[11]||(e[11]=t("label",null,"Ordre d'affichage:",-1)),s(t("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>l.value.ordre=n),type:"number",min:"0"},null,512),[[p,l.value.ordre,void 0,{number:!0}]])]),t("button",X,u(l.value.id?"Mettre à jour":"Créer"),1),l.value.id?(i(),r("button",{key:0,class:"btn-secondary",type:"button",onClick:N},"Annuler")):w("",!0)],32),t("div",Y,[t("div",Z,[e[13]||(e[13]=t("label",null,"Filtrer par notion:",-1)),s(t("input",{"onUpdate:modelValue":e[5]||(e[5]=n=>c.value=n),type:"text",placeholder:"Filtrer les notions...",class:"filter-input"},null,512),[[p,c.value]]),s(t("select",{"onUpdate:modelValue":e[6]||(e[6]=n=>f.value.notion=n)},[e[12]||(e[12]=t("option",{value:""},"Toutes les notions",-1)),(i(!0),r(g,null,h(k.value,n=>(i(),r("option",{key:n.id,value:n.id},u(m(n)),9,$))),128))],512),[[_,f.value.notion]])])]),t("table",ee,[e[15]||(e[15]=t("thead",null,[t("tr",null,[t("th",null,"ID"),t("th",null,"Nom du chapitre"),t("th",null,"Notion"),t("th",null,"Ordre"),t("th",null,"Actions")])],-1)),t("tbody",null,[(i(!0),r(g,null,h(x.value,n=>(i(),r("tr",{key:n.id},[t("td",null,u(n.id),1),t("td",null,u(n.nom),1),t("td",null,u(B(n.notion)),1),t("td",null,u(n.ordre||0),1),t("td",null,[j(I(z),{item:n,actions:["edit","delete"],"edit-label":"Éditer","confirm-message":"Êtes-vous sûr de vouloir supprimer ce chapitre ?",onEdit:V,onDelete:L},null,8,["item"])])]))),128)),x.value.length===0?(i(),r("tr",te,e[14]||(e[14]=[t("td",{colspan:"5",style:{"text-align":"center","font-style":"italic"}},"Aucun chapitre trouvé.",-1)]))):w("",!0)])])]))}},pe=O(oe,[["__scopeId","data-v-d334b35d"]]);export{pe as default};
