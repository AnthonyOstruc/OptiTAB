import{a as v,c as V,A as ce,b as a,d as t,g as h,k as f,L as E,F as w,p as b,j as C,t as r,B as _,w as O,n as j,H as me,o as s,h as ve,u as pe}from"./vendor-CPU10QdV.js";import{g as fe,a as ge,r as ye,u as H,c as W,d as Ce}from"./scientificRenderer-BIHedVTI.js";import{_ as he}from"./index-BhTphZWV.js";import{a as we,g as be}from"./curriculum-DPSaZDuo.js";import{A as xe}from"./AdminActionsButtons-ClSGDHPQ.js";import"./ui-es3YBeq-.js";import"./pdf-OEFxGcL4.js";import"./mathlive-B5k0jhbN.js";const Ne={class:"form-group"},_e=["value"],Ae={key:0,class:"context-panel"},Me={class:"context-row"},ke={class:"context-row"},Ie={class:"context-row"},Te={class:"context-row"},De={class:"context-row"},Se={class:"context-row"},Ee={class:"form-group"},$e={class:"form-group"},Le={class:"form-group"},Ue={key:0,class:"selected-images"},Ve=["src","alt"],je={class:"image-name"},Be=["onClick"],Pe={class:"form-group"},ze={class:"form-group"},Fe={class:"btn-primary",type:"submit"},Ge={key:0,class:"preview-section"},Re={class:"preview-item"},qe={key:0,class:"preview-image-info"},Oe={class:"image-indicator"},He={class:"image-status-list"},We={class:"preview-cours"},Xe={class:"preview-header"},Je={class:"ordre-badge"},Ye=["innerHTML"],Ze={class:"filters"},Ke={class:"filter-group"},Qe=["value"],et={class:"filter-group"},tt={class:"admin-table"},it={class:"ctx-cell"},nt={key:0},lt={class:"modal-description"},ot={class:"modal-form"},rt={class:"form-group"},at=["value"],st={class:"form-group"},ut={class:"modal-actions"},dt=["disabled"],ct=10*1024*1024,mt={__name:"AdminCours",setup(vt){const X=["image/jpeg","image/jpg","image/png","image/gif","image/webp","image/svg+xml"],A=v([]),p=v([]),$=v([]),l=v({id:null,chapitre:"",titre:"",contenu:"",ordre:0,difficulte:"moyen"}),g=v({chapitre:"",nom:""}),M=v(!1),d=v(null),y=v([]),L=v(null),k=v(!1),u=v({originalCours:null,newChapitre:"",newTitre:""}),B=V(()=>{let n=A.value;return g.value.chapitre&&(n=n.filter(e=>e.chapitre==g.value.chapitre)),g.value.nom&&(n=n.filter(e=>e.titre.toLowerCase().includes(g.value.nom.toLowerCase()))),n.sort((e,i)=>(e.ordre||0)-(i.ordre||0))});async function I(){try{const[n,e,i]=await Promise.all([we(),be(),fe()]);p.value=Array.isArray(n)?n:n?.data||[],$.value=Array.isArray(e)?e:e?.data||[],A.value=Array.isArray(i?.data)?i.data:Array.isArray(i)?i:[]}catch{A.value=[],p.value=[],$.value=[]}}ce(I);function P(){l.value={id:null,chapitre:"",titre:"",contenu:"",ordre:0,difficulte:"moyen"},M.value=!1,d.value=null,y.value=[],L.value&&(L.value.value="")}function J(n){Array.from(n.target.files).forEach(i=>{try{if(!X.includes(i.type)){alert(`Type de fichier non support√©: ${i.name}. Utilisez JPG, PNG, GIF, WebP ou SVG.`);return}if(i.size>ct){alert(`Fichier trop volumineux: ${i.name}. Taille maximale: 10MB.`);return}y.value.push(i)}catch{alert(`Erreur lors de l'ajout de ${i.name}`)}})}function Y(n){y.value.splice(n,1)}function Z(n){return URL.createObjectURL(n)}function K(n){return{easy:"Facile",medium:"Moyen",hard:"Difficile"}[n]||n}async function Q(){if(!(!l.value.chapitre||!l.value.titre||!l.value.contenu))try{const n={facile:"easy",moyen:"medium",difficile:"hard"},e={chapitre:Number(l.value.chapitre),titre:l.value.titre,contenu:l.value.contenu,ordre:l.value.ordre,difficulty:n[l.value.difficulte]||"medium"};l.value.id?await H(l.value.id,e):await W(e),P(),await I()}catch{}}function ee(n){const e={easy:"facile",medium:"moyen",hard:"difficile"},i=n.difficulte||n.difficulty||"medium",o=e[i]||"moyen";l.value={id:n.id,chapitre:n.chapitre,titre:n.titre||"",contenu:n.contenu||"",ordre:n.ordre||0,difficulte:o},M.value=!1,d.value=null}async function te(n){try{await Ce(n),await I()}catch{}}function ie(n){te(n.id)}function ne(n){u.value={originalCours:n,newChapitre:"",newTitre:`${n.titre}`},k.value=!0}async function le(){if(!u.value.newChapitre||!u.value.newTitre.trim()){alert("Veuillez s√©lectionner un chapitre et saisir un titre pour la copie.");return}try{const n=u.value.originalCours,e={facile:"easy",moyen:"medium",difficile:"hard"},i={chapitre:Number(u.value.newChapitre),titre:u.value.newTitre.trim(),contenu:n.contenu,ordre:n.ordre||0,difficulty:n.difficulty||e[n.difficulte]||"medium"},o=A.value.find(c=>c.chapitre==u.value.newChapitre);if(o){if(!confirm(`Le chapitre "${F(u.value.newChapitre)}" a d√©j√† un cours.

Titre actuel: "${o.titre}"
Nouveau titre: "${u.value.newTitre.trim()}"

Voulez-vous remplacer le cours existant ?`))return;await H(o.id,i)}else await W(i);await I(),k.value=!1,u.value={originalCours:null,newChapitre:"",newTitre:""},alert("Cours dupliqu√© avec succ√®s !")}catch{alert("Erreur lors de la duplication du cours.")}}function z(){k.value=!1,u.value={originalCours:null,newChapitre:"",newTitre:""}}function oe(){if(!l.value.titre||!l.value.contenu){alert("Veuillez remplir au moins le titre et le contenu pour pr√©visualiser");return}const n=y.value.map(e=>e.name).join(",");d.value={titre:l.value.titre,contenu:l.value.contenu,ordre:l.value.ordre||0,difficulte:l.value.difficulte||"moyen",difficulty:l.value.difficulte==="facile"?"easy":l.value.difficulte==="moyen"?"medium":"hard",image:n,images:y.value},M.value=!0,me(()=>{ye()})}function F(n){const e=p.value.find(i=>String(i.id)===String(n));return e?e.nom:n}function T(n){return $.value.find(e=>String(e.id)===String(n))}function D(n){if(!n)return null;const e=T(n.notion);if(!e)return{themeNom:"",matiereNom:"",paysNom:"",niveauNom:""};const i=e.matiere_nom||e.contexte_detail&&e.contexte_detail.matiere_nom||"",o=e.theme_nom||"",c=e.contexte_detail&&e.contexte_detail.pays?e.contexte_detail.pays.nom:"",m=e.contexte_detail&&e.contexte_detail.niveau?e.contexte_detail.niveau.nom:"";return{matiereNom:i,themeNom:o,paysNom:c,niveauNom:m}}const x=V(()=>{const n=p.value.find(e=>String(e.id)===String(l.value.chapitre));return n?D(n):null});function re(n,e=null){return(n||"").split(",").map(o=>o.trim()).filter(Boolean).map((o,c)=>{const m=S(o);return{id:`preview-${c}`,image:m?URL.createObjectURL(m):o,image_type:"illustration",position:c+1}})}function S(n){return y.value.find(e=>e.name===n)}function ae(n){const e=re(n.image,n);let i=n.contenu;const o=(n.image||"").split(",").map(c=>c.trim()).filter(Boolean);return i=i.replace(/\[IMAGE_(\d+)\]/g,(c,m)=>{const de=parseInt(m)-1,U=o[de],q=S(U);return q?`
        <div class="preview-image-container" style="text-align: center; margin: 2em 0;">
          <img src="${URL.createObjectURL(q)}" alt="Image ${m}" class="preview-image" style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);" />
          <div class="image-info" style="margin-top: 0.5rem; font-size: 0.875rem; color: #28a745; font-weight: 500;">‚úÖ ${U}</div>
        </div>
      `:`
        <div class="preview-image-placeholder">
          <div class="placeholder-icon">üñºÔ∏è</div>
          <div class="placeholder-text">Image manquante: ${U||`IMAGE_${m}`}</div>
          <div class="placeholder-hint">Uploadez cette image dans la section ci-dessus</div>
        </div>
      `}),ge(i,e)}const se=V(()=>d.value?.contenu?ae(d.value):"");function G(n){const e=T(n.notion),i=D(n);return[n.nom,e?`‚Äî ${e.nom}`:"",i&&i.matiereNom?`‚Äî ${i.matiereNom}`:"",i&&(i.paysNom||i.niveauNom)?`‚Äî ${[i.paysNom,i.niveauNom].filter(Boolean).join(" ¬∑ ")}`:""].filter(Boolean).join(" ")}function N(n){return String(n||"").normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"")}function R(n){const e=p.value.find(m=>String(m.id)===String(n));if(!e)return"";const i=T(e.notion),o=D(e);return[o?.matiereNom,o?.themeNom,i?.nom,e.nom,o?.paysNom,o?.niveauNom].filter(Boolean).join(" ‚Ä∫ ")}function ue(n){const e=p.value.find(m=>String(m.id)===String(n));if(!e)return"";const i=T(e.notion),o=D(e);return[N(i?.nom),N(o?.themeNom),N(o?.matiereNom),N(o?.paysNom),N(o?.niveauNom)].filter(Boolean).join("_")}return(n,e)=>(s(),a("div",null,[e[44]||(e[44]=t("h2",{class:"admin-title"},"Gestion des Cours",-1)),t("form",{class:"admin-form",onSubmit:O(Q,["prevent"])},[t("div",Ne,[e[11]||(e[11]=t("label",null,"Chapitre:",-1)),f(t("select",{"onUpdate:modelValue":e[0]||(e[0]=i=>l.value.chapitre=i),required:""},[e[10]||(e[10]=t("option",{value:""},"Choisir un chapitre",-1)),(s(!0),a(w,null,b(p.value,i=>(s(),a("option",{key:i.id,value:i.id},r(G(i)),9,_e))),128))],512),[[E,l.value.chapitre]])]),x.value?(s(),a("div",Ae,[t("div",Me,[e[12]||(e[12]=t("strong",null,"Mati√®re:",-1)),e[13]||(e[13]=C()),t("span",null,r(x.value.matiereNom||"‚Äî"),1)]),t("div",ke,[e[14]||(e[14]=t("strong",null,"Th√®me:",-1)),e[15]||(e[15]=C()),t("span",null,r(x.value.themeNom||"‚Äî"),1)]),t("div",Ie,[e[16]||(e[16]=t("strong",null,"Pays:",-1)),e[17]||(e[17]=C()),t("span",null,r(x.value.paysNom||"‚Äî"),1)]),t("div",Te,[e[18]||(e[18]=t("strong",null,"Niveau:",-1)),e[19]||(e[19]=C()),t("span",null,r(x.value.niveauNom||"‚Äî"),1)]),t("div",De,[e[20]||(e[20]=t("strong",null,"Chemin:",-1)),e[21]||(e[21]=C()),t("span",null,r(R(l.value.chapitre)),1)]),t("div",Se,[e[22]||(e[22]=t("strong",null,"Code:",-1)),e[23]||(e[23]=C()),t("code",null,r(ue(l.value.chapitre)),1)])])):h("",!0),t("div",Ee,[e[24]||(e[24]=t("label",null,"Titre du cours:",-1)),f(t("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>l.value.titre=i),placeholder:"Titre du cours",required:""},null,512),[[_,l.value.titre]])]),t("div",$e,[e[25]||(e[25]=t("label",null,"Contenu:",-1)),f(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=i=>l.value.contenu=i),rows:"6",required:""},null,512),[[_,l.value.contenu]]),e[26]||(e[26]=t("small",{style:{color:"#666","font-size":"0.875rem"}}," Supporte HTML, LaTeX ($formule$), et images avec [IMAGE_1], [IMAGE_2], etc. ",-1))]),t("div",Le,[e[28]||(e[28]=t("label",null,"Images (optionnel):",-1)),t("input",{type:"file",ref_key:"imagesInput",ref:L,onChange:J,accept:"image/*",multiple:"",class:"images-file-input"},null,544),e[29]||(e[29]=t("small",{style:{color:"#666","font-size":"0.875rem"}}," S√©lectionnez les images qui seront r√©f√©renc√©es dans le contenu avec [IMAGE_1], [IMAGE_2], etc. ",-1)),y.value.length>0?(s(),a("div",Ue,[e[27]||(e[27]=t("h5",null,"Images s√©lectionn√©es :",-1)),(s(!0),a(w,null,b(y.value,(i,o)=>(s(),a("div",{key:o,class:"selected-image-item"},[t("img",{src:Z(i),alt:i.name,class:"image-preview"},null,8,Ve),t("span",je,r(i.name),1),t("button",{type:"button",class:"btn-remove",onClick:c=>Y(o)},"√ó",8,Be)]))),128))])):h("",!0)]),t("div",Pe,[e[30]||(e[30]=t("label",null,"Ordre d'affichage:",-1)),f(t("input",{"onUpdate:modelValue":e[3]||(e[3]=i=>l.value.ordre=i),type:"number",min:"0"},null,512),[[_,l.value.ordre,void 0,{number:!0}]])]),t("div",ze,[e[32]||(e[32]=t("label",null,"Difficult√©:",-1)),f(t("select",{"onUpdate:modelValue":e[4]||(e[4]=i=>l.value.difficulte=i)},e[31]||(e[31]=[t("option",{value:"facile"},"Facile",-1),t("option",{value:"moyen"},"Moyen",-1),t("option",{value:"difficile"},"Difficile",-1)]),512),[[E,l.value.difficulte]])]),t("button",Fe,r(l.value.id?"Mettre √† jour":"Cr√©er"),1),l.value.id?(s(),a("button",{key:1,class:"btn-secondary",type:"button",onClick:P},"Annuler")):h("",!0),t("button",{class:"btn-secondary",type:"button",onClick:oe},"Pr√©visualiser")],32),M.value&&d.value?(s(),a("div",Ge,[t("h3",null,"Aper√ßu du cours "+r(l.value.id?"(Mode √©dition)":"(Mode cr√©ation)"),1),t("div",Re,[t("h4",null,r(d.value.titre),1),d.value.image?(s(),a("div",qe,[t("span",Oe,"üñºÔ∏è Images: "+r(d.value.image),1),t("div",He,[(s(!0),a(w,null,b(d.value.image.split(",").map(i=>i.trim()).filter(Boolean),i=>(s(),a("span",{key:i,class:j(["image-status",S(i)?"available":"missing"])},r(i)+": "+r(S(i)?"‚úÖ Disponible":"‚ùå Manquante - Assurez-vous d'avoir upload√© cette image"),3))),128))])])):h("",!0),t("div",We,[t("div",Xe,[t("span",{class:j(["difficulty-badge",d.value.difficulty])},r(K(d.value.difficulty)),3),t("span",Je,"Ordre: "+r(d.value.ordre),1)]),t("div",{class:"preview-content",innerHTML:se.value},null,8,Ye)])])])):h("",!0),t("div",Ze,[t("div",Ke,[e[34]||(e[34]=t("label",null,"Filtrer par chapitre:",-1)),f(t("select",{"onUpdate:modelValue":e[5]||(e[5]=i=>g.value.chapitre=i)},[e[33]||(e[33]=t("option",{value:""},"Tous les chapitres",-1)),(s(!0),a(w,null,b(p.value,i=>(s(),a("option",{key:i.id,value:i.id},r(i.nom)+" ("+r(i.notion_nom)+") ",9,Qe))),128))],512),[[E,g.value.chapitre]])]),t("div",et,[e[35]||(e[35]=t("label",null,"Rechercher:",-1)),f(t("input",{"onUpdate:modelValue":e[6]||(e[6]=i=>g.value.nom=i),type:"text",placeholder:"Rechercher dans le titre..."},null,512),[[_,g.value.nom]])])]),t("table",tt,[e[37]||(e[37]=t("thead",null,[t("tr",null,[t("th",null,"ID"),t("th",null,"Titre"),t("th",null,"Chapitre"),t("th",null,"Contexte"),t("th",null,"Ordre"),t("th",null,"Difficult√©"),t("th",null,"Actions")])],-1)),t("tbody",null,[(s(!0),a(w,null,b(B.value,i=>(s(),a("tr",{key:i.id},[t("td",null,r(i.id),1),t("td",null,r(i.titre),1),t("td",null,r(F(i.chapitre)),1),t("td",it,r(R(i.chapitre)),1),t("td",null,r(i.ordre||0),1),t("td",null,[t("span",{class:j(["difficulte-badge",`difficulte-${i.difficulte||i.difficulty||"moyen"}`])},r(i.difficulte||i.difficulty||"moyen"),3)]),t("td",null,[ve(pe(xe),{item:i,actions:["edit","duplicate","delete"],"edit-label":"√âditer","duplicate-label":"Dupliquer","confirm-message":"√ätes-vous s√ªr de vouloir supprimer ce cours ?",onEdit:ee,onDuplicate:ne,onDelete:ie},null,8,["item"])])]))),128)),B.value.length===0?(s(),a("tr",nt,e[36]||(e[36]=[t("td",{colspan:"7",style:{"text-align":"center","font-style":"italic"}},"Aucun cours trouv√©.",-1)]))):h("",!0)])]),k.value?(s(),a("div",{key:1,class:"modal-overlay",onClick:z},[t("div",{class:"modal-content",onClick:e[9]||(e[9]=O(()=>{},["stop"]))},[e[43]||(e[43]=t("h3",null,"Dupliquer le cours",-1)),t("p",lt,[e[38]||(e[38]=C(' Cr√©er une copie de "')),t("strong",null,r(u.value.originalCours?.titre),1),e[39]||(e[39]=C('" '))]),t("div",ot,[t("div",rt,[e[41]||(e[41]=t("label",null,"Nouveau chapitre:",-1)),f(t("select",{"onUpdate:modelValue":e[7]||(e[7]=i=>u.value.newChapitre=i),required:""},[e[40]||(e[40]=t("option",{value:""},"Choisir un chapitre",-1)),(s(!0),a(w,null,b(p.value,i=>(s(),a("option",{key:i.id,value:i.id},r(G(i)),9,at))),128))],512),[[E,u.value.newChapitre]])]),t("div",st,[e[42]||(e[42]=t("label",null,"Nouveau titre:",-1)),f(t("input",{"onUpdate:modelValue":e[8]||(e[8]=i=>u.value.newTitre=i),placeholder:"Titre de la copie",required:""},null,512),[[_,u.value.newTitre]])])]),t("div",ut,[t("button",{class:"btn-secondary",onClick:z},"Annuler"),t("button",{class:"btn-primary",onClick:le,disabled:!u.value.newChapitre||!u.value.newTitre.trim()}," Dupliquer ",8,dt)])])])):h("",!0)]))}},xt=he(mt,[["__scopeId","data-v-0118ab88"]]);export{xt as default};
