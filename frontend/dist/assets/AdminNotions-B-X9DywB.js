import{a as u,c as _,B as M,C as B,b as a,d as n,g as k,k as d,K as v,L as N,F as g,p as w,t as r,w as E,o as i,m as O,h as q,u as I}from"./vendor-D171CWhe.js";import{g as j,u as z,c as G,d as K}from"./notions-C-ObNzpI.js";import{g as P}from"./themes-THNwa3Vc.js";import{g as R}from"./matiere-contextes-DbkYd_BX.js";import{_ as H}from"./index-lv_OcPRH.js";import"./PaysNiveauxSelector.vue_vue_type_style_index_0_scoped_6652d9f9_lang-l0sNRNKZ.js";import"./PaysNiveauxDisplay.vue_vue_type_style_index_0_scoped_821033d6_lang-l0sNRNKZ.js";import{A as J}from"./AdminActionsButtons-CuAf-izV.js";import"./ui-jaH5oyHW.js";import"./pdf-B39ievqC.js";import"./mathlive-B5k0jhbN.js";const Q={class:"form-group"},W=["value"],X={class:"form-group"},Y={class:"form-group"},Z={class:"btn-primary",type:"submit"},ee={class:"filters"},te={class:"filter-group"},oe=["value"],ne={class:"filter-group"},le=["value"],re={class:"admin-table"},ae={key:1,class:"no-theme"},ie={key:0},se={__name:"AdminNotions",setup(ue){const C=u([]),m=u([]),p=u([]),c=u(""),f=u(""),x=u(""),l=u({id:null,nom:"",theme:"",niveaux:[],ordre:0}),s=u({theme:"",contexte:""}),A=_(()=>{if(!c.value)return p.value;const o=c.value.toLowerCase();return p.value.filter(e=>e.matiere_nom.toLowerCase().includes(o)||e.pays?.nom.toLowerCase().includes(o)||e.niveau?.nom.toLowerCase().includes(o)||`${e.matiere_nom} — ${e.pays?.nom} - ${e.niveau?.nom}`.toLowerCase().includes(o))}),S=_(()=>{let o=m.value;if(s.value.contexte&&(o=o.filter(e=>String(e.contexte)===String(s.value.contexte))),f.value){const e=f.value.toLowerCase();o=o.filter(t=>t.nom.toLowerCase().includes(e)||t.contexte_detail?.matiere_nom.toLowerCase().includes(e)||t.contexte_detail?.pays?.nom.toLowerCase().includes(e)||t.contexte_detail?.niveau?.nom.toLowerCase().includes(e)||`${t.nom} — ${t.contexte_detail?.matiere_nom} — ${t.contexte_detail?.pays?.nom} - ${t.contexte_detail?.niveau?.nom}`.toLowerCase().includes(e))}return o}),V=_(()=>{if(!x.value)return m.value;const o=x.value.toLowerCase();return m.value.filter(e=>e.nom.toLowerCase().includes(o)||e.contexte_detail?.matiere_nom.toLowerCase().includes(o)||e.contexte_detail?.pays?.nom.toLowerCase().includes(o)||e.contexte_detail?.niveau?.nom.toLowerCase().includes(o)||`${e.nom} — ${e.contexte_detail?.matiere_nom} — ${e.contexte_detail?.pays?.nom} - ${e.contexte_detail?.niveau?.nom}`.toLowerCase().includes(o))}),L=_(()=>{let o=C.value;return s.value.contexte&&(o=o.filter(e=>{const t=m.value.find(y=>y.id===e.theme);return t&&String(t.contexte)===String(s.value.contexte)})),s.value.theme&&(o=o.filter(e=>String(e.theme)===String(s.value.theme))),[...o].sort((e,t)=>{const y=Number(e?.ordre??0),F=Number(t?.ordre??0);return y!==F?y-F:String(e?.nom||"").localeCompare(String(t?.nom||""))})});async function b(){try{const[{data:o},{data:e},t]=await Promise.all([j(),P(),R()]);C.value=o||[],m.value=e||[],p.value=Array.isArray(t)?t:t?.data||[]}catch{C.value=[],m.value=[],p.value=[]}}M(b),B(()=>s.value.contexte,(o,e)=>{o!==e&&(s.value.theme="")});function h(){l.value={id:null,nom:"",theme:"",niveaux:[],ordre:0}}async function $(){if(!(!l.value.nom||!l.value.theme))try{const o={nom:l.value.nom,theme:Number(l.value.theme),niveaux:[],ordre:l.value.ordre};l.value.id?await z(l.value.id,o):await G(o);const e=l.value.theme;h(),l.value.theme=e,await b()}catch{}}function T(o){o.niveaux&&o.niveaux.map(e=>e.id),l.value={id:o.id,nom:o.nom,theme:o.theme||"",niveaux:[],ordre:o.ordre||0}}async function U(o){try{await K(o),await b()}catch{}}function D(o){U(o.id)}return(o,e)=>(i(),a("div",null,[e[18]||(e[18]=n("h2",{class:"admin-title"},"Gestion des Notions",-1)),n("form",{class:"admin-form",onSubmit:E($,["prevent"])},[n("div",Q,[e[9]||(e[9]=n("label",null,"Thème (lié à un contexte Matière + Niveau):",-1)),d(n("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>x.value=t),type:"text",placeholder:"Filtrer les thèmes...",class:"filter-input"},null,512),[[v,x.value]]),d(n("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.theme=t),required:""},[e[8]||(e[8]=n("option",{value:""},"Choisir un thème",-1)),(i(!0),a(g,null,w(V.value,t=>(i(),a("option",{key:t.id,value:t.id},r(t.nom)+" — "+r(t.contexte_detail?.matiere_nom)+" — "+r(t.contexte_detail?.pays?.nom)+" - "+r(t.contexte_detail?.niveau?.nom),9,W))),128))],512),[[N,l.value.theme]])]),n("div",X,[e[10]||(e[10]=n("label",null,"Nom de la notion:",-1)),d(n("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>l.value.nom=t),placeholder:"Nom de la notion",required:""},null,512),[[v,l.value.nom]])]),n("div",Y,[e[11]||(e[11]=n("label",null,"Ordre d'affichage:",-1)),d(n("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.ordre=t),type:"number",min:"0"},null,512),[[v,l.value.ordre,void 0,{number:!0}]])]),n("button",Z,r(l.value.id?"Mettre à jour":"Créer"),1),l.value.id?(i(),a("button",{key:0,class:"btn-secondary",type:"button",onClick:h},"Annuler")):k("",!0)],32),n("div",ee,[n("div",te,[e[13]||(e[13]=n("label",null,"Filtrer par contexte:",-1)),d(n("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>c.value=t),type:"text",placeholder:"Filtrer les contextes...",class:"filter-input"},null,512),[[v,c.value]]),d(n("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>s.value.contexte=t)},[e[12]||(e[12]=n("option",{value:""},"Tous les contextes",-1)),(i(!0),a(g,null,w(A.value,t=>(i(),a("option",{key:t.id,value:t.id},r(t.matiere_nom)+" — "+r(t.pays.nom)+" - "+r(t.niveau.nom),9,oe))),128))],512),[[N,s.value.contexte]])]),n("div",ne,[e[15]||(e[15]=n("label",null,"Filtrer par thème:",-1)),d(n("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>f.value=t),type:"text",placeholder:"Filtrer les thèmes...",class:"filter-input"},null,512),[[v,f.value]]),d(n("select",{"onUpdate:modelValue":e[7]||(e[7]=t=>s.value.theme=t)},[e[14]||(e[14]=n("option",{value:""},"Tous les thèmes",-1)),(i(!0),a(g,null,w(S.value,t=>(i(),a("option",{key:t.id,value:t.id},r(t.nom)+" — "+r(t.contexte_detail?.matiere_nom)+" — "+r(t.contexte_detail?.pays?.nom)+" - "+r(t.contexte_detail?.niveau?.nom),9,le))),128))],512),[[N,s.value.theme]])])]),n("table",re,[e[17]||(e[17]=n("thead",null,[n("tr",null,[n("th",null,"ID"),n("th",null,"Ordre"),n("th",null,"Nom de la notion"),n("th",null,"Thème"),n("th",null,"Actions")])],-1)),n("tbody",null,[(i(!0),a(g,null,w(L.value,t=>(i(),a("tr",{key:t.id},[n("td",null,r(t.id),1),n("td",null,r(t.ordre||0),1),n("td",null,r(t.nom),1),n("td",null,[t.theme_nom?(i(),a("span",{key:0,class:"theme-badge",style:O({backgroundColor:t.theme_couleur,color:"#fff"})},r(t.theme_nom),5)):(i(),a("span",ae,"Aucun thème"))]),n("td",null,[q(I(J),{item:t,actions:["edit","delete"],"edit-label":"Éditer","confirm-message":"Êtes-vous sûr de vouloir supprimer cette notion ?",onEdit:T,onDelete:D},null,8,["item"])])]))),128)),L.value.length===0?(i(),a("tr",ie,e[16]||(e[16]=[n("td",{colspan:"5",style:{"text-align":"center","font-style":"italic"}},"Aucune notion trouvée.",-1)]))):k("",!0)])])]))}},Ce=H(se,[["__scopeId","data-v-b4376f6f"]]);export{Ce as default};
