import{b as i,i as k,d as s,t as l,k as E,w as P,o as n,j as q,l as S,F as x,s as C,C as B,g as V,a as y,c as h,e as K,q as L,n as Q,m as g,K as M,M as J,p as R}from"./vendor-1gmgAmFu.js";import{_ as T,l as W,m as X}from"./index-DCsGFNRY.js";import{A as Y}from"./AdminActionsButtons-DwhEeVfZ.js";import{a as Z,u as $,c as ss,d as es}from"./niveaux-BQxLp9oM.js";import"./ui-jaH5oyHW.js";import"./pdf-B39ievqC.js";import"./mathlive-B5k0jhbN.js";const os={class:"modal-header"},as={class:"modal-body"},ts={key:0,class:"modal-footer"},ls={__name:"SimpleModal",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Modal"}},emits:["close"],setup(d,{emit:e}){const b=e,o=()=>{b("close")};return(v,p)=>d.isOpen?(n(),i("div",{key:0,class:"modal-overlay",onClick:o},[s("div",{class:"modal-content",onClick:p[0]||(p[0]=P(()=>{},["stop"]))},[s("div",os,[s("h3",null,l(d.title),1),s("button",{onClick:o,class:"close-btn"},"×")]),s("div",as,[E(v.$slots,"default",{},void 0,!0)]),v.$slots.footer?(n(),i("div",ts,[E(v.$slots,"footer",{},void 0,!0)])):k("",!0)])])):k("",!0)}},rs=T(ls,[["__scopeId","data-v-57ebf5bf"]]),is={name:"AdminNiveaux",components:{SimpleModal:rs,AdminActionsButtons:Y},setup(){const{showToast:d}=W(),e=y([]),b=y([]),o=y(!1),v=y(!1),p=y(!1),_=y(!1),f=y({nom:"",description:"",pays:null,ordre:0,couleur:"#3b82f6",est_actif:!0}),t=h(()=>e.value.filter(a=>a.est_actif).length),r=h(()=>e.value.reduce((a,c)=>a+(c.statistiques?.matieres||0),0)),U=h(()=>e.value.reduce((a,c)=>a+(c.statistiques?.cours||0),0)),z=h(()=>{const a=new Map;for(const u of e.value){const m=u.pays??`p-${u.pays_nom}`;a.has(m)||a.set(m,{pays_id:u.pays??m,pays_nom:u.pays_nom||"Pays",pays_drapeau:u.pays_drapeau||"",niveaux:[]}),a.get(m).niveaux.push(u)}const c=Array.from(a.values()).sort((u,m)=>u.pays_nom.localeCompare(m.pays_nom));return c.forEach(u=>u.niveaux.sort((m,H)=>(m.ordre??0)-(H.ordre??0))),c}),N=async()=>{try{o.value=!0;const a=await Z();e.value=Array.isArray(a)?a:a?.results||[]}catch{d("Erreur lors du chargement des niveaux","error")}finally{o.value=!1}},w=async()=>{try{const a=await X();b.value=a}catch{d("Erreur lors du chargement des pays","error")}},O=async()=>{await w(),p.value=!0},I=async a=>{await w(),f.value={id:a.id,nom:a.nom,description:a.description||"",pays:a.pays||null,ordre:a.ordre,couleur:a.couleur,est_actif:a.est_actif},_.value=!0},F=async()=>{try{if(v.value=!0,_.value){const{id:a,...c}=f.value;await $(a,c),d("Niveau modifié avec succès","success")}else await ss(f.value),d("Niveau créé avec succès","success");A(),N()}catch{d("Erreur lors de la sauvegarde","error")}finally{v.value=!1}},j=a=>{D(a.id)},G=a=>{D(a.id)},D=async a=>{try{await es(a),d("Niveau supprimé avec succès","success"),N()}catch{d("Erreur lors de la suppression","error")}},A=()=>{p.value=!1,_.value=!1,f.value={nom:"",description:"",pays:null,ordre:0,couleur:"#3b82f6",est_actif:!0}};return K(()=>{N()}),{niveaux:e,pays:b,loading:o,saving:v,showCreateModal:p,showEditModal:_,formData:f,niveauxActifs:t,totalMatieres:r,totalCours:U,niveauxByPays:z,openCreateModal:O,editNiveau:I,saveNiveau:F,confirmDeleteNiveau:j,handleDeleteNiveau:G,closeModal:A}}},ns={class:"admin-niveaux"},ds={class:"header"},us={key:0,class:"loading-state"},cs={key:1,class:"stats-grid"},vs={class:"stat-card"},ms={class:"stat-number"},ps={class:"stat-card"},fs={class:"stat-number"},ys={class:"stat-card"},_s={class:"stat-number"},gs={class:"stat-card"},bs={class:"stat-number"},hs={key:2},Ms={class:"pays-header"},Ns={class:"pays-title"},xs={class:"niveaux-list"},Cs={class:"niveau-header"},ks={class:"niveau-info"},ws={class:"niveau-actions"},Ds={class:"niveau-stats"},As={class:"stat-item"},Es={class:"stat-value"},qs={class:"stat-item"},Ss={class:"stat-value"},Bs={class:"stat-item"},Vs={class:"stat-value"},Ps={class:"stat-item"},Ts={class:"stat-value"},Us={class:"niveau-status"},zs={class:"ordre-badge"},Os={class:"form-group"},Is={class:"form-group"},Fs=["value"],js={class:"form-group"},Gs={class:"form-row"},Hs={class:"form-group"},Ks={class:"form-group"},Ls={class:"form-group"},Qs={class:"checkbox-label"},Js=["disabled"],Rs={key:0},Ws={key:1};function Xs(d,e,b,o,v,p){const _=V("AdminActionsButtons"),f=V("SimpleModal");return n(),i("div",ns,[s("div",ds,[e[11]||(e[11]=s("h1",null,"Gestion des Niveaux",-1)),s("button",{onClick:e[0]||(e[0]=(...t)=>o.openCreateModal&&o.openCreateModal(...t)),class:"btn-primary"},e[10]||(e[10]=[s("i",{class:"fas fa-plus"},null,-1),S(" Nouveau Niveau ")]))]),o.loading?(n(),i("div",us,e[12]||(e[12]=[s("div",{class:"spinner"},null,-1),s("p",null,"Chargement des niveaux...",-1)]))):(n(),i("div",cs,[s("div",vs,[e[13]||(e[13]=s("h3",null,"Total Niveaux",-1)),s("p",ms,l(o.niveaux.length),1)]),s("div",ps,[e[14]||(e[14]=s("h3",null,"Niveaux Actifs",-1)),s("p",fs,l(o.niveauxActifs),1)]),s("div",ys,[e[15]||(e[15]=s("h3",null,"Total Matières",-1)),s("p",_s,l(o.totalMatieres),1)]),s("div",gs,[e[16]||(e[16]=s("h3",null,"Total Cours",-1)),s("p",bs,l(o.totalCours),1)])])),o.loading?k("",!0):(n(),i("div",hs,[(n(!0),i(x,null,C(o.niveauxByPays,t=>(n(),i("div",{key:t.pays_id,class:"pays-group"},[s("div",Ms,[s("h2",Ns,l(t.pays_nom),1)]),s("div",xs,[(n(!0),i(x,null,C(t.niveaux,r=>(n(),i("div",{key:r.id,class:"niveau-card"},[s("div",Cs,[s("div",ks,[s("div",{class:"niveau-color",style:L({backgroundColor:r.couleur})},null,4),s("div",null,[s("h3",null,l(r.nom),1),s("p",null,l(r.description||"Aucune description"),1)])]),s("div",ws,[q(_,{item:r,actions:["edit","delete"],"edit-label":"Modifier","confirm-message":"Êtes-vous sûr de vouloir supprimer ce niveau ?",onEdit:o.editNiveau,onDelete:o.handleDeleteNiveau},null,8,["item","onEdit","onDelete"])])]),s("div",Ds,[s("div",As,[e[17]||(e[17]=s("span",{class:"stat-label"},"Matières:",-1)),s("span",Es,l(r.statistiques?.matieres||0),1)]),s("div",qs,[e[18]||(e[18]=s("span",{class:"stat-label"},"Cours:",-1)),s("span",Ss,l(r.statistiques?.cours||0),1)]),s("div",Bs,[e[19]||(e[19]=s("span",{class:"stat-label"},"Exercices:",-1)),s("span",Vs,l(r.statistiques?.exercices||0),1)]),s("div",Ps,[e[20]||(e[20]=s("span",{class:"stat-label"},"Quiz:",-1)),s("span",Ts,l(r.statistiques?.quiz||0),1)])]),s("div",Us,[s("span",{class:Q(["status-badge",r.est_actif?"active":"inactive"])},l(r.est_actif?"Actif":"Inactif"),3),s("span",zs,"Ordre: "+l(r.ordre),1)])]))),128))])]))),128))])),q(f,{"is-open":o.showCreateModal||o.showEditModal,title:o.showEditModal?"Modifier le Niveau":"Nouveau Niveau",onClose:o.closeModal},{footer:B(()=>[s("button",{onClick:e[8]||(e[8]=(...t)=>o.closeModal&&o.closeModal(...t)),class:"btn-secondary"},"Annuler"),s("button",{onClick:e[9]||(e[9]=(...t)=>o.saveNiveau&&o.saveNiveau(...t)),class:"btn-primary",disabled:o.saving},[o.saving?(n(),i("span",Rs,"Enregistrement...")):(n(),i("span",Ws,l(o.showEditModal?"Modifier":"Créer"),1))],8,Js)]),default:B(()=>[s("form",{onSubmit:e[7]||(e[7]=P((...t)=>o.saveNiveau&&o.saveNiveau(...t),["prevent"])),class:"niveau-form"},[s("div",Os,[e[21]||(e[21]=s("label",{for:"nom"},"Nom du niveau *",-1)),g(s("input",{id:"nom","onUpdate:modelValue":e[1]||(e[1]=t=>o.formData.nom=t),type:"text",required:"",placeholder:"ex: 6ème"},null,512),[[M,o.formData.nom]])]),s("div",Is,[e[23]||(e[23]=s("label",{for:"pays"},"Pays *",-1)),g(s("select",{id:"pays","onUpdate:modelValue":e[2]||(e[2]=t=>o.formData.pays=t),required:""},[e[22]||(e[22]=s("option",{value:""},"Sélectionner un pays",-1)),(n(!0),i(x,null,C(o.pays,t=>(n(),i("option",{key:t.id,value:t.id},l(t.nom),9,Fs))),128))],512),[[J,o.formData.pays]])]),s("div",js,[e[24]||(e[24]=s("label",{for:"description"},"Description",-1)),g(s("textarea",{id:"description","onUpdate:modelValue":e[3]||(e[3]=t=>o.formData.description=t),placeholder:"Description du niveau...",rows:"3"},null,512),[[M,o.formData.description]])]),s("div",Gs,[s("div",Hs,[e[25]||(e[25]=s("label",{for:"ordre"},"Ordre d'affichage",-1)),g(s("input",{id:"ordre","onUpdate:modelValue":e[4]||(e[4]=t=>o.formData.ordre=t),type:"number",min:"0",placeholder:"0"},null,512),[[M,o.formData.ordre,void 0,{number:!0}]])]),s("div",Ks,[e[26]||(e[26]=s("label",{for:"couleur"},"Couleur",-1)),g(s("input",{id:"couleur","onUpdate:modelValue":e[5]||(e[5]=t=>o.formData.couleur=t),type:"color",class:"color-picker"},null,512),[[M,o.formData.couleur]])])]),s("div",Ls,[s("label",Qs,[g(s("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.formData.est_actif=t),type:"checkbox"},null,512),[[R,o.formData.est_actif]]),e[27]||(e[27]=S(" Niveau actif "))])])],32)]),_:1},8,["is-open","title","onClose"])])}const te=T(is,[["render",Xs],["__scopeId","data-v-f64f10ec"]]);export{te as default};
