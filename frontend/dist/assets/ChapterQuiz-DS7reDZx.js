import{a as v,c as g,C as ee,A as gt,M as _t,H as j,E as zt,f as wt,z as Qt,y as yt,o as a,d as n,h as qt,b as i,g as _,F as de,p as ve,n as k,t as r,u as te,j as se,m as Oe}from"./vendor-JoY6QM7x.js";import{D as bt}from"./DashboardLayout-BQxYtzur.js";import{g as At,a as St,c as xt,b as Ct,s as It}from"./quiz-DC1c3tez.js";import{_ as kt,u as Tt,c as $t}from"./index-CaRFDJpf.js";import{d as Lt}from"./curriculum-1vPkSFMM.js";import{useDailyObjectivesIntegration as Pt}from"./useDailyObjectives-Exur5uet.js";import{B as Mt}from"./BackButton-DcJ3p42f.js";import"./menuItems-CGsFFYXe.js";import"./matieres-CW6TrQsL.js";import"./ui-jaH5oyHW.js";import"./pdf-B39ievqC.js";import"./mathlive-B5k0jhbN.js";const Dt={class:"chapter-quiz-section"},Nt={key:0,class:"clean-navigation"},Rt={class:"nav-grid"},Et=["onClick"],Vt={class:"nav-icon"},Xt={class:"nav-label"},jt={class:"nav-count"},Jt={class:"quiz-header"},Ot={class:"quiz-title"},Ut={class:"quiz-subtitle"},Bt={key:1,class:"quiz-list"},Ft=["onClick"],Ht={class:"quiz-card-header"},Gt={class:"quiz-card-title"},Kt={class:"quiz-card-description"},Wt={class:"quiz-card-meta"},Yt={class:"quiz-questions"},Zt={class:"quiz-time"},es={key:0,class:"quiz-status-container"},ts={class:"cooldown-time-left"},ss={class:"cooldown-time"},ns={class:"quiz-right-info"},os={class:"quiz-attempts"},as={class:"attempts-number"},is={class:"score-value"},rs={key:1,class:"quiz-status-container"},us={class:"quiz-progress-info"},ls={class:"progress-text"},cs={key:0,class:"just-started-indicator"},ds={key:1,class:"completed-indicator"},vs={key:2,class:"lost-question-indicator"},ps={key:0,class:"first-question-lost"},fs={key:1},ms={key:3,class:"saved-question-indicator"},hs={class:"quiz-right-info"},gs={class:"quiz-saved-time"},_s={class:"saved-time"},zs={class:"continue-text"},ws={class:"continue-arrow"},Qs={key:2,class:"quiz-status-container"},ys={class:"quiz-right-info"},qs={class:"quiz-attempts"},bs={class:"attempts-number"},As={class:"score-value"},Ss={key:0,class:"pagination-container"},xs={class:"pagination-info"},Cs={class:"pagination-controls"},Is=["disabled"],ks={class:"pagination-numbers"},Ts=["onClick"],$s=["disabled"],Ls={key:1,class:"no-quiz-message"},Ps={class:"no-quiz-icon"},Ms={key:2,class:"quiz-interface"},Ds={key:0,class:"session-restored-banner"},Ns={class:"session-restored-content"},Rs={class:"session-restored-text"},Es={key:0},Vs={key:1},Xs={key:2},js={key:0},Js={key:1},Os={class:"quiz-progress"},Us={class:"progress-bar"},Bs={class:"progress-text"},Fs={class:"question-timer"},Hs={class:"timer-info"},Gs={class:"timer-bar"},Ks={class:"timer-difficulty"},Ws={class:"question-container"},Ys=["innerHTML"],Zs={class:"options-container"},en=["onClick"],tn={class:"option-letter"},sn=["innerHTML"],nn={key:0,class:"timeout-message"},on={key:1,class:"explanation"},an=["innerHTML"],rn={class:"quiz-actions"},un=["disabled"],ln={key:1,class:"answer-actions"},cn={key:3,class:"quiz-results"},dn={class:"results-header"},vn={class:"score-percentage"},pn={key:0,class:"gamification-results"},fn={class:"xp-icon"},mn={key:0},hn={key:1},gn={class:"xp-details"},_n={class:"xp-amount"},zn={key:0},wn={key:1},Qn={class:"xp-info"},yn={key:0},qn={key:1},bn={key:2},An={key:3},Sn={key:0,class:"level-up-display"},xn={class:"level-up-text"},Cn={class:"results-stats"},In={class:"stat-card"},kn={class:"stat-number"},Tn={class:"stat-card"},$n={class:"stat-number"},Ln={class:"stat-card"},Pn={class:"stat-number"},Mn={key:0,class:"stat-card lost-questions"},Dn={class:"stat-number"},Nn={class:"stat-card gamification"},Rn={class:"stat-number"},En={key:1,class:"lost-questions-info"},Vn={class:"lost-questions-info-text"},pe=5,Xn={__name:"ChapterQuiz",setup(jn){const J=_t(),Qe=yt(),O=Tt(),{handleQuizCompletion:Ue,updateUserXPInstantly:Be}=$t(),{onQuizCompleted:Fe}=Pt(),h=v([]),ye=v(""),qe=v([]),l=v(null),z=v(0),T=v(null),w=v(!1),Q=v([]),q=v(!1),$=v(1),E=v(0),be=v(!1),U=v(!1),B=v(null),fe=v(null),me=v(!1),F=v(null),he=v(null),He=v(0);let X=null;const ne=g(()=>{const t=(l.value?.difficulty||l.value?.difficulte||"easy").toString().toLowerCase();return["easy","facile"].includes(t)?"easy":["medium","moyen"].includes(t)?"medium":["hard","difficile"].includes(t)?"hard":"easy"}),Ae=g(()=>({easy:20,medium:25,hard:30})[ne.value]||20),Se=g(()=>Ae.value);g(()=>(He.value,he.value?Math.max(0,Math.floor((Date.now()-he.value)/1e3)):0));const L=v(0),Ge=g(()=>`${Se.value}s`),xe=v(0),ge=v(!0);function Ce(){X&&(clearInterval(X),X=null),L.value=Se.value,ge.value=!0,he.value=Date.now(),xe.value++,X=setInterval(()=>{L.value--,L.value<=0&&Ke()},1e3)}function Ke(){oe(),Q.value.push({questionIndex:z.value,selectedAnswer:null,correctAnswer:P.value.correct_answer,correct:!1,timeOut:!0}),w.value=!0,T.value=null,V()}function oe(){X&&(clearInterval(X),X=null),ge.value=!1}const y=v("todo"),b=v([]),Ie=v(!1),C=v(new Map),ke=v(!1);let H=null;const ae=v(new Set),p=ae;function ie(){try{const t=new Set;h.value.forEach(e=>{pt(e.id)&&t.add(e.id)}),ae.value=t}catch{}}const P=g(()=>!l.value||!l.value.questions?null:l.value.questions[z.value]),Te=g(()=>h.value.reduce((t,e)=>t+(e.questions?.length||0),0)),_e=g(()=>Q.value.filter(t=>t.correct).length),We=g(()=>Q.value.filter(t=>!t.correct).length),ze=g(()=>Q.value.length),re=g(()=>l.value?l.value.questions.length-Q.value.length:0),$e=g(()=>ze.value>0?_e.value/ze.value*100:0),Le=g(()=>{const t=h.value.filter(d=>!D(d.id)&&!(p.value&&p.value.has(d.id))),e=h.value.filter(d=>{if(p.value&&p.value.has(d.id)||!D(d.id))return!1;const m=b.value.filter(x=>x.quiz===d.id);if(m.length>0){const x=m[m.length-1],I=d.questions?.length||0;if((x.total_points||0)<I)return!1}return R(d.id)<5}),s=h.value.filter(d=>{if(p.value&&p.value.has(d.id)||!D(d.id))return!1;const m=b.value.filter(x=>x.quiz===d.id);if(m.length>0){const x=m[m.length-1],I=d.questions?.length||0;if((x.total_points||0)<I)return!1}return R(d.id)>=5}),o=h.value.filter(d=>{if(p.value&&p.value.has(d.id))return!0;if(D(d.id)){const m=b.value.filter(S=>S.quiz===d.id);if(m.length>0){const S=m[m.length-1],x=d.questions?.length||0;if((S.total_points||0)<x)return!0}}return!1}),c=p.value&&p.value.size>0,u=o.length>0||c,f=[{key:"todo",label:"Quiz à faire",shortLabel:"À faire",icon:"📝",count:t.length,description:"Quiz jamais commencés"}];return u&&f.push({key:"continue",label:"Quiz à continuer",shortLabel:"À continuer",icon:"🔄",count:o.length,priority:"high",description:"Quiz commencés mais pas terminés"}),e.length>0&&f.push({key:"below-average",label:"Sous la moyenne",shortLabel:"À revoir",icon:"📈",count:e.length,description:"Quiz à refaire (note < 5/10)"}),s.length>0&&f.push({key:"done",label:"Quiz réussis",shortLabel:"Réussis",icon:"✅",count:s.length,description:"Quiz maîtrisés (note ≥ 5/10)"}),f});ee(b,()=>{const t=Le.value;!t.some(s=>s.key===y.value)&&t.length>0&&(y.value=t[0].key)},{deep:!0});const M=v(1),K=g(()=>{switch(y.value){case"todo":return h.value.filter(t=>!D(t.id)&&!(p.value&&p.value.has(t.id)));case"continue":return h.value.filter(t=>{if(p.value&&p.value.has(t.id))return!0;if(D(t.id)){const e=b.value.filter(s=>s.quiz===t.id);if(e.length>0){const s=e[e.length-1],o=t.questions?.length||0;return(s.total_points||0)<o}}return!1});case"below-average":return h.value.filter(t=>{if(p.value&&p.value.has(t.id)||!D(t.id))return!1;const e=b.value.filter(o=>o.quiz===t.id);if(e.length>0){const o=e[e.length-1],c=t.questions?.length||0;if((o.total_points||0)<c)return!1}return R(t.id)<5});case"done":return h.value.filter(t=>{if(p.value&&p.value.has(t.id)||!D(t.id))return!1;const e=b.value.filter(o=>o.quiz===t.id);if(e.length>0){const o=e[e.length-1],c=t.questions?.length||0;if((o.total_points||0)<c)return!1}return R(t.id)>=5});default:return h.value}}),Ye=g(()=>{const t=(M.value-1)*pe,e=t+pe;return K.value.slice(t,e)}),ue=g(()=>Math.ceil(K.value.length/pe));function Ze(t){M.value=t}function et(){M.value>1&&M.value--}function tt(){M.value<ue.value&&M.value++}ee(y,()=>{M.value=1});function st(){h.value.forEach(t=>{const e=D(t.id),s=p.value&&p.value.has(t.id),o=b.value.filter(d=>d.quiz===t.id),c=R(t.id);let u=!1;if(e&&o.length>0){const d=o[o.length-1],m=t.questions?.length||0;u=(d.total_points||0)<m}let f="À faire";s&&!e?f="À continuer (sauvegardé)":u?f="À continuer (incomplet)":e&&(f=c<5?"Sous la moyenne (À revoir)":"Réussis")})}function D(t){return b.value.some(e=>e.quiz===t)}function Pe(t){return b.value.filter(e=>e.quiz===t).length}function R(t){const e=b.value.filter(c=>c.quiz===t).sort((c,u)=>{const f=new Date(c.date_creation||c.created_at||0);return new Date(u.date_creation||u.created_at||0)-f});if(!e.length)return 0;const s=e[0];if(!s||!s.total_points)return 0;const o=(Number(s.score)||0)/(Number(s.total_points)||1)*10;return Math.round(o*10)/10}const W=()=>{j(()=>{window.MathJax&&window.MathJax.typesetPromise()})};ee(P,()=>{P.value&&W()},{deep:!0}),ee(w,()=>{w.value&&W()});async function le(){try{Ie.value=!0;const t=J.params.chapitreId,e=await Ct(t),s=Array.isArray(e)?e:e?.data||e?.results||[];b.value=s}catch(t){t.response?.status===401?b.value=[]:b.value=[]}finally{Ie.value=!1}}gt(async()=>{window.addEventListener("beforeunload",Je),window.addEventListener("pagehide",()=>{l.value&&!q.value&&V()});try{const t=J.params.chapitreId,e=J.query.quizId,[s,o]=await Promise.all([Lt(t).catch(()=>null),At(t)]);qe.value=s?[s]:[],ye.value=s?.nom||"Chapitre";const c=Array.isArray(o.data)?o.data:o.data?.quiz||[];if(h.value=c.map(u=>({...u,questions:Array.isArray(u?.questions)?u.questions:Array.isArray(u?.questions_data)?u.questions_data:[]})),ie(),e){const u=h.value.find(f=>f.id==e);if(u)if(J.query.autoStart==="true"){Y().then(()=>{}),we(u);return}else{Promise.all([le(),Y()]).then(()=>{}),await j(),await we(u);return}}await Promise.all([le(),Y()]),ie(),ft(),await j(),W()}catch{h.value=[]}});function Me(t){return{easy:"Facile",medium:"Moyen",hard:"Difficile"}[t]||t}function nt(t){if(!t)return"Inconnu";const s=new Date-t,o=Math.floor(s/(1e3*60)),c=Math.floor(s/(1e3*60*60)),u=Math.floor(s/(1e3*60*60*24));return o<1?"À l'instant":o<60?`Il y a ${o}min`:c<24?`Il y a ${c}h`:u<7?`Il y a ${u}j`:t.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}function ot(t){return`${Math.ceil(t*1.5)} min`}function we(t){O.isAuthenticated;const e=C.value.get(t.id);if(e&&!e.can_attempt){alert(`⏰ ${e.message}`);return}l.value={...t,questions:Array.isArray(t?.questions)?t.questions:Array.isArray(t?.questions_data)?t.questions_data:[]};const s=dt(l.value);s?(T.value=null,w.value=!1,q.value||(U.value=!1),Q.value.length===0&&z.value):(z.value=0,T.value=null,w.value=!1,Q.value=[],q.value=!1,U.value=!1,B.value=Date.now(),fe.value=ct(),V()),V(),Ce(),St(t.id).then(o=>{const c=Array.isArray(o)?o:o?.data||o?.results||[];s||($.value=(c.length||0)+1)}).catch(o=>{s||($.value=1)}),j(()=>{W()})}function at(t){!w.value&&L.value>0&&(T.value=t)}function it(){if(T.value===null)return;if(vt()){alert("🚨 Tentative de triche détectée. Le quiz va redémarrer."),G(l.value.id),location.reload();return}oe(),w.value=!0;const t=T.value===P.value.correct_answer;Q.value.push({questionIndex:z.value,selectedAnswer:T.value,correctAnswer:P.value.correct_answer,correct:t,timestamp:Date.now()}),V()}function rt(){z.value<l.value.questions.length-1?(z.value++,T.value=null,w.value=!1,V(),W(),Ce()):De()}async function De(){q.value=!0,oe(),G(l.value.id);const t=B.value?Math.floor((Date.now()-B.value)/1e3):0,e=l.value.questions.length,s=_e.value;try{const o=O.level,c=await It({quiz_id:l.value.id,score:s,total_points:e,temps_total_seconde:t}),u=Number(c?.xp_gagne??c?.data?.xp_gagne??0),f=Number(c?.tentative_numero??c?.data?.tentative_numero??$.value);E.value=u,$.value=f,U.value=!0;const d=e>0?s/e*100:0,m={isSuccess:d>=50,score:s,percentage:d,timeSpent:t,difficulty:ne.value,totalQuestions:e,correctAnswers:s};Fe(m);const S=await Be(u,"quiz_completion");S.success&&S.levelUp&&(be.value=!0);try{await Ue(l.value.id,u,f,l.value.titre||"Quiz")}catch{}f>=3&&u>0,await le(),ie(),st(),j(()=>{})}catch(o){if(o.response?.status===400&&o.response?.data?.detail){alert(o.response.data.detail),await Y(),await Ne();return}E.value=0,U.value=!1}await Y()}async function Ne(){l.value&&!q.value&&G(l.value.id),l.value=null,q.value=!1,await le(),j(()=>{})}function ut(t){return t>=80?"excellent":t>=60?"good":t>=40?"average":"poor"}function Re(t){const e=Number(t);return e<5?"score-below-average":e===5?"score-average":"score-above-average"}async function Y(){if(h.value.length){ke.value=!0;try{for(const t of h.value)try{const e=await xt(t.id);C.value.set(t.id,e)}catch(e){e.response?.status===401?C.value.set(t.id,{can_attempt:!0,message:"Mode local"}):C.value.set(t.id,{can_attempt:!0})}Xe()}catch{}finally{ke.value=!1}}}function Ee(t){return C.value.get(t)||{can_attempt:!0}}function Ve(t){return!Ee(t).can_attempt}function Xe(){H&&clearInterval(H);const e=Array.from(C.value.values()).some(s=>!s.can_attempt)?1e4:6e4;H=setInterval(()=>{mt(),!Array.from(C.value.values()).some(o=>!o.can_attempt)&&e!==6e4&&Xe()},e)}function lt(){H&&(clearInterval(H),H=null)}function ct(){return`quiz_${l.value?.id}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function V(){if(!l.value||q.value)return;const t={sessionId:fe.value,quizId:l.value.id,chapitreId:J.params.chapitreId,currentQuestionIndex:z.value,userAnswers:[...Q.value],quizStartTime:B.value,currentAttempt:$.value,timestamp:Date.now(),questionsCompleted:Q.value.length,expectedNextQuestion:z.value+1,userId:O.id};try{localStorage.setItem(`optitab_quiz_save_${l.value.id}`,JSON.stringify(t)),F.value=t;const e=new Set(p.value);e.add(l.value.id),ae.value=e,Z.delete(l.value.id)}catch{}}function dt(t){try{const e=localStorage.getItem(`optitab_quiz_save_${t.id}`);if(!e)return!1;let s=JSON.parse(e);if(!je(s,t)){const I=t.questions?.length||0,N={...s};if(s.currentQuestionIndex>=I&&(N.currentQuestionIndex=Math.min(s.userAnswers.length,I-1)),Math.abs(s.currentQuestionIndex-s.userAnswers.length)>3&&s.currentQuestionIndex<I&&(N.currentQuestionIndex=s.userAnswers.length),je(N,t))s=N,localStorage.setItem(`optitab_quiz_save_${t.id}`,JSON.stringify(N));else return G(t.id),!1}const o=3600*1e3;if(Date.now()-s.timestamp>o)return G(t.id),!1;me.value=!0;const c=s.userAnswers.some(I=>I.questionIndex===s.currentQuestionIndex),u=t.questions?.length||0,f=s.currentQuestionIndex>=u-1,d=s.userAnswers.length>=u;if(f||d)return Q.value=[...s.userAnswers],B.value=s.quizStartTime,$.value=s.currentAttempt,q.value=!0,U.value=!1,G(t.id),!0;const m=Math.min(s.currentQuestionIndex+1,u-1);fe.value=s.sessionId,z.value=m,Q.value=[...s.userAnswers],B.value=s.quizStartTime,$.value=s.currentAttempt,F.value=s;const S=!c,x=s.currentQuestionIndex+1;return!0}catch{return!1}}function je(t,e){if(t.userId!==O.id||t.quizId!==e.id||t.questionsCompleted!==t.userAnswers.length||t.currentQuestionIndex>=e.questions.length)return!1;const s=t.userAnswers.length,o=Math.abs(t.currentQuestionIndex-s),c=e.questions?.length||0,u=t.currentQuestionIndex>=c-1,f=t.userAnswers.length>=c;if(u||f){if(o>3)return!1}else if(o>2)return!1;return!0}function G(t){try{localStorage.removeItem(`optitab_quiz_save_${t}`),F.value=null;const e=new Set(p.value);e.delete(t),ae.value=e,Z.delete(t)}catch{}}function vt(){return F.value?z.value>F.value.expectedNextQuestion||Q.value.length<F.value.questionsCompleted||z.value>=l.value.questions.length:!1}function pt(t){try{const e=localStorage.getItem(`optitab_quiz_save_${t}`);if(!e)return!1;const s=JSON.parse(e);return Date.now()-s.timestamp>36e5||s.userId!==O.id?!1:s.currentQuestionIndex>=0}catch{return!1}}ee(p,(t,e)=>{t.size,e.size},{deep:!0});const ft=()=>{j(()=>{h.value.length>0&&ie()})},Z=new Map;function A(t){if(Z.has(t)){const e=Z.get(t);if(Date.now()-e.timestamp<5e3)return e.data}try{const e=localStorage.getItem(`optitab_quiz_save_${t}`);if(!e)return null;const s=JSON.parse(e),o=h.value.find(ce=>ce.id===t)?.questions?.length||0,c=Math.min(s.currentQuestionIndex+1,o),u=s.userAnswers.some(ce=>ce.questionIndex===s.currentQuestionIndex),f=!u,d=s.currentQuestionIndex===0&&!u,m=s.currentQuestionIndex===0&&s.userAnswers.length===0,S=s.currentQuestionIndex>=o-1,x=s.userAnswers.length>=o,I=S||x,N={currentQuestion:c,totalQuestions:o,answersGiven:s.userAnswers.length,lastSaved:new Date(s.timestamp),progress:c,lostQuestion:s.currentQuestionIndex+1,isFirstQuestionLost:d,questionLost:f,hasAnsweredCurrentQuestion:u,isJustStarted:m,isQuizCompleted:I};return Z.set(t,{data:N,timestamp:Date.now()}),N}catch{return null}}function mt(){const t=Date.now();let e=!1;C.value.forEach((s,o)=>{if(!s.can_attempt&&s.next_attempt_time){const c=new Date(s.next_attempt_time).getTime(),u=Math.max(0,c-t);if(u<=0)C.value.set(o,{can_attempt:!0,message:"Nouvelle tentative autorisée"}),e=!0;else{const f=Math.floor(u/36e5),d=Math.floor(u%(1e3*60*60)/(1e3*60)),m=`${f}h${d.toString().padStart(2,"0")}min`;s.time_remaining_formatted!==m&&(C.value.set(o,{...s,time_remaining_seconds:Math.floor(u/1e3),time_remaining_formatted:m}),e=!0)}}}),e&&(C.value=new Map(C.value))}function ht(){const t=qe.value.find(e=>e.id==J.params.chapitreId);t&&t.notion?Qe.push({name:"QuizChapitres",params:{notionId:t.notion}}):Qe.back()}function Je(t){if(l.value&&!q.value){V();const e="Êtes-vous sûr de vouloir quitter ? Votre progression sera sauvegardée.";return t.returnValue=e,e}}return zt(()=>{oe(),lt(),window.removeEventListener("beforeunload",Je),l.value&&!q.value&&V()}),(t,e)=>(a(),wt(bt,null,{default:Qt(()=>[n("section",Dt,[qt(Mt,{text:"Retour aux chapitres",customAction:ht,position:"top-left"}),!l.value&&!q.value?(a(),i("div",Nt,[n("div",Rt,[(a(!0),i(de,null,ve(Le.value,s=>(a(),i("button",{key:s.key,class:k(["nav-item",{active:s.key===y.value}]),onClick:o=>y.value=s.key},[n("span",Vt,r(s.icon),1),n("span",Xt,r(s.shortLabel),1),n("span",jt,r(s.count),1)],10,Et))),128))])])):_("",!0),n("div",Jt,[n("h2",Ot,"Quiz QCM - "+r(ye.value),1),n("p",Ut,r(Te.value)+" "+r(Te.value>1?"questions":"question")+" disponibles dans "+r(h.value.length)+" "+r((h.value.length>1,"quiz")),1)]),!l.value&&!q.value?(a(),i("div",Bt,[(a(!0),i(de,null,ve(Ye.value,s=>(a(),i("div",{key:s.id,class:k(["quiz-card",{completed:D(s.id),cooldown:Ve(s.id),"saved-progress":te(p).value&&te(p).value.has(s.id)}]),onClick:o=>we(s)},[n("div",Ht,[n("h3",Gt,r(s.titre),1),n("span",{class:k(["quiz-difficulty",s.difficulty])},r(Me(s.difficulty)),3)]),n("p",Kt,r(s.instruction),1),n("div",Wt,[n("span",Yt,r(s.questions?.length||0)+" questions",1),n("span",Zt,"~"+r(ot(s.questions?.length||0)),1)]),Ve(s.id)?(a(),i("div",es,[n("div",ts,[e[1]||(e[1]=n("span",{class:"cooldown-icon"},"⏰",-1)),n("span",ss,r(Ee(s.id).time_remaining_formatted),1)]),n("div",ns,[n("div",os,[e[2]||(e[2]=n("span",{class:"attempts-label"},"Tentative:",-1)),n("span",as,r(Pe(s.id)),1)]),n("div",{class:k(["quiz-score",Re(R(s.id))])},[n("span",is,r(R(s.id))+"/10",1)],2)])])):te(p).value&&te(p).value.has(s.id)?(a(),i("div",rs,[n("div",us,[e[3]||(e[3]=n("span",{class:"progress-icon"},"🔄",-1)),n("span",ls,[se(r(A(s.id)?.progress||1)+"/"+r(A(s.id)?.totalQuestions||s.questions?.length||0)+" ",1),A(s.id)?.isJustStarted?(a(),i("span",cs," (Débuté) ")):A(s.id)?.isQuizCompleted?(a(),i("span",ds," (Terminé - Voir résultats) ")):A(s.id)?.questionLost?(a(),i("span",vs,[A(s.id)?.isFirstQuestionLost?(a(),i("span",ps," (Q1 perdue) ")):(a(),i("span",fs," (Q"+r(A(s.id)?.lostQuestion)+" perdue) ",1))])):(a(),i("span",ms," (Q"+r(A(s.id)?.lostQuestion)+" sauvegardée) ",1))])]),n("div",hs,[n("div",gs,[e[4]||(e[4]=n("span",{class:"saved-label"},"Sauvegardé:",-1)),n("span",_s,r(nt(A(s.id)?.lastSaved)),1)]),n("div",{class:k(["quiz-continue-badge",{completed:A(s.id)?.isQuizCompleted}])},[n("span",zs,r(A(s.id)?.isQuizCompleted?"Voir résultats":"Continuer"),1),n("span",ws,r(A(s.id)?.isQuizCompleted?"📊":"→"),1)],2)])])):D(s.id)?(a(),i("div",Qs,[e[6]||(e[6]=n("div",{class:"quiz-left-spacer"},null,-1)),n("div",ys,[n("div",qs,[e[5]||(e[5]=n("span",{class:"attempts-label"},"Tentative:",-1)),n("span",bs,r(Pe(s.id)),1)]),n("div",{class:k(["quiz-score",Re(R(s.id))])},[n("span",As,r(R(s.id))+"/10",1)],2)])])):_("",!0)],10,Ft))),128)),K.value.length>pe?(a(),i("div",Ss,[n("div",xs," Page "+r(M.value)+" sur "+r(ue.value)+" ("+r(K.value.length)+" quiz au total) ",1),n("div",Cs,[n("button",{onClick:et,disabled:M.value===1,class:"pagination-btn"}," ← Précédent ",8,Is),n("div",ks,[(a(!0),i(de,null,ve(ue.value,s=>(a(),i("button",{key:s,onClick:o=>Ze(s),class:k(["pagination-number",{active:s===M.value}])},r(s),11,Ts))),128))]),n("button",{onClick:tt,disabled:M.value===ue.value,class:"pagination-btn"}," Suivant → ",8,$s)])])):_("",!0),K.value.length===0?(a(),i("div",Ls,[n("div",Ps,r(y.value==="todo"?"📚":y.value==="continue"?"🔄":y.value==="below-average"?"📈":"🎯"),1),n("h3",null,r(y.value==="todo"?"Aucun quiz à faire":y.value==="continue"?"Aucun quiz en cours":y.value==="below-average"?"Aucun quiz à revoir":"Aucun quiz réussi"),1),n("p",null,r(y.value==="todo"?"Tous les quiz de ce chapitre ont été commencés ou terminés.":y.value==="continue"?"Commencez un quiz pour pouvoir le reprendre plus tard.":y.value==="below-average"?"Bravo ! Aucun quiz n'a une note inférieure à 5/10.":"Terminez des quiz avec une note d'au moins 5/10 pour qu'ils apparaissent ici."),1)])):_("",!0)])):_("",!0),l.value&&!q.value?(a(),i("div",Ms,[me.value?(a(),i("div",Ds,[n("div",Ns,[e[12]||(e[12]=n("span",{class:"session-restored-icon"},"🔄",-1)),n("div",Rs,[e[11]||(e[11]=n("strong",null,"Session restaurée",-1)),A(l.value?.id)?.isJustStarted?(a(),i("p",Es,e[7]||(e[7]=[se(" Vous reprenez là où vous vous étiez arrêté. "),n("strong",{class:"info-text"},"ℹ️ Quiz débuté - Vous commencez à la question 1.",-1)]))):Q.value.length===0?(a(),i("p",Vs,e[8]||(e[8]=[se(" Vous reprenez là où vous vous étiez arrêté. "),n("strong",{class:"warning-text"},"⚠️ La première question a été perdue car vous n'aviez pas encore répondu.",-1),se(" Vous commencez à la question 2. ")]))):(a(),i("p",Xs,[se(" Vous reprenez là où vous vous étiez arrêté. "+r(Q.value.length)+" réponse(s) précédente(s) sauvegardée(s). ",1),A(l.value?.id)?.questionLost?(a(),i("span",js,e[9]||(e[9]=[n("strong",{class:"warning-text"},"⚠️ La question précédente a été perdue car vous n'aviez pas encore répondu.",-1)]))):(a(),i("span",Js,e[10]||(e[10]=[n("strong",{class:"success-text"},"✅ La question précédente a été sauvegardée avec votre réponse.",-1)])))]))]),n("button",{onClick:e[0]||(e[0]=s=>me.value=!1),class:"session-restored-close"},"✕")])])):_("",!0),n("div",Os,[n("div",Us,[n("div",{class:"progress-fill",style:Oe({width:`${(z.value+1)/l.value.questions.length*100}%`})},null,4)]),n("span",Bs,r(z.value+1)+" / "+r(l.value.questions.length),1)]),n("div",Fs,[n("div",Hs,[e[13]||(e[13]=n("span",{class:"timer-label"},"Temps par question :",-1)),n("span",{class:k(["timer-time",{warning:L.value<=5,critical:L.value<=2}])},r(L.value)+"s ",3)]),n("div",Gs,[(a(),i("div",{class:"timer-fill-smooth",key:xe.value,style:Oe({animationDuration:Ge.value,backgroundColor:L.value<=5?L.value<=2?"#ef4444":"#f59e0b":"#10b981",animationPlayState:ge.value?"running":"paused"})},null,4))]),n("div",Ks,[n("span",{class:k(["difficulty-badge",ne.value])},r(Me(ne.value))+" - "+r(Ae.value)+"s ",3)])]),n("div",Ws,[n("h3",{class:"question-title",innerHTML:P.value.question},null,8,Ys),n("div",Zs,[(a(!0),i(de,null,ve(P.value.options,(s,o)=>(a(),i("div",{key:o,class:k(["option-card",{selected:T.value===o,correct:w.value&&o===P.value.correct_answer,incorrect:w.value&&T.value===o&&o!==P.value.correct_answer,disabled:w.value&&L.value<=0}]),onClick:c=>at(o)},[n("div",tn,r(String.fromCharCode(65+o)),1),n("span",{class:"option-text",innerHTML:s},null,8,sn)],10,en))),128))]),w.value&&L.value<=0?(a(),i("div",nn,e[14]||(e[14]=[n("div",{class:"timeout-icon"},"⏰",-1),n("p",{class:"timeout-text"},'Temps écoulé ! La bonne réponse est affichée ci-dessus. Cliquez sur "Question suivante" pour continuer.',-1)]))):_("",!0),w.value&&P.value.explanation?(a(),i("div",on,[e[15]||(e[15]=n("h4",{class:"explanation-title"},"Explication :",-1)),n("p",{class:"explanation-text",innerHTML:P.value.explanation},null,8,an)])):_("",!0),n("div",rn,[w.value?_("",!0):(a(),i("button",{key:0,class:"btn-primary",disabled:T.value===null,onClick:it}," Valider ",8,un)),w.value?(a(),i("div",ln,[z.value<l.value.questions.length-1?(a(),i("button",{key:0,class:"btn-primary",onClick:rt}," Question suivante ")):(a(),i("button",{key:1,class:"btn-success",onClick:De}," Terminer le quiz "))])):_("",!0)])])])):_("",!0),q.value?(a(),i("div",cn,[n("div",dn,[e[16]||(e[16]=n("h2",{class:"results-title"},"Résultats du Quiz",-1)),n("div",{class:k(["score-circle",ut($e.value)])},[n("span",vn,r(Math.round($e.value))+"%",1)],2)]),U.value?(a(),i("div",pn,[n("div",{class:k(["xp-earned",{"no-xp":E.value===0}])},[n("div",fn,[E.value>0?(a(),i("span",mn,"🎉")):(a(),i("span",hn,"💡"))]),n("div",gn,[n("div",_n,[E.value>0?(a(),i("span",zn,"+"+r(E.value)+" XP",1)):(a(),i("span",wn,"0 XP"))]),n("div",Qn,[$.value===1&&E.value>0?(a(),i("span",yn,"🥇 Premier essai réussi ! XP = ton score × difficulté")):$.value===1&&E.value===0?(a(),i("span",qn,"💪 Premier essai - Continue à t'améliorer !")):$.value>1?(a(),i("span",bn,"🔄 Tentative supplémentaire - Aucun XP (cooldown 1h30)")):(a(),i("span",An,"Continue tes efforts !"))])])],2),be.value?(a(),i("div",Sn,[e[17]||(e[17]=n("div",{class:"level-up-icon"},"🆙",-1)),n("div",xn,"Niveau "+r(te(O).level)+" atteint !",1)])):_("",!0)])):_("",!0),n("div",Cn,[n("div",In,[n("span",kn,r(_e.value),1),e[18]||(e[18]=n("span",{class:"stat-label"},"Bonnes réponses",-1))]),n("div",Tn,[n("span",$n,r(We.value),1),e[19]||(e[19]=n("span",{class:"stat-label"},"Mauvaises réponses",-1))]),n("div",Ln,[n("span",Pn,r(ze.value),1),e[20]||(e[20]=n("span",{class:"stat-label"},"Total questions",-1))]),re.value>0?(a(),i("div",Mn,[n("span",Dn,r(re.value),1),e[21]||(e[21]=n("span",{class:"stat-label"},"Questions perdues",-1))])):_("",!0),n("div",Nn,[n("span",Rn,r($.value),1),e[22]||(e[22]=n("span",{class:"stat-label"},"Tentative #",-1))])]),e[25]||(e[25]=n("div",{class:"cooldown-info"},[n("div",{class:"cooldown-info-icon"},"⏰"),n("div",{class:"cooldown-info-text"},[n("strong",null,"Prochaine tentative possible dans 1h30"),n("p",null,"Le système de cooldown empêche la mémorisation des réponses et encourage la préparation.")])],-1)),re.value>0?(a(),i("div",En,[e[24]||(e[24]=n("div",{class:"lost-questions-info-icon"},"⚠️",-1)),n("div",Vn,[n("strong",null,r(re.value)+" question(s) perdue(s) pour éviter la tricherie",1),e[23]||(e[23]=n("p",null,"En cas de rafraîchissement ou de perte de connexion, la question en cours est automatiquement perdue pour maintenir l'intégrité du quiz.",-1))])])):_("",!0),n("div",{class:"results-actions"},[n("button",{class:"btn-primary",onClick:Ne},"Retour à la liste")])])):_("",!0)])]),_:1}))}},to=kt(Xn,[["__scopeId","data-v-96780021"]]);export{to as default};
