import{_ as R,G as T,q as A,h as r,m,p as D,f as V,w as H,M as I,C as E,o as i,a as e,c as l,b as M,d as g,t as a,k as P,v as J,F as j,e as U,l as q,B as z}from"./index-C20tTf3S.js";import{D as G}from"./DashboardLayout-DmmXvv68.js";import{g as O,a as W}from"./synthesis-CPiG3z-Q.js";import{u as K}from"./useSmartNavigation-CohFfUbW.js";import"./menuItems-zei-A9he.js";import"./matieres-Ce1WeeoH.js";const Q={class:"synthesis-page"},X={class:"page-header"},Y={class:"header-content"},Z={class:"page-subtitle"},ee={class:"search-section"},se={class:"search-input-wrapper"},te={key:0,class:"loading-container"},oe={key:1,class:"error-container"},ae={key:2,class:"fiches-grid"},ne={key:0,class:"empty-state"},ie=["onClick"],re={class:"card-header"},le={class:"card-meta"},ce={class:"matiere-badge"},de={class:"reading-time"},ue={class:"card-body"},he={class:"fiche-title"},me={class:"card-footer"},pe={class:"stats-box"},ve={class:"stats-content"},_e={class:"stat"},ge={class:"stat"},ye={class:"modal-header"},fe={class:"modal-title-section"},we={class:"modal-title"},be={class:"modal-meta"},ke={class:"meta-badge matiere"},xe={class:"meta-badge time"},$e={class:"modal-body"},Ce=["innerHTML"],Me={class:"modal-footer"},Se={class:"content-stats"},Be={class:"stat-chip"},Fe={class:"stat-chip"},Le={__name:"Sheets",setup(Ne){I(),E();const S=T(),p=A(),{matiereIdFromRoute:B}=K(),y=r([]),f=r([]),v=r(!0),u=r(""),c=r(""),_=r(!1),n=r(null),h=m(()=>B.value||S.activeMatiereId),F=m(()=>{if(!h.value)return"Toutes les mati√®res";const t=f.value.find(s=>s.id==h.value);return t?t.nom:"Mati√®re"});m(()=>{if(!p.isAuthenticated)return"Non connect√©";const t=p.pays?.nom||"Pays non d√©fini",s=p.niveau_pays?.nom||"Niveau non d√©fini";return`${t} - ${s}`});const w=m(()=>{let t=y.value;if(c.value.trim()){const s=c.value.toLowerCase();t=t.filter(o=>o.titre.toLowerCase().includes(s)||o.summary.toLowerCase().includes(s))}return t.sort((s,o)=>s.titre.localeCompare(o.titre))});async function b(){v.value=!0,u.value="";try{const t={};h.value&&(t.matiere=h.value);const[s,o]=await Promise.all([O(t),W()]);y.value=s.data;const d=o.data?.matieres_disponibles||o.data||[];f.value=Array.isArray(d)?d:[]}catch(t){console.error("Erreur lors du chargement:",t),u.value="Impossible de charger les fiches de synth√®se."}finally{v.value=!1}}function L(t){return t?t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/<p[^>]*style="[^"]*color:blue[^"]*"[^>]*>([^<]+)<\/p>/g,'<h2 class="section-title blue">$1</h2>').replace(/<p[^>]*style="[^"]*color:darkorange[^"]*"[^>]*>([^<]+)<\/p>/g,'<h3 class="subsection-title orange">$1</h3>').replace(/<p[^>]*style="[^"]*color:red[^"]*"[^>]*>([^<]+)<\/p>/g,'<div class="alert-box warning">$1</div>').replace(/<p[^>]*style="[^"]*color:green[^"]*"[^>]*>([^<]+)<\/p>/g,'<div class="alert-box success">$1</div>').replace(/<p[^>]*style="[^"]*color:purple[^"]*"[^>]*>([^<]+)<\/p>/g,'<h4 class="example-title">$1</h4>').replace(/^###\s+(.+)$/gm,'<h3 class="subsection-title">$1</h3>').replace(/^##\s+(.+)$/gm,'<h2 class="section-title">$1</h2>').replace(/^#\s+(.+)$/gm,'<h1 class="main-title">$1</h1>').replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+)\*/g,"<em>$1</em>").replace(/\n\n/g,"<br/>").replace(/\n/g,"<br/>").trim():""}function k(t){return t?t.replace(/<[^>]*>/g,"").trim().split(/\s+/).length:0}function x(t){if(!t)return 0;const s=[/\$[^$]+\$/g,/\$\$[^$]+\$\$/g];let o=0;return s.forEach(d=>{const C=t.match(d);C&&(o+=C.length)}),o}function N(t){n.value=t,_.value=!0,z(()=>{window.MathJax&&window.MathJax.typesetPromise&&window.MathJax.typesetPromise()})}function $(){_.value=!1,n.value=null}return D(b),(t,s)=>(i(),V(G,null,{default:H(()=>[e("div",Q,[e("header",X,[e("div",Y,[s[2]||(s[2]=e("h1",{class:"page-title"},[e("span",{class:"title-icon"},"üìã"),g(" Fiches de Synth√®se ")],-1)),e("p",Z,a(F.value),1)]),e("div",ee,[e("div",se,[P(e("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>c.value=o),type:"text",placeholder:"Rechercher une fiche...",class:"search-input"},null,512),[[J,c.value]]),s[3]||(s[3]=e("svg",{class:"search-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"11",cy:"11",r:"8"}),e("path",{d:"m21 21-4.35-4.35"})],-1))])])]),v.value?(i(),l("div",te,s[4]||(s[4]=[e("div",{class:"loading-spinner"},null,-1),e("span",null,"Chargement des fiches...",-1)]))):u.value?(i(),l("div",oe,[s[5]||(s[5]=e("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),s[6]||(s[6]=e("h3",null,"Erreur de chargement",-1)),e("p",null,a(u.value),1),e("button",{onClick:b,class:"retry-button"},"R√©essayer")])):(i(),l("div",ae,[w.value.length===0?(i(),l("div",ne,[s[7]||(s[7]=e("div",{class:"empty-icon"},"üìÑ",-1)),s[8]||(s[8]=e("h3",null,"Aucune fiche trouv√©e",-1)),e("p",null,a(c.value?"Aucune fiche ne correspond √† votre recherche.":"Aucune fiche de synth√®se disponible."),1)])):M("",!0),(i(!0),l(j,null,U(w.value,o=>(i(),l("div",{key:o.id,class:"fiche-card",onClick:d=>N(o)},[e("div",re,[e("div",le,[e("span",ce,a(o.matiere_nom),1),e("span",de,a(o.reading_time_minutes||5)+"min",1)])]),e("div",ue,[e("h3",he,a(o.titre),1)]),e("div",me,[e("div",pe,[e("div",ve,[e("span",_e,a(k(o.summary))+" mots",1),e("span",ge,a(x(o.summary))+" formules",1)])]),s[9]||(s[9]=e("button",{class:"view-button"},[e("span",null,"Ouvrir"),e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M7 17l9.2-9.2M17 17V7H7"})])],-1))])],8,ie))),128))])),_.value?(i(),l("div",{key:3,class:"modal-overlay",onClick:$},[e("div",{class:"modal-container",onClick:s[1]||(s[1]=q(()=>{},["stop"]))},[e("div",ye,[e("div",fe,[e("h2",we,a(n.value?.titre),1),e("div",be,[e("span",ke,a(n.value?.matiere_nom),1),e("span",xe,a(n.value?.reading_time_minutes||5)+"min",1)])]),e("button",{onClick:$,class:"close-button"},s[10]||(s[10]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)]))]),e("div",$e,[e("div",{class:"synthesis-content",innerHTML:L(n.value?.summary)},null,8,Ce)]),e("div",Me,[e("div",Se,[e("span",Be,[s[11]||(s[11]=e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e("polyline",{points:"14,2 14,8 20,8"})],-1)),g(" "+a(k(n.value?.summary))+" mots ",1)]),e("span",Fe,[s[12]||(s[12]=e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"3"}),e("path",{d:"M12 1v6m0 6v6m11-7h-6m-6 0H1"})],-1)),g(" "+a(x(n.value?.summary))+" formules ",1)])])])])])):M("",!0)])]),_:1}))}},Ie=R(Le,[["__scopeId","data-v-dd9e75a5"]]);export{Ie as default};
