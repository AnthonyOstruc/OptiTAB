import{D as Oe}from"./DashboardLayout-D1TcTAih.js";import{_ as ee,u as de,f as Le,a as qe,b as J,X as Ne,c as Xe,d as Qe,e as Ue,g as Ve,h as Re,i as He,r as Be}from"./index-BhTphZWV.js";import{a as m,c as T,C as Ae,A as se,b as a,o as t,d as e,n as N,g as y,j as K,u as X,t as o,F as Q,p as U,m as xe,f as Se,z as re,G as Fe,k as Z,L as he,w as $e,H as je,y as ke,i as be,E as Je,h as ne,B as Ce,K as Ge}from"./vendor-CPU10QdV.js";import{g as Pe,a as ce,b as Me,c as We}from"./curriculum-DPSaZDuo.js";import{g as Ie}from"./matieres-BKndaZDR.js";import{g as Ke}from"./exercices-D4i9jcVH.js";import{c as Ye}from"./quiz-CRbLhkZQ.js";import{useDailyObjectives as Ze}from"./useDailyObjectives-CeA3zzqF.js";import"./menuItems-sTa2MZDg.js";import"./ui-es3YBeq-.js";import"./pdf-OEFxGcL4.js";import"./mathlive-B5k0jhbN.js";const et={class:"leaderboard-card"},tt={class:"leaderboard-header"},st={class:"leaderboard-tabs"},at=["disabled"],ot={key:0,class:"flag"},it=["disabled"],nt={key:0,class:"leaderboard-body"},lt={class:"leaderboard-content"},rt={key:0,class:"leaderboard-item me-item"},ct={class:"rank"},dt={class:"me-rank"},ut={class:"me-sub"},vt={class:"user"},pt={class:"info"},mt={class:"meta"},_t={key:0,class:"flag"},ht={key:1,class:"niveau"},ft={class:"xp"},gt={class:"me-xp"},yt={class:"me-percent"},bt={class:"leaderboard-list"},$t={class:"rank"},kt={key:0,class:"trophy gold"},wt={key:1,class:"trophy silver"},Ct={key:2,class:"trophy bronze"},xt={key:3},St={class:"user"},jt={class:"avatar"},Pt={class:"info"},zt={class:"name"},Dt={key:0,class:"flag"},At={key:0,class:"meta"},It={class:"xp"},Et={key:1,class:"expanded-section"},Tt={class:"expanded-header"},Rt={class:"expanded-count"},qt={class:"leaderboard-list"},Mt={class:"rank"},Ot={class:"user"},Lt={class:"avatar"},Nt={class:"info"},Xt={class:"name"},Qt={key:0,class:"flag"},Ut={key:0,class:"meta"},Vt={class:"xp"},Ht={key:0,class:"leaderboard-actions"},Bt=["disabled"],Ft={key:1,class:"empty-state"},Jt={key:1,class:"leaderboard-loading"},Gt={__name:"LeaderboardWidget",setup(V){const w=de(),k=m("global"),C=m(!0);m([]);const x=m(null),S=m(!1),j=m([]),q=T(()=>!!w?.pays?.id),f=T(()=>!!w?.niveau_pays?.id);function h(b){b==="pays"&&!q.value||b==="niveau"&&!f.value||(k.value=b)}function E(b){if(!b)return"U";const d=String(b).trim().split(/\s+/);return d.length===1?d[0].substring(0,2).toUpperCase():(d[0].substring(0,1)+d[1].substring(0,1)).toUpperCase()}async function P(){C.value=!0;try{const d=(await Le({scope:k.value,limit:50}))?.data?.data||{},c=d.leaderboard||[];j.value=c.slice(0,50),x.value=d.me||null,S.value=!1}catch{j.value=[],x.value=null}finally{C.value=!1}}async function z(){S.value=!0}function A(){S.value=!1}return Ae(k,()=>P()),se(()=>P()),(b,d)=>(t(),a("div",et,[e("div",tt,[d[4]||(d[4]=e("h3",{class:"leaderboard-title"},"Classement",-1)),e("div",st,[e("button",{class:N(["tab",{active:k.value==="global"}]),onClick:d[0]||(d[0]=c=>h("global"))},"Global",2),e("button",{class:N(["tab",{active:k.value==="pays"}]),onClick:d[1]||(d[1]=c=>h("pays")),disabled:!q.value},[X(w).pays?.drapeau_emoji?(t(),a("span",ot,o(X(w).pays?.drapeau_emoji),1)):y("",!0),d[3]||(d[3]=K(" Pays "))],10,at),e("button",{class:N(["tab",{active:k.value==="niveau"}]),onClick:d[2]||(d[2]=c=>h("niveau")),disabled:!f.value}," Niveau ",10,it)])]),C.value?(t(),a("div",Jt,[d[10]||(d[10]=e("div",{class:"skeleton me"},null,-1)),(t(),a(Q,null,U(6,c=>e("div",{class:"skeleton row",key:c})),64))])):(t(),a("div",nt,[e("div",lt,[x.value?(t(),a("div",rt,[e("div",ct,[e("div",dt,"#"+o(x.value.rank),1),e("div",ut,"sur "+o(x.value.total),1)]),e("div",vt,[e("div",pt,[d[5]||(d[5]=e("div",{class:"name"},"Vous",-1)),e("div",mt,[x.value.pays_flag?(t(),a("span",_t,o(x.value.pays_flag),1)):y("",!0),x.value.niveau?(t(),a("span",ht,o(x.value.niveau),1)):y("",!0)])])]),e("div",ft,[e("div",gt,o(x.value.xp)+" XP",1),e("div",yt,"Top "+o(x.value.percentile)+"%",1)])])):y("",!0),e("ul",bt,[(t(!0),a(Q,null,U(j.value.slice(0,5),c=>(t(),a("li",{key:c.id,class:"leaderboard-item"},[e("div",$t,[c.rank===1?(t(),a("span",kt,"🥇")):c.rank===2?(t(),a("span",wt,"🥈")):c.rank===3?(t(),a("span",Ct,"🥉")):(t(),a("span",xt,"#"+o(c.rank),1))]),e("div",St,[e("div",jt,o(E(c.display_name)),1),e("div",Pt,[e("div",zt,[c.pays_flag?(t(),a("span",Dt,o(c.pays_flag),1)):y("",!0),K(" "+o(c.display_name),1)]),c.niveau?(t(),a("div",At,o(c.niveau),1)):y("",!0)])]),e("div",It,o(c.xp)+" XP",1)]))),128))]),S.value&&j.value.length>5?(t(),a("div",Et,[e("div",Tt,[d[6]||(d[6]=e("span",{class:"expanded-title"},"Autres classés",-1)),e("span",Rt,o(Math.min(j.value.length-5,45))+" utilisateurs",1)]),e("ul",qt,[(t(!0),a(Q,null,U(j.value.slice(5,50),c=>(t(),a("li",{key:c.id,class:"leaderboard-item expanded-item"},[e("div",Mt," #"+o(c.rank),1),e("div",Ot,[e("div",Lt,o(E(c.display_name)),1),e("div",Nt,[e("div",Xt,[c.pays_flag?(t(),a("span",Qt,o(c.pays_flag),1)):y("",!0),K(" "+o(c.display_name),1)]),c.niveau?(t(),a("div",Ut,o(c.niveau),1)):y("",!0)])]),e("div",Vt,o(c.xp)+" XP",1)]))),128))])])):y("",!0)]),j.value.length>0?(t(),a("div",Ht,[!S.value&&j.value.length>5?(t(),a("button",{key:0,onClick:z,class:"btn-see-more",disabled:C.value},d[7]||(d[7]=[e("span",{class:"btn-text"},"Voir plus",-1)]),8,Bt)):S.value?(t(),a("button",{key:1,onClick:A,class:"btn-see-less"},d[8]||(d[8]=[e("span",{class:"btn-text"},"Voir moins",-1)]))):y("",!0)])):y("",!0),j.value.length?y("",!0):(t(),a("div",Ft,d[9]||(d[9]=[e("div",null,"Pas encore de classement pour ce filtre.",-1)])))]))]))}},Wt=ee(Gt,[["__scopeId","data-v-cd1b608f"]]),Kt={class:"xp-card"},Yt={class:"xp-header"},Zt={class:"xp-level"},es={class:"xp-ring"},ts={viewBox:"0 0 36 36",class:"circular-chart"},ss=["stroke-dasharray"],as={x:"18",y:"20.35",class:"percentage"},os={class:"xp-next"},is={class:"streak-section"},ns={class:"streak-header"},ls={class:"streak-icon-container"},rs={key:0,class:"streak-badge"},cs={class:"streak-info"},ds={class:"streak-subtitle"},us={key:0,class:"streak-next-xp"},vs={class:"streak-xp-display"},ps={class:"xp-icon"},ms={class:"xp-value"},_s={class:"streak-progress-container"},hs={class:"streak-progress-bar"},fs={class:"streak-progress-text"},gs={key:0,class:"streak-motivation"},ys={class:"motivation-text"},bs={__name:"XPBadges",setup(V){const w=de(),{initializeStreak:k,currentStreak:C,nextStreakXP:x}=qe(),S=T(()=>w.level||0),j=T(()=>w.xp||0),q=T(()=>w.xp_to_next||0),f=T(()=>C.value),h=T(()=>f.value===0?0:f.value<=7?f.value/7*100:((f.value-1)%7+1)/7*100),E=T(()=>{if(f.value===0)return"Commencez votre streak !";if(f.value<=7)return`${f.value}/7 jours`;const c=(f.value-1)%7+1,D=Math.floor((f.value-1)/7)+1;return`${c}/7 jours (semaine ${D})`}),P=()=>f.value===0?"Connectez-vous chaque jour pour gagner des XP":f.value===1?"Excellent début ! Continuez demain":f.value<7?`${f.value} jours consécutifs`:f.value<30?`${f.value} jours - Vous êtes régulier !`:`${f.value} jours - Vous êtes un champion !`,z=()=>{const c=["Continuez comme ça ! Chaque jour compte.","Vous construisez une habitude d'apprentissage solide !","Impressionnant ! Votre persévérance paie.","Vous êtes sur la bonne voie vers la maîtrise !","Chaque jour d'apprentissage vous rapproche de vos objectifs."],D=Math.min(Math.floor(f.value/5),c.length-1);return c[D]},A=()=>f.value===0?1:f.value<=5?f.value:5,b=()=>{const c=A();return c>=5?"👑":c>=3?"🏆":c>=2?"⭐":"💎"},d=T(()=>{const c=Number(S.value||0),D=Number(j.value||0),g=c*c*10,i=(c+1)*(c+1)*10,$=Math.max(D,g)-g,H=Math.max(1,i-g);return`${Math.min(100,Math.round($/H*100))}, 100`});return se(()=>{k()}),(c,D)=>(t(),a("div",Kt,[e("div",Yt,[D[0]||(D[0]=e("div",{class:"xp-title"},"Progression XP",-1)),e("div",Zt,"Niveau "+o(S.value),1)]),e("div",es,[(t(),a("svg",ts,[D[1]||(D[1]=e("path",{class:"circle-bg",d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"},null,-1)),e("path",{class:"circle","stroke-dasharray":d.value,d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"},null,8,ss),e("text",as,o(j.value)+" XP",1)]))]),e("div",os,o(q.value)+" XP pour le prochain niveau",1),e("div",is,[e("div",ns,[e("div",ls,[e("span",{class:N(["streak-icon",{"streak-active":f.value>0}])},"🔥",2),f.value>0?(t(),a("div",rs,o(f.value),1)):y("",!0)]),e("div",cs,[D[2]||(D[2]=e("h4",{class:"streak-title"},"Streak Quotidien",-1)),e("p",ds,o(P()),1),f.value>0?(t(),a("p",us,"Prochain: +"+o(X(x))+" XP",1)):y("",!0)]),e("div",vs,[e("span",ps,o(b()),1),e("span",ms,"+"+o(A())+" XP",1)])]),e("div",_s,[e("div",hs,[e("div",{class:"streak-progress-fill",style:xe({width:h.value+"%"})},null,4)]),e("div",fs,o(E.value),1)]),f.value>0?(t(),a("div",gs,[e("p",ys,o(z()),1)])):y("",!0)])]))}},$s=ee(bs,[["__scopeId","data-v-3295ee29"]]),ks={key:0,class:"game-reset-notification"},ws={__name:"GameResetNotification",props:{autoHide:{type:Number,default:8e3}},setup(V){const w=V,k=m(!1);function C(){k.value=!1,localStorage.setItem("game-reset-notification-seen","true")}return se(()=>{localStorage.getItem("game-reset-notification-seen")||(k.value=!0,w.autoHide>0&&setTimeout(()=>{k.value&&C()},w.autoHide))}),(x,S)=>(t(),Se(Fe,{name:"notification",appear:""},{default:re(()=>[k.value?(t(),a("div",ks,[S[0]||(S[0]=e("div",{class:"notification-icon"},[e("span",null,"🎮")],-1)),S[1]||(S[1]=e("div",{class:"notification-content"},[e("div",{class:"notification-title"}," Système de gamification mis à jour ! "),e("div",{class:"notification-message"},[e("p",null,[K("🎯 "),e("strong",null,"Nouveau :"),K(" Seuls les "),e("strong",null,"quiz"),K(" donnent maintenant des XP")]),e("p",null,"📚 Les exercices guidés restent éducatifs (0 XP)"),e("p",null,"🏆 Tous les compteurs ont été remis à zéro pour un restart équitable")])],-1)),e("button",{onClick:C,class:"notification-close"}," ✕ ")])):y("",!0)]),_:1}))}},Cs=ee(ws,[["__scopeId","data-v-64a66099"]]),xs={class:"quiz-history"},Ss={class:"quiz-header"},js={class:"quiz-filters"},Ps=["value"],zs=["disabled"],Ds=["value"],As=["disabled"],Is=["value"],Es={key:0,class:"stats-section"},Ts={class:"stats-grid"},Rs={class:"stat-card quiz-completed"},qs={class:"stat-value"},Ms={class:"stat-card quiz-average"},Os={class:"stat-value"},Ls={class:"stat-card quiz-notions"},Ns={class:"stat-value"},Xs={key:1,class:"matiere-stats"},Qs={class:"matiere-grid"},Us={class:"matiere-name"},Vs={class:"matiere-info"},Hs={class:"matiere-average"},Bs={class:"matiere-count"},Fs={key:2,class:"quiz-list-section"},Js={class:"section-subtitle"},Gs={class:"inline-mastery-filters"},Ws=["onClick"],Ks={key:0,class:"inline-mastery-icon"},Ys={class:"inline-mastery-label"},Zs={key:0,class:"quiz-list-content"},ea={key:0,class:"empty-state"},ta={key:1,class:"quiz-grid"},sa=["onClick"],aa={class:"quiz-card-title-section"},oa=["onClick","title"],ia={key:0,class:"cooldown-lock",title:"Quiz en cooldown"},na={key:1,class:"navigation-icon",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},la={class:"quiz-breadcrumb-compact"},ra={class:"quiz-card-actions"},ca={key:0,class:"retry-indicator"},da={key:0,class:"quiz-card-details"},ua={class:"quiz-breadcrumb"},va={class:"breadcrumb-item"},pa={class:"breadcrumb-item"},ma={class:"breadcrumb-item"},_a={class:"quiz-meta"},ha={class:"quiz-attempt"},fa={key:0,class:"total-attempts"},ga={class:"quiz-date"},ya={key:0,class:"quiz-time"},ba={key:0,class:"quiz-cooldown-info"},$a={class:"cooldown-warning"},ka={class:"cooldown-text"},wa={key:2,class:"pagination-container"},Ca=["disabled"],xa={class:"pagination-pages"},Sa=["onClick"],ja=["disabled"],Pa={key:3,class:"loading-state"},De=12,za={__name:"QuizHistory",setup(V){const w=de(),k=ke(),C=m(!0),x=m({completed:0,average:0,masteredNotions:0}),S=m([]),j=m([]),q=m([]),f=m([]),h=m([]),E=m({}),P=m(""),z=m(""),A=m(""),b=m("all"),d=m(1),c=m(new Set),D=m(!0),g=m(new Map),i=m(!1),r=T(()=>{if(!P.value)return[];const n=parseInt(P.value);return f.value.filter(s=>{const _=typeof s.theme=="object"?s.theme?.id:s.theme;let R=null;return typeof s.theme=="object"&&(R=s.theme?.matiere_id||s.theme?.matiere?.id||null),!R&&_&&E.value[_]&&(R=E.value[_].matiere_id||E.value[_].matiere),parseInt(R)===n})}),$=T(()=>{if(!z.value)return[];const n=parseInt(z.value);return h.value.filter(l=>{const s=l.notion_id??l.notion?.id??(typeof l.notion=="number"?l.notion:null);return parseInt(s)===n})}),H=T(()=>{let n=S.value;return b.value!=="all"&&(n=n.filter(l=>{const s=l.score_on_10;switch(b.value){case"mastered":return s>=7;case"average":return s>=5&&s<7;case"poor":return s<5;default:return!0}})),n}),F=T(()=>Math.ceil(H.value.length/De)),ae=T(()=>{const n=(d.value-1)*De,l=n+De;return H.value.slice(n,l)}),ue=T(()=>q.value||[]),fe=T(()=>{const n=[],l=F.value,s=d.value;if(l<=7)for(let _=1;_<=l;_++)n.push(_);else if(s<=4){for(let _=1;_<=5;_++)n.push(_);l>5&&n.push("..."),n.push(l)}else if(s>=l-3){n.push(1),l>6&&n.push("...");for(let _=l-4;_<=l;_++)_>1&&n.push(_)}else{n.push(1),n.push("...");for(let _=s-1;_<=s+1;_++)n.push(_);n.push("..."),n.push(l)}return n}),ve=[{value:"all",label:"Tous",icon:"",class:"all"},{value:"mastered",label:"Maîtrisés",icon:"✅",class:"mastered"},{value:"average",label:"Moyens",icon:"⚠️",class:"average"},{value:"poor",label:"Non maîtrisés",icon:"❌",class:"poor"}],pe=async()=>{if(S.value.length){i.value=!0;try{for(const n of S.value)try{const l=await Ye(n.quiz_id);g.value.set(n.quiz_id,l)}catch{g.value.set(n.quiz_id,{can_attempt:!0})}}catch{}finally{i.value=!1}}},Y=n=>g.value.get(n)||{can_attempt:!0},G=n=>!Y(n).can_attempt,oe=async()=>{try{const[n,l,s,_]=await Promise.all([J.get("/api/matieres/user_matieres/"),J.get("/api/themes/notions-pour-utilisateur/"),Pe({}).catch(()=>J.get("/api/notions/pour-utilisateur/")),ce({})]);let R=[];n?.data?.matieres_disponibles?R=n.data.matieres_disponibles:n?.data?.data?R=n.data.data:Array.isArray(n?.data)&&(R=n.data);let W=[];s?.data?.notions_disponibles?W=s.data.notions_disponibles:s?.data?.data?W=s.data.data:Array.isArray(s?.data)?W=s.data:s?.data?.results&&(W=s.data.results);const te=l?.data?.themes||[],M=l?.data?.notions||[],ge={};te.forEach(ye=>{const Te=ye.matiere_id||ye.matiere&&(ye.matiere.id||ye.matiere);ge[ye.id]={matiere_id:Te,matiere:Te}}),E.value=ge,Array.isArray(M)&&M.length>0&&(W=M);const Ee=Array.isArray(_?.data)?_.data:_?.results||[];q.value=Array.isArray(R)?R:[],f.value=Array.isArray(W)?W:[],h.value=Array.isArray(Ee)?Ee:[],await je()}catch{try{const[l,s,_]=await Promise.all([Ie({}),Pe({}),ce({})]);q.value=Array.isArray(l?.data)?l.data:l?.results||[],f.value=Array.isArray(s?.data)?s.data:s?.results||[],h.value=Array.isArray(_?.data)?_.data:_?.results||[],await je()}catch{}}},ie=async()=>{C.value=!0;try{const n={};P.value&&(n.matiere=P.value),z.value&&(n.notion=z.value),A.value&&(n.chapitre=A.value);const s=(await J.get("/api/suivis/quiz/stats/",{params:n})).data;x.value=s.global_stats||{completed:0,average:0,masteredNotions:0},S.value=s.quiz_list||[],j.value=s.matiere_stats||[],S.value.length>0&&await pe()}catch{}finally{C.value=!1}},me=async()=>{if(z.value="",A.value="",I(),P.value&&r.value.length===0)try{const n=await J.get("/api/themes/notions-pour-utilisateur/",{params:{matiere:P.value}}),l=n?.data?.themes||[],s=n?.data?.notions||[],_={};l.forEach(M=>{const ge=M.matiere_id||M.matiere&&(M.matiere.id||M.matiere);_[M.id]={matiere_id:ge,matiere:ge}}),E.value={...E.value,..._};let R=s;if(!Array.isArray(R)||R.length===0){const M=await J.get("/api/notions/pour-utilisateur/",{params:{matiere:P.value}});M?.data?.notions_disponibles?R=M.data.notions_disponibles:M?.data?.data?R=M.data.data:Array.isArray(M?.data)?R=M.data:M?.data?.results&&(R=M.data.results)}const W=f.value.map(M=>M.id),te=R.filter(M=>!W.includes(M.id));f.value=[...f.value,...te]}catch{}ie()},O=async()=>{if(A.value="",I(),z.value)try{let n=await Me(z.value),l=[];if(Array.isArray(n?.data)?l=n.data:n?.data?.results&&(l=n.data.results),l.length===0){const s=await ce({notion:z.value});Array.isArray(s?.data)?l=s.data:s?.data?.results&&(l=s.data.results)}if(l.length===0){const s=await J.get(`/api/notions/${z.value}/chapitres/`);Array.isArray(s?.data)?l=s.data:s?.data?.results&&(l=s.data.results)}if(l.length>0){const s=h.value.map(R=>R.id),_=l.filter(R=>!s.includes(R.id));h.value=[...h.value,..._]}}catch{}ie()},L=()=>{I(),ie()},B=n=>n>=7?"score-good":n>=5?"score-average":"score-poor",le=n=>new Date(n).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),_e=n=>{const l=Math.floor(n/60),s=n%60;return`${l}:${s.toString().padStart(2,"0")}`},ze=n=>{c.value.has(n)?c.value.delete(n):c.value.add(n)},we=n=>c.value.has(n),v=()=>{D.value=!D.value},p=async n=>{try{if(G(n.quiz_id)){const _=Y(n.quiz_id);alert(`⏰ Ce quiz est en cooldown. ${_.message}`);return}const l=n.chapitre.id,s=n.quiz_id;await k.push({path:`/quiz-exercices/${l}`,query:{quizId:s,autoStart:"true"}})}catch{}},u=n=>{typeof n=="number"&&n>=1&&n<=F.value&&(d.value=n)},I=()=>{d.value=1};return se(async()=>{if(w.isLoading||!w.isAuthenticated&&!w.id){let n=0;for(;(w.isLoading||!w.isAuthenticated)&&n<30;)await new Promise(l=>setTimeout(l,100)),n++}await oe(),await ie()}),(n,l)=>(t(),a("div",xs,[e("div",Ss,[l[8]||(l[8]=e("h3",{class:"quiz-title"},"🧠 Historique des Quiz",-1)),e("div",js,[Z((t(),a("select",{"onUpdate:modelValue":l[0]||(l[0]=s=>P.value=s),onChange:me,class:"filter-select",key:"matieres-"+ue.value.length},[l[5]||(l[5]=e("option",{value:""},"Toutes les matières",-1)),(t(!0),a(Q,null,U(ue.value,s=>(t(),a("option",{key:`matiere-${s.id}`,value:s.id},o(s.titre||s.nom),9,Ps))),128))],32)),[[he,P.value]]),Z(e("select",{"onUpdate:modelValue":l[1]||(l[1]=s=>z.value=s),onChange:O,class:"filter-select",disabled:!P.value},[l[6]||(l[6]=e("option",{value:""},"Toutes les notions",-1)),(t(!0),a(Q,null,U(r.value,s=>(t(),a("option",{key:s.id,value:s.id},o(s.titre),9,Ds))),128))],40,zs),[[he,z.value]]),Z(e("select",{"onUpdate:modelValue":l[2]||(l[2]=s=>A.value=s),onChange:L,class:"filter-select",disabled:!z.value},[l[7]||(l[7]=e("option",{value:""},"Tous les chapitres",-1)),(t(!0),a(Q,null,U($.value,s=>(t(),a("option",{key:s.id,value:s.id},o(s.titre),9,Is))),128))],40,As),[[he,A.value]])])]),C.value?y("",!0):(t(),a("div",Es,[e("div",Ts,[e("div",Rs,[l[9]||(l[9]=e("span",{class:"stat-label"},"Quiz effectués",-1)),e("span",qs,o(x.value.completed),1)]),e("div",Ms,[l[10]||(l[10]=e("span",{class:"stat-label"},"Note moyenne",-1)),e("span",Os,o(x.value.average)+"/10",1)]),e("div",Ls,[l[11]||(l[11]=e("span",{class:"stat-label"},"Notions maîtrisées",-1)),e("span",Ns,o(x.value.masteredNotions),1)])])])),!C.value&&j.value.length>0?(t(),a("div",Xs,[l[12]||(l[12]=e("h4",{class:"section-subtitle"},"📊 Moyennes par matière",-1)),e("div",Qs,[(t(!0),a(Q,null,U(j.value,s=>(t(),a("div",{key:s.id,class:"matiere-card"},[e("div",Us,o(s.titre),1),e("div",Vs,[e("span",Hs,o(s.average)+"/10",1),e("span",Bs,o(s.quiz_count)+" quiz",1)])]))),128))])])):y("",!0),C.value?y("",!0):(t(),a("div",Fs,[e("div",{class:"quiz-list-header",onClick:v},[e("h4",Js,"📝 Quiz effectués ("+o(H.value.length)+")",1),e("div",Gs,[(t(),a(Q,null,U(ve,s=>e("button",{key:s.value,onClick:$e(_=>b.value=s.value,["stop"]),class:N(["inline-mastery-btn",{active:b.value===s.value},s.class])},[s.icon?(t(),a("span",Ks,o(s.icon),1)):y("",!0),e("span",Ys,o(s.label),1)],10,Ws)),64))]),e("button",{class:N(["section-toggle",{expanded:D.value}])},l[13]||(l[13]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"6,9 12,15 18,9"})],-1)]),2)]),D.value?(t(),a("div",Zs,[H.value.length===0?(t(),a("div",ea,l[14]||(l[14]=[e("p",null,"Aucun quiz trouvé avec ces filtres",-1)]))):(t(),a("div",ta,[(t(!0),a(Q,null,U(ae.value,s=>(t(),a("div",{key:s.id,class:N(["quiz-card",{"multiple-attempts":s.total_attempts>1,cooldown:G(s.quiz_id)}])},[e("div",{class:"quiz-card-header",onClick:_=>ze(s.id)},[e("div",aa,[e("h5",{class:N(["quiz-card-title clickable-title",{"cooldown-title":G(s.quiz_id)}]),onClick:$e(_=>p(s),["stop"]),title:G(s.quiz_id)?"Quiz en cooldown - Accès temporairement bloqué":"Accéder au quiz: "+s.quiz_titre},[G(s.quiz_id)?(t(),a("span",ia,"🔒")):y("",!0),K(" "+o(s.quiz_titre)+" ",1),G(s.quiz_id)?y("",!0):(t(),a("svg",na,l[15]||(l[15]=[e("path",{d:"M7 17l9.2-9.2M17 17V7H7"},null,-1)])))],10,oa),e("div",la,o(s.matiere.titre)+" → "+o(s.notion.titre),1)]),e("div",ra,[e("div",{class:N(["quiz-score",B(s.score_on_10)])},[K(o(s.score_on_10)+"/10 ",1),s.total_attempts>1?(t(),a("span",ca,"↻")):y("",!0)],2),e("button",{class:N(["expand-toggle",{expanded:we(s.id)}])},l[16]||(l[16]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"6,9 12,15 18,9"})],-1)]),2)])],8,sa),we(s.id)?(t(),a("div",da,[e("div",ua,[e("span",va,o(s.matiere.titre),1),l[17]||(l[17]=e("span",{class:"breadcrumb-separator"},"→",-1)),e("span",pa,o(s.notion.titre),1),l[18]||(l[18]=e("span",{class:"breadcrumb-separator"},"→",-1)),e("span",ma,o(s.chapitre.titre),1)]),e("div",_a,[e("span",ha,[K(" Tentative #"+o(s.tentative_numero)+" ",1),s.total_attempts>1?(t(),a("span",fa," ("+o(s.total_attempts)+" au total) ",1)):y("",!0)]),e("span",ga,o(le(s.date_creation)),1),s.temps_total_seconde?(t(),a("span",ya,o(_e(s.temps_total_seconde)),1)):y("",!0)]),G(s.quiz_id)?(t(),a("div",ba,[e("div",$a,[l[19]||(l[19]=e("span",{class:"cooldown-icon"},"⏰",-1)),e("span",ka," Prochaine tentative possible dans "+o(Y(s.quiz_id).time_remaining_formatted),1)])])):y("",!0)])):y("",!0)],2))),128))])),F.value>1?(t(),a("div",wa,[e("button",{onClick:l[3]||(l[3]=s=>u(d.value-1)),disabled:d.value<=1,class:"pagination-btn"}," ‹ Précédent ",8,Ca),e("div",xa,[(t(!0),a(Q,null,U(fe.value,s=>(t(),a("button",{key:s,onClick:_=>u(s),class:N(["pagination-page",{active:s===d.value}])},o(s),11,Sa))),128))]),e("button",{onClick:l[4]||(l[4]=s=>u(d.value+1)),disabled:d.value>=F.value,class:"pagination-btn"}," Suivant › ",8,ja)])):y("",!0)])):y("",!0)])),C.value?(t(),a("div",Pa,l[20]||(l[20]=[e("div",{class:"spinner"},null,-1),e("p",null,"Chargement des quiz...",-1)]))):y("",!0)]))}},Da=ee(za,[["__scopeId","data-v-c9b8fbbd"]]),Aa={class:"base-history"},Ia={class:"history-header"},Ea={class:"history-title"},Ta={class:"history-filters"},Ra=["value"],qa=["disabled"],Ma=["value"],Oa=["disabled"],La=["value"],Na={key:0,class:"stats-section"},Xa={key:1,class:"matiere-stats"},Qa={key:2,class:"items-list-section"},Ua={class:"section-subtitle"},Va={key:0,class:"inline-filters"},Ha={key:0,class:"items-list-content"},Ba={key:0,class:"empty-state"},Fa={key:1,class:"items-grid"},Ja={key:2,class:"pagination-container"},Ga=["disabled"],Wa={class:"pagination-pages"},Ka=["onClick"],Ya=["disabled"],Za={key:3,class:"loading-state"},eo={__name:"BaseHistory",props:{title:{type:String,required:!0},listTitle:{type:String,required:!0},loadingText:{type:String,default:"Chargement..."},apiEndpoint:{type:String,required:!0},customFilters:{type:Array,default:()=>[]},navigationHandler:{type:Function,default:null},itemsPerPage:{type:Number,default:12},filteredItems:{type:Array,default:null}},emits:["data-loaded","filter-changed"],setup(V,{expose:w,emit:k}){const C=V,x=k,S=de();ke();const j=m(!0),q=m({}),f=m([]),h=m([]),E=m([]),P=m([]),z=m([]),A=m({}),b=m(""),d=m(""),c=m(""),D=m("all"),g=m(1),i=m(new Set),r=m(!0),$=T(()=>{if(!b.value)return[];const v=parseInt(b.value);return P.value.filter(u=>{const I=typeof u.theme=="object"?u.theme?.id:u.theme;let n=null;return typeof u.theme=="object"&&(n=u.theme?.matiere_id||u.theme?.matiere?.id||null),!n&&I&&A.value[I]&&(n=A.value[I].matiere_id||A.value[I].matiere),parseInt(n)===v})}),H=T(()=>{if(!d.value)return[];const v=parseInt(d.value);return z.value.filter(p=>{const u=p.notion_id??p.notion?.id??(typeof p.notion=="number"?p.notion:null);return parseInt(u)===v})}),F=T(()=>C.filteredItems?C.filteredItems:f.value),ae=T(()=>Math.ceil(F.value.length/C.itemsPerPage)),ue=T(()=>{const v=(g.value-1)*C.itemsPerPage,p=v+C.itemsPerPage;return F.value.slice(v,p)}),fe=T(()=>{const v=[],p=ae.value,u=g.value;if(p<=7)for(let I=1;I<=p;I++)v.push(I);else if(u<=4){for(let I=1;I<=5;I++)v.push(I);p>5&&v.push("..."),v.push(p)}else if(u>=p-3){v.push(1),p>6&&v.push("...");for(let I=p-4;I<=p;I++)I>1&&v.push(I)}else{v.push(1),v.push("...");for(let I=u-1;I<=u+1;I++)v.push(I);v.push("..."),v.push(p)}return v}),ve=T(()=>E.value||[]),pe=async()=>{try{const[v,p,u,I]=await Promise.all([J.get("/api/matieres/user_matieres/"),J.get("/api/themes/notions-pour-utilisateur/"),Pe({}).catch(()=>J.get("/api/notions/pour-utilisateur/")),ce({})]);let n=[];v?.data?.matieres_disponibles?n=v.data.matieres_disponibles:v?.data?.data?n=v.data.data:Array.isArray(v?.data)&&(n=v.data);let l=[];u?.data?.notions_disponibles?l=u.data.notions_disponibles:u?.data?.data?l=u.data.data:Array.isArray(u?.data)?l=u.data:u?.data?.results&&(l=u.data.results);const s=p?.data?.themes||[],_=p?.data?.notions||[],R={};s.forEach(te=>{const M=te.matiere_id||te.matiere&&(te.matiere.id||te.matiere);R[te.id]={matiere_id:M,matiere:M}}),A.value=R,Array.isArray(_)&&_.length>0&&(l=_);const W=Array.isArray(I?.data)?I.data:I?.results||[];E.value=Array.isArray(n)?n:[],P.value=Array.isArray(l)?l:[],z.value=Array.isArray(W)?W:[],await je()}catch{try{const[p,u,I]=await Promise.all([Ie({}),Pe({}),ce({})]);E.value=Array.isArray(p?.data)?p.data:p?.results||[],P.value=Array.isArray(u?.data)?u.data:u?.results||[],z.value=Array.isArray(I?.data)?I.data:I?.results||[],await je()}catch{}}},Y=async()=>{j.value=!0;try{const v={};b.value&&(v.matiere=b.value),d.value&&(v.notion=d.value),c.value&&(v.chapitre=c.value);const u=(await J.get(C.apiEndpoint,{params:v})).data;q.value=u.global_stats||{},f.value=u.quiz_list||u.exercice_list||[],h.value=u.matiere_stats||[],x("data-loaded",u)}catch{}finally{j.value=!1}},G=async()=>{if(d.value="",c.value="",_e(),b.value&&$.value.length===0)try{const v=await J.get("/api/themes/notions-pour-utilisateur/",{params:{matiere:b.value}}),p=v?.data?.themes||[],u=v?.data?.notions||[],I={};p.forEach(_=>{const R=_.matiere_id||_.matiere&&(_.matiere.id||_.matiere);I[_.id]={matiere_id:R,matiere:R}}),A.value={...A.value,...I};let n=u;if(!Array.isArray(n)||n.length===0){const _=await J.get("/api/notions/pour-utilisateur/",{params:{matiere:b.value}});_?.data?.notions_disponibles?n=_.data.notions_disponibles:_?.data?.data?n=_.data.data:Array.isArray(_?.data)?n=_.data:_?.data?.results&&(n=_.data.results)}const l=P.value.map(_=>_.id),s=n.filter(_=>!l.includes(_.id));P.value=[...P.value,...s]}catch{}Y(),x("filter-changed",{matiere:b.value,notion:d.value,chapitre:c.value})},oe=async()=>{if(c.value="",_e(),d.value)try{let v=await Me(d.value),p=[];if(Array.isArray(v?.data)?p=v.data:v?.data?.results&&(p=v.data.results),p.length===0){const u=await ce({notion:d.value});Array.isArray(u?.data)?p=u.data:u?.data?.results&&(p=u.data.results)}if(p.length===0){const u=await J.get(`/api/notions/${d.value}/chapitres/`);Array.isArray(u?.data)?p=u.data:u?.data?.results&&(p=u.data.results)}if(p.length>0){const u=z.value.map(n=>n.id),I=p.filter(n=>!u.includes(n.id));z.value=[...z.value,...I]}}catch{}Y(),x("filter-changed",{matiere:b.value,notion:d.value,chapitre:c.value})},ie=()=>{_e(),Y(),x("filter-changed",{matiere:b.value,notion:d.value,chapitre:c.value})},me=v=>{i.value.has(v)?i.value.delete(v):i.value.add(v)},O=v=>i.value.has(v),L=()=>{r.value=!r.value},B=v=>{C.navigationHandler&&C.navigationHandler(v)},le=v=>{typeof v=="number"&&v>=1&&v<=ae.value&&(g.value=v)},_e=()=>{g.value=1},ze=v=>new Date(v).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),we=v=>{const p=Math.floor(v/60),u=v%60;return`${p}:${u.toString().padStart(2,"0")}`};return se(async()=>{if(S.isLoading||!S.isAuthenticated&&!S.id){let v=0;for(;(S.isLoading||!S.isAuthenticated)&&v<30;)await new Promise(p=>setTimeout(p,100)),v++}await pe(),await Y()}),w({formatDate:ze,formatTime:we,toggleItemDetails:me,isItemExpanded:O,navigateToItem:B,selectedCustomFilter:D,resetPagination:_e}),(v,p)=>(t(),a("div",Aa,[e("div",Ia,[e("h3",Ea,o(V.title),1),e("div",Ta,[Z((t(),a("select",{"onUpdate:modelValue":p[0]||(p[0]=u=>b.value=u),onChange:G,class:"filter-select",key:"matieres-"+ve.value.length},[p[5]||(p[5]=e("option",{value:""},"Toutes les matières",-1)),(t(!0),a(Q,null,U(ve.value,u=>(t(),a("option",{key:`matiere-${u.id}`,value:u.id},o(u.titre||u.nom),9,Ra))),128))],32)),[[he,b.value]]),Z(e("select",{"onUpdate:modelValue":p[1]||(p[1]=u=>d.value=u),onChange:oe,class:"filter-select",disabled:!b.value},[p[6]||(p[6]=e("option",{value:""},"Toutes les notions",-1)),(t(!0),a(Q,null,U($.value,u=>(t(),a("option",{key:u.id,value:u.id},o(u.titre),9,Ma))),128))],40,qa),[[he,d.value]]),Z(e("select",{"onUpdate:modelValue":p[2]||(p[2]=u=>c.value=u),onChange:ie,class:"filter-select",disabled:!d.value},[p[7]||(p[7]=e("option",{value:""},"Tous les chapitres",-1)),(t(!0),a(Q,null,U(H.value,u=>(t(),a("option",{key:u.id,value:u.id},o(u.titre),9,La))),128))],40,Oa),[[he,c.value]])])]),j.value?y("",!0):(t(),a("div",Na,[be(v.$slots,"global-stats",{stats:q.value,loading:j.value},void 0,!0)])),!j.value&&h.value.length>0?(t(),a("div",Xa,[be(v.$slots,"matiere-stats",{stats:h.value},void 0,!0)])):y("",!0),j.value?y("",!0):(t(),a("div",Qa,[e("div",{class:"items-list-header",onClick:L},[e("h4",Ua,o(V.listTitle)+" ("+o(F.value.length)+")",1),V.customFilters&&V.customFilters.length>0?(t(),a("div",Va,[be(v.$slots,"custom-filters",{filters:V.customFilters,selected:D.value},void 0,!0)])):y("",!0),e("button",{class:N(["section-toggle",{expanded:r.value}])},p[8]||(p[8]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"6,9 12,15 18,9"})],-1)]),2)]),r.value?(t(),a("div",Ha,[F.value.length===0?(t(),a("div",Ba,[be(v.$slots,"empty-state",{},()=>[p[9]||(p[9]=e("p",null,"Aucun élément trouvé avec ces filtres",-1))],!0)])):(t(),a("div",Fa,[be(v.$slots,"items-list",{items:ue.value,toggleDetails:me,isExpanded:O,navigateToItem:B},void 0,!0)])),ae.value>1?(t(),a("div",Ja,[e("button",{onClick:p[3]||(p[3]=u=>le(g.value-1)),disabled:g.value<=1,class:"pagination-btn"}," ‹ Précédent ",8,Ga),e("div",Wa,[(t(!0),a(Q,null,U(fe.value,u=>(t(),a("button",{key:u,onClick:I=>le(u),class:N(["pagination-page",{active:u===g.value}])},o(u),11,Ka))),128))]),e("button",{onClick:p[4]||(p[4]=u=>le(g.value+1)),disabled:g.value>=ae.value,class:"pagination-btn"}," Suivant › ",8,Ya)])):y("",!0)])):y("",!0)])),j.value?(t(),a("div",Za,[p[10]||(p[10]=e("div",{class:"spinner"},null,-1)),e("p",null,o(V.loadingText),1)])):y("",!0)]))}},to=ee(eo,[["__scopeId","data-v-685ade94"]]),so={class:"stats-grid"},ao={class:"stat-card exercice-completed"},oo={class:"stat-value"},io={class:"stat-card exercice-correct"},no={class:"stat-value"},lo={class:"stat-card exercice-percentage"},ro={class:"stat-value"},co={class:"stat-card exercice-notions"},uo={class:"stat-value"},vo={class:"matiere-grid"},po={class:"matiere-name"},mo={class:"matiere-info"},_o={class:"matiere-average"},ho={class:"matiere-count"},fo={class:"inline-mastery-filters"},go=["onClick"],yo={class:"inline-mastery-icon"},bo={class:"inline-mastery-label"},$o=["onClick"],ko={class:"exercice-card-title-section"},wo=["onClick","title"],Co={class:"exercice-breadcrumb-compact"},xo={class:"exercice-card-actions"},So={key:0,class:"exercice-card-details"},jo={class:"exercice-breadcrumb"},Po={class:"breadcrumb-item"},zo={class:"breadcrumb-item"},Do={class:"breadcrumb-item"},Ao={class:"exercice-meta"},Io={class:"exercice-date"},Eo={key:0,class:"exercice-time"},To={key:1,class:"exercice-points"},Ro={__name:"ExercicesHistory",setup(V,{expose:w}){const k=ke(),C=m(null),x=[{value:"all",label:"Tous",icon:"",class:"all"},{value:"correct",label:"Réussis",icon:"✅",class:"correct"},{value:"incorrect",label:"Ratés",icon:"❌",class:"incorrect"}],S=m("all"),j=m([]),q=T(()=>{let d=j.value;return S.value!=="all"&&(d=d.filter(c=>{switch(S.value){case"correct":return c.est_correct===!0;case"incorrect":return c.est_correct===!1;default:return!0}})),d}),f=d=>{j.value=d.exercice_list||[]},h=d=>{},E=d=>d?"status-correct":"status-incorrect",P=async d=>{try{const c=d.exercice_id;await k.push({name:"ExerciceDetail",params:{exerciceId:String(c)}})}catch{}},z=d=>new Date(d).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),A=d=>{const c=Math.floor(d/60),D=d%60;return`${c}:${D.toString().padStart(2,"0")}`},b=d=>{S.value=d};return w({updateSelectedMastery:b}),(d,c)=>(t(),Se(to,{ref_key:"baseHistoryRef",ref:C,title:"🧭 Historique des Exercices","list-title":"📝 Exercices effectués","loading-text":"Chargement des exercices...","api-endpoint":"/api/suivis/exercices/stats/","custom-filters":x,"navigation-handler":P,"items-per-page":12,"filtered-items":q.value,onDataLoaded:f,onFilterChanged:h},{"global-stats":re(({stats:D})=>[e("div",so,[e("div",ao,[c[0]||(c[0]=e("span",{class:"stat-label"},"Exercices effectués",-1)),e("span",oo,o(D.completed||0),1)]),e("div",io,[c[1]||(c[1]=e("span",{class:"stat-label"},"Exercices réussis",-1)),e("span",no,o(D.correct||0),1)]),e("div",lo,[c[2]||(c[2]=e("span",{class:"stat-label"},"Taux de réussite",-1)),e("span",ro,o(D.percentage||0)+"%",1)]),e("div",co,[c[3]||(c[3]=e("span",{class:"stat-label"},"Notions maîtrisées",-1)),e("span",uo,o(D.masteredNotions||0),1)])])]),"matiere-stats":re(({stats:D})=>[c[4]||(c[4]=e("h4",{class:"section-subtitle"},"📊 Moyennes par matière",-1)),e("div",vo,[(t(!0),a(Q,null,U(D,g=>(t(),a("div",{key:g.id,class:"matiere-card"},[e("div",po,o(g.titre),1),e("div",mo,[e("span",_o,o(g.average)+"/10",1),e("span",ho,o(g.exercice_count)+" exercices",1)])]))),128))])]),"custom-filters":re(({filters:D,selected:g})=>[e("div",fo,[(t(!0),a(Q,null,U(D,i=>(t(),a("button",{key:i.value,onClick:$e(r=>b(i.value),["stop"]),class:N(["inline-mastery-btn",i.class,{active:S.value===i.value}])},[e("span",yo,o(i.icon),1),e("span",bo,o(i.label),1)],10,go))),128))])]),"items-list":re(({items:D,toggleDetails:g,isExpanded:i,navigateToItem:r})=>[(t(!0),a(Q,null,U(D,$=>(t(),a("div",{key:$.id,class:N(["exercice-card",{correct:$.est_correct,incorrect:!$.est_correct}])},[e("div",{class:"exercice-card-header",onClick:H=>g($.id)},[e("div",ko,[e("h5",{class:"exercice-card-title clickable-title",onClick:$e(H=>r($),["stop"]),title:"Accéder à l'exercice: "+$.exercice_titre},[K(o($.exercice_titre)+" ",1),c[5]||(c[5]=e("svg",{class:"navigation-icon",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M7 17l9.2-9.2M17 17V7H7"})],-1))],8,wo),e("div",Co,o($.matiere.titre)+" → "+o($.notion.titre),1)]),e("div",xo,[e("div",{class:N(["exercice-status",E($.est_correct)])},o($.est_correct?"✅":"❌"),3),e("button",{class:N(["expand-toggle",{expanded:i($.id)}])},c[6]||(c[6]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"6,9 12,15 18,9"})],-1)]),2)])],8,$o),i($.id)?(t(),a("div",So,[e("div",jo,[e("span",Po,o($.matiere.titre),1),c[7]||(c[7]=e("span",{class:"breadcrumb-separator"},"→",-1)),e("span",zo,o($.notion.titre),1),c[8]||(c[8]=e("span",{class:"breadcrumb-separator"},"→",-1)),e("span",Do,o($.chapitre.titre),1)]),e("div",Ao,[e("span",Io,o(z($.date_creation)),1),$.temps_seconde?(t(),a("span",Eo,o(A($.temps_seconde)),1)):y("",!0),$.points_obtenus?(t(),a("span",To,o($.points_obtenus)+" points ",1)):y("",!0)])])):y("",!0)],2))),128))]),"empty-state":re(()=>c[9]||(c[9]=[e("p",null,"Aucun exercice trouvé avec ces filtres",-1),e("p",{class:"empty-hint"},"Essayez de modifier vos filtres ou commencez à faire des exercices !",-1)])),_:1},8,["filtered-items"]))}},qo=ee(Ro,[["__scopeId","data-v-7d5fc64f"]]),Mo={class:"daily-objectives-card"},Oo={class:"objective-icon"},Lo={class:"objective-content"},No={class:"objective-text"},Xo={class:"objective-progress"},Qo={class:"progress-bar"},Uo={class:"progress-text"},Vo={key:1,class:"no-objective"},Ho={key:2,class:"completion-badge"},Bo={class:"objectives-list"},Fo={class:"objective-info"},Jo={class:"objective-icon-small"},Go={class:"objective-details"},Wo={class:"objective-text-small"},Ko={class:"objective-description"},Yo={class:"objective-reward"},Zo={class:"objective-status"},ei={class:"progress-info"},ti={class:"progress-bar-modal"},si={key:0,class:"status-completed"},ai={class:"modal-footer"},oi={class:"daily-summary"},ii={class:"summary-stat"},ni={class:"stat-value"},li={class:"summary-stat"},ri={class:"stat-value"},ci={__name:"DailyObjectives",setup(V){const w=m(!1),{currentObjective:k,unlockedObjectivesList:C,unlockedObjectives:x,allObjectives:S,userStats:j,loadTodayStats:q,simulateQuizEasy:f,simulateQuizMedium:h,simulateQuizHard:E,simulateQuizPerfect:P,simulateExerciseCompleted:z,simulateQuizStreak:A}=Ze(),b=m(0),d=T(()=>(b.value,C.value.filter(O=>O.isCompleted).length)),c=T(()=>(b.value,C.value.filter(O=>O.isCompleted).reduce((O,L)=>O+L.xpReward,0))),D=()=>{w.value=!0},g=()=>{w.value=!1},i=T(()=>{if(b.value,!k.value)return 0;const O=k.value.progress,L=k.value.target;return Math.min(O/L*100,100)}),r=()=>i.value,$=O=>O>=100?"completed":O>=75?"almost-done":O>=25?"half-way":O>0?"starting":"",H=()=>f(),F=()=>h(),ae=()=>E(),ue=()=>P(),fe=()=>z(),ve=()=>A(Math.floor(Math.random()*8)+1),pe=O=>{b.value++,q(),setTimeout(()=>{k.value},100)},Y=O=>{b.value++},G=O=>{b.value++};Ae(j,(O,L)=>{b.value++},{deep:!0}),Ae(x,(O,L)=>{b.value++},{deep:!0});let oe=null;const ie=()=>{oe=setInterval(()=>{q(),b.value++},2e3)},me=()=>{oe&&(clearInterval(oe),oe=null)};return se(()=>{window.addEventListener("dailyObjectiveProgress",pe),window.addEventListener("objectiveUnlocked",Y),window.addEventListener("dailyObjectiveCompleted",G),ie()}),Je(()=>{window.removeEventListener("dailyObjectiveProgress",pe),window.removeEventListener("objectiveUnlocked",Y),window.removeEventListener("dailyObjectiveCompleted",G),me()}),window.testDailyObjectives={quizEasy:H,quizMedium:F,quizHard:ae,quizPerfect:ue,exerciseCompleted:fe,quizStreak:ve},(O,L)=>(t(),a(Q,null,[e("div",Mo,[e("div",{class:"objective-header"},[L[1]||(L[1]=e("div",{class:"objective-title"},"🎯 Défi du jour",-1)),e("button",{class:"see-more-btn",onClick:D}," Voir tous les défis ")]),X(k)?(t(),a("div",{class:"current-objective",key:b.value},[e("div",Oo,o(X(k).icon),1),e("div",Lo,[e("div",No,o(X(k).text),1),e("div",Xo,[e("div",Qo,[e("div",{class:N(["progress-fill",$(i.value)]),style:xe({width:i.value+"%"})},null,6)]),e("div",Uo,o(X(k).progress)+" / "+o(X(k).target),1)])])])):(t(),a("div",Vo," 🎉 Tous les défis du jour sont terminés ! Revenez demain pour de nouveaux défis. ")),X(k)&&X(k).isCompleted?(t(),a("div",Ho," ✅ Défi complété ! +"+o(X(k).xpReward)+" XP ",1)):y("",!0)]),w.value?(t(),a("div",{key:0,class:"modal-overlay",onClick:g},[e("div",{class:"modal-content",onClick:L[0]||(L[0]=$e(()=>{},["stop"]))},[e("div",{class:"modal-header"},[L[2]||(L[2]=e("h3",null,"🎯 Vos défis journaliers",-1)),e("button",{class:"close-btn",onClick:g},"×")]),e("div",Bo,[(t(!0),a(Q,null,U(X(S),(B,le)=>(t(),a("div",{key:le,class:N(["objective-item",{completed:B.isCompleted,locked:!B.isUnlocked}])},[e("div",Fo,[e("div",Jo,o(B.icon),1),e("div",Go,[e("div",Wo,o(B.name),1),e("div",Ko,o(B.text),1),e("div",Yo,"+"+o(B.xpReward)+" XP",1)])]),e("div",Zo,[e("div",ei,o(B.progress)+" / "+o(B.target),1),e("div",ti,[e("div",{class:N(["progress-fill-modal",{completed:B.isCompleted}]),style:xe({width:B.percentage+"%"})},null,6)]),B.isCompleted?(t(),a("div",si," ✅ Terminé ")):y("",!0)])],2))),128))]),e("div",ai,[e("div",oi,[e("div",ii,[L[3]||(L[3]=e("span",{class:"stat-label"},"Défis complétés :",-1)),e("span",ni,o(d.value)+" / "+o(X(S).length),1)]),e("div",li,[L[4]||(L[4]=e("span",{class:"stat-label"},"XP gagnés aujourd'hui :",-1)),e("span",ri,"+"+o(c.value),1)])]),L[5]||(L[5]=e("p",{class:"modal-note"}," Tous les défis se réinitialisent chaque jour à minuit. Bonne chance ! ",-1))])])])):y("",!0),ne(Ne)],64))}},di=ee(ci,[["__scopeId","data-v-93456603"]]),ui={class:"streak-test-container"},vi={class:"status-grid"},pi={class:"status-card"},mi={class:"status-content"},_i={class:"status-value"},hi={class:"status-card"},fi={class:"status-content"},gi={class:"status-value"},yi={class:"status-card"},bi={class:"status-content"},$i={class:"status-value"},ki={class:"status-card"},wi={class:"status-content"},Ci={class:"simulation-section"},xi={class:"simulation-buttons"},Si={key:0,class:"test-results"},ji={class:"results-list"},Pi={class:"result-time"},zi={class:"result-message"},Di={__name:"StreakTestButton",setup(V){const w=de(),{currentStreak:k,isStreakCheckedToday:C,checkDailyStreak:x,resetStreak:S,initializeStreak:j}=qe(),{updateUserXPInstantly:q}=Xe(),f=m([]),h=(i,r="info")=>{const $=new Date().toLocaleTimeString();f.value.unshift({timestamp:$,message:i,type:r}),f.value.length>8&&(f.value=f.value.slice(0,8))},E=i=>{try{h(`🎭 Simulation du jour ${i}...`,"info");const r=new Date,$=new Date(r);$.setDate(r.getDate()-1);const H=$.toISOString().split("T")[0],F=i-1;localStorage.setItem("lastLoginDate",H),localStorage.setItem("currentStreak",F.toString()),localStorage.removeItem("streakCheckedToday"),k.value=F,C.value=!1,h(`✅ Streak de ${i} jours simulé (dernière connexion: ${H})`,"success"),setTimeout(()=>{A()},500)}catch(r){h(`❌ Erreur simulation jour ${i}: ${r.message}`,"error")}},P=()=>{try{h("💔 Simulation rupture de streak...","warning");const i=new Date,r=new Date(i);r.setDate(i.getDate()-3);const $=r.toISOString().split("T")[0];localStorage.setItem("lastLoginDate",$),localStorage.setItem("currentStreak","0"),localStorage.removeItem("streakCheckedToday"),k.value=0,C.value=!1,h("✅ Rupture de streak simulée (3 jours d'écart)","warning"),setTimeout(()=>{A()},500)}catch(i){h(`❌ Erreur simulation rupture: ${i.message}`,"error")}},z=()=>{try{h("🔄 Reset de la simulation...","info");const i=new Date().toISOString().split("T")[0];localStorage.setItem("lastLoginDate",i),localStorage.setItem("currentStreak","0"),localStorage.removeItem("streakCheckedToday"),k.value=0,C.value=!1,h("✅ Simulation remise à aujourd'hui (streak: 0)","success")}catch(i){h(`❌ Erreur reset simulation: ${i.message}`,"error")}},A=async()=>{try{h("🔄 Vérification du streak...","info");const i=await x();i.success?i.alreadyChecked?h("✅ Streak déjà vérifié aujourd'hui","success"):h(`🎉 Streak: ${i.streakDays} jours, +${i.xpGained} XP`,"success"):h(`❌ Erreur: ${i.reason||"inconnue"}`,"error")}catch(i){h(`❌ Erreur: ${i.message}`,"error")}},b=async()=>{try{h("➕ Test +5 XP...","info");const i=w.xp||0;if((await q(5,"test_manual")).success){const $=w.xp||0;h(`✅ XP: ${i} → ${$} (+5)`,"success")}else h("❌ Échec mise à jour XP","error")}catch(i){h(`❌ Erreur: ${i.message}`,"error")}},d=async()=>{try{h("➖ Test -5 XP...","info");const i=w.xp||0;if((await q(-5,"test_manual_decrease")).success){const $=w.xp||0;h(`✅ XP: ${i} → ${$} (-5)`,"success")}else h("❌ Échec diminution XP","error")}catch(i){h(`❌ Erreur: ${i.message}`,"error")}},c=()=>{try{S(),h("🗑️ Streak remis à zéro","warning")}catch(i){h(`❌ Erreur reset: ${i.message}`,"error")}},D=async()=>{try{h("🔄 Rafraîchissement...","info"),j(),h("✅ Données rafraîchies","success")}catch(i){h(`❌ Erreur: ${i.message}`,"error")}},g=()=>{f.value=[]};return se(()=>{h("🚀 Test Badges & Streak chargé","info")}),(i,r)=>(t(),a("div",ui,[r[18]||(r[18]=e("div",{class:"test-header"},[e("h3",null,"🧪 Test Badges & Streak"),e("p",{class:"test-subtitle"},"Interface de test pour administrateur")],-1)),e("div",vi,[e("div",pi,[r[8]||(r[8]=e("span",{class:"status-icon"},"🔥",-1)),e("div",mi,[r[7]||(r[7]=e("span",{class:"status-label"},"Streak",-1)),e("span",_i,o(X(k))+" jours",1)])]),e("div",hi,[r[10]||(r[10]=e("span",{class:"status-icon"},"⭐",-1)),e("div",fi,[r[9]||(r[9]=e("span",{class:"status-label"},"XP",-1)),e("span",gi,o(X(w).xp||0),1)])]),e("div",yi,[r[12]||(r[12]=e("span",{class:"status-icon"},"🏆",-1)),e("div",bi,[r[11]||(r[11]=e("span",{class:"status-label"},"Niveau",-1)),e("span",$i,o(X(w).level||0),1)])]),e("div",ki,[r[14]||(r[14]=e("span",{class:"status-icon"},"📅",-1)),e("div",wi,[r[13]||(r[13]=e("span",{class:"status-label"},"Vérifié",-1)),e("span",{class:N(["status-value",{checked:X(C)}])},o(X(C)?"Oui":"Non"),3)])])]),e("div",Ci,[r[15]||(r[15]=e("h4",null,"🎭 Simulation de Jours",-1)),r[16]||(r[16]=e("p",{class:"simulation-info"},"Simulez différents jours pour tester le streak",-1)),e("div",xi,[e("button",{onClick:r[0]||(r[0]=$=>E(1)),class:"sim-btn day-1"}," 📅 Jour 1 "),e("button",{onClick:r[1]||(r[1]=$=>E(2)),class:"sim-btn day-2"}," 📅 Jour 2 "),e("button",{onClick:r[2]||(r[2]=$=>E(3)),class:"sim-btn day-3"}," 📅 Jour 3 "),e("button",{onClick:r[3]||(r[3]=$=>E(4)),class:"sim-btn day-4"}," 📅 Jour 4 "),e("button",{onClick:r[4]||(r[4]=$=>E(5)),class:"sim-btn day-5"}," 📅 Jour 5 "),e("button",{onClick:r[5]||(r[5]=$=>E(7)),class:"sim-btn day-7"}," 📅 Jour 7 "),e("button",{onClick:r[6]||(r[6]=$=>E(10)),class:"sim-btn day-10"}," 📅 Jour 10 ")]),e("div",{class:"simulation-controls"},[e("button",{onClick:P,class:"sim-btn break"}," 💔 Casser le Streak "),e("button",{onClick:z,class:"sim-btn reset"}," 🔄 Reset Simulation ")])]),e("div",{class:"test-actions"},[e("button",{onClick:A,class:"test-btn primary"}," 🔄 Vérifier Streak "),e("button",{onClick:b,class:"test-btn success"}," ➕ +5 XP "),e("button",{onClick:d,class:"test-btn danger"}," ➖ -5 XP "),e("button",{onClick:c,class:"test-btn warning"}," 🗑️ Reset "),e("button",{onClick:D,class:"test-btn info"}," 🔄 Refresh ")]),f.value.length>0?(t(),a("div",Si,[e("div",{class:"results-header"},[r[17]||(r[17]=e("h4",null,"📊 Résultats des tests",-1)),e("button",{onClick:g,class:"clear-btn"},"🗑️")]),e("div",ji,[(t(!0),a(Q,null,U(f.value,($,H)=>(t(),a("div",{key:H,class:N(["result-item",$.type])},[e("span",Pi,o($.timestamp),1),e("span",zi,o($.message),1)],2))),128))])])):y("",!0)]))}},Ai=ee(Di,[["__scopeId","data-v-d8c0f382"]]),Ii={class:"dashboard-content"},Ei={class:"dashboard-center-top"},Ti={key:0,class:"dashboard-spinner"},Ri={key:1},qi={class:"section leaderboard-section"},Mi={class:"leaderboard-grid"},Oi={class:"leaderboard-container"},Li={class:"level-container"},Ni={key:0},Xi={key:1},Qi={key:2,class:"dashboard-spinner"},Ui={key:3,class:"section"},Vi={__name:"DashboardStudent",setup(V){const w=de();Qe(),ke();const k=m({done:0,acquired:0,not_acquired:0}),C=m(!0),x=m([]),S=m([]),j=m([]),q=m({}),f=m({}),h=m([]),E=m(null);T(()=>x.value.length?[...x.value].sort((A,b)=>new Date(b.date_creation)-new Date(A.date_creation))[0]:null);function P(){q.value=Object.fromEntries(S.value.map(z=>[z.id,z])),f.value=Object.fromEntries(j.value.map(z=>[z.id,z]))}return se(async()=>{try{const[z,A,b,d,c,D]=await Promise.all([We({}),ce({}),Ke(),Ie(),Ue().catch(()=>null),Ve().catch(()=>null)]),g=r=>Array.isArray(r)?r:r?.results||[];S.value=g(z),j.value=g(A),x.value=g(b?.data),h.value=g(d?.data??d),E.value=D?.data?.data||null;const i=c?.data?.data;i&&(w.xp=i.xp??w.xp,w.level=i.level??w.level,w.xp_to_next=i.xp_to_next??i.next_level_xp-i.xp),P(),k.value.done=x.value.length,k.value.acquired=x.value.filter(r=>r.est_correct===!0).length,k.value.not_acquired=x.value.filter(r=>r.est_correct===!1).length}catch{}C.value=!1}),(z,A)=>(t(),a("div",Ii,[ne(Cs),e("div",Ei,[X(w).isLoading?(t(),a("div",Ti,A[0]||(A[0]=[e("span",{class:"spinner"},null,-1)]))):(t(),a("h1",Ri," Bienvenue "+o(X(w).firstName)+" sur votre tableau de bord ",1))]),e("div",qi,[e("div",Mi,[e("div",Oi,[ne(Wt)]),e("div",Li,[ne($s),ne(di)])])]),C.value?y("",!0):(t(),a("div",Ni,[ne(Da)])),C.value?y("",!0):(t(),a("div",Xi,[ne(qo)])),C.value?(t(),a("div",Qi,A[1]||(A[1]=[e("span",{class:"spinner"},null,-1)]))):y("",!0),X(w).isAdmin?(t(),a("div",Ui,[A[2]||(A[2]=e("div",{class:"section-header"},[e("h3",{class:"section-title"},"🧪 Tests (Admin uniquement)")],-1)),ne(Ai)])):y("",!0)]))}},Hi=ee(Vi,[["__scopeId","data-v-1d784f6f"]]),Bi={class:"parent-dashboard"},Fi={class:"add-child"},Ji=["disabled"],Gi={key:0,class:"hint"},Wi={class:"create-child"},Ki={class:"form-row"},Yi={class:"form-row"},Zi=["disabled"],en={key:0,class:"hint"},tn={key:1,class:"temp-pass"},sn={key:0,class:"loading"},an={key:1},on={key:0,class:"empty"},nn={key:1,class:"children-grid"},ln={class:"child-header"},rn={class:"avatar"},cn={class:"child-info"},dn={class:"name"},un={key:0,class:"flag"},vn={class:"meta"},pn={key:0},mn={class:"xp"},_n={class:"xp-value"},hn={class:"level"},fn={class:"child-body"},gn={class:"metrics-grid"},yn={class:"metric"},bn={class:"bar"},$n={class:"hint"},kn={class:"metric small"},wn={class:"kpi"},Cn={class:"metric small ok"},xn={class:"kpi"},Sn={class:"metric small ko"},jn={class:"kpi"},Pn={key:0,class:"last-activity"},zn={class:"activity-line"},Dn={class:"activity-title"},An={key:0,class:"activity-meta"},In={class:"actions"},En=["onClick"],Tn=["onClick","disabled"],Rn={__name:"DashboardParent",setup(V){const w=m(!0),k=m([]),C=ke(),x=m(""),S=m(!1),j=m(""),q=m(null),f=m(!1),h=m(""),E=m(""),P=m({first_name:"",last_name:"",email:""});function z(g){if(!g)return"E";const i=String(g).trim().split(/\s+/);return i.length===1?i[0].substring(0,2).toUpperCase():(i[0].substring(0,1)+i[1].substring(0,1)).toUpperCase()}function A(g){C.push({name:"ChildOverview",params:{childId:String(g)}})}se(async()=>{try{const i=(await Re())?.data?.data||{};k.value=i.children||[]}catch{k.value=[]}finally{w.value=!1}});async function b(){try{const i=(await Re())?.data?.data||{};k.value=i.children||[]}catch{k.value=[]}}async function d(){j.value="";const g=String(x.value||"").trim();if(!g){j.value="Renseignez l'email de l'élève";return}S.value=!0;try{await He({email:g}),x.value="",j.value="Élève ajouté ✅",await b()}catch{j.value="Impossible d'ajouter cet élève"}finally{S.value=!1,setTimeout(()=>{j.value=""},2500)}}async function c(g){q.value=g;try{await Be(g),await b()}catch{}q.value=null}async function D(){h.value="",E.value="";const g={first_name:String(P.value.first_name||"").trim(),last_name:String(P.value.last_name||"").trim(),email:String(P.value.email||"").trim().toLowerCase()};if(!g.first_name||!g.last_name||!g.email){h.value="Renseignez prénom, nom et email";return}f.value=!0;try{const r=(await J.post("/api/users/me/children/create/",g))?.data?.data||{};E.value=r.temp_password||"",h.value="Compte créé et lié ✅",P.value={first_name:"",last_name:"",email:""},await b()}catch{h.value="Création impossible (email déjà utilisé?)"}finally{f.value=!1,setTimeout(()=>{h.value=""},3e3)}}return(g,i)=>(t(),a("div",Bi,[i[13]||(i[13]=e("div",{class:"header"},[e("h1",null,"Tableau de bord Parent"),e("p",{class:"subtitle"},"Suivez la progression de vos enfants, simplement.")],-1)),e("div",Fi,[Z(e("input",{"onUpdate:modelValue":i[0]||(i[0]=r=>x.value=r),type:"email",placeholder:"Email de l'élève",class:"input"},null,512),[[Ce,x.value]]),e("button",{class:"btn",disabled:S.value,onClick:d},"Ajouter",8,Ji),j.value?(t(),a("span",Gi,o(j.value),1)):y("",!0)]),e("div",Wi,[e("details",null,[i[5]||(i[5]=e("summary",null,"Créer un compte pour un enfant",-1)),e("div",Ki,[Z(e("input",{"onUpdate:modelValue":i[1]||(i[1]=r=>P.value.first_name=r),class:"input",placeholder:"Prénom"},null,512),[[Ce,P.value.first_name]]),Z(e("input",{"onUpdate:modelValue":i[2]||(i[2]=r=>P.value.last_name=r),class:"input",placeholder:"Nom"},null,512),[[Ce,P.value.last_name]])]),e("div",Yi,[Z(e("input",{"onUpdate:modelValue":i[3]||(i[3]=r=>P.value.email=r),class:"input",placeholder:"Email"},null,512),[[Ce,P.value.email]])]),e("button",{class:"btn",disabled:f.value,onClick:D},"Créer le compte",8,Zi),h.value?(t(),a("div",en,o(h.value),1)):y("",!0),E.value?(t(),a("div",tn,[i[4]||(i[4]=K("Mot de passe temporaire: ")),e("code",null,o(E.value),1)])):y("",!0)])]),w.value?(t(),a("div",sn,i[6]||(i[6]=[e("span",{class:"spinner"},null,-1)]))):(t(),a("div",an,[k.value.length===0?(t(),a("div",on,i[7]||(i[7]=[e("p",null,"Aucun enfant rattaché pour le moment.",-1)]))):(t(),a("div",nn,[(t(!0),a(Q,null,U(k.value,r=>(t(),a("div",{class:"child-card",key:r.id},[e("div",ln,[e("div",rn,o(z(r.display_name)),1),e("div",cn,[e("div",dn,[r.pays_flag?(t(),a("span",un,o(r.pays_flag),1)):y("",!0),K(" "+o(r.display_name),1)]),e("div",vn,[r.niveau?(t(),a("span",pn,o(r.niveau),1)):y("",!0)])]),e("div",mn,[e("div",_n,o(r.xp)+" XP",1),e("div",hn,"Niveau "+o(r.level),1)])]),e("div",fn,[e("div",gn,[e("div",yn,[i[8]||(i[8]=e("div",{class:"label"},"Objectif hebdo",-1)),e("div",bn,[e("div",{class:"fill",style:xe({width:(r.metrics?.weekly_progress||0)+"%"})},null,4)]),e("div",$n,o(r.metrics?r.metrics.weekly_done+" / "+r.metrics.weekly_goal:"—"),1)]),e("div",kn,[e("div",wn,o(r.metrics?.done_total??"—"),1),i[9]||(i[9]=e("div",{class:"kpi-label"},"Exercices",-1))]),e("div",Cn,[e("div",xn,o(r.metrics?.acquired_count??"—"),1),i[10]||(i[10]=e("div",{class:"kpi-label"},"Acquis",-1))]),e("div",Sn,[e("div",jn,o(r.metrics?.not_acquired_count??"—"),1),i[11]||(i[11]=e("div",{class:"kpi-label"},"À revoir",-1))])]),r.last_activity?(t(),a("div",Pn,[i[12]||(i[12]=e("div",{class:"label"},"Dernière activité",-1)),e("div",zn,[e("span",Dn,o(r.last_activity.exercice_title),1),r.last_activity.chapitre_title?(t(),a("span",An,"• "+o(r.last_activity.chapitre_title),1)):y("",!0)])])):y("",!0),e("div",In,[e("button",{class:"btn",onClick:$=>A(r.id)},"Voir détails",8,En),e("button",{class:"btn secondary",onClick:$=>c(r.id),disabled:q.value===r.id},"Retirer",8,Tn)])])]))),128))]))]))]))}},qn=ee(Rn,[["__scopeId","data-v-e116edd0"]]),Gn={__name:"Dashboard",setup(V){const w=de(),k=T(()=>w.role==="parent"?qn:Hi);return(C,x)=>(t(),Se(Oe,null,{default:re(()=>[(t(),Se(Ge(k.value)))]),_:1}))}};export{Gn as default};
