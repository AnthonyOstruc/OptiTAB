import{_ as X,h as p,m as $,p as Y,s as Z,c as u,a as t,b as x,k as c,z as C,F as S,e as T,d as f,t as l,v as b,l as j,i as z,a2 as ee,o as s,j as te,u as ne}from"./index-C20tTf3S.js";import{a as ie,g as oe,l as P,c as le,m as ae,n as re}from"./curriculum-C6dJwtfd.js";import"./PaysNiveauxSelector.vue_vue_type_style_index_0_scoped_6652d9f9_lang-l0sNRNKZ.js";import"./PaysNiveauxDisplay.vue_vue_type_style_index_0_scoped_821033d6_lang-l0sNRNKZ.js";import{A as ue}from"./AdminActionsButtons-BF654C6o.js";import{E as se}from"./ExerciceQCM-DJualaHI.js";import"./exercices-D5_EwlUY.js";const de={class:"form-group"},pe=["value"],ce={key:0,class:"context-panel"},ve={class:"context-row"},me={class:"context-row"},fe={class:"context-row"},ye={class:"context-row"},ge={class:"context-row"},we={class:"context-row"},he={class:"form-group"},xe={class:"form-group"},Ce={class:"form-group"},be={class:"form-group"},Ne={class:"btn-primary",type:"submit"},Ee={key:0,class:"preview-section"},ke={class:"preview-item"},De={class:"filters"},Se={class:"filter-group"},Te=["disabled"],Ve=["value"],qe={class:"filter-group"},Me={class:"filter-group"},Ae={class:"admin-table"},Be={class:"ctx-cell"},Ue={key:0},Fe={class:"modal-description"},_e={class:"modal-form"},$e={class:"form-group"},je=["value"],ze={class:"form-group"},Pe={class:"modal-actions"},Ie=["disabled"],Le={__name:"AdminExercices",setup(Qe){const V=p([]),v=p([]),M=p([]);p({});const o=p({id:null,chapitre:"",nom:"",enonce:"",solution:"",difficulte:"moyen",niveaux:[]}),d=p({chapitre:"",type:"",nom:""}),N=p(!1),m=p(null),E=p(!1),a=p({originalExercice:null,newChapitre:"",newTitre:""}),A=$(()=>{let n=V.value;if(d.value.chapitre&&(n=n.filter(e=>e.chapitre==d.value.chapitre)),d.value.type&&(n=n.filter(e=>e.type===d.value.type)),d.value.nom){const e=String(d.value.nom).toLowerCase();n=n.filter(i=>String(i.titre||i.nom||i.question||i.contenu||"").toLowerCase().includes(e))}return n});async function I(){try{const[n,e]=await Promise.all([ie(),oe()]);v.value=n||[],M.value=e||[],await y()}catch(n){console.error("[AdminExercices] Erreur chargement chapitres:",n)}}Y(I),Z(()=>o.value.chapitre,async()=>{await y()});async function y(){try{const n={};o.value.chapitre&&(n.chapitre=Number(o.value.chapitre)),V.value=await le(n)}catch(n){console.error("[AdminExercices] Erreur lors du chargement exercices:",n),V.value=[]}}function B(){o.value={id:null,chapitre:"",nom:"",type:"",enonce:"",solution:"",difficulte:"moyen",niveaux:[]},N.value=!1,m.value=null}async function L(){if(!(!o.value.chapitre||!o.value.enonce))try{const n={facile:"easy",moyen:"medium",difficile:"hard"},e={chapitre:Number(o.value.chapitre),titre:o.value.nom||"Exercice",contenu:o.value.enonce,difficulty:n[o.value.difficulte]||"medium",question:o.value.enonce,reponse_correcte:o.value.solution||"",points:1};o.value.id?await ae(o.value.id,e):await P(e),B(),await y()}catch(n){console.error("[AdminExercices] Erreur:",n)}}function Q(n){const e=n.niveaux?n.niveaux.map(r=>r.id):[],i={easy:"facile",medium:"moyen",hard:"difficile"};o.value={id:n.id,chapitre:n.chapitre,nom:n.titre||n.nom||"",enonce:n.contenu||n.question||n.enonce||"",solution:n.reponse_correcte||n.solution||"",difficulte:i[n.difficulty]||n.difficulte||"moyen",niveaux:e},N.value=!1,m.value=null,console.log("üîç Exercice √† √©diter:",n),console.log("üìù Formulaire rempli:",o.value)}async function R(n){try{await re(n),await y()}catch(e){console.error("Erreur:",e)}}function G(n){R(n.id)}function O(n){a.value={originalExercice:n,newChapitre:"",newTitre:`${n.titre||n.nom}`},E.value=!0}async function H(){if(!a.value.newChapitre||!a.value.newTitre.trim()){alert("Veuillez s√©lectionner un chapitre et saisir un titre pour la copie.");return}try{const n=a.value.originalExercice,e={easy:"easy",medium:"medium",hard:"hard"},i={chapitre:Number(a.value.newChapitre),titre:a.value.newTitre.trim(),contenu:n.contenu||n.question||n.enonce||"",difficulty:n.difficulty||e[n.difficulte]||"medium",question:n.contenu||n.question||n.enonce||"",reponse_correcte:n.reponse_correcte||n.solution||"",etapes:n.etapes||"",points:n.points||1};await P(i),await y(),E.value=!1,a.value={originalExercice:null,newChapitre:"",newTitre:""},alert("Exercice dupliqu√© avec succ√®s !")}catch(n){console.error("Erreur lors de la duplication:",n),alert("Erreur lors de la duplication de l'exercice.")}}function U(){E.value=!1,a.value={originalExercice:null,newChapitre:"",newTitre:""}}function J(){if(!o.value.nom||!o.value.enonce){alert("Veuillez remplir au moins le titre et l'√©nonc√© pour pr√©visualiser");return}const n={facile:"easy",moyen:"medium",difficile:"hard"};m.value={titre:o.value.nom,instruction:o.value.enonce,etapes:"",solution:o.value.solution||"",difficulty:n[o.value.difficulte]||"medium"},N.value=!0}function K(n){const e=v.value.find(i=>String(i.id)===String(n));return e?e.nom:n}function k(n){return M.value.find(e=>String(e.id)===String(n))}function D(n){if(!n)return null;const e=k(n.notion);if(!e)return{themeNom:"",matiereNom:"",paysNom:"",niveauNom:""};const i=e.matiere_nom||e.contexte_detail&&e.contexte_detail.matiere_nom||"",r=e.theme_nom||"",q=e.contexte_detail&&e.contexte_detail.pays?e.contexte_detail.pays.nom:"",h=e.contexte_detail&&e.contexte_detail.niveau?e.contexte_detail.niveau.nom:"";return{matiereNom:i,themeNom:r,paysNom:q,niveauNom:h}}const g=$(()=>{const n=v.value.find(e=>String(e.id)===String(o.value.chapitre));return n?D(n):null});function F(n){const e=k(n.notion),i=D(n);return[n.nom,e?`‚Äî ${e.nom}`:"",i&&i.matiereNom?`‚Äî ${i.matiereNom}`:"",i&&(i.paysNom||i.niveauNom)?`‚Äî ${[i.paysNom,i.niveauNom].filter(Boolean).join(" ¬∑ ")}`:""].filter(Boolean).join(" ")}function w(n){return String(n||"").normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"")}function _(n){const e=v.value.find(h=>String(h.id)===String(n));if(!e)return"";const i=k(e.notion),r=D(e);return[r?.matiereNom,r?.themeNom,i?.nom,e.nom,r?.paysNom,r?.niveauNom].filter(Boolean).join(" ‚Ä∫ ")}function W(n){const e=v.value.find(h=>String(h.id)===String(n));if(!e)return"";const i=k(e.notion),r=D(e);return[w(i?.nom),w(r?.themeNom),w(r?.matiereNom),w(r?.paysNom),w(r?.niveauNom)].filter(Boolean).join("_")}return(n,e)=>(s(),u("div",null,[e[43]||(e[43]=t("h2",{class:"admin-title"},"Gestion des Exercices",-1)),t("form",{class:"admin-form",onSubmit:j(L,["prevent"])},[t("div",de,[e[12]||(e[12]=t("label",null,"Chapitre:",-1)),c(t("select",{"onUpdate:modelValue":e[0]||(e[0]=i=>o.value.chapitre=i),required:""},[e[11]||(e[11]=t("option",{value:""},"Choisir un chapitre",-1)),(s(!0),u(S,null,T(v.value,i=>(s(),u("option",{key:i.id,value:i.id},l(F(i)),9,pe))),128))],512),[[C,o.value.chapitre]])]),g.value?(s(),u("div",ce,[t("div",ve,[e[13]||(e[13]=t("strong",null,"Mati√®re:",-1)),e[14]||(e[14]=f()),t("span",null,l(g.value.matiereNom||"‚Äî"),1)]),t("div",me,[e[15]||(e[15]=t("strong",null,"Th√®me:",-1)),e[16]||(e[16]=f()),t("span",null,l(g.value.themeNom||"‚Äî"),1)]),t("div",fe,[e[17]||(e[17]=t("strong",null,"Pays:",-1)),e[18]||(e[18]=f()),t("span",null,l(g.value.paysNom||"‚Äî"),1)]),t("div",ye,[e[19]||(e[19]=t("strong",null,"Niveau:",-1)),e[20]||(e[20]=f()),t("span",null,l(g.value.niveauNom||"‚Äî"),1)]),t("div",ge,[e[21]||(e[21]=t("strong",null,"Chemin:",-1)),e[22]||(e[22]=f()),t("span",null,l(_(o.value.chapitre)),1)]),t("div",we,[e[23]||(e[23]=t("strong",null,"Code:",-1)),e[24]||(e[24]=f()),t("code",null,l(W(o.value.chapitre)),1)])])):x("",!0),t("div",he,[e[25]||(e[25]=t("label",null,"Titre:",-1)),c(t("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>o.value.nom=i),placeholder:"Titre de l'exercice",required:""},null,512),[[b,o.value.nom]])]),t("div",xe,[e[26]||(e[26]=t("label",null,"√ânonc√©:",-1)),c(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=i=>o.value.enonce=i),rows:"4",required:""},null,512),[[b,o.value.enonce]])]),t("div",Ce,[e[27]||(e[27]=t("label",null,"Solution:",-1)),c(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=i=>o.value.solution=i),rows:"4"},null,512),[[b,o.value.solution]])]),t("div",be,[e[29]||(e[29]=t("label",null,"Difficult√©:",-1)),c(t("select",{"onUpdate:modelValue":e[4]||(e[4]=i=>o.value.difficulte=i)},e[28]||(e[28]=[t("option",{value:"facile"},"Facile",-1),t("option",{value:"moyen"},"Moyen",-1),t("option",{value:"difficile"},"Difficile",-1)]),512),[[C,o.value.difficulte]])]),t("button",Ne,l(o.value.id?"Mettre √† jour":"Cr√©er"),1),o.value.id?(s(),u("button",{key:1,class:"btn-secondary",type:"button",onClick:B},"Annuler")):x("",!0),t("button",{class:"btn-secondary",type:"button",onClick:J},"Pr√©visualiser")],32),N.value&&m.value?(s(),u("div",Ee,[t("h3",null,"Aper√ßu de l'exercice "+l(o.value.id?"(Mode √©dition)":"(Mode cr√©ation)"),1),t("div",ke,[z(se,{eid:`preview-${o.value.id||"new"}`,titre:m.value.titre,instruction:m.value.instruction,etapes:m.value.etapes,solution:m.value.solution,difficulty:m.value.difficulty},null,8,["eid","titre","instruction","etapes","solution","difficulty"])])])):x("",!0),t("div",De,[t("div",Se,[e[31]||(e[31]=t("label",null,"Filtrer par chapitre:",-1)),c(t("select",{"onUpdate:modelValue":e[5]||(e[5]=i=>d.value.chapitre=i),disabled:v.value.length===0},[e[30]||(e[30]=t("option",{value:""},"Tous les chapitres",-1)),(s(!0),u(S,null,T(v.value,i=>(s(),u("option",{key:i.id,value:i.id},l(i.nom),9,Ve))),128))],8,Te),[[C,d.value.chapitre]])]),t("div",qe,[e[33]||(e[33]=t("label",null,"Filtrer par type:",-1)),c(t("select",{"onUpdate:modelValue":e[6]||(e[6]=i=>d.value.type=i)},e[32]||(e[32]=[ee('<option value="" data-v-62e82a52>Tous les types</option><option value="qcm" data-v-62e82a52>QCM</option><option value="calcul" data-v-62e82a52>Calcul</option><option value="demonstration" data-v-62e82a52>D√©monstration</option><option value="probleme" data-v-62e82a52>Probl√®me</option>',5)]),512),[[C,d.value.type]])]),t("div",Me,[e[34]||(e[34]=t("label",null,"Rechercher:",-1)),c(t("input",{"onUpdate:modelValue":e[7]||(e[7]=i=>d.value.nom=i),type:"text",placeholder:"Rechercher dans l'√©nonc√©..."},null,512),[[b,d.value.nom]])])]),t("table",Ae,[e[36]||(e[36]=t("thead",null,[t("tr",null,[t("th",null,"ID"),t("th",null,"Titre"),t("th",null,"Chapitre"),t("th",null,"Contexte"),t("th",null,"Difficult√©"),t("th",null,"Actions")])],-1)),t("tbody",null,[(s(!0),u(S,null,T(A.value,i=>(s(),u("tr",{key:i.id},[t("td",null,l(i.id),1),t("td",null,l(i.titre||i.nom),1),t("td",null,l(K(i.chapitre)),1),t("td",Be,l(_(i.chapitre)),1),t("td",null,[t("span",{class:te(["difficulte-badge",`difficulte-${i.difficulte||i.difficulty}`])},l(i.difficulte||i.difficulty),3)]),t("td",null,[z(ne(ue),{item:i,actions:["edit","duplicate","delete"],"edit-label":"√âditer","duplicate-label":"Dupliquer","confirm-message":"√ätes-vous s√ªr de vouloir supprimer cet exercice ?",onEdit:Q,onDuplicate:O,onDelete:G},null,8,["item"])])]))),128)),A.value.length===0?(s(),u("tr",Ue,e[35]||(e[35]=[t("td",{colspan:"6",style:{"text-align":"center","font-style":"italic"}},"Aucun exercice trouv√©.",-1)]))):x("",!0)])]),E.value?(s(),u("div",{key:1,class:"modal-overlay",onClick:U},[t("div",{class:"modal-content",onClick:e[10]||(e[10]=j(()=>{},["stop"]))},[e[42]||(e[42]=t("h3",null,"Dupliquer l'exercice",-1)),t("p",Fe,[e[37]||(e[37]=f(' Cr√©er une copie de "')),t("strong",null,l(a.value.originalExercice?.titre||a.value.originalExercice?.nom),1),e[38]||(e[38]=f('" '))]),t("div",_e,[t("div",$e,[e[40]||(e[40]=t("label",null,"Nouveau chapitre:",-1)),c(t("select",{"onUpdate:modelValue":e[8]||(e[8]=i=>a.value.newChapitre=i),required:""},[e[39]||(e[39]=t("option",{value:""},"Choisir un chapitre",-1)),(s(!0),u(S,null,T(v.value,i=>(s(),u("option",{key:i.id,value:i.id},l(F(i)),9,je))),128))],512),[[C,a.value.newChapitre]])]),t("div",ze,[e[41]||(e[41]=t("label",null,"Nouveau titre:",-1)),c(t("input",{"onUpdate:modelValue":e[9]||(e[9]=i=>a.value.newTitre=i),placeholder:"Titre de la copie",required:""},null,512),[[b,a.value.newTitre]])])]),t("div",Pe,[t("button",{class:"btn-secondary",onClick:U},"Annuler"),t("button",{class:"btn-primary",onClick:H,disabled:!a.value.newChapitre||!a.value.newTitre.trim()}," Dupliquer ",8,Ie)])])])):x("",!0)]))}},Xe=X(Le,[["__scopeId","data-v-62e82a52"]]);export{Xe as default};
