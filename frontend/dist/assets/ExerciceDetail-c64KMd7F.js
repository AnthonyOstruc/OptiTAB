const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/useDailyObjectives-B4lktBMi.js","assets/index-C20tTf3S.js","assets/index-CNJib2To.css"])))=>i.map(i=>d[i]);
import{at as j,h as p,m as A,_ as D,f as k,w as C,r as P,o as v,q as M,M as R,p as L,C as O,a as n,i as y,c as g,t as V,u as F,as as U}from"./index-C20tTf3S.js";import{i as $}from"./curriculum-C6dJwtfd.js";import{u as N,c as J,d as T,g as z}from"./exercices-D5_EwlUY.js";import{D as Q}from"./DashboardLayout-DmmXvv68.js";import{E as G}from"./ExerciceQCM-DJualaHI.js";import{B as H}from"./BackButton-B9UoO6zr.js";import{P as w}from"./PDFDownloadButton-DYw0idcX.js";import"./menuItems-zei-A9he.js";import"./matieres-Ce1WeeoH.js";function K(){const m=j(),r=p({}),l=p(!1),d=p("");async function h(){l.value=!0,d.value="";try{const{data:e}=await z(),t=Array.isArray(e)?e:e?.results||[];return r.value=Object.fromEntries(t.map(s=>[s.exercice,{status:s.est_correct?"acquired":"not_acquired",id:s.id}])),console.log("üìä Statuts charg√©s:",Object.keys(r.value).length),r.value}catch(e){throw console.error("‚ùå Erreur chargement statuts:",e),d.value="Impossible de charger les statuts",e}finally{l.value=!1}}async function S(e,t){if(!e)throw new Error("ID exercice requis");try{const s=!!r.value[e];if(t){const f=r.value[e];if(f)await N(f.id,{exercice:e,reponse_donnee:t,est_correct:t==="acquired"}),r.value[e]={status:t,id:f.id};else{const b=await J({exercice:e,reponse_donnee:t,est_correct:t==="acquired",points_obtenus:t==="acquired"?1:0,temps_seconde:0}),B=b?.data?.id||b?.id;r.value[e]={status:t,id:B},t==="acquired"&&!s&&await x(e)}}else{const f=r.value[e];f&&await T(f.id),delete r.value[e]}console.log("‚úÖ Statut mis √† jour:",{exerciceId:e,status:t,wasAlreadyCompleted:s})}catch(s){throw console.error("‚ùå Erreur mise √† jour statut:",s),t?r.value[e]={status:t,id:null}:delete r.value[e],s}}function q(e){return r.value[e]?.status||null}function a(e){return r.value[e]?.status==="acquired"}function u(e){return!!r.value[e]}const c=A(()=>{const e={acquired:0,not_acquired:0,total:0};return Object.values(r.value).forEach(({status:t})=>{t==="acquired"?e.acquired++:t==="not_acquired"&&e.not_acquired++,e.total++}),e});function _(e,t){if(!Array.isArray(e))return[];switch(t){case"acquired":return e.filter(s=>a(s.id));case"not_acquired":return e.filter(s=>r.value[s.id]?.status==="not_acquired");case"done":return e.filter(s=>u(s.id));case"all":return e.filter(s=>!u(s.id));default:return e}}function E(){r.value={},d.value=""}async function x(e){try{console.log("üîç V√©rification des d√©bloquages pour exercice:",e)}catch(t){console.warn("‚ö†Ô∏è Erreur lors de la v√©rification des d√©bloquages:",t)}}function i(e,t){m.notifyExerciseUnlocked(e,t)}function o(e,t){m.notifyChapterCompleted(e,t)}return{statusMap:r,isLoadingStatuses:l,statusError:d,statusCounts:c,loadStatuses:h,updateExerciseStatus:S,getExerciseStatus:q,isExerciseAcquired:a,hasExerciseStatus:u,filterExercisesByStatus:_,resetStatuses:E,checkForUnlockedExercises:x,notifyExerciseUnlocked:i,notifyChapterCompleted:o}}const W={__name:"ExercisePageLayout",setup(m){return(r,l)=>(v(),k(Q,null,{default:C(()=>[P(r.$slots,"default",{},void 0,!0)]),_:3}))}},X=D(W,[["__scopeId","data-v-fa4ed041"]]),Y={class:"exercice-detail-section"},Z={key:0,class:"state-container"},I={key:1,class:"state-container"},ee={key:2,class:"exercice-content"},te={class:"exercice-actions"},ae={key:3,class:"state-container"},re={__name:"ExerciceDetail",setup(m){const r=R(),l=O();M();const{statusMap:d,loadStatuses:h,updateExerciseStatus:S}=K(),q=r.params.exerciceId,a=p(null),u=p(!0),c=p(""),_=()=>{const i=a.value?.chapitre?{name:"Exercices",params:{chapitreId:String(a.value.chapitre)}}:{name:"Dashboard"};l.push(i)},E=async()=>{u.value=!0,c.value="";try{const i=await $(q);if(a.value=i?.data||i,!a.value){c.value="Exercice non trouv√©";return}await h()}catch(i){console.error("[ExerciceDetail] Erreur:",i),c.value="Impossible de charger l'exercice. Veuillez r√©essayer."}finally{u.value=!1}},x=async({exerciceId:i,status:o})=>{try{if(await S(i,o),o==="acquired"){console.log("[ExerciceDetail] Exercice r√©ussi - int√©gration objectifs journaliers");const{useDailyObjectivesIntegration:e}=await U(async()=>{const{useDailyObjectivesIntegration:s}=await import("./useDailyObjectives-B4lktBMi.js");return{useDailyObjectivesIntegration:s}},__vite__mapDeps([0,1,2])),{onExerciseCompleted:t}=e();t({exerciceId:i,isSuccess:!0,status:"acquired"})}}catch(e){console.error("[ExerciceDetail] Erreur handleStatus:",e)}};return L(E),(i,o)=>(v(),k(X,null,{default:C(()=>[n("section",Y,[y(H,{text:"Retour aux exercices",customAction:_,position:"top-left"}),u.value?(v(),g("div",Z,o[0]||(o[0]=[n("div",{class:"loading-spinner"},null,-1),n("p",null,"Chargement de l'exercice...",-1)]))):c.value?(v(),g("div",I,[o[1]||(o[1]=n("div",{class:"icon"},"‚ùå",-1)),o[2]||(o[2]=n("h3",null,"Erreur de chargement",-1)),n("p",null,V(c.value),1),n("button",{class:"btn-primary",onClick:E},"R√©essayer")])):a.value?(v(),g("div",ee,[n("div",te,[y(w,{type:"single",data:a.value,title:`Exercice_${a.value.id}_Enonce`,text:"üìÑ Exercice (PDF serveur)",useMathJax:!0,includeSolution:!1,class:"pdf-btn exercice-btn"},null,8,["data","title"]),y(w,{type:"single",data:a.value,title:`Exercice_${a.value.id}_Corrige`,text:"üìù Exercice + Corrig√© (PDF serveur)",useMathJax:!0,includeSolution:!0,class:"pdf-btn corrige-btn"},null,8,["data","title"])]),y(G,{eid:a.value.id,titre:a.value.titre||a.value.nom,instruction:a.value.instruction||a.value.contenu||a.value.question,solution:a.value.solution||a.value.reponse_correcte||"",etapes:a.value.etapes||"",difficulty:a.value.difficulty||a.value.difficulte||"medium",current:F(d)[a.value.id]?.status,onStatusChanged:x},null,8,["eid","titre","instruction","solution","etapes","difficulty","current"])])):(v(),g("div",ae,[o[3]||(o[3]=n("div",{class:"icon"},"üìù",-1)),o[4]||(o[4]=n("h3",null,"Exercice non trouv√©",-1)),o[5]||(o[5]=n("p",null,"L'exercice demand√© n'existe pas ou n'est plus disponible.",-1)),n("button",{class:"btn-primary",onClick:_},"Retour aux exercices")]))])]),_:1}))}},ve=D(re,[["__scopeId","data-v-11764a8c"]]);export{ve as default};
