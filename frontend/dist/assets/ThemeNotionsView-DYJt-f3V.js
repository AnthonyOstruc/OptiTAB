import{_ as F,C as M,q as R,h as d,p as q,s as L,c as i,o as n,a as s,a2 as A,t as k,F as f,e as w,b as z,f as B}from"./index-C20tTf3S.js";import{a as H}from"./themes-KZqHIzgY.js";import{N as V}from"./NotionCard-CDHvqGL7.js";const J={class:"tnv-wrapper"},K={key:0,class:"tnv-state tnv-loading"},O={key:1,class:"tnv-state tnv-error"},U={key:2,class:"tnv-content"},P={key:0,class:"tnv-themes"},W={class:"tnv-theme-header"},G={class:"tnv-theme-title"},Q={class:"tnv-theme-count"},X={class:"tnv-notions-grid"},Y={key:0,class:"tnv-no-notions"},Z={key:1,class:"tnv-fallback"},tt={class:"tnv-notions-grid"},j=12e4,et={__name:"ThemeNotionsView",props:{matiereId:{type:[Number,String],required:!0},notionRouteName:{type:String,required:!0}},setup(_){const y=_,D=M(),C=R(),u=d(!1),v=d(""),c=d([]),a=d({}),p=d([]);function N(o){D.push({name:y.notionRouteName,params:{notionId:o}})}const x=new Map;function S(o){return`tnv_cache:${T(o)}`}function I(o){try{const e=localStorage.getItem(S(o));if(!e)return null;const t=JSON.parse(e);return!t||!t.t||!t.v||Date.now()-t.t>j?null:t}catch{return null}}function E(o,e){try{const t=JSON.stringify({t:Date.now(),v:e});localStorage.setItem(S(o),t)}catch{}}function T(o){const e=C.niveau_pays?.id||"n",t=C.pays?.id||"p";return`${o}|${e}|${t}`}async function m(o){if(!o)return;v.value="";const e=T(o),t=x.get(e)||I(o);t&&Date.now()-t.t<j?(c.value=t.v.themes,a.value=t.v.themeToNotions,p.value=t.v.directNotions,u.value=!1):u.value=!0;try{const{data:r}=await H({matiere:o}),g=Array.isArray(r?.themes)?r.themes:[],b=Array.isArray(r?.notions)?r.notions:[],h={};for(const l of b)h[l.theme]||(h[l.theme]=[]),h[l.theme].push(l);c.value=g,a.value=h,p.value=g.length===0?b.filter(l=>!l.theme):[];const $={themes:c.value,themeToNotions:a.value,directNotions:p.value};x.set(e,{t:Date.now(),v:$}),E(o,$)}catch{v.value="Erreur lors du chargement des concepts"}finally{u.value=!1}}return q(()=>m(y.matiereId)),L(()=>y.matiereId,o=>m(o)),(o,e)=>(n(),i("div",J,[u.value?(n(),i("div",K,e[1]||(e[1]=[s("div",{class:"tnv-spinner"},null,-1),s("p",null,"Chargement des concepts...",-1)]))):v.value?(n(),i("div",O,[e[2]||(e[2]=A('<div class="tnv-error-icon" data-v-19314285><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-19314285><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" data-v-19314285></circle><line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2" data-v-19314285></line><line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2" data-v-19314285></line></svg></div>',1)),s("p",null,k(v.value),1),s("button",{class:"tnv-retry",onClick:e[0]||(e[0]=t=>m(_.matiereId))},"Réessayer")])):(n(),i("div",U,[c.value.length>0?(n(),i("div",P,[(n(!0),i(f,null,w(c.value,t=>(n(),i("div",{key:t.id,class:"tnv-theme-block"},[s("div",W,[s("h2",G,k(t.nom),1),s("div",Q,k((a.value[t.id]||[]).length)+" concept"+k((a.value[t.id]||[]).length>1?"s":""),1)]),s("div",X,[(n(!0),i(f,null,w(a.value[t.id]||[],r=>(n(),B(V,{key:r.id,title:r.nom,description:r.description||"",onClick:g=>N(r.id)},null,8,["title","description","onClick"]))),128)),a.value[t.id]&&a.value[t.id].length?z("",!0):(n(),i("div",Y,e[3]||(e[3]=[A('<div class="tnv-empty-icon" data-v-19314285><svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-19314285><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-19314285></path><polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-19314285></polyline><line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-19314285></line><line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-19314285></line><polyline points="10,9 9,9 8,9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-19314285></polyline></svg></div><p data-v-19314285>Aucun concept disponible</p>',2)])))])]))),128))])):(n(),i("div",Z,[e[4]||(e[4]=s("div",{class:"tnv-fallback-header"},[s("h3",null,"Concepts disponibles"),s("p",null,"Explorez les concepts fondamentaux de cette matière")],-1)),s("div",tt,[(n(!0),i(f,null,w(p.value,t=>(n(),B(V,{key:t.id,title:t.nom,description:t.description||"",onClick:r=>N(t.id)},null,8,["title","description","onClick"]))),128))])]))]))]))}},rt=F(et,[["__scopeId","data-v-19314285"]]);export{rt as T};
