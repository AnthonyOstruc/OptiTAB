import{a as f,h as q,C,A as L,o as c,d as t,j as I,b as l,F as x,s as $,n as v,i as k,w as j,l as h,t as r}from"./vendor-1gmgAmFu.js";import{D as z}from"./DashboardLayout-CioqXtbg.js";import{B as K}from"./BaseHistory-BP2m3P1M.js";import{_ as G,b as J}from"./index-DCsGFNRY.js";import"./menuItems-C0wivC9l.js";import"./matieres-D5ssBX4k.js";import"./ui-jaH5oyHW.js";import"./curriculum-snq3CWRS.js";import"./pdf-B39ievqC.js";import"./mathlive-B5k0jhbN.js";const O={class:"history-page"},P={class:"summary-table"},Q={class:"summary-header"},U={class:"summary-row"},W={class:"cell matiere"},X={class:"cell notion"},Y=["onClick"],Z={class:"notion-label"},tt={class:"cell count"},et={class:"cell correct"},st={class:"cell incorrect"},ot={key:0,class:"summary-details-row"},it={class:"details-cell"},rt={class:"chapter-table"},at={key:0,class:"chapter-loading"},nt={key:1,class:"chapter-error"},ct={key:2},lt={class:"cell chapitre"},dt={class:"cell count"},ut={class:"cell correct"},vt={class:"cell incorrect"},pt={class:"cell ratio"},_t=["onClick"],mt={class:"exercice-card-title-section"},ht=["onClick","title"],gt={class:"exercice-breadcrumb-compact"},yt={class:"exercice-card-actions"},ft={key:0,class:"exercice-card-details"},xt={class:"exercice-breadcrumb"},kt={class:"breadcrumb-item"},bt={class:"breadcrumb-item"},Ct={class:"breadcrumb-item"},$t={class:"exercice-meta"},Dt={class:"exercice-date"},St={key:0,class:"exercice-time"},Mt={key:1,class:"exercice-points"},Nt={__name:"ExercisesHistory",setup(At){const N=L(),D=o=>{N.push({name:"ExerciceDetail",params:{exerciceId:String(o.exercice_id)}})},u=f("exercice_count"),p=f("desc"),g=f(new Set),_=f({}),A=o=>[...(Array.isArray(o)?o:[]).map(s=>({...s,average:s.exercice_count>0?s.correct_count/s.exercice_count*100:0}))].sort((s,a)=>{const d=s[u.value]||0,i=a[u.value]||0;return p.value==="asc"?d-i:i-d}),B=o=>o===0?"0%":`${Math.round(o)}%`,S=o=>o>=90?"excellent":o>=75?"good":o>=50?"average":"poor",y=o=>{u.value===o?p.value=p.value==="asc"?"desc":"asc":(u.value=o,p.value="desc")},b=o=>`${o.matiere.id}-${o.notion.id}`,M=o=>g.value.has(b(o)),m=o=>{const e=b(o);return _.value[e]||(_.value[e]={loading:!1,error:"",chapters:[]}),_.value[e]},E=async o=>{const e=b(o);if(g.value.has(e)){g.value.delete(e);return}g.value.add(e);const n=m(o);n.chapters&&n.chapters.length>0||await R(o.matiere.id,o.notion.id)},R=async(o,e)=>{const n=`${o}-${e}`;_.value[n]={loading:!0,error:"",chapters:[]};try{const s=await J.get("/api/suivis/exercices/stats/",{params:{matiere:o,notion:e}}),a=Array.isArray(s?.data?.exercice_list)?s.data.exercice_list:[],d=V(a);_.value[n]={loading:!1,error:"",chapters:d}}catch(s){const a=s?.response?.data?.error||"Erreur lors du chargement des d√©tails";_.value[n]={loading:!1,error:a,chapters:[]}}},V=o=>{const e=new Map;for(const s of o){const a=s?.chapitre||{},d=a?.id;if(!d)continue;e.has(d)||e.set(d,{chapitre:{id:d,titre:a?.titre||"Chapitre"},exercice_count:0,correct_count:0,incorrect_count:0});const i=e.get(d);i.exercice_count+=1,s.est_correct?i.correct_count+=1:i.incorrect_count+=1}const n=Array.from(e.values()).map(s=>{const a=s.exercice_count>0?s.correct_count/s.exercice_count:0,d=Math.round(a*10*10)/10;return{...s,ratio_percent:a*100,average_10:d}});return n.sort((s,a)=>String(s.chapitre.titre).localeCompare(String(a.chapitre.titre),"fr",{sensitivity:"base"})),n},F=o=>o?"status-correct":"status-incorrect",H=o=>new Date(o).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),w=o=>{const e=Math.floor(o/60),n=o%60;return`${e}:${n.toString().padStart(2,"0")}`};return(o,e)=>(c(),q(z,null,{default:C(()=>[t("div",O,[e[16]||(e[16]=t("h2",{class:"page-title"},"Historique complet des exercices",-1)),I(K,{title:"üß≠ Historique des Exercices","list-title":"üìù Tous mes exercices","loading-text":"Chargement de l'historique...","api-endpoint":"/api/suivis/exercices/stats/","items-per-page":20,"navigation-handler":D},{"matiere-notion-stats":C(({stats:n})=>[t("div",P,[t("div",Q,[e[8]||(e[8]=t("div",null,"Mati√®re",-1)),e[9]||(e[9]=t("div",null,"Notion",-1)),t("div",{class:"sortable-header",onClick:e[0]||(e[0]=s=>y("exercice_count"))},[e[4]||(e[4]=h(" Faits ")),t("span",{class:v(["sort-icon",{active:u.value==="exercice_count"}])},r(u.value==="exercice_count"&&p.value==="asc"?"‚Üë":"‚Üì"),3)]),t("div",{class:"sortable-header",onClick:e[1]||(e[1]=s=>y("correct_count"))},[e[5]||(e[5]=h(" R√©ussis ")),t("span",{class:v(["sort-icon",{active:u.value==="correct_count"}])},r(u.value==="correct_count"&&p.value==="asc"?"‚Üë":"‚Üì"),3)]),t("div",{class:"sortable-header",onClick:e[2]||(e[2]=s=>y("incorrect_count"))},[e[6]||(e[6]=h(" Rat√©s ")),t("span",{class:v(["sort-icon",{active:u.value==="incorrect_count"}])},r(u.value==="incorrect_count"&&p.value==="asc"?"‚Üë":"‚Üì"),3)]),t("div",{class:"sortable-header",onClick:e[3]||(e[3]=s=>y("average"))},[e[7]||(e[7]=h(" Moyenne ")),t("span",{class:v(["sort-icon",{active:u.value==="average"}])},r(u.value==="average"&&p.value==="asc"?"‚Üë":"‚Üì"),3)])]),(c(!0),l(x,null,$(A(n),s=>(c(),l(x,{key:`${s.matiere.id}-${s.notion.id}`},[t("div",U,[t("div",W,r(s.matiere.titre),1),t("div",X,[t("button",{class:"notion-toggle",onClick:a=>E(s)},[t("span",Z,r(s.notion.titre),1),(c(),l("svg",{class:v(["chevron",{expanded:M(s)}]),width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},e[10]||(e[10]=[t("polyline",{points:"6,9 12,15 18,9"},null,-1)]),2))],8,Y)]),t("div",tt,r(s.exercice_count),1),t("div",et,r(s.correct_count),1),t("div",st,r(s.incorrect_count),1),t("div",{class:v(["cell average",S(s.average)])},r(B(s.average)),3)]),M(s)?(c(),l("div",ot,[t("div",it,[t("div",rt,[e[11]||(e[11]=t("div",{class:"chapter-header"},[t("div",null,"Chapitre"),t("div",null,"Faits"),t("div",null,"R√©ussis"),t("div",null,"Rat√©s"),t("div",null,"R√©ussite"),t("div",null,"Moyenne")],-1)),m(s).loading?(c(),l("div",at,"Chargement des d√©tails...")):m(s).error?(c(),l("div",nt,r(m(s).error),1)):(c(),l("div",ct,[(c(!0),l(x,null,$(m(s).chapters,a=>(c(),l("div",{key:a.chapitre.id,class:"chapter-row"},[t("div",lt,r(a.chapitre.titre),1),t("div",dt,r(a.exercice_count),1),t("div",ut,r(a.correct_count),1),t("div",vt,r(a.incorrect_count),1),t("div",pt,r(Math.round(a.ratio_percent))+"%",1),t("div",{class:v(["cell average",S(a.average_10*10)])},r(a.average_10)+"/10",3)]))),128))]))])])])):k("",!0)],64))),128))])]),"items-list":C(({items:n,toggleDetails:s,isExpanded:a,navigateToItem:d})=>[(c(!0),l(x,null,$(n,i=>(c(),l("div",{key:i.id,class:v(["exercice-card",{correct:i.est_correct,incorrect:!i.est_correct}])},[t("div",{class:"exercice-card-header",onClick:T=>s(i.id)},[t("div",mt,[t("h5",{class:"exercice-card-title clickable-title",onClick:j(T=>D(i),["stop"]),title:"Acc√©der √† l'exercice: "+i.exercice_titre},[h(r(i.exercice_titre)+" ",1),e[12]||(e[12]=t("svg",{class:"navigation-icon",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M7 17l9.2-9.2M17 17V7H7"})],-1))],8,ht),t("div",gt,r(i.matiere.titre)+" ‚Üí "+r(i.notion.titre),1)]),t("div",yt,[t("div",{class:v(["exercice-status",F(i.est_correct)])},r(i.est_correct?"‚úÖ":"‚ùå"),3),t("button",{class:v(["expand-toggle",{expanded:a(i.id)}])},e[13]||(e[13]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"6,9 12,15 18,9"})],-1)]),2)])],8,_t),a(i.id)?(c(),l("div",ft,[t("div",xt,[t("span",kt,r(i.matiere.titre),1),e[14]||(e[14]=t("span",{class:"breadcrumb-separator"},"‚Üí",-1)),t("span",bt,r(i.notion.titre),1),e[15]||(e[15]=t("span",{class:"breadcrumb-separator"},"‚Üí",-1)),t("span",Ct,r(i.chapitre.titre),1)]),t("div",$t,[t("span",Dt,r(H(i.date_creation)),1),i.temps_seconde?(c(),l("span",St,r(w(i.temps_seconde)),1)):k("",!0),i.points_obtenus?(c(),l("span",Mt,r(i.points_obtenus)+" points",1)):k("",!0)])])):k("",!0)],2))),128))]),_:1})])]),_:1}))}},It=G(Nt,[["__scopeId","data-v-c63c006f"]]);export{It as default};
