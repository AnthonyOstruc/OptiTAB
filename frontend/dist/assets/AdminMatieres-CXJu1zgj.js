import{_ as B,h as d,m as S,p as j,c as o,a as s,k as y,b,v as g,z as F,F as c,e as v,t as r,l as U,aF as L,o as i,d as z,i as G,u as P}from"./index-C20tTf3S.js";import{b as T,u as q,c as I,d as O}from"./matieres-Ce1WeeoH.js";import{c as R,g as $,d as H}from"./matiere-contextes-C9CwZsNm.js";import{A as J}from"./AdminActionsButtons-BF654C6o.js";const K={class:"contextes-panel"},Q={class:"contextes-actions"},W=["label"],X=["value","disabled"],Y=["disabled"],Z={key:0},ee={key:1},te={key:0,class:"chips"},ae=["onClick","disabled"],se={class:"btn-primary",type:"submit"},ne={class:"admin-table"},oe={class:"pays-badges"},ie=["title"],le={class:"pays-flag"},re={class:"pays-name"},ue={key:0,class:"pays-empty"},de={__name:"AdminMatieres",setup(ce){const _=d([]),k=d([]),p=d({}),u=d({niveau:""}),m=d(!1),f=d(null),M=S(()=>{const a=new Map;for(const t of k.value||[]){const e=t.pays||t.pays_id||t.pays_nom;a.has(e)||a.set(e,{pays_id:e,pays_nom:t.pays_nom||"Pays",niveaux:[]}),a.get(e).niveaux.push(t)}return Array.from(a.values()).sort((t,e)=>t.pays_nom.localeCompare(e.pays_nom))});function w(a){return(p.value[n.value.id]||[]).some(e=>e.niveau?.id===a||e.niveau===a)}const n=d({id:null,nom:"",description:"",svg_icon:""});async function x(){try{const{data:a}=await T();_.value=a||[],k.value=await L({est_actif:!0}),await h()}catch(a){console.error("Erreur lors du chargement des mati√®res:",a),_.value=[]}}j(x);function C(){n.value={id:null,nom:"",description:"",svg_icon:""},u.value.niveau=""}async function A(){if(n.value.nom)try{n.value.id?await q(n.value.id,n.value):await I(n.value),C(),await x()}catch(a){console.error("Erreur lors de la sauvegarde:",a)}}function E(a){n.value={id:a.id,nom:a.nom||a.titre||"",description:a.description||"",svg_icon:a.svg_icon||""},u.value.niveau=""}async function V(a){try{await O(a.id),await x()}catch(t){console.error("Erreur lors de la suppression:",t)}}async function h(){try{const a=await $(),t={};for(const e of a)t[e.matiere]||(t[e.matiere]=[]),t[e.matiere].push(e);p.value=t}catch(a){console.error("Erreur lors du chargement des contextes:",a)}}async function N(){if(!(!n.value.id||!u.value.niveau))try{m.value=!0,await R({matiere:n.value.id,niveau:u.value.niveau}),await h(),u.value.niveau=""}catch(a){console.error("Erreur lors de l'ajout du contexte:",a)}finally{m.value=!1}}async function D(a){try{f.value=a,await H(a),await h()}catch(t){console.error("Erreur lors de la suppression du contexte:",t)}finally{f.value=null}}return(a,t)=>(i(),o("div",null,[t[8]||(t[8]=s("h2",{class:"admin-title"},"Gestion des Mati√®res",-1)),s("form",{class:"admin-form",onSubmit:U(A,["prevent"])},[y(s("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.value.nom=e),placeholder:"Nom de la mati√®re",required:""},null,512),[[g,n.value.nom]]),y(s("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>n.value.description=e),placeholder:"Description"},null,512),[[g,n.value.description]]),y(s("textarea",{"onUpdate:modelValue":t[2]||(t[2]=e=>n.value.svg_icon=e),placeholder:"Code SVG"},null,512),[[g,n.value.svg_icon]]),s("div",K,[t[5]||(t[5]=s("h3",null,"Contextes (Mati√®re + Niveau)",-1)),s("div",Q,[y(s("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>u.value.niveau=e),class:"select"},[t[4]||(t[4]=s("option",{value:""},"S√©lectionner un niveau",-1)),(i(!0),o(c,null,v(M.value,e=>(i(),o("optgroup",{key:e.pays_id,label:e.pays_nom},[(i(!0),o(c,null,v(e.niveaux,l=>(i(),o("option",{key:l.id,value:l.id,disabled:w(l.id)},r(l.nom),9,X))),128))],8,W))),128))],512),[[F,u.value.niveau]]),s("button",{class:"btn-primary",type:"button",onClick:N,disabled:!n.value.id||!u.value.niveau||m.value},[m.value?(i(),o("span",Z,"Ajout...")):(i(),o("span",ee,"Ajouter"))],8,Y)]),(p.value[n.value.id]||[]).length?(i(),o("div",te,[(i(!0),o(c,null,v(p.value[n.value.id],e=>(i(),o("span",{class:"chip",key:e.id},[z(r(e.pays.nom)+" - "+r(e.niveau.nom)+" ",1),s("button",{class:"chip-remove",title:"Retirer",onClick:l=>D(e.id),disabled:f.value===e.id},"√ó",8,ae)]))),128))])):b("",!0),t[6]||(t[6]=s("small",{class:"hint"},"Cr√©ez des contextes pour lier cette mati√®re √† des niveaux/pays.",-1))]),s("button",se,r(n.value.id?"Mettre √† jour":"Cr√©er"),1),n.value.id?(i(),o("button",{key:0,class:"btn-secondary",type:"button",onClick:C},"Annuler")):b("",!0)],32),s("table",ne,[t[7]||(t[7]=s("thead",null,[s("tr",null,[s("th",null,"ID"),s("th",null,"Nom"),s("th",null,"Description"),s("th",null,"Contextes (aper√ßu)"),s("th",null,"Actions")])],-1)),s("tbody",null,[(i(!0),o(c,null,v(_.value,e=>(i(),o("tr",{key:e.id},[s("td",null,r(e.id),1),s("td",null,r(e.nom),1),s("td",null,r(e.description),1),s("td",null,[s("div",oe,[(i(!0),o(c,null,v(e.contextes||[],l=>(i(),o("span",{key:l.id,class:"pays-badge",title:(l.pays?.nom||"")+" - "+(l.niveau?.nom||"")},[s("span",le,r(l.pays?.drapeau_emoji||"üè≥Ô∏è"),1),s("span",re,r((l.pays?.nom||"")+" - "+(l.niveau?.nom||"")),1)],8,ie))),128)),e.contextes&&e.contextes.length?b("",!0):(i(),o("span",ue,"Aucun"))])]),s("td",null,[G(P(J),{item:e,actions:["edit","delete"],"edit-label":"√âditer","confirm-message":"√ätes-vous s√ªr de vouloir supprimer cette mati√®re ?",onEdit:E,onDelete:V},null,8,["item"])])]))),128))])])]))}},_e=B(de,[["__scopeId","data-v-20d0a1d6"]]);export{_e as default};
