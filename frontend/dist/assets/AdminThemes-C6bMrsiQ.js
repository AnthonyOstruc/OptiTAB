import{_ as C,h as p,m as E,p as k,c as l,a as o,t as s,l as M,k as d,z as g,F as x,e as y,v as m,o as i,b,n as N,i as S,u as U}from"./index-C20tTf3S.js";import{g as j,u as D,c as B,d as F}from"./themes-KZqHIzgY.js";import{g as O}from"./matiere-contextes-C9CwZsNm.js";import"./PaysNiveauxDisplay.vue_vue_type_style_index_0_scoped_821033d6_lang-l0sNRNKZ.js";import{A as $}from"./AdminActionsButtons-BF654C6o.js";const z={class:"admin-themes"},L={class:"admin-form"},R={class:"form-group"},q=["value"],I={class:"form-group"},P={class:"form-group"},G={class:"form-group"},J={class:"color-input-group"},H={class:"form-group"},K={class:"form-actions"},Q={type:"submit",class:"btn-primary"},W={class:"admin-list"},X={class:"filters"},Y={class:"filter-group"},Z=["value"],ee={class:"filter-group"},te={class:"themes-grid"},oe={class:"theme-header"},re={class:"theme-name"},ne={key:0,class:"context-chip"},se={key:1,class:"theme-description"},le={class:"theme-meta"},ie={class:"theme-ordre"},ae={class:"theme-actions"},ue={__name:"AdminThemes",setup(de){const c=p([]),v=p([]),r=p({id:null,contexte:"",nom:"",description:"",couleur:"#3b82f6",ordre:0}),a=p({contexte:"",nom:""});E(()=>[]);const h=()=>{let e=Array.isArray(v.value)?v.value:[];return a.value.contexte&&(e=e.filter(t=>String(t.contexte)===String(a.value.contexte))),a.value.nom&&(e=e.filter(t=>t.nom.toLowerCase().includes(a.value.nom.toLowerCase()))),e.sort((t,u)=>(t.ordre||0)-(u.ordre||0))};async function f(){try{const[n,e]=await Promise.all([O(),j()]);c.value=Array.isArray(n)?n:n?.data||[],v.value=Array.isArray(e)?e:e?.data||[]}catch(n){console.error("Erreur lors du chargement:",n)}}function _(){r.value={id:null,contexte:"",nom:"",description:"",couleur:"#3b82f6",ordre:0}}async function T(){if(!(!r.value.contexte||!r.value.nom))try{const n=c.value.find(u=>u.id===Number(r.value.contexte));if(!n){console.error("Contexte non trouvé");return}if(!n.matiere){console.error("Matière non trouvée dans le contexte"),alert("Erreur: Impossible de récupérer la matière associée à ce contexte.");return}if(v.value.find(u=>u.matiere===n.matiere&&(u.nom===r.value.nom||u.titre===r.value.nom)&&u.id!==r.value.id)){alert("Un thème avec ce nom existe déjà dans cette matière.");return}const t={contexte:Number(r.value.contexte),matiere:n.matiere,nom:r.value.nom,description:r.value.description,couleur:r.value.couleur,ordre:r.value.ordre};console.log("Payload being sent:",t),console.log("Selected contexte:",n),r.value.id?await D(r.value.id,t):await B(t),_(),await f()}catch(n){if(console.error("Erreur lors de la sauvegarde:",n),n.response?.data){const e=n.response.data;e.non_field_errors?alert(`Erreur: ${e.non_field_errors.join(", ")}`):e.titre?alert(`Erreur sur le nom: ${e.titre.join(", ")}`):e.matiere?alert(`Erreur sur la matière: ${e.matiere.join(", ")}`):alert(`Erreur: ${JSON.stringify(e)}`)}else alert("Erreur lors de la sauvegarde. Vérifiez les données saisies.")}}function A(n){r.value={id:n.id,contexte:n.contexte||"",nom:n.nom||n.titre||"",description:n.description||"",couleur:n.couleur||"#3b82f6",ordre:n.ordre||0}}async function V(n){try{await F(n),await f()}catch(e){console.error("Erreur lors de la suppression:",e)}}function w(n){V(n.id)}return k(f),(n,e)=>(i(),l("div",z,[e[18]||(e[18]=o("h1",{class:"admin-title"},"Gestion des Thèmes",-1)),o("div",L,[o("h2",null,s(r.value.id?"Modifier":"Ajouter")+" un thème",1),o("form",{onSubmit:M(T,["prevent"])},[o("div",R,[e[9]||(e[9]=o("label",null,"Contexte (Matière + Niveau):",-1)),d(o("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>r.value.contexte=t),required:""},[e[8]||(e[8]=o("option",{value:""},"Choisir un contexte",-1)),(i(!0),l(x,null,y(c.value,t=>(i(),l("option",{key:t.id,value:t.id},s(t.matiere_nom)+" — "+s(t.pays.nom)+" - "+s(t.niveau.nom),9,q))),128))],512),[[g,r.value.contexte]])]),o("div",I,[e[10]||(e[10]=o("label",null,"Nom du thème:",-1)),d(o("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>r.value.nom=t),type:"text",required:""},null,512),[[m,r.value.nom]])]),o("div",P,[e[11]||(e[11]=o("label",null,"Description:",-1)),d(o("textarea",{"onUpdate:modelValue":e[2]||(e[2]=t=>r.value.description=t),rows:"3"},null,512),[[m,r.value.description]])]),o("div",G,[e[12]||(e[12]=o("label",null,"Couleur:",-1)),o("div",J,[d(o("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>r.value.couleur=t),type:"color"},null,512),[[m,r.value.couleur]]),d(o("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>r.value.couleur=t),type:"text",placeholder:"#3b82f6"},null,512),[[m,r.value.couleur]])])]),o("div",H,[e[13]||(e[13]=o("label",null,"Ordre d'affichage:",-1)),d(o("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>r.value.ordre=t),type:"number",min:"0"},null,512),[[m,r.value.ordre,void 0,{number:!0}]])]),o("div",K,[o("button",Q,s(r.value.id?"Modifier":"Ajouter"),1),o("button",{type:"button",onClick:_,class:"btn-secondary"},"Annuler")])],32)]),o("div",W,[e[17]||(e[17]=o("h2",null,"Thèmes existants",-1)),o("div",X,[o("div",Y,[e[15]||(e[15]=o("label",null,"Filtrer par contexte:",-1)),d(o("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>a.value.contexte=t)},[e[14]||(e[14]=o("option",{value:""},"Tous les contextes",-1)),(i(!0),l(x,null,y(c.value,t=>(i(),l("option",{key:t.id,value:t.id},s(t.matiere_nom)+" — "+s(t.pays.nom)+" - "+s(t.niveau.nom),9,Z))),128))],512),[[g,a.value.contexte]])]),o("div",ee,[e[16]||(e[16]=o("label",null,"Rechercher:",-1)),d(o("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>a.value.nom=t),type:"text",placeholder:"Nom du thème..."},null,512),[[m,a.value.nom]])])]),o("div",te,[(i(!0),l(x,null,y(h(),t=>(i(),l("div",{key:t.id,class:"theme-card"},[o("div",oe,[o("div",{class:"theme-color",style:N({backgroundColor:t.couleur})},null,4),o("h4",re,s(t.titre||t.nom),1)]),t.contexte_detail?(i(),l("div",ne,s(t.contexte_detail.matiere_nom)+" — "+s(t.contexte_detail.pays?.nom)+" - "+s(t.contexte_detail.niveau?.nom),1)):b("",!0),t.description?(i(),l("p",se,s(t.description),1)):b("",!0),o("div",le,[o("span",ie,"Ordre: "+s(t.ordre||0),1)]),o("div",ae,[S(U($),{item:t,actions:["edit","delete"],"edit-label":"Modifier","confirm-message":"Êtes-vous sûr de vouloir supprimer ce thème ?",onEdit:A,onDelete:w},null,8,["item"])])]))),128))])])]))}},xe=C(ue,[["__scopeId","data-v-20ce16fb"]]);export{xe as default};
