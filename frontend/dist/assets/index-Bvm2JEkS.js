const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Home-BtMO1NRk.js","assets/MainLayout-D9P7WCS-.js","assets/vendor-D171CWhe.js","assets/menuItems-D4F2gOe0.js","assets/matieres-UO5rRmLj.js","assets/MainLayout-S54voF8R.css","assets/BaseCard-DoU90Cc8.js","assets/BaseCard-wVd7U2iM.css","assets/ui-jaH5oyHW.js","assets/pdf-B39ievqC.js","assets/mathlive-B5k0jhbN.js","assets/Home-CqipD9yn.css","assets/Dashboard-BQsdkVUO.js","assets/DashboardLayout-B5CnNSIn.js","assets/DashboardLayout-DlpgjpAm.css","assets/curriculum-Ch8J6CLY.js","assets/exercices-CWs1pYtm.js","assets/quiz-C0dQ8Pww.js","assets/useDailyObjectives-KKZq7PFm.js","assets/Dashboard-D8sEj_10.css","assets/ChildOverview-xECYB2Gz.js","assets/ChildOverview-Ct9ZYVDo.css","assets/Account-gAX7tkKD.js","assets/niveaux-BV2sTUx5.js","assets/defineProperty-CByTjH6h.js","assets/Account-BvdlpVBp.css","assets/Pricing-CZVCv2hM.js","assets/Pricing-B0gC7E42.css","assets/Exercises-CYTtQR95.js","assets/themes-C6vWazcy.js","assets/useSmartNavigation-DCiE2lIC.js","assets/Exercises-DJgsPd93.css","assets/OnlineCourses-CMW9JRdD.js","assets/OnlineCourses-SnnzWnAW.css","assets/Quiz-BTb_3pbs.js","assets/Quiz-BaVQ_woE.css","assets/QuizNotions-BY-iKxNd.js","assets/ThemeNotionsView-B9hnnwNd.js","assets/NotionCard-CzoUDQ6W.js","assets/NotionCard-CHk7ZF0g.css","assets/ThemeNotionsView-Od9CvGnQ.css","assets/BackButton-CfvpP0Hf.js","assets/BackButton-C5yUIBdm.css","assets/QuizNotions-D2--llqa.css","assets/QuizChapitres-Db2gmT4Y.js","assets/ChapitresListView-BwoKxQfd.js","assets/ChapitresListView-CCAmRy31.css","assets/ChapterQuiz--v4IaR_2.js","assets/ChapterQuiz-hEmS9nlz.css","assets/CourseNotions-BiYH1Z3K.js","assets/CourseNotions-C3FzQNzR.css","assets/CourseChapitres-D0dJKzN7.js","assets/CourseChapitre-BlhcOgF7.js","assets/PDFDownloadButton-IGUR72Fh.js","assets/PDFDownloadButton-D7sfzo-M.css","assets/cours-CXkJGuuq.js","assets/scientificRenderer-SJJ6pUZd.js","assets/CourseChapitre-1As98nXp.css","assets/Cours-CpJeUiwr.js","assets/Cours-BkIZ9rTK.css","assets/CoursDetail-D-2iVYs0.js","assets/CoursDetail-CZyP49zS.css","assets/Sheets-BQuh7fZW.js","assets/synthesis-CaNiFqju.js","assets/Sheets-D4Zq-ef4.css","assets/About-BPY7wHB7.js","assets/ApprentissageFlexible-DDIWKMCj.js","assets/About-DmdnZUkQ.css","assets/CoursParticuliers-re7PHRP9.js","assets/CoursParticuliers-BWyPAPki.css","assets/PasswordReset-RGbuOMbT.js","assets/PasswordReset-BGr53cxo.css","assets/CGV-Nfp06c-1.js","assets/CGV-BgP3puIB.css","assets/CGU-C2idCSJm.js","assets/CGU-DdhkNJwG.css","assets/Confidentialite-BPERfxXQ.js","assets/Confidentialite-BBWG7fbl.css","assets/Conditions-B4hxqoon.js","assets/Conditions-D7anzJ0L.css","assets/Notions-DQJ-pwaw.js","assets/notions-XJaE2fl-.js","assets/math-DsqdWQfm.js","assets/Notions-CNPax--8.css","assets/Themes-Dv26B5x1.js","assets/Themes-BmNvf7tJ.css","assets/ThemeNotions-BWDfmYKu.js","assets/ThemeNotions-tPiWNz0W.css","assets/Chapitres-BLu6il-N.js","assets/Chapitres-DMZqd22O.css","assets/ChapterExercises-CUL2Us19.js","assets/ExerciceQCM-1msu3eU1.js","assets/ExerciceQCM-Bi28n1Dj.css","assets/ChapterExercises-baUBz5MU.css","assets/Tabs-BMJrncHP.css","assets/ExerciceDetail-1ICcudZ7.js","assets/ExerciceDetail-CYwV5da-.css","assets/Progress-Ep7-aFQt.js","assets/Progress-oXpKVhMa.css","assets/Calculator-BGH2Xb1T.js","assets/calculator-Bg5TjjgQ.js","assets/calculator-CbtoceRh.js","assets/Calculator-Dy0zL-nw.css","assets/TestFiltrageStrict-BEq8kLi6.js","assets/TestFiltrageStrict-BeULsNWG.css","assets/AdminLayout-CjAsE3Gj.js","assets/AdminLayout-zRG-CH6Y.css","assets/AdminMatieres-Dg8IlBTx.js","assets/matiere-contextes-CBtZbnO6.js","assets/AdminActionsButtons-D-mCqUkd.js","assets/AdminActionsButtons-Ccw6G07H.css","assets/AdminMatieres-BounX-DR.css","assets/AdminThemes-lDAWzDaq.js","assets/PaysNiveauxDisplay.vue_vue_type_style_index_0_scoped_821033d6_lang-l0sNRNKZ.js","assets/AdminThemes-C42FetGD.css","assets/AdminNotions-Bj0wWZd-.js","assets/PaysNiveauxSelector.vue_vue_type_style_index_0_scoped_6652d9f9_lang-l0sNRNKZ.js","assets/AdminNotions-CICP2R-z.css","assets/AdminChapitres-Cem1eF90.js","assets/AdminChapitres-NJFWNzBT.css","assets/AdminExercices-Di6YW-wH.js","assets/AdminExercices-CUAMC96q.css","assets/AdminExercicesPlus-Cbco6gpS.js","assets/AdminExercicesPlus-bswOZmlE.css","assets/AdminCours-Cjozfdrh.js","assets/AdminCours-CpH06XSE.css","assets/AdminCoursPlus-po15fr9W.js","assets/AdminCoursPlus-DJVlzxGp.css","assets/AdminSheets-yBegzwvk.js","assets/AdminSheets-BzsaFlZ6.css","assets/AdminQuiz-ChnHWTLU.js","assets/AdminQuiz-xcDF0Z17.css","assets/AdminQuizPlus-DXBJrCBN.js","assets/AdminQuizPlus-Cbgqxmao.css","assets/AdminNiveaux-DQYFCavZ.js","assets/AdminNiveaux-BU2lQ2eA.css","assets/AdminPays-Zvekl4nj.js","assets/AdminPays-8Ot7-Z35.css","assets/NotFound-DiIhP0T5.js","assets/NotFound-BRLCr2dc.css"])))=>i.map(i=>d[i]);
import{r as Ae,a as C,c as R,b as S,o as _,d as i,e as ee,f as ne,g as z,t as D,h as j,i as Ne,w as Ue,n as J,T as Be,j as fe,k as st,v as vt,l as _t,m as rt,F as pe,p as he,q as ge,u as H,s as yt,x as It,y as Ge,z as De,A as ue,B as be,C as Te,D as St,E as ot,G as at,H as Et,I as bt}from"./vendor-D171CWhe.js";import{a as nt}from"./ui-jaH5oyHW.js";import{_ as M}from"./pdf-B39ievqC.js";import"./mathlive-B5k0jhbN.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function s(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(a){if(a.ep)return;a.ep=!0;const n=s(a);fetch(a.href,n)}})();const le=Ae({}),me=C([]);function ze(){return{modalStates:le,activeModals:me,openModal:(o,l={})=>{le[o]={isOpen:!0,...l},me.value.includes(o)||me.value.push(o),document.body.style.overflow="hidden"},closeModal:o=>{le[o]&&(le[o].isOpen=!1);const l=me.value.indexOf(o);l>-1&&me.value.splice(l,1),me.value.length===0&&(document.body.style.overflow="")},closeAllModals:()=>{Object.keys(le).forEach(o=>{le[o].isOpen=!1}),me.value=[],document.body.style.overflow=""},isModalOpen:o=>le[o]?.isOpen||!1,getModalState:o=>le[o]||{isOpen:!1},updateModalOptions:(o,l)=>{le[o]&&Object.assign(le[o],l)}}}const G={LOGIN:"login",REGISTER:"register",FORGOT_PASSWORD:"forgot-password",SIGNUP:"signup",CONFIRM_DELETE:"confirm-delete",SETTINGS:"settings",AUTO_NIVEAU:"auto-niveau"},W={required:e=>typeof e=="string"?e.trim().length>0||"Ce champ est requis":e!=null||"Ce champ est requis",email:e=>e?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)||"Format d'email invalide":!0,minLength:e=>t=>t?t.length>=e||`Minimum ${e} caractères requis`:!0,maxLength:e=>t=>t?t.length<=e||`Maximum ${e} caractères autorisés`:!0,password:e=>{if(!e)return!0;const t=/[A-Z]/.test(e),s=/[a-z]/.test(e),r=/\d/.test(e);return e.length>=8?t?s?r?!0:"Le mot de passe doit contenir au moins un chiffre":"Le mot de passe doit contenir au moins une minuscule":"Le mot de passe doit contenir au moins une majuscule":"Le mot de passe doit contenir au moins 8 caractères"},confirmPassword:e=>t=>t?e===t||"Les mots de passe ne correspondent pas":"Veuillez confirmer votre mot de passe"};function kt(e={},t={}){const s=Ae({...e}),r=Ae({}),a=Ae({}),n=C(!1),o=R(()=>Object.keys(r).length===0||Object.values(r).every(I=>!I)),l=R(()=>Object.values(r).some(I=>I)),c=(I,d)=>{const h=t[I];if(!h)return!0;for(const y of h){const L=y(d,void 0,s);if(L!==!0)return r[I]=L,!1}return delete r[I],!0},p=()=>{let I=!0;return Object.keys(t).forEach(d=>{c(d,s[d])||(I=!1)}),I};return{formData:s,errors:r,touched:a,isSubmitting:n,isValid:o,hasErrors:l,validateField:c,validateForm:p,setFieldValue:(I,d)=>{s[I]=d,a[I]&&c(I,d)},setFieldTouched:I=>{a[I]=!0,c(I,s[I])},resetForm:()=>{Object.keys(s).forEach(I=>{s[I]=e[I]||""}),Object.keys(r).forEach(I=>{delete r[I]}),Object.keys(a).forEach(I=>{delete a[I]}),n.value=!1},setErrors:I=>{Object.assign(r,I)},getFieldError:I=>r[I]||"",isFieldTouched:I=>a[I]||!1,handleSubmit:async I=>{if(!n.value){if(Object.keys(t).forEach(d=>{a[d]=!0}),!p())return!1;n.value=!0;try{return await I(s),!0}catch{return!1}finally{n.value=!1}}}}}const wt={LOGIN:{fields:{email:{type:"email",label:"Email",placeholder:"votre@email.com",required:!0,name:"username",autocomplete:"username",validation:[W.required,W.email]},password:{type:"password",label:"Mot de passe",placeholder:"Votre mot de passe",required:!0,name:"current-password",autocomplete:"current-password",validation:[W.required,W.minLength(6)]},rememberMe:{type:"checkbox",label:"Se souvenir de moi",required:!1}},submitText:"Se connecter",socialText:"Continuer avec Google"},REGISTER:{fields:{firstName:{type:"text",label:"Prénom",placeholder:"Votre prénom",required:!0,autocomplete:"given-name",validation:[W.required,W.minLength(2)]},lastName:{type:"text",label:"Nom",placeholder:"Votre nom",required:!0,autocomplete:"family-name",validation:[W.required,W.minLength(2)]},email:{type:"email",label:"Email",placeholder:"votre@email.com",required:!0,autocomplete:"email",validation:[W.required,W.email]},password:{type:"password",label:"Mot de passe",placeholder:"Créez un mot de passe",required:!0,autocomplete:"new-password",validation:[W.required,W.password]},confirmPassword:{type:"password",label:"Confirmer le mot de passe",placeholder:"Confirmez votre mot de passe",required:!0,autocomplete:"new-password",validation:[W.required]},acceptTerms:{type:"checkbox",label:"J'accepte les conditions d'utilisation",required:!0,validation:[e=>e===!0||"Vous devez accepter les conditions d'utilisation"]},newsletter:{type:"checkbox",label:"Je souhaite recevoir les actualités et offres d'OptiTAB",required:!1}},submitText:"Créer mon compte",socialText:"Continuer avec Google"},FORGOT_PASSWORD:{fields:{email:{type:"email",label:"Email",placeholder:"votre@email.com",required:!0,autocomplete:"email",validation:[W.required,W.email]}},submitText:"Envoyer le lien de réinitialisation",socialText:"Continuer avec Google"}};function je(e){const t=wt[e];if(!t)throw new Error(`Unknown form type: ${e}`);const s=Object.keys(t.fields).reduce((d,h)=>{const y=t.fields[h];return d[h]=y.type==="checkbox"?!1:"",d},{}),r=Object.keys(t.fields).reduce((d,h)=>{const y=t.fields[h];return y.validation&&(d[h]=y.validation),d},{});e==="REGISTER"&&r.confirmPassword.push((d,h,y)=>W.confirmPassword(y.password)(d));const{formData:a,errors:n,touched:o,isSubmitting:l,isValid:c,getFieldError:p,setFieldTouched:m,handleSubmit:g,resetForm:f}=kt(s,r);return{config:t,formData:a,errors:n,touched:o,isSubmitting:l,isValid:c,getFieldError:p,setFieldTouched:m,submitForm:async(d,h)=>await g(async L=>{try{return await d(L),!0}catch(x){return h?.(x),!1}}),resetForm:f,getFieldConfig:d=>t.fields[d]||null,getFieldNames:()=>Object.keys(t.fields),isFieldRequired:d=>t.fields[d]?.required||!1,getFieldType:d=>t.fields[d]?.type||"text"}}const K=(e,t)=>{const s=e.__vccOpts||e;for(const[r,a]of t)s[r]=a;return s},At={name:"CloseIcon"},Tt={class:"close-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"};function Mt(e,t,s,r,a,n){return _(),S("svg",Tt,t[0]||(t[0]=[i("line",{x1:"18",y1:"6",x2:"6",y2:"18"},null,-1),i("line",{x1:"6",y1:"6",x2:"18",y2:"18"},null,-1)]))}const Ct=K(At,[["render",Mt],["__scopeId","data-v-8853147e"]]),Ft={name:"Modal",components:{CloseIcon:Ct},props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:""},showHeader:{type:Boolean,default:!0},showCloseButton:{type:Boolean,default:!0},closeButtonLabel:{type:String,default:"Fermer"},closeOnOverlay:{type:Boolean,default:!0},canClose:{type:Boolean,default:!0},size:{type:String,default:"medium",validator:e=>["small","medium","large","full"].includes(e)},contentClass:{type:String,default:""}},emits:["close","overlay-click"],setup(e,{emit:t}){return{titleId:R(()=>e.title?`modal-title-${Date.now()}`:""),handleClose:()=>{t("close")},handleOverlayClick:()=>{e.closeOnOverlay&&e.canClose&&(t("overlay-click"),t("close"))}}}},Lt={key:0,class:"modal-wrapper"},Rt=["aria-modal","aria-labelledby"],xt={key:0,class:"modal-header"},Ot=["id"],Pt=["aria-label"],Nt={class:"modal-body"};function Dt(e,t,s,r,a,n){const o=ee("CloseIcon");return _(),ne(Be,{to:"body"},[s.isOpen?(_(),S("div",Lt,[i("div",{class:"modal-overlay",onClick:t[0]||(t[0]=(...l)=>r.handleOverlayClick&&r.handleOverlayClick(...l)),role:"presentation"}),i("div",{class:J(["modal-content",`modal-${s.size}`]),role:"dialog","aria-modal":s.isOpen,"aria-labelledby":r.titleId,onClick:t[2]||(t[2]=Ue(()=>{},["stop"]))},[s.showHeader?(_(),S("div",xt,[s.title?(_(),S("h2",{key:0,id:r.titleId,class:"modal-title"},D(s.title),9,Ot)):z("",!0),s.showCloseButton&&s.canClose?(_(),S("button",{key:1,class:"modal-close-btn",onClick:t[1]||(t[1]=(...l)=>r.handleClose&&r.handleClose(...l)),"aria-label":s.closeButtonLabel},[j(o)],8,Pt)):z("",!0)])):z("",!0),i("div",Nt,[Ne(e.$slots,"default",{},void 0,!0)])],10,Rt)])):z("",!0)])}const Fe=K(Ft,[["render",Dt],["__scopeId","data-v-91224a14"]]),Vt={name:"FormInput",props:{modelValue:{type:[String,Number],default:""},type:{type:String,default:"text",validator:e=>["text","email","password","number","tel","url","date"].includes(e)},label:{type:String,default:""},placeholder:{type:String,default:""},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},name:{type:String,default:""},autocomplete:{type:String,default:""},error:{type:String,default:""},helpText:{type:String,default:""}},emits:["update:modelValue","input","focus","blur","keydown"],setup(e,{emit:t}){const s=`input-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,r=C(!1),a=R({get:()=>e.modelValue,set:f=>t("update:modelValue",f)}),n=R(()=>({"has-error":e.error,"is-disabled":e.disabled})),o=R(()=>e.type==="password"?r.value?"text":"password":e.type);return{inputId:s,inputValue:a,inputClass:n,actualType:o,isPasswordVisible:r,handleInput:f=>t("input",f),handleFocus:f=>t("focus",f),handleBlur:f=>t("blur",f),handleKeydown:f=>t("keydown",f),togglePasswordVisibility:()=>{r.value=!r.value}}}},qt={class:"form-group"},Ut=["for"],Bt={key:0,class:"required-indicator"},Gt={class:"input-wrapper"},zt=["id","type","placeholder","required","disabled","name","autocomplete"],jt=["disabled"],$t={key:0,width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Xt={key:1,width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Ht={key:1,class:"form-error"},Qt={key:2,class:"form-help"};function Wt(e,t,s,r,a,n){return _(),S("div",qt,[s.label?(_(),S("label",{key:0,for:r.inputId,class:"form-label"},[fe(D(s.label)+" ",1),s.required?(_(),S("span",Bt,"*")):z("",!0)],8,Ut)):z("",!0),i("div",Gt,[st(i("input",{id:r.inputId,"onUpdate:modelValue":t[0]||(t[0]=o=>r.inputValue=o),type:r.actualType,placeholder:s.placeholder,required:s.required,disabled:s.disabled,name:s.name,autocomplete:s.autocomplete,class:J(["form-input",r.inputClass]),onInput:t[1]||(t[1]=(...o)=>r.handleInput&&r.handleInput(...o)),onFocus:t[2]||(t[2]=(...o)=>r.handleFocus&&r.handleFocus(...o)),onBlur:t[3]||(t[3]=(...o)=>r.handleBlur&&r.handleBlur(...o)),onKeydown:t[4]||(t[4]=(...o)=>r.handleKeydown&&r.handleKeydown(...o))},null,42,zt),[[vt,r.inputValue]]),s.type==="password"?(_(),S("button",{key:0,type:"button",class:"password-toggle",onClick:t[5]||(t[5]=(...o)=>r.togglePasswordVisibility&&r.togglePasswordVisibility(...o)),disabled:s.disabled,tabindex:"-1"},[r.isPasswordVisible?(_(),S("svg",$t,t[6]||(t[6]=[i("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"},null,-1),i("line",{x1:"1",y1:"1",x2:"23",y2:"23"},null,-1)]))):(_(),S("svg",Xt,t[7]||(t[7]=[i("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"},null,-1),i("circle",{cx:"12",cy:"12",r:"3"},null,-1)])))],8,jt)):z("",!0)]),s.error?(_(),S("p",Ht,D(s.error),1)):z("",!0),s.helpText?(_(),S("p",Qt,D(s.helpText),1)):z("",!0)])}const Kt=K(Vt,[["render",Wt],["__scopeId","data-v-49655f01"]]),Jt={name:"FormField",components:{FormInput:Kt},props:{fieldName:{type:String,required:!0},fieldConfig:{type:Object,required:!0},modelValue:{type:[String,Number,Boolean],default:""},disabled:{type:Boolean,default:!1},getFieldError:{type:Function,required:!0}},emits:["update:modelValue","blur","input"],setup(e,{emit:t}){const s=R({get:()=>e.modelValue,set:l=>t("update:modelValue",l)}),r=R(()=>e.fieldConfig?["text","email","password","number","tel","url"].includes(e.fieldConfig.type):!1),a=R(()=>({"has-error":e.getFieldError(e.fieldName),"is-disabled":e.disabled}));return{fieldValue:s,isInputField:r,fieldClass:a,handleBlur:l=>{t("blur",{fieldName:e.fieldName,event:l})},handleInput:l=>{t("input",{fieldName:e.fieldName,event:l})}}}},Yt={key:1,class:"checkbox-field"},Zt={class:"checkbox-label"},es=["required","disabled"],ts=["innerHTML"],ss={key:0,class:"form-error"},rs={key:2,class:"unsupported-field"},os={class:"error-message"};function as(e,t,s,r,a,n){const o=ee("FormInput");return s.fieldConfig?(_(),S("div",{key:0,class:J(["form-field",r.fieldClass])},[r.isInputField?(_(),ne(o,{key:0,modelValue:r.fieldValue,"onUpdate:modelValue":t[0]||(t[0]=l=>r.fieldValue=l),type:s.fieldConfig.type,label:s.fieldConfig.label,placeholder:s.fieldConfig.placeholder,required:s.fieldConfig.required,disabled:s.disabled,name:s.fieldConfig.name||s.fieldName,autocomplete:s.fieldConfig.autocomplete,error:s.getFieldError(s.fieldName),"help-text":s.fieldConfig.helpText,onBlur:r.handleBlur,onInput:r.handleInput},null,8,["modelValue","type","label","placeholder","required","disabled","name","autocomplete","error","help-text","onBlur","onInput"])):s.fieldConfig.type==="checkbox"?(_(),S("div",Yt,[i("label",Zt,[st(i("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>r.fieldValue=l),type:"checkbox",class:"checkbox-input",required:s.fieldConfig.required,disabled:s.disabled},null,8,es),[[_t,r.fieldValue]]),i("span",{class:"checkbox-text",innerHTML:s.fieldConfig.label},null,8,ts)]),s.getFieldError(s.fieldName)?(_(),S("p",ss,D(s.getFieldError(s.fieldName)),1)):z("",!0)])):(_(),S("div",rs,[i("p",os,'Field type "'+D(s.fieldConfig.type)+'" is not supported',1)]))],2)):z("",!0)}const it=K(Jt,[["render",as],["__scopeId","data-v-d5ac912b"]]),ns={name:"LoadingSpinner",props:{size:{type:String,default:"medium",validator:e=>["small","medium","large"].includes(e)},color:{type:String,default:"current"}},computed:{sizeClass(){return`spinner-${this.size}`},spinnerStyle(){return this.color==="current"?{}:{"--spinner-color":this.color}}}};function is(e,t,s,r,a,n){return _(),S("div",{class:J(["loading-spinner",n.sizeClass]),style:rt(n.spinnerStyle)},t[0]||(t[0]=[i("div",{class:"spinner-ring"},null,-1)]),6)}const ls=K(ns,[["render",is],["__scopeId","data-v-f8c69cd1"]]),cs={name:"DynamicForm",components:{FormField:it,LoadingSpinner:ls},props:{fieldNames:{type:Array,required:!0},getFieldConfig:{type:Function,required:!0},formData:{type:Object,required:!0},isSubmitting:{type:Boolean,default:!1},isValid:{type:Boolean,default:!0},getFieldError:{type:Function,required:!0},setFieldTouched:{type:Function,required:!0},submitText:{type:String,default:"Soumettre"}},emits:["submit","field-blur","field-input"],setup(e,{emit:t}){return{handleSubmit:()=>{t("submit")},handleFieldBlur:({fieldName:n,event:o})=>{e.setFieldTouched(n),t("field-blur",{fieldName:n,event:o})},handleFieldInput:({fieldName:n,event:o})=>{t("field-input",{fieldName:n,event:o})}}}},us={class:"form-fields"},ds=["disabled"],ms={key:1};function fs(e,t,s,r,a,n){const o=ee("FormField"),l=ee("LoadingSpinner");return _(),S("form",{onSubmit:t[0]||(t[0]=Ue((...c)=>r.handleSubmit&&r.handleSubmit(...c),["prevent"])),class:"dynamic-form"},[i("div",us,[(_(!0),S(pe,null,he(s.fieldNames,c=>(_(),ne(o,{key:c,"field-name":c,"field-config":s.getFieldConfig(c),modelValue:s.formData[c],"onUpdate:modelValue":p=>s.formData[c]=p,disabled:s.isSubmitting,"get-field-error":s.getFieldError,onBlur:r.handleFieldBlur,onInput:r.handleFieldInput},null,8,["field-name","field-config","modelValue","onUpdate:modelValue","disabled","get-field-error","onBlur","onInput"]))),128))]),Ne(e.$slots,"form-content",{},void 0,!0),i("button",{type:"submit",class:"form-submit-btn",disabled:s.isSubmitting||!s.isValid},[s.isSubmitting?(_(),ne(l,{key:0})):(_(),S("span",ms,D(s.submitText),1))],8,ds),Ne(e.$slots,"form-actions",{},void 0,!0)],32)}const $e=K(cs,[["render",fs],["__scopeId","data-v-6fbd3fc3"]]),ps="/icons/google.svg",lt=[{key:"google",label:"Continuer avec Google",icon:ps,btnClass:"google-btn",color:"#e5e7eb"}];function Ve(e){if(e<=0)return{level:0,next_level_xp:10,xp_to_next:10};let t=0;for(;;){const a=(t+1)*(t+1)*10;if(e<a)break;t+=1}const s=(t+1)*(t+1)*10,r=s-e;return{level:t,next_level_xp:s,xp_to_next:r}}localStorage.removeItem("user");const oe=ge("user",{state:()=>({id:null,firstName:"",lastName:"",email:"",telephone:"",date_naissance:"",niveau_pays:null,pays:null,role:"student",xp:0,level:0,xp_to_next:0,isAdmin:!1,isAuthenticated:!1,isLoading:!1}),actions:{setUser(e){this.id=e.id||e.user_id||null,this.firstName=e.first_name||"",this.lastName=e.last_name||"",this.email=e.email||"",this.telephone=e.telephone||"",this.date_naissance=e.date_naissance||"",this.niveau_pays=e.niveau_pays||null,this.pays=e.pays||null,this.role=e.role||"student";const t=Number(e.xp??0),s=Ve(t);this.xp=t,this.level=Number(s.level),this.xp_to_next=Number(s.xp_to_next);const r=["anthonytabet.c@gmail.com","admin@optitab.com"];this.isAdmin=e.is_staff||e.isAdmin||r.includes(e.email)||!1,this.isAuthenticated=!0,this.isLoading=!1},clearUser(){ye.stopTokenMonitoring();const e=this.id;if(this.id=null,this.firstName="",this.lastName="",this.email="",this.telephone="",this.date_naissance="",this.niveau_pays=null,this.pays=null,this.role="student",this.xp=0,this.level=0,this.xp_to_next=0,this.isAdmin=!1,this.isAuthenticated=!1,this.isLoading=!1,e){const s=`configurationCompleted_${e}`;localStorage.removeItem(s)}["selectedMatieres","favoriteMatieresIds","activeMatiereId","selectedMatieresIds","access_token","refresh_token"].forEach(s=>localStorage.removeItem(s))},async fetchUser(){this.isLoading=!0;try{const e=localStorage.getItem("access_token"),t=localStorage.getItem("refresh_token"),s=await zs(),r=s.data?.data||s.data,a=this.pays&&this.niveau_pays,n=r.pays&&r.niveau_pays;if(a&&!n&&this.id){const o=`configurationCompleted_${this.id}`;localStorage.removeItem(o),["selectedMatieres","favoriteMatieresIds","activeMatiereId","selectedMatieresIds"].forEach(c=>localStorage.removeItem(c))}this.setUser(r),setTimeout(()=>{ye.startTokenMonitoring()},500)}catch(e){const t=e.response?.status,s=e.response?.data?.message||e.message;t===401?this.clearUser():t>=500?setTimeout(()=>{this.isAuthenticated||this.fetchUser()},5e3):this.clearUser()}finally{this.isLoading=!1}}}}),$={SELECTED_SUBJECT:"selected-subject",SELECTED_MATIERES:"selected-matieres-ids",FAVORITE_MATIERES:"favorite-matieres-ids",ACTIVE_MATIERE:"active-matiere-id"},Me={MAX_SELECTED_MATIERES:10,MAX_FAVORITE_MATIERES:20},de={INVALID_ID:"ID de matière invalide",LIMIT_REACHED:"Limite atteinte"},ct={UNAUTHORIZED:401,NOT_FOUND:404},X=(e,t,s={})=>{const r={context:t,message:e.message,timestamp:new Date().toISOString(),...s};return e.response&&(e.response.status,ct.NOT_FOUND),r},ut=e=>{if(e==null)return!1;const t=Number(e);return!isNaN(t)&&t>0&&Number.isInteger(t)},te=e=>ut(e)?Number(e):null,Q=()=>!!localStorage.getItem("access_token"),Z=(e,t)=>{try{return localStorage.setItem(e,JSON.stringify(t)),!0}catch{return!1}},Xe=(e,t,s=!0)=>{try{const r=localStorage.getItem(e);if(!r)return t;if(!s)return r;try{return JSON.parse(r)}catch{return r}}catch{return t}},Se=e=>Array.isArray(e)?e.filter(ut).map(te):[],Ee=(e,t)=>e.response?.status===ct.UNAUTHORIZED,dt=(e,t)=>e<t,k=(e,t={},s="info")=>{const r={operation:e,timestamp:new Date().toISOString(),...t};switch(s){case"warn":break;case"error":break;default:}},hs=ge("subjects-favorites",()=>{const e=C([]),t=C(!1),s=C(null),r=R(()=>e.value.length),a=R(()=>dt(r.value,Me.MAX_FAVORITE_MATIERES)),n=R(()=>f=>{const u=te(f);return u!==null&&e.value.includes(u)}),o=async f=>{const u=te(f);if(!u)return k("addFavoriteMatiere",{id:f,error:de.INVALID_ID},"warn"),!1;if(e.value.includes(u))return k("addFavoriteMatiere",{id:u,status:"already_favorite"}),!0;if(!a.value)return k("addFavoriteMatiere",{id:u,error:de.LIMIT_REACHED,currentCount:r.value,maxCount:Me.MAX_FAVORITE_MATIERES},"warn"),!1;if(e.value.push(u),Z($.FAVORITE_MATIERES,e.value),k("addFavoriteMatiere",{id:u,status:"local_update",authenticated:Q()}),!Q())return!0;try{return t.value=!0,s.value=null,await Ns(u),k("addFavoriteMatiere",{id:u,status:"backend_success"}),!0}catch(b){return Ee(b,"addFavoriteMatiere")?!0:(e.value=e.value.filter(F=>F!==u),Z($.FAVORITE_MATIERES,e.value),s.value=X(b,"addFavoriteMatiere",{matiereId:u}),!1)}finally{t.value=!1}},l=async f=>{const u=te(f);if(!u)return k("removeFavoriteMatiere",{id:f,error:de.INVALID_ID},"warn"),!1;const b=e.value.indexOf(u);if(b===-1)return k("removeFavoriteMatiere",{id:u,status:"not_found"}),!0;if(e.value.splice(b,1),Z($.FAVORITE_MATIERES,e.value),k("removeFavoriteMatiere",{id:u,status:"local_update",authenticated:Q()}),!Q())return!0;try{return t.value=!0,s.value=null,await Ds(u),k("removeFavoriteMatiere",{id:u,status:"backend_success"}),!0}catch(F){return Ee(F,"removeFavoriteMatiere")?!0:(e.value.splice(b,0,u),Z($.FAVORITE_MATIERES,e.value),s.value=X(F,"removeFavoriteMatiere",{matiereId:u}),!1)}finally{t.value=!1}};return{favoriteMatieresIds:e,isSyncing:t,lastSyncError:s,favoriteMatieresCount:r,canAddMoreFavorites:a,isFavoriteMatiere:n,addFavoriteMatiere:o,removeFavoriteMatiere:l,toggleFavoriteMatiere:async f=>{const u=te(f);if(!u)return k("toggleFavoriteMatiere",{matiereId:f,error:de.INVALID_ID},"warn"),!1;try{return e.value.includes(u)?await l(u):await o(u)}catch(b){return s.value=X(b,"toggleFavoriteMatiere",{matiereId:u}),!1}},loadFavoriteMatieresIds:async()=>{try{const f=Xe($.FAVORITE_MATIERES,[]),u=Se(f);e.value=u,k("loadFavoriteMatieresIds",{loadedCount:u.length,totalStored:f.length})}catch(f){s.value=X(f,"loadFavoriteMatieresIds"),e.value=[]}},clearFavorites:async()=>{try{const f=[...e.value];for(const u of f)await l(u);return k("clearFavorites",{clearedCount:f.length}),!0}catch(f){return s.value=X(f,"clearFavorites"),!1}},setFavoriteMatieresIds:f=>{const u=Se(f);e.value=u,Z($.FAVORITE_MATIERES,u),k("setFavoriteMatieresIds",{setCount:u.length,originalCount:f.length})}}}),gs=ge("subjects-selected",()=>{const e=C([]),t=C(!1),s=C(null),r=R(()=>e.value.length),a=R(()=>dt(r.value,Me.MAX_SELECTED_MATIERES)),n=R(()=>f=>{const u=te(f);return u!==null&&e.value.includes(u)}),o=async f=>{const u=te(f);if(!u)return k("addMatiereId",{id:f,error:de.INVALID_ID},"warn"),!1;if(e.value.includes(u))return k("addMatiereId",{id:u,status:"already_selected"}),!0;if(!a.value)return k("addMatiereId",{id:u,error:de.LIMIT_REACHED,currentCount:r.value,maxCount:Me.MAX_SELECTED_MATIERES},"warn"),!1;if(e.value.push(u),Z($.SELECTED_MATIERES,e.value),k("addMatiereId",{id:u,status:"local_update",authenticated:Q()}),!Q())return!0;try{return t.value=!0,s.value=null,await Vs(u),k("addMatiereId",{id:u,status:"backend_success"}),!0}catch(b){return Ee(b,"addMatiereId")?!0:(e.value=e.value.filter(F=>F!==u),Z($.SELECTED_MATIERES,e.value),s.value=X(b,"addMatiereId",{matiereId:u}),!1)}finally{t.value=!1}},l=async f=>{const u=te(f);if(!u)return k("removeMatiereId",{id:f,error:de.INVALID_ID},"warn"),!1;const b=e.value.indexOf(u);if(b===-1)return k("removeMatiereId",{id:u,status:"not_found"}),!0;try{return e.value.splice(b,1),Z($.SELECTED_MATIERES,e.value),k("removeMatiereId",{id:u,status:"local_update",authenticated:Q()}),Q()&&(t.value=!0,s.value=null,await qs(u),k("removeMatiereId",{id:u,status:"backend_success"})),!0}catch(F){return e.value.splice(b,0,u),Z($.SELECTED_MATIERES,e.value),s.value=X(F,"removeMatiereId",{matiereId:u}),!1}finally{t.value=!1}};return{selectedMatieresIds:e,isSyncing:t,lastSyncError:s,selectedMatieresCount:r,canAddMoreSelected:a,isSelectedMatiere:n,addMatiereId:o,removeMatiereId:l,loadSelectedMatieresIds:async()=>{try{const f=Xe($.SELECTED_MATIERES,[]),u=Se(f);e.value=u,k("loadSelectedMatieresIds",{loadedCount:u.length,totalStored:f.length})}catch(f){s.value=X(f,"loadSelectedMatieresIds"),e.value=[]}},clearSelectedMatieres:async()=>{try{const f=[...e.value];for(const u of f)await l(u);return k("clearSelectedMatieres",{clearedCount:f.length}),!0}catch(f){return s.value=X(f,"clearSelectedMatieres"),!1}},setSelectedMatieresIds:f=>{const u=Se(f);e.value=u,Z($.SELECTED_MATIERES,u),k("setSelectedMatieresIds",{setCount:u.length,originalCount:f.length})},addMultipleMatieres:async f=>{try{const u=Se(f),F=(await Promise.all(u.map(I=>o(I)))).filter(Boolean).length,w=u.length;return k("addMultipleMatieres",{successCount:F,totalCount:w,successRate:`${(F/w*100).toFixed(1)}%`}),F===w}catch(u){return s.value=X(u,"addMultipleMatieres",{ids:f}),!1}}}}),vs=ge("subjects-active",()=>{const e=C(null),t=C(!1),s=C(null),r=R(()=>m=>{const g=te(m);return g!==null&&e.value===g}),a=R(()=>e.value!==null),n=async m=>{const g=te(m);if(!g)return k("setActiveMatiere",{id:m,error:de.INVALID_ID},"warn"),!1;if(e.value===g)return k("setActiveMatiere",{id:g,status:"already_active"}),!0;try{const f=e.value;return e.value=g,Z($.ACTIVE_MATIERE,g),k("setActiveMatiere",{id:g,previousId:f,status:"local_update",authenticated:Q()}),Q()&&(t.value=!0,s.value=null,await Us(g),k("setActiveMatiere",{id:g,status:"backend_success"})),!0}catch(f){return e.value=previousId,previousId?Z($.ACTIVE_MATIERE,previousId):localStorage.removeItem($.ACTIVE_MATIERE),s.value=X(f,"setActiveMatiere",{matiereId:g}),!1}finally{t.value=!1}};return{activeMatiereId:e,isSyncing:t,lastSyncError:s,isActiveMatiere:r,hasActiveMatiere:a,setActiveMatiere:n,clearActiveMatiere:async()=>{try{const m=e.value;return e.value=null,localStorage.removeItem($.ACTIVE_MATIERE),k("clearActiveMatiere",{previousId:m,status:"cleared"}),!0}catch(m){return s.value=X(m,"clearActiveMatiere"),!1}},loadActiveMatiereId:async()=>{try{const m=Xe($.ACTIVE_MATIERE,null),g=m!==null?te(m):null;e.value=g,k("loadActiveMatiereId",{loadedId:g,storedValue:m})}catch(m){s.value=X(m,"loadActiveMatiereId"),e.value=null}},getOrSetSmartActiveMatiere:async(m=[])=>{try{if(e.value)return e.value;if(m.length>0){const g=m[0];if(await n(g))return g}return k("getOrSetSmartActiveMatiere",{status:"no_matiere_available",selectedCount:m.length}),null}catch(g){return s.value=X(g,"getOrSetSmartActiveMatiere"),null}},setActiveMatiereId:m=>{const g=te(m);e.value=g,g?Z($.ACTIVE_MATIERE,g):localStorage.removeItem($.ACTIVE_MATIERE),k("setActiveMatiereId",{id:g,status:"direct_set"})}}}),_s=ge("subjects-sync",()=>{const e=C(!1),t=C(null),s=C(null),r=async p=>{if(!Q())return k("loadPreferencesFromServer",{status:"user_not_authenticated",message:"Utilisateur non connecté, chargement depuis localStorage uniquement"}),!1;try{e.value=!0,t.value=null,k("loadPreferencesFromServer",{status:"starting",authenticated:!0});const m=await Gs();return m?(p.selectedStore&&p.selectedStore.setSelectedMatieresIds(m.selectedIds||[]),p.favoritesStore&&p.favoritesStore.setFavoriteMatieresIds(m.favoriteIds||[]),p.activeStore&&p.activeStore.setActiveMatiereId(m.activeId||null),s.value=new Date().toISOString(),k("loadPreferencesFromServer",{status:"success",selectedCount:m.selectedIds?.length||0,favoritesCount:m.favoriteIds?.length||0,activeId:m.activeId}),!0):(k("loadPreferencesFromServer",{status:"no_data",message:"Aucune donnée reçue du backend"}),!1)}catch(m){return Ee(m,"loadPreferencesFromServer")||(t.value=X(m,"loadPreferencesFromServer")),!1}finally{e.value=!1}},a=async()=>{if(!Q())return k("syncWithBackend",{status:"user_not_authenticated",message:"Synchronisation ignorée (utilisateur non connecté)"}),!0;try{e.value=!0,t.value=null,k("syncWithBackend",{status:"starting",authenticated:!0});const p=await Bs();return p&&(s.value=new Date().toISOString(),k("syncWithBackend",{status:"success",timestamp:s.value})),p}catch(p){return Ee(p,"syncWithBackend")?!0:(t.value=X(p,"syncWithBackend"),!1)}finally{e.value=!1}};return{isSyncing:e,lastSyncError:t,lastSyncTimestamp:s,loadPreferencesFromServer:r,syncWithBackend:a,initializeAfterLogin:async p=>{if(!Q())return k("initializeAfterLogin",{status:"user_not_authenticated",message:"initializeAfterLogin appelé sans authentification"},"warn"),!1;try{return k("initializeAfterLogin",{status:"starting",message:"Initialisation après connexion..."}),await r(p)||(p.selectedStore?.selectedMatieresCount>0||p.favoritesStore?.favoriteMatieresCount>0)&&(k("initializeAfterLogin",{status:"syncing_local_to_backend",message:"Synchronisation des données locales vers le backend..."}),await a()),k("initializeAfterLogin",{status:"completed",message:"Initialisation après connexion terminée"}),!0}catch(m){return k("initializeAfterLogin",{status:"error",error:m.message},"error"),!1}},getSyncStatus:()=>({isSyncing:e.value,lastSyncError:t.value,lastSyncTimestamp:s.value,isAuthenticated:Q(),canSync:Q()&&!e.value}),clearSyncErrors:()=>{t.value=null,k("clearSyncErrors",{status:"errors_cleared"})},forceSync:async p=>{try{k("forceSync",{status:"starting",message:"Synchronisation forcée..."});const m=await r(p),g=await a(),f=m||g;return k("forceSync",{status:f?"success":"partial_failure",loadSuccess:m,syncSuccess:g}),f}catch(m){return t.value=X(m,"forceSync"),!1}}}}),Le=ge("subjects",()=>{const e=hs(),t=gs(),s=vs(),r=_s(),a=R(()=>H(e.favoriteMatieresIds)),n=R(()=>H(t.selectedMatieresIds)),o=R(()=>H(s.activeMatiereId)),l=R(()=>H(e.favoriteMatieresCount)),c=R(()=>H(t.selectedMatieresCount)),p=R(()=>e.isFavoriteMatiere),m=R(()=>t.isSelectedMatiere),g=R(()=>s.isActiveMatiere),f=R(()=>H(s.hasActiveMatiere)),u=R(()=>H(e.canAddMoreFavorites)),b=R(()=>H(t.canAddMoreSelected)),F=R(()=>H(e.isSyncing)||H(t.isSyncing)||H(s.isSyncing)||H(r.isSyncing)),w=R(()=>H(e.lastSyncError)||H(t.lastSyncError)||H(s.lastSyncError)||H(r.lastSyncError)),I=async N=>await e.addFavoriteMatiere(N),d=async N=>await e.removeFavoriteMatiere(N),h=async N=>await e.toggleFavoriteMatiere(N),y=async N=>await t.addMatiereId(N),L=async N=>await t.removeMatiereId(N),x=async N=>await t.addMultipleMatieres(N),V=async N=>await s.setActiveMatiere(N),B=async()=>await s.clearActiveMatiere(),T=async(N=[])=>await s.getOrSetSmartActiveMatiere(N),v=async()=>{const N={selectedStore:t,favoritesStore:e,activeStore:s};return await r.loadPreferencesFromServer(N)};return{favoriteMatieresIds:a,selectedMatieresIds:n,activeMatiereId:o,favoriteMatieresCount:l,selectedMatieresCount:c,isFavoriteMatiere:p,isSelectedMatiere:m,isActiveMatiere:g,hasActiveMatiere:f,canAddMoreFavorites:u,canAddMoreSelected:b,isSyncing:F,lastSyncError:w,addFavoriteMatiere:I,removeFavoriteMatiere:d,toggleFavoriteMatiere:h,addMatiereId:y,removeMatiereId:L,addMultipleMatieres:x,setActiveMatiere:V,clearActiveMatiere:B,getOrSetSmartActiveMatiere:T,loadPreferencesFromServer:v,syncWithBackend:async()=>{const N={selectedStore:t,favoritesStore:e,activeStore:s};return await r.syncWithBackend(N)},initializeAfterLogin:async()=>{const N={selectedStore:t,favoritesStore:e,activeStore:s};return await r.initializeAfterLogin(N)},initialize:async()=>{try{k("initialize",{status:"starting"}),await Promise.all([e.loadFavoriteMatieresIds(),t.loadSelectedMatieresIds(),s.loadActiveMatiereId()]),Q()&&await v(),k("initialize",{status:"success",favoritesCount:l.value,selectedCount:c.value,activeId:o.value})}catch(N){throw X(N,"initialize"),N}},clearAll:async()=>{try{await Promise.all([e.clearFavorites(),t.clearSelectedMatieres(),s.clearActiveMatiere()]),k("clearAll",{status:"success"})}catch(N){throw X(N,"clearAll"),N}},getSyncStatus:()=>r.getSyncStatus(),clearSyncErrors:()=>{e.lastSyncError=null,t.lastSyncError=null,s.lastSyncError=null,r.clearSyncErrors()},getStats:()=>({hasActiveMatiere:f.value,activeMatiereId:o.value,favoritesCount:l.value,selectedCount:c.value,canAddMoreFavorites:u.value,canAddMoreSelected:b.value,isSyncing:F.value,lastSyncError:w.value,favoriteMatieresIds:a.value,selectedMatieresIds:n.value,isAuthenticated:Q(),timestamp:new Date().toISOString()}),loadFavoriteMatieresIds:async()=>await e.loadFavoriteMatieresIds(),loadSelectedMatieresIds:async()=>await t.loadSelectedMatieresIds(),loadActiveMatiereId:async()=>await s.loadActiveMatiereId(),stores:{favorites:e,selected:t,active:s,sync:r}}}),ys=["Exercises","Quiz","Sheets","OnlineCourses"],Is={Exercises:e=>({name:"Notions",params:{matiereId:String(e)}}),Quiz:e=>({name:"QuizNotions",params:{matiereId:String(e)}}),Sheets:e=>({name:"Sheets",query:{matiereId:String(e)}}),OnlineCourses:e=>({name:"CourseNotions",params:{matiereId:String(e)}})},ke=(e,t,s)=>{try{const r=Le();if(!ys.includes(e.name)){Ce(e,r),s();return}const a=e.params.matiereId||e.query.matiereId;if(a&&mt(a)){Ce(e,r),s();return}const n=Ss(r);if(n){const o=Is[e.name];if(o){const l=o(n);s(l);return}}s()}catch{s()}},Ce=(e,t)=>{try{const s=e.params.matiereId||e.query.matiereId;if(mt(s)){const r=Number(s);t.selectedMatieresIds.includes(r)||t.addMatiereId(r),t.setActiveMatiere(r)}}catch{}},Ss=e=>{try{if(e.activeMatiereId)return e.activeMatiereId;if(e.selectedMatieresIds.length>0){const t=e.selectedMatieresIds[0];return e.setActiveMatiere(t),t}return null}catch{return null}},mt=e=>e!=null&&!isNaN(Number(e))&&Number(e)>0,Ie=(e,t,s)=>{try{const r=Le();e.name==="Notions"&&e.params.matiereId&&Ce(e,r),s()}catch{s()}},Re=(e,t,s)=>{try{const r=Le();["QuizNotions","QuizChapitres","ChapterQuiz"].includes(e.name)&&e.params.matiereId&&Ce(e,r),s()}catch{s()}};function Es(e,t,s){const r=oe();if(!r.isAuthenticated)return s();if(!r.niveau_pays&&e.name!=="Dashboard")return s({name:"Dashboard"});s()}const bs=["Cours","Exercises","Quiz","Sheets","Themes","Notions","Chapitres","ChapterExercises","ChapterQuiz","ThemeNotions","CourseChapitres","CourseChapitre","CourseNotions","QuizChapitres","QuizNotions","Progress","Calculator"];function ks(e){return bs.includes(e)}const ws=[{path:"/",name:"Home",component:()=>M(()=>import("./Home-BtMO1NRk.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))},{path:"/dashboard",name:"Dashboard",component:()=>M(()=>import("./Dashboard-BQsdkVUO.js"),__vite__mapDeps([12,13,2,3,4,8,14,15,9,16,17,18,10,19]))},{path:"/child/:childId",name:"ChildOverview",component:()=>M(()=>import("./ChildOverview-xECYB2Gz.js"),__vite__mapDeps([20,2,8,9,10,21])),meta:{requiresAuth:!0}},{path:"/account",name:"Account",component:()=>M(()=>import("./Account-gAX7tkKD.js"),__vite__mapDeps([22,2,13,3,4,8,14,23,9,24,10,25])),meta:{requiresAuth:!0}},{path:"/pricing",name:"Pricing",component:()=>M(()=>import("./Pricing-CZVCv2hM.js"),__vite__mapDeps([26,13,2,3,4,8,14,9,10,27])),meta:{requiresAuth:!0}},{path:"/exercises",name:"Exercises",component:()=>M(()=>import("./Exercises-CYTtQR95.js"),__vite__mapDeps([28,13,2,3,4,8,14,6,7,29,30,9,10,31])),meta:{requiresAuth:!0},beforeEnter:ke},{path:"/online-courses",name:"OnlineCourses",component:()=>M(()=>import("./OnlineCourses-CMW9JRdD.js"),__vite__mapDeps([32,13,2,3,4,8,14,6,7,30,9,10,33])),meta:{requiresAuth:!0},beforeEnter:ke},{path:"/quiz",name:"Quiz",component:()=>M(()=>import("./Quiz-BTb_3pbs.js"),__vite__mapDeps([34,13,2,3,4,8,14,6,7,30,9,10,35])),meta:{requiresAuth:!0},beforeEnter:ke},{path:"/quiz/:matiereId",name:"QuizNotions",component:()=>M(()=>import("./QuizNotions-BY-iKxNd.js"),__vite__mapDeps([36,2,13,3,4,8,14,37,29,38,39,40,41,42,9,10,43])),meta:{requiresAuth:!0},beforeEnter:Re},{path:"/quiz-chapitres/:notionId",name:"QuizChapitres",component:()=>M(()=>import("./QuizChapitres-Db2gmT4Y.js"),__vite__mapDeps([44,2,13,3,4,8,14,45,41,42,46,15,9,10])),meta:{requiresAuth:!0},beforeEnter:Re},{path:"/quiz-exercices/:chapitreId",name:"ChapterQuiz",component:()=>M(()=>import("./ChapterQuiz--v4IaR_2.js"),__vite__mapDeps([47,2,13,3,4,8,14,17,15,9,18,10,41,42,48])),meta:{requiresAuth:!0},beforeEnter:Re},{path:"/course-notions/:matiereId",name:"CourseNotions",component:()=>M(()=>import("./CourseNotions-BiYH1Z3K.js"),__vite__mapDeps([49,2,13,3,4,8,14,41,42,37,29,38,39,40,9,10,50])),meta:{requiresAuth:!0}},{path:"/course-chapitres/:notionId",name:"CourseChapitres",component:()=>M(()=>import("./CourseChapitres-D0dJKzN7.js"),__vite__mapDeps([51,2,13,3,4,8,14,45,41,42,46,15,9,10])),meta:{requiresAuth:!0}},{path:"/course/:chapitreId",name:"CourseChapitre",component:()=>M(()=>import("./CourseChapitre-BlhcOgF7.js"),__vite__mapDeps([52,2,13,3,4,8,14,41,42,53,9,54,15,55,56,10,57])),meta:{requiresAuth:!0}},{path:"/cours/:matiereId/:notionId/:chapitreId",name:"Cours",component:()=>M(()=>import("./Cours-CpJeUiwr.js"),__vite__mapDeps([58,2,13,3,4,8,14,41,42,55,56,9,10,59])),meta:{requiresAuth:!0}},{path:"/cours/:matiereId/:notionId/:chapitreId/:coursId",name:"CoursDetail",component:()=>M(()=>import("./CoursDetail-D-2iVYs0.js"),__vite__mapDeps([60,2,13,3,4,8,14,41,42,55,56,9,10,61])),meta:{requiresAuth:!0}},{path:"/sheets",name:"Sheets",component:()=>M(()=>import("./Sheets-BQuh7fZW.js"),__vite__mapDeps([62,2,13,3,4,8,14,63,30,9,10,64])),meta:{requiresAuth:!0},beforeEnter:ke},{path:"/about",name:"About",component:()=>M(()=>import("./About-BPY7wHB7.js"),__vite__mapDeps([65,66,1,2,3,4,5,8,9,10,67]))},{path:"/cours-particuliers",name:"CoursParticuliers",component:()=>M(()=>import("./CoursParticuliers-re7PHRP9.js"),__vite__mapDeps([68,66,1,2,3,4,5,8,9,10,69]))},{path:"/password-reset",name:"PasswordReset",component:()=>M(()=>import("./PasswordReset-RGbuOMbT.js"),__vite__mapDeps([70,2,8,9,10,71]))},{path:"/cgv",name:"CGV",component:()=>M(()=>import("./CGV-Nfp06c-1.js"),__vite__mapDeps([72,1,2,3,4,5,8,9,10,73]))},{path:"/cgu",name:"CGU",component:()=>M(()=>import("./CGU-C2idCSJm.js"),__vite__mapDeps([74,1,2,3,4,5,8,9,10,75]))},{path:"/confidentialite",name:"Confidentialite",component:()=>M(()=>import("./Confidentialite-BPERfxXQ.js"),__vite__mapDeps([76,1,2,3,4,5,8,9,10,77]))},{path:"/conditions",name:"Conditions",component:()=>M(()=>import("./Conditions-B4hxqoon.js"),__vite__mapDeps([78,1,2,3,4,5,8,9,10,79]))},{path:"/notions/:matiereId",name:"Notions",component:()=>M(()=>import("./Notions-DQJ-pwaw.js"),__vite__mapDeps([80,2,13,3,4,8,14,81,29,82,41,42,9,10,83,39])),meta:{requiresAuth:!0},beforeEnter:Ie},{path:"/themes/:matiereId",name:"Themes",component:()=>M(()=>import("./Themes-Dv26B5x1.js"),__vite__mapDeps([84,2,13,3,4,8,14,37,29,38,39,40,41,42,9,10,85])),meta:{requiresAuth:!0},beforeEnter:Ie},{path:"/theme-notions/:themeId",name:"ThemeNotions",component:()=>M(()=>import("./ThemeNotions-BWDfmYKu.js"),__vite__mapDeps([86,2,13,3,4,8,14,15,9,38,39,41,42,10,87])),meta:{requiresAuth:!0},beforeEnter:Ie},{path:"/chapitres/:notionId",name:"Chapitres",component:()=>M(()=>import("./Chapitres-BLu6il-N.js"),__vite__mapDeps([88,2,13,3,4,8,14,15,9,45,41,42,46,10,89])),meta:{requiresAuth:!0},beforeEnter:Ie},{path:"/exercices/:chapitreId",name:"Exercices",component:()=>M(()=>import("./ChapterExercises-CUL2Us19.js"),__vite__mapDeps([90,9,2,13,3,4,8,14,15,16,91,92,41,42,53,54,10,93,94])),meta:{requiresAuth:!0},beforeEnter:Ie},{path:"/exercice/:exerciceId",name:"ExerciceDetail",component:()=>M(()=>import("./ExerciceDetail-1ICcudZ7.js"),__vite__mapDeps([95,9,2,15,16,13,3,4,8,14,91,92,41,42,53,54,10,96])),meta:{requiresAuth:!0}},{path:"/progress",name:"Progress",component:()=>M(()=>import("./Progress-Ep7-aFQt.js"),__vite__mapDeps([97,13,2,3,4,8,14,15,9,16,10,98,94])),meta:{requiresAuth:!0}},{path:"/calculator",name:"Calculator",component:()=>M(()=>import("./Calculator-BGH2Xb1T.js"),__vite__mapDeps([99,2,13,3,4,8,14,100,82,101,9,10,102]))},{path:"/test-filtrage-strict",name:"TestFiltrageStrict",component:()=>M(()=>import("./TestFiltrageStrict-BEq8kLi6.js"),__vite__mapDeps([103,4,2,8,9,10,104]))},{path:"/admin",component:()=>M(()=>import("./AdminLayout-CjAsE3Gj.js"),__vite__mapDeps([105,2,13,3,4,8,14,9,10,106])),meta:{requiresAdmin:!0},children:[{path:"matieres",name:"AdminMatieres",component:()=>M(()=>import("./AdminMatieres-Dg8IlBTx.js"),__vite__mapDeps([107,2,4,108,109,110,8,9,10,111]))},{path:"themes",name:"AdminThemes",component:()=>M(()=>import("./AdminThemes-lDAWzDaq.js"),__vite__mapDeps([112,2,29,108,113,109,110,8,9,10,114]))},{path:"notions",name:"AdminNotions",component:()=>M(()=>import("./AdminNotions-Bj0wWZd-.js"),__vite__mapDeps([115,2,81,29,108,116,113,109,110,8,9,10,117]))},{path:"chapitres",name:"AdminChapitres",component:()=>M(()=>import("./AdminChapitres-Cem1eF90.js"),__vite__mapDeps([118,2,15,9,109,110,8,10,119]))},{path:"exercices",name:"AdminExercices",component:()=>M(()=>import("./AdminExercices-Di6YW-wH.js"),__vite__mapDeps([120,2,15,9,116,113,109,110,91,16,92,8,10,121]))},{path:"exercices-plus",name:"AdminExercicesPlus",component:()=>M(()=>import("./AdminExercicesPlus-Cbco6gpS.js"),__vite__mapDeps([122,2,15,9,16,91,92,8,10,123]))},{path:"cours",name:"AdminCours",component:()=>M(()=>import("./AdminCours-Cjozfdrh.js"),__vite__mapDeps([124,2,55,15,9,109,110,56,8,10,125]))},{path:"cours-plus",name:"AdminCoursPlus",component:()=>M(()=>import("./AdminCoursPlus-po15fr9W.js"),__vite__mapDeps([126,2,15,9,55,56,8,10,127]))},{path:"sheets",name:"AdminSheets",component:()=>M(()=>import("./AdminSheets-yBegzwvk.js"),__vite__mapDeps([128,2,63,15,9,4,8,10,129]))},{path:"quiz",name:"AdminQuiz",component:()=>M(()=>import("./AdminQuiz-ChnHWTLU.js"),__vite__mapDeps([130,2,17,15,9,109,110,8,10,131]))},{path:"quiz-plus",name:"AdminQuizPlus",component:()=>M(()=>import("./AdminQuizPlus-DXBJrCBN.js"),__vite__mapDeps([132,2,15,9,17,8,10,133]))},{path:"niveaux",name:"AdminNiveaux",component:()=>M(()=>import("./AdminNiveaux-DQYFCavZ.js"),__vite__mapDeps([134,2,109,110,23,8,9,10,135]))},{path:"pays",name:"AdminPays",component:()=>M(()=>import("./AdminPays-Zvekl4nj.js"),__vite__mapDeps([136,2,8,9,10,137]))},{path:"",redirect:{name:"AdminMatieres"}}]},{path:"/:pathMatch(.*)*",name:"NotFound",component:()=>M(()=>import("./NotFound-DiIhP0T5.js"),__vite__mapDeps([138,2,8,9,10,139]))}],He=yt({history:It(),routes:ws,scrollBehavior(){return{top:0}}});He.beforeEach(async(e,t,s)=>{const r=localStorage.getItem("access_token");localStorage.getItem("refresh_token");const a=oe();let n=a.isAuthenticated,o=a.isAdmin;const l=c=>{if(!c)return!0;try{let m=c.split(".")[1].replace(/-/g,"+").replace(/_/g,"/");const g=m.length%4;g&&(m+="=".repeat(4-g));const f=JSON.parse(atob(m)),u=Math.floor(Date.now()/1e3);return f.exp<u}catch{return!1}};if(r&&l(r)&&(localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),a.clearUser(),n=!1,o=!1),r&&!l(r)&&!n)try{await a.fetchUser(),n=a.isAuthenticated,o=a.isAdmin}catch{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),a.clearUser(),n=!1,o=!1}(e.meta.requiresAuth||e.name==="Dashboard")&&!n?s({name:"Home"}):e.meta.requiresAdmin&&(!n||!o)?s({name:"Home"}):n&&(e.name==="Home"||e.path==="/")?s({name:"Dashboard"}):n&&ks(e.name)?Es(e,t,s):s()});function As(){let e="http://localhost:8000".trim();return e?(/^https:\/\/(127\.0\.0\.1|localhost)(:\d+)?/i.test(e)&&(e=e.replace(/^https:/i,"http:")),e.replace(/\/+$/,"")):"https://optitab-backend.onrender.com"}const ft=As(),Ts=(ft||"").includes("onrender.com"),Ye="".toLowerCase(),Ms=!1,Cs=["debug","info","warn","error"].includes(Ye)?Ye:"error",ae={BASE_URL:ft,REFRESH_ENDPOINT:"/api/users/token/refresh/",REQUEST_TIMEOUT:Ts?3e4:8e3,REFRESH_TIMEOUT:4e3,MAX_RETRIES:1,RETRY_DELAY:500,LOGGING:{ENABLED:Ms,LEVEL:Cs,SENSITIVE_FIELDS:["password","token","refresh","access"]},DEFAULT_HEADERS:{"Content-Type":"application/json",Accept:"application/json"}};class P{static isDevelopment(){return!1}static isProduction(){return!0}static log(t,s,r={}){if(!this.isDevelopment())return;const a=this.sanitizeData(r),o={timestamp:new Date().toISOString(),level:t,message:s,data:a,source:"api-client"};switch(t){case"error":break;case"warn":break;case"info":break;default:}}static sanitizeData(t){if(!t||typeof t!="object")return t;const s={...t},r=ae.LOGGING.SENSITIVE_FIELDS,a=n=>{for(const o in n)if(n.hasOwnProperty(o)){const l=o.toLowerCase();r.some(c=>l.includes(c))?n[o]="[MASKED]":typeof n[o]=="object"&&n[o]!==null&&a(n[o])}};return a(s),s}static error(t,s=null){if(this.isProduction())return;const r={message:s?.message,status:s?.response?.status,statusText:s?.response?.statusText,url:s?.config?.url,method:s?.config?.method};this.isDevelopment()&&(r.stack=s?.stack),this.log("error",t,r)}static warn(t,s={}){this.log("warn",t,s)}static info(t,s={}){this.log("info",t,s)}static debug(t,s={}){this.isDevelopment()&&this.log("debug",t,s)}static isLoggingEnabled(){return ae.LOGGING.ENABLED}static secureLog(t,s,r={}){if(!this.isLoggingEnabled())return;const a=["debug","info","warn","error"],n=a.indexOf(t),o=a.indexOf(ae.LOGGING.LEVEL);n>=o&&this.log(t,s,r)}}class Fs{constructor(){this.isRefreshing=!1,this.refreshSubscribers=[],this.refreshPromise=null}decodeJwt(t){try{if(!t)return null;const s=t.split(".");if(s.length<2)return null;let r=s[1].replace(/-/g,"+").replace(/_/g,"/");const a=r.length%4;a&&(r+="=".repeat(4-a));const n=atob(r);return JSON.parse(n)}catch(s){return P.warn("Impossible de décoder le token JWT",{error:s.message}),null}}getAccessToken(){return localStorage.getItem("access_token")}getRefreshToken(){return localStorage.getItem("refresh_token")}setTokens(t,s=null){t&&localStorage.setItem("access_token",t),s&&localStorage.setItem("refresh_token",s)}clearTokens(){localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}isTokenExpired(t){if(!t)return!0;const s=this.decodeJwt(t);if(!s||typeof s.exp!="number")return!1;const r=Math.floor(Date.now()/1e3);return s.exp<r}async refreshAccessToken(){if(this.isRefreshing)return this.refreshPromise;this.isRefreshing=!0,this.refreshPromise=this._performRefresh();try{return await this.refreshPromise}finally{this.isRefreshing=!1,this.refreshPromise=null}}async _performRefresh(t=3){const s=this.getRefreshToken();if(!s)throw new Error("Aucun token de rafraîchissement disponible");let r;for(let a=0;a<=t;a++)try{P.secureLog("info",`Tentative de rafraîchissement du token (essai ${a+1}/${t+1})`);const n=await nt.post(`${ae.BASE_URL}${ae.REFRESH_ENDPOINT}`,{refresh:s},{timeout:ae.REFRESH_TIMEOUT,headers:{"Content-Type":"application/json"}}),{access:o,refresh:l}=n.data;return this.setTokens(o,l),P.secureLog("info","Token rafraîchi avec succès"),o}catch(n){if(r=n,P.error(`Échec du rafraîchissement du token (essai ${a+1})`,n),n.response?.status>=400&&n.response?.status<500&&n.code!=="ECONNABORTED")break;if(a<t){const o=Math.min(1e3*Math.pow(2,a),1e4);P.secureLog("info",`Nouvelle tentative dans ${o}ms`),await this._sleep(o)}}throw this.clearTokens(),r}_sleep(t){return new Promise(s=>setTimeout(s,t))}onRefreshed(t){this.refreshSubscribers.forEach(s=>s(t)),this.refreshSubscribers=[]}addRefreshSubscriber(t){this.refreshSubscribers.push(t)}shouldRefreshToken(t,s=5){if(!t)return!1;const r=this.decodeJwt(t);if(!r||typeof r.exp!="number")return!1;const a=Math.floor(Date.now()/1e3),n=s*60;return r.exp-a<=n}async proactiveRefresh(){const t=this.getAccessToken(),s=this.getRefreshToken();if(!t||!s)return!1;if(this.shouldRefreshToken(t,5)){P.secureLog("info","Rafraîchissement proactif du token");try{return await this.refreshAccessToken(),!0}catch(r){return P.error("Échec du rafraîchissement proactif",r),!1}}return!1}}class pt{static async retryRequest(t,s=ae.MAX_RETRIES){let r;for(let a=0;a<=s;a++)try{return await t()}catch(n){if(r=n,this.shouldNotRetry(n))throw n;if(a<s){const o=this.calculateDelay(a);P.secureLog("warn",`Tentative ${a+1} échouée, nouvelle tentative dans ${o}ms`,{error:n.message,status:n.response?.status}),await this.sleep(o)}}throw r}static shouldNotRetry(t){const s=t.response?.status;return s>=400&&s<500&&s!==429?!0:(t.code==="ECONNABORTED",!1)}static calculateDelay(t){return Math.min(ae.RETRY_DELAY*Math.pow(2,t),1e4)}static sleep(t){return new Promise(s=>setTimeout(s,t))}}class qe{static logout(t="Session expirée"){P.secureLog("info","Déconnexion utilisateur",{reason:t}),U.clearTokens();try{oe().clearUser()}catch(s){P.secureLog("warn","Erreur lors du nettoyage du store utilisateur",{error:s.message})}He.push("/")}}const U=new Fs;let _e=null;const A=nt.create({baseURL:ae.BASE_URL,timeout:ae.REQUEST_TIMEOUT,headers:ae.DEFAULT_HEADERS,withCredentials:!0});A.interceptors.request.use(e=>{const t=U.getAccessToken();return t&&!U.isTokenExpired(t)&&(e.headers.Authorization=`Bearer ${t}`,P.secureLog("info","Token ajouté à la requête",{url:e.url,method:e.method})),e},e=>(P.error("Erreur dans l'intercepteur de requête",e),Promise.reject(e)));A.interceptors.response.use(e=>(P.secureLog("info","Requête réussie",{url:e.config.url,method:e.config.method,status:e.status}),e),async e=>{const{config:t,response:s}=e;if(t?.url?.includes("/api/users/notifications/")&&s?.status===404?P.debug("Notification introuvable (404)",{url:t.url,method:t.method,status:s.status}):P.error("Erreur de requête",e),(s?.status===401||s?.status===403)&&!t.__isRetryRequest){const a=!!U.getAccessToken(),n=!!U.getRefreshToken(),o=s?.data?.code==="token_not_valid"||s?.data?.detail?.includes("token")||s?.data?.messages?.some(c=>c?.token?.includes("expired")),l=s?.data?.detail?.includes("refresh")||s?.data?.messages?.some(c=>c?.token?.includes("refresh"));if(a&&n&&(o||s?.status===401))return P.secureLog("info","Erreur de token détectée, tentative de rafraîchissement",{status:s.status,url:t.url,isTokenExpiredError:o,isRefreshTokenError:l}),Ze(t,e);if(s?.status===403){if(P.secureLog("warn","Erreur 403 - Accès refusé",{url:t.url,hasAccessToken:a,hasRefreshToken:n}),a&&n&&!t.__isRetryRequest)return Ze(t,e)}else P.secureLog("warn",`Erreur ${s?.status} sans tokens valides ou erreur d'authentification`,{url:t.url,status:s?.status,hasAccessToken:a,hasRefreshToken:n})}return!s&&(e.code==="ECONNABORTED"||e.code==="NETWORK_ERROR")?Ls(t):Promise.reject(e)});async function Ze(e,t){try{if(!U.getRefreshToken())return P.secureLog("warn","Aucun token de rafraîchissement disponible"),qe.logout("Aucun token de rafraîchissement disponible"),Promise.reject(t);P.secureLog("info","Tentative de rafraîchissement du token",{url:e.url});const r=await U.refreshAccessToken();if(!r)throw new Error("Aucun nouveau token reçu");return U.onRefreshed(r),e.headers.Authorization=`Bearer ${r}`,e.__isRetryRequest=!0,P.secureLog("info","Requête retry avec le nouveau token",{url:e.url}),A(e)}catch(s){P.error("Échec du rafraîchissement du token",s);const r=s.response?.status;let a="Échec du rafraîchissement du token";return r===401?a="Token de rafraîchissement invalide ou expiré":r===400?a="Requête de rafraîchissement malformée":s.response||(a="Erreur réseau lors du rafraîchissement"),qe.logout(a),Promise.reject(t)}}async function Ls(e,t){return pt.retryRequest(()=>(P.secureLog("info","Retry de la requête réseau",{url:e.url}),A(e)))}const ye={async request(e){return pt.retryRequest(()=>A(e))},async cachedGet(e,{params:t={},ttl:s=3e5,signal:r}={}){const a=u=>u?Object.keys(u).sort().map(w=>`${encodeURIComponent(w)}=${encodeURIComponent(u[w]??"")}`).join("&"):"";let n="n",o="p";try{const u=oe();n=u?.niveau_pays?.id??"n",o=u?.pays?.id??"p"}catch{}const l=typeof localStorage<"u"&&localStorage.getItem("access_token")||"",c=l?l.slice(0,12):"anon",p=`GET|${e}|${a(t)}|${n}|${o}|${c}`;window.__API_RESPONSE_CACHE__||(window.__API_RESPONSE_CACHE__=new Map),window.__API_INFLIGHT__||(window.__API_INFLIGHT__=new Map);const m=Date.now(),g=window.__API_RESPONSE_CACHE__.get(p);if(g&&m-g.t<s)return g.r;if(window.__API_INFLIGHT__.has(p))return window.__API_INFLIGHT__.get(p);const f=A.get(e,{params:t,signal:r}).then(u=>(window.__API_RESPONSE_CACHE__.set(p,{t:Date.now(),r:u}),window.__API_INFLIGHT__.delete(p),u)).catch(u=>{throw window.__API_INFLIGHT__.delete(p),u});return window.__API_INFLIGHT__.set(p,f),f},isAuthenticated(){const e=U.getAccessToken();return e&&!U.isTokenExpired(e)},async refreshToken(){return U.refreshAccessToken()},logout(e){qe.logout(e)},getStats(){return{isRefreshing:U.isRefreshing,hasValidToken:this.isAuthenticated(),refreshSubscribersCount:U.refreshSubscribers.length}},cleanExpiredTokens(){const e=U.getAccessToken(),t=U.getRefreshToken();let s=!1;return e&&U.isTokenExpired(e)&&(P.secureLog("info","Nettoyage du token d'accès expiré"),localStorage.removeItem("access_token"),s=!0),t&&U.isTokenExpired(t)&&(P.secureLog("info","Nettoyage du token de rafraîchissement expiré"),localStorage.removeItem("refresh_token"),s=!0),s&&P.secureLog("info","Tokens expirés nettoyés automatiquement"),s},hasValidTokens(){const e=U.getAccessToken(),t=U.getRefreshToken(),s=e&&!U.isTokenExpired(e),r=t&&!U.isTokenExpired(t);return{hasAccess:s,hasRefresh:r,hasAnyValid:s||r}},startTokenMonitoring(){_e&&clearInterval(_e),_e=setInterval(async()=>{try{this.cleanExpiredTokens(),await U.proactiveRefresh()}catch(e){P.error("Erreur lors de la surveillance des tokens",e)}},3e4),P.secureLog("info","Surveillance automatique des tokens démarrée")},stopTokenMonitoring(){_e&&(clearInterval(_e),_e=null,P.secureLog("info","Surveillance automatique des tokens arrêtée"))},async proactiveTokenRefresh(){return U.proactiveRefresh()}},_a=Object.freeze(Object.defineProperty({__proto__:null,apiUtils:ye,default:A},Symbol.toStringTag,{value:"Module"}));class et{constructor(t){this.endpoint=t}async getAll(t={}){try{return(await ye.cachedGet(this.endpoint,{params:t,ttl:12e4})).data}catch(s){throw this.handleError("récupération",s),s}}async getById(t){try{return(await A.get(`${this.endpoint}${t}/`)).data}catch(s){throw this.handleError(`récupération de l'élément ${t}`,s),s}}async create(t){try{return(await A.post(this.endpoint,t)).data}catch(s){throw this.handleError("création",s),s}}async update(t,s){try{return(await A.patch(`${this.endpoint}${t}/`,s)).data}catch(r){throw this.handleError(`mise à jour de l'élément ${t}`,r),r}}async delete(t){try{await A.delete(`${this.endpoint}${t}/`)}catch(s){throw this.handleError(`suppression de l'élément ${t}`,s),s}}async getByFilter(t={}){return this.getAll(t)}async getByRelation(t,s,r={}){return this.getAll({...r,[t]:s})}async getHierarchical(t,s){try{return(await A.get(`${this.endpoint}${t}/${s}/`)).data}catch(r){throw this.handleError(`récupération hiérarchique ${s}`,r),r}}handleError(t,s){}async getHierarchy(t,s){try{const[r,a]=await Promise.all([this.getById(t),this.getHierarchical(t,s)]);return{parent:r,children:a}}catch(r){throw this.handleError(`récupération de la hiérarchie ${t}`,r),r}}}const ht={createEndpoint(e){return new et(e)},createCRUDFunctions(e){const t=new et(e);return{getAll:s=>t.getAll(s),getById:s=>t.getById(s),create:s=>t.create(s),update:(s,r)=>t.update(s,r),delete:s=>t.delete(s),getByFilter:s=>t.getByFilter(s),getByRelation:(s,r,a)=>t.getByRelation(s,r,a),getHierarchical:(s,r)=>t.getHierarchical(s,r),getHierarchy:(s,r)=>t.getHierarchy(s,r)}}},se=()=>(se._instance||(se._instance=ht.createCRUDFunctions("/api/pays/")),se._instance),ya=e=>se().getAll(e),Ia=e=>se().getById(e),Sa=e=>se().create(e),Ea=(e,t)=>se().update(e,t),ba=e=>se().delete(e),Rs=(e={})=>se().getByFilter({...e,est_actif:!0}),ka=(e,t={})=>se().getByFilter({...t,search:e}),re=()=>(re._instance||(re._instance=ht.createCRUDFunctions("/api/niveaux/")),re._instance),wa=e=>re().getAll(e),Aa=e=>re().getById(e),Ta=e=>re().create(e),Ma=(e,t)=>re().update(e,t),Ca=e=>re().delete(e),Fa=(e,t={})=>re().getByRelation("pays_id",e,t),La=(e,t={})=>re().getByRelation("pays_id",e,{...t,est_actif:!0}),xs=e=>se().getHierarchical(e,"niveaux"),Ra=e=>re().getHierarchical(e,"matieres"),xa=e=>se().getHierarchy(e,"niveaux"),Oa=e=>re().getHierarchy(e,"matieres"),Os=()=>A.get("/api/users/preferences/"),Ps=e=>A.post("/api/users/preferences/bulk-update/",e),Pa=()=>A.get("/api/users/favorites/"),Ns=e=>A.post(`/api/users/favorites/add/${e}/`),Ds=e=>A.delete(`/api/users/favorites/remove/${e}/`),Na=()=>A.get("/api/users/selected/"),Vs=e=>A.post(`/api/users/selected/add/${e}/`),qs=e=>A.delete(`/api/users/selected/remove/${e}/`),Us=e=>A.post(`/api/users/selected/set-active/${e}/`),Bs=async()=>{try{const e=JSON.parse(localStorage.getItem("selected-matieres-ids")||"[]"),t=JSON.parse(localStorage.getItem("favorite-matieres-ids")||"[]"),s=localStorage.getItem("active-matiere-id"),r={};return t.length>0&&(r.favorite_matiere_ids=t),e.length>0&&(r.selected_matieres=e.map((a,n)=>({matiere_id:parseInt(a),order:n,is_active:parseInt(a)===parseInt(s)}))),s&&(r.active_matiere_id=parseInt(s)),Object.keys(r).length>0&&await Ps(r),!0}catch{return!1}},Gs=async()=>{try{const{data:e}=await Os(),t=e.favorite_matieres?.map(a=>a.matiere.id)||[],s=e.selected_matieres||[],r=e.active_matiere_id;return localStorage.setItem("favorite-matieres-ids",JSON.stringify(t)),localStorage.setItem("selected-matieres-ids",JSON.stringify(s.map(a=>a.matiere.id))),r?localStorage.setItem("active-matiere-id",r.toString()):localStorage.removeItem("active-matiere-id"),{favoriteIds:t,selectedIds:s.map(a=>a.matiere.id),activeId:r,selectedMatieres:s}}catch{return null}},zs=()=>A.get("/api/users/me/"),Da=e=>A.patch("/api/users/me/update/",e),Va=e=>A.patch("/api/users/me/niveau/",{niveau_pays_id:e}),qa=e=>A.patch("/api/users/me/pays/",{pays_id:e}),js=(e,t)=>{let s,r;return typeof e=="object"&&e!==null?(s=e.pays_id??e.pays,r=e.niveau_id??e.niveau_pays_id??e.niveau):(s=e,r=t),A.patch("/api/users/me/pays-niveau/",{pays_id:s,niveau_pays_id:r})},$s=()=>A.get("/api/users/me/gamification/"),Ua=(e={})=>{const t=e.scope||"global",s=e.limit||20;return A.get("/api/users/leaderboard/",{params:{scope:t,limit:s}})},Ba=()=>A.get("/api/users/me/overview/"),Ga=()=>A.get("/api/users/me/streaks/"),za=()=>A.get("/api/users/me/recommendations/"),ja=()=>A.get("/api/users/me/children/"),$a=e=>A.post("/api/users/me/children/add/",e),Xa=e=>A.delete(`/api/users/me/children/${e}/remove/`),Xs=e=>A.post("/api/users/me/update-xp/",e),Qe=(e={})=>A.get("/api/users/notifications/",{params:e}),gt=async e=>{try{return await A.patch(`/api/users/notifications/${e}/`,{read:!0})}catch(t){return{success:!1,error:t.response?.status||"unknown"}}},Hs=async()=>{const t=(await Qe({unread:1}))?.data||[];return{count:(await Promise.allSettled(t.map(a=>gt(a.id)))).filter(a=>a.status==="fulfilled"&&a.value.success!==!1).length}},Qs=async e=>{try{return await A.delete(`/api/users/notifications/${e}/`)}catch(t){return{success:!1,error:t.response?.status||"unknown"}}},Ha=async()=>{const t=(await Qe())?.data||[];return{count:(await Promise.allSettled(t.map(a=>Qs(a.id)))).filter(a=>a.status==="fulfilled"&&a.value.success!==!1).length}},Qa=()=>A.post("/api/users/email/send-code/"),Wa=e=>A.post("/api/users/email/verify-code/",{code:e}),Ws=e=>A.post("/api/users/register/",e,{timeout:2e4}),Ks=e=>({first_name:e.firstName?.trim(),last_name:e.lastName?.trim(),email:e.email?.trim().toLowerCase(),password:e.password,password_confirmation:e.confirmPassword}),Js=e=>A.post("/api/users/login/",{email:(e?.email||"").trim().toLowerCase(),password:e?.password},{timeout:2e4}),Ys=e=>({email:e.email?.trim().toLowerCase(),password:e.password}),Ka=e=>A.post("/api/users/verify-code/",e,{timeout:15e3}),Ja=e=>A.post("/api/users/logout/",e,{timeout:1e4}),Zs=e=>A.post("/api/users/auth/google/",e,{timeout:2e4}),tt=e=>A.post("/api/users/auth/google/oauth-exchange/",e,{timeout:2e4}),er=e=>A.post("/api/users/auth/google/oauth-token/",e,{timeout:2e4}),tr=e=>{const t=(e?.email||"").trim().toLowerCase();return A.post("/api/users/password/reset/",{email:t},{timeout:15e3})},Ya=({token:e,password:t})=>A.post("/api/users/password/reset/confirm/",{token:e,password:t},{timeout:15e3}),we=C([]);let sr=1;function We(){const e=(o,l="info",c=5e3)=>{const p=sr++,m={id:p,message:o,type:l,visible:!0};return we.value.push(m),setTimeout(()=>{t(p)},c),p},t=o=>{const l=we.value.findIndex(c=>c.id===o);l>-1&&we.value.splice(l,1)};return{toasts:we,showToast:e,removeToast:t,success:(o,l)=>e(o,"success",l),error:(o,l)=>e(o,"error",l),warning:(o,l)=>e(o,"warning",l),info:(o,l)=>e(o,"info",l)}}const rr={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_URL:"http://localhost:8000",VITE_GOOGLE_CLIENT_ID:"151259305565-a03g822b5qhoaia71gju8hl9cbnu9lp4.apps.googleusercontent.com"};function or(){const e=Ge(),t=oe(),{openModal:s,closeModal:r,isModalOpen:a}=ze(),{showToast:n}=We(),o=C(!1),l="151259305565-a03g822b5qhoaia71gju8hl9cbnu9lp4.apps.googleusercontent.com",c=C(!1),p=C(!1),m=C(!1),g=()=>{try{if(localStorage.getItem("gsi_disable_fedcm")==="1")return!1;const h=rr?.VITE_GSI_ENABLE_FEDCM;return h==="true"}catch{return!1}},f=(d={})=>{const{useFedCMForPrompt:h=g()}=d;typeof google<"u"&&google.accounts.id.initialize({client_id:l,callback:u,context:"signin",ux_mode:"popup",auto_select:!1,cancel_on_tap_outside:!0,use_fedcm_for_prompt:!!h})},u=async d=>{try{o.value=!0;const h=await Zs({access_token:d.credential}),{user:y,access:L,refresh:x}=h.data.data;localStorage.setItem("access_token",L),localStorage.setItem("refresh_token",x),t.setUser(y),await t.fetchUser(),r(G.LOGIN),e.push("/dashboard"),n("Connexion réussie !","success")}catch(h){const y=h.response?.data?.message||"Erreur de connexion";n(y,"error"),c.value&&(s(G.LOGIN),c.value=!1)}finally{o.value=!1}},b=()=>new Promise((d,h)=>{try{if(google?.accounts?.oauth2?.initTokenClient){google.accounts.oauth2.initTokenClient({client_id:l,scope:"openid email profile",callback:async L=>{try{if(L?.access_token){const x=await er({access_token:L.access_token}),{user:V,access:B,refresh:T}=x.data.data;localStorage.setItem("access_token",B),localStorage.setItem("refresh_token",T),t.setUser(V),await t.fetchUser(),r(G.LOGIN),e.push("/dashboard"),n("Connexion réussie !","success"),m.value=!0,c.value=!1,d(!0);return}if(google?.accounts?.oauth2?.initCodeClient){google.accounts.oauth2.initCodeClient({client_id:l,scope:"openid email profile",ux_mode:"popup",callback:async V=>{try{if(V?.code){const B=await tt({code:V.code,client_id:l}),{user:T,access:v,refresh:E}=B.data.data;localStorage.setItem("access_token",v),localStorage.setItem("refresh_token",E),t.setUser(T),await t.fetchUser(),r(G.LOGIN),e.push("/dashboard"),n("Connexion réussie !","success"),m.value=!0,c.value=!1,d(!0);return}h(new Error("Code OAuth non reçu"))}catch(B){h(B)}}}).requestCode();return}h(new Error("OAuth2 Code Flow non disponible"))}catch(x){h(x)}}}).requestAccessToken();return}if(google?.accounts?.oauth2?.initCodeClient){google.accounts.oauth2.initCodeClient({client_id:l,scope:"openid email profile",ux_mode:"popup",callback:async L=>{try{if(L?.code){const x=await tt({code:L.code,client_id:l}),{user:V,access:B,refresh:T}=x.data.data;localStorage.setItem("access_token",B),localStorage.setItem("refresh_token",T),t.setUser(V),await t.fetchUser(),r(G.LOGIN),e.push("/dashboard"),n("Connexion réussie !","success"),m.value=!0,c.value=!1,d(!0);return}h(new Error("Code OAuth non reçu"))}catch(x){h(x)}}}).requestCode();return}h(new Error("OAuth2 non disponible"))}catch(y){h(y)}}),F=async()=>{if(typeof google<"u"){if(!g())try{await b();return}catch{c.value&&(s(G.LOGIN),c.value=!1),n("Échec de la connexion Google","error");return}c.value=a(G.LOGIN),c.value&&(r(G.LOGIN),await De());try{p.value=!1;const d=()=>{google.accounts.id.prompt(h=>{try{const y=h?.isNotDisplayed?.(),L=h?.getNotDisplayedReason?.(),x=h?.isSkippedMoment?.(),V=h?.getSkippedReason?.(),B=h?.isDismissedMoment?.(),T=h?.getDismissedReason?.(),v=B&&T!=="credential_returned"||y||x;if(!p.value&&(y||L==="opt_out_or_no_session"||L==="unknown_reason"||B&&T==="token_generation_failed"||B&&T==="network_error")){p.value=!0;try{f({useFedCMForPrompt:!1}),De().then(()=>{d()});return}catch{}}if(!m.value&&(v||y||x||B)){b().catch(()=>{c.value&&(s(G.LOGIN),c.value=!1)});return}v&&c.value&&(s(G.LOGIN),c.value=!1)}catch{}})};d()}catch{c.value&&(s(G.LOGIN),c.value=!1)}}else n("Google Sign-In non disponible","error")},w=()=>new Promise((d,h)=>{if(typeof google<"u"){d();return}const y=document.createElement("script");y.src="https://accounts.google.com/gsi/client",y.async=!0,y.defer=!0,y.onload=()=>{d()},y.onerror=()=>{h(new Error("Failed to load Google script"))},document.head.appendChild(y)});return{isGoogleLoading:o,signInWithGoogle:F,setupGoogleSignIn:async()=>{try{await w(),f()}catch{}},loadGoogleScript:w,initializeGoogleSignIn:f}}const ar={name:"LoginModal",components:{Modal:Fe,DynamicForm:$e},props:{isOpen:{type:Boolean,default:!1}},emits:["close","login","signup","forgot-password"],setup(e,{emit:t}){const s=Ge(),r=oe(),{closeModal:a}=ze(),{setupGoogleSignIn:n,signInWithGoogle:o,isGoogleLoading:l}=or(),{config:c,formData:p,isSubmitting:m,isValid:g,getFieldError:f,setFieldTouched:u,submitForm:b,getFieldConfig:F,getFieldNames:w}=je("LOGIN"),I=w(),d=C("");be(async()=>{await n();try{const v=localStorage.getItem("remember_me");if(v){const E=JSON.parse(v),O=Date.now();E?.expiresAt&&O<E.expiresAt&&E?.email&&E?.password?(p.email=E.email,p.password=E.password,p.rememberMe=!0):E?.expiresAt&&O>=E.expiresAt&&localStorage.removeItem("remember_me")}}catch{}});const h=()=>{d.value="",t("close")},y=()=>{d.value=""},L=async()=>{await b(x)},x=async v=>{const E=Ys(v);try{const O=await Js(E),q=O.data.data||O.data,ie=q.access,ce=q.refresh;if(!ie||!ce)throw new Error("Tokens d'authentification manquants");localStorage.setItem("access_token",ie),localStorage.setItem("refresh_token",ce);const Y=q||O.data;(Y.user_id||Y.id)&&r.setUser(Y);try{if(v.rememberMe){const ve={email:v.email,password:v.password,expiresAt:Date.now()+2592e6};localStorage.setItem("remember_me",JSON.stringify(ve))}else localStorage.removeItem("remember_me")}catch{}t("login",{email:v.email}),h(),a(G.LOGIN),s.push("/dashboard"),r.fetchUser().catch(ve=>{})}catch(O){const q=O.response?.data?.detail||O.response?.data?.error;d.value=q||"Erreur lors de la connexion"}};return{config:c,fieldNames:I,socialProviders:lt,formData:p,isSubmitting:m,isValid:g,isGoogleLoading:l,getFieldError:f,setFieldTouched:u,getFieldConfig:F,handleClose:h,handleFormSubmit:L,handleSocialLogin:v=>{v==="google"?o():t("login",{provider:v})},handleSignUp:()=>{t("signup")},handleForgotPassword:()=>{t("forgot-password")},loginError:d,handleInput:y}}},nr={class:"signup-link signup-link-top"},ir={class:"form-options"},lr={key:0,class:"login-error"},cr={class:"social-login"},ur={class:"social-btn-group"},dr=["onClick","disabled"],mr=["src","alt"];function fr(e,t,s,r,a,n){const o=ee("DynamicForm"),l=ee("Modal");return _(),ne(l,{"is-open":s.isOpen,title:"Connexion",size:"small",onClose:r.handleClose},{default:ue(()=>[i("div",nr,[i("p",null,[t[2]||(t[2]=fe(" Pas encore de compte ? ")),i("button",{type:"button",class:"signup-btn",onClick:t[0]||(t[0]=(...c)=>r.handleSignUp&&r.handleSignUp(...c))}," Créer un compte ")])]),j(o,{"field-names":r.fieldNames,"get-field-config":r.getFieldConfig,"form-data":r.formData,"is-submitting":r.isSubmitting,"is-valid":r.isValid,"get-field-error":r.getFieldError,"set-field-touched":r.setFieldTouched,"submit-text":r.config.submitText,onSubmit:r.handleFormSubmit,onInput:r.handleInput},{"form-content":ue(()=>[i("div",ir,[i("button",{type:"button",class:"forgot-password-btn",onClick:t[1]||(t[1]=(...c)=>r.handleForgotPassword&&r.handleForgotPassword(...c))}," Mot de passe oublié ? ")])]),_:1},8,["field-names","get-field-config","form-data","is-submitting","is-valid","get-field-error","set-field-touched","submit-text","onSubmit","onInput"]),r.loginError?(_(),S("div",lr,D(r.loginError),1)):z("",!0),t[3]||(t[3]=i("div",{class:"divider"},[i("span",{class:"divider-line"}),i("span",{class:"divider-text"},"ou"),i("span",{class:"divider-line"})],-1)),i("div",cr,[i("div",ur,[(_(!0),S(pe,null,he(r.socialProviders,c=>(_(),S("button",{key:c.key,class:J(["social-btn",c.btnClass]),onClick:()=>r.handleSocialLogin(c.key),disabled:r.isSubmitting||c.key==="google"&&r.isGoogleLoading},[i("img",{src:c.icon,alt:c.key,class:"social-icon"},null,8,mr),fe(" "+D(c.label),1)],10,dr))),128))])])]),_:1,__:[3]},8,["is-open","onClose"])}const pr=K(ar,[["render",fr],["__scopeId","data-v-5a3a77fd"]]),hr={name:"PasswordStrength",props:{password:{type:String,required:!0}},computed:{rules(){const e=this.password||"";return[{key:"length",label:"8+ caractères",passed:e.length>=8},{key:"uppercase",label:"Majuscule",passed:/[A-Z]/.test(e)},{key:"lowercase",label:"Minuscule",passed:/[a-z]/.test(e)},{key:"digit",label:"Chiffre",passed:/\d/.test(e)},{key:"special",label:"Caractère spécial",passed:/[^A-Za-z0-9]/.test(e)}]}}},gr={class:"password-strength"},vr={class:"icon"},_r={key:0,width:"16",height:"16",fill:"none",viewBox:"0 0 16 16"},yr={key:1,width:"16",height:"16",fill:"none",viewBox:"0 0 16 16"},Ir={class:"label"};function Sr(e,t,s,r,a,n){return _(),S("div",gr,[(_(!0),S(pe,null,he(n.rules,o=>(_(),S("div",{key:o.key,class:J(["strength-box",{passed:o.passed}])},[i("span",vr,[o.passed?(_(),S("svg",_r,t[0]||(t[0]=[i("path",{d:"M4 8.5l3 3 5-5",stroke:"#10b981","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))):(_(),S("svg",yr,t[1]||(t[1]=[i("circle",{cx:"8",cy:"8",r:"7",stroke:"#d1d5db","stroke-width":"2"},null,-1)])))]),i("span",Ir,D(o.label),1)],2))),128))])}const Er=K(hr,[["render",Sr],["__scopeId","data-v-5e920371"]]),br={name:"RegisterModal",components:{Modal:Fe,DynamicForm:$e,FormField:it,PasswordStrength:Er},props:{isOpen:{type:Boolean,default:!1}},emits:["close","register","login","terms","privacy"],setup(e,{emit:t}){const{config:s,formData:r,isSubmitting:a,isValid:n,getFieldError:o,setFieldTouched:l,submitForm:c,getFieldConfig:p,getFieldNames:m}=je("REGISTER"),g=oe(),f=["firstName","lastName"],u=m().filter(T=>!["firstName","lastName","acceptTerms","newsletter"].includes(T)),b=C(""),F=C("");function w(T,v="error"){b.value=T,F.value=v,setTimeout(()=>{b.value="",F.value=""},4e3)}const I=()=>{t("close")},d=async()=>{const T=await c(h)},h=async T=>{const v=Ks(T);try{const E=await Ws(v);if(E&&E.data){const O=E.data?.data||E.data,q=O.access,ie=O.refresh;q&&ie&&(localStorage.setItem("access_token",q),localStorage.setItem("refresh_token",ie)),g.setUser(O)}w("Compte créé avec succès!","success"),t("register",{...v}),setTimeout(I,1200)}catch(E){const O=E.response?.data;let q="";O?.errors&&typeof O.errors=="object"?q=Object.entries(O.errors).map(([ce,Y])=>{if(Array.isArray(Y))return`${ce}: ${Y.join(", ")}`;if(typeof Y=="object"&&Y!==null){const ve=Object.values(Y).flat();return`${ce}: ${ve.join(", ")}`}return`${ce}: ${String(Y)}`}).join(" | ")||O.message:O?.message?q=O.message:q=E.message,w(q||"Erreur lors de la création du compte","error")}};return{config:s,formData:r,isSubmitting:a,isValid:n,getFieldError:o,setFieldTouched:l,submitForm:c,getFieldConfig:p,getFieldNames:m,nameFields:f,mainFieldNames:u,socialProviders:lt,handleClose:I,handleFormSubmit:d,handleFieldBlur:({fieldName:T,event:v})=>{l(T)},handleSocialRegister:T=>{t("register",{provider:T})},handleLogin:()=>{t("login")},handleTermsClick:()=>{t("terms")},handlePrivacyClick:()=>{t("privacy")},feedbackMessage:b,feedbackType:F,showFeedback:w}}},kr={class:"login-link login-link-top"},wr={class:"top-fields"},Ar={class:"name-fields"},Tr={key:0,class:"password-strength-row"},Mr={class:"terms-section"},Cr={class:"newsletter-section"},Fr={class:"social-register"},Lr={class:"social-btn-group"},Rr=["onClick","disabled"],xr=["src","alt"];function Or(e,t,s,r,a,n){const o=ee("FormField"),l=ee("PasswordStrength"),c=ee("DynamicForm"),p=ee("Modal");return _(),ne(p,{"is-open":s.isOpen,title:"Créer un compte",size:"medium",onClose:r.handleClose},{default:ue(()=>[i("div",kr,[i("p",null,[t[5]||(t[5]=fe(" Déjà un compte ? ")),i("button",{type:"button",class:"login-btn",onClick:t[0]||(t[0]=(...m)=>r.handleLogin&&r.handleLogin(...m))}," Se connecter ")])]),i("div",wr,[i("div",Ar,[j(o,{"field-name":"firstName","field-config":r.getFieldConfig("firstName"),modelValue:r.formData.firstName,"onUpdate:modelValue":t[1]||(t[1]=m=>r.formData.firstName=m),disabled:r.isSubmitting,"get-field-error":r.getFieldError,onBlur:r.handleFieldBlur},null,8,["field-config","modelValue","disabled","get-field-error","onBlur"]),j(o,{"field-name":"lastName","field-config":r.getFieldConfig("lastName"),modelValue:r.formData.lastName,"onUpdate:modelValue":t[2]||(t[2]=m=>r.formData.lastName=m),disabled:r.isSubmitting,"get-field-error":r.getFieldError,onBlur:r.handleFieldBlur},null,8,["field-config","modelValue","disabled","get-field-error","onBlur"])])]),j(c,{class:"register-dynamic-form","field-names":r.mainFieldNames,"get-field-config":r.getFieldConfig,"form-data":r.formData,"is-submitting":r.isSubmitting,"is-valid":r.isValid,"get-field-error":r.getFieldError,"set-field-touched":r.setFieldTouched,"submit-text":r.config.submitText,onSubmit:r.handleFormSubmit},{"form-content":ue(()=>[r.mainFieldNames.includes("password")?(_(),S("div",Tr,[j(l,{password:r.formData.password},null,8,["password"])])):z("",!0),i("div",Mr,[j(o,{"field-name":"acceptTerms","field-config":r.getFieldConfig("acceptTerms"),modelValue:r.formData.acceptTerms,"onUpdate:modelValue":t[3]||(t[3]=m=>r.formData.acceptTerms=m),disabled:r.isSubmitting,"get-field-error":r.getFieldError,onBlur:r.handleFieldBlur},null,8,["field-config","modelValue","disabled","get-field-error","onBlur"])]),i("div",Cr,[j(o,{"field-name":"newsletter","field-config":r.getFieldConfig("newsletter"),modelValue:r.formData.newsletter,"onUpdate:modelValue":t[4]||(t[4]=m=>r.formData.newsletter=m),disabled:r.isSubmitting,"get-field-error":r.getFieldError,onBlur:r.handleFieldBlur},null,8,["field-config","modelValue","disabled","get-field-error","onBlur"])])]),_:1},8,["field-names","get-field-config","form-data","is-submitting","is-valid","get-field-error","set-field-touched","submit-text","onSubmit"]),r.feedbackMessage?(_(),S("div",{key:0,class:J(["register-feedback",r.feedbackType])},D(r.feedbackMessage),3)):z("",!0),t[6]||(t[6]=i("div",{class:"divider"},[i("span",{class:"divider-line"}),i("span",{class:"divider-text"},"ou"),i("span",{class:"divider-line"})],-1)),i("div",Fr,[i("div",Lr,[(_(!0),S(pe,null,he(r.socialProviders,m=>(_(),S("button",{key:m.key,class:J(["social-btn",m.btnClass]),onClick:()=>r.handleSocialRegister(m.key),disabled:r.isSubmitting},[i("img",{src:m.icon,alt:m.key,class:"social-icon"},null,8,xr),fe(" "+D(m.label),1)],10,Rr))),128))])])]),_:1,__:[6]},8,["is-open","onClose"])}const Pr=K(br,[["render",Or],["__scopeId","data-v-f7c43139"]]),Nr={name:"ForgotPasswordModal",components:{Modal:Fe,DynamicForm:$e},props:{isOpen:{type:Boolean,default:!1}},emits:["close","forgot-password","login"],setup(e,{emit:t}){const s=C(!1),{config:r,formData:a,isSubmitting:n,isValid:o,getFieldError:l,setFieldTouched:c,submitForm:p,getFieldConfig:m,getFieldNames:g,resetForm:f}=je("FORGOT_PASSWORD"),u=g(),b=()=>{t("close"),f(),s.value=!1},F=async()=>{await p(async d=>{await tr({email:d.email}),t("forgot-password",{...d}),s.value=!0},d=>{})};return{isSuccess:s,config:r,fieldNames:u,formData:a,isSubmitting:n,isValid:o,getFieldError:l,setFieldTouched:c,getFieldConfig:m,handleClose:b,handleFormSubmit:F,handleBackToLogin:()=>{t("login")},handleResend:async()=>{s.value=!1,await F()}}}},Dr={key:0,class:"success-state"},Vr={class:"success-message"},qr={class:"success-actions"},Ur={key:1},Br={class:"back-to-login"};function Gr(e,t,s,r,a,n){const o=ee("DynamicForm"),l=ee("Modal");return _(),ne(l,{"is-open":s.isOpen,title:"Mot de passe oublié",size:"small",onClose:r.handleClose},{default:ue(()=>[r.isSuccess?(_(),S("div",Dr,[t[4]||(t[4]=i("div",{class:"success-icon"},[i("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[i("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),i("polyline",{points:"22,4 12,14.01 9,11.01"})])],-1)),t[5]||(t[5]=i("h3",{class:"success-title"},"Email envoyé !",-1)),i("p",Vr,[t[3]||(t[3]=fe(" Nous avons envoyé un lien de réinitialisation à ")),i("strong",null,D(r.formData.email),1)]),i("div",qr,[i("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=(...c)=>r.handleClose&&r.handleClose(...c))}," Fermer "),i("button",{type:"button",class:"btn btn-secondary",onClick:t[1]||(t[1]=(...c)=>r.handleResend&&r.handleResend(...c))}," Renvoyer l'email ")])])):(_(),S("div",Ur,[t[6]||(t[6]=i("div",{class:"instructions"},[i("p",{class:"instruction-text"}," Entrez votre adresse email et nous vous enverrons un lien pour réinitialiser votre mot de passe. ")],-1)),j(o,{"field-names":r.fieldNames,"get-field-config":r.getFieldConfig,"form-data":r.formData,"is-submitting":r.isSubmitting,"is-valid":r.isValid,"get-field-error":r.getFieldError,"set-field-touched":r.setFieldTouched,"submit-text":r.config.submitText,onSubmit:r.handleFormSubmit},null,8,["field-names","get-field-config","form-data","is-submitting","is-valid","get-field-error","set-field-touched","submit-text","onSubmit"]),i("div",Br,[i("p",null,[i("button",{type:"button",class:"back-btn",onClick:t[2]||(t[2]=(...c)=>r.handleBackToLogin&&r.handleBackToLogin(...c))}," ← Retour à la connexion ")])])]))]),_:1},8,["is-open","onClose"])}const zr=K(Nr,[["render",Gr],["__scopeId","data-v-da9e5044"]]),jr={class:"pays-niveau-selector"},$r={class:"modal-header"},Xr={class:"progress-bar"},Hr={class:"modal-subtitle"},Qr={key:0,class:"step-content"},Wr={key:0,class:"loading-state"},Kr={key:1,class:"error-state"},Jr={key:2,class:"pays-grid"},Yr=["onClick"],Zr={class:"pays-flag"},eo={class:"pays-info"},to={key:0,class:"selected-indicator"},so={class:"step-actions"},ro=["disabled"],oo={key:0},ao={key:1},no={key:1,class:"step-content"},io={class:"section-header"},lo={key:0,class:"loading-state"},co={key:1,class:"empty-state"},uo={key:2,class:"niveaux-grid"},mo=["onClick"],fo={class:"niveau-info"},po={key:0,class:"selected-indicator"},ho={class:"step-actions"},go=["disabled"],vo={key:0},_o={key:1},yo={key:2,class:"step-content"},Io={class:"confirmation-content"},So={class:"configuration-summary"},Eo={class:"summary-item"},bo={class:"value"},ko={class:"summary-item"},wo={class:"value"},Ao={__name:"PaysNiveauSelector",props:{isOpen:{type:Boolean,default:!1}},emits:["configuration-complete","close"],setup(e,{emit:t}){const s=e,r=t,a=oe(),{showToast:n}=We(),o=C(1),l=C([]),c=C([]),p=C(null),m=C(null),g=C(!1),f=C(!1),u=C(!1),b=C(!1),F=R(()=>l.value.find(T=>T.id===p.value)),w=R(()=>c.value.find(T=>T.id===m.value)),I=()=>{switch(o.value){case 1:return"Étape 1 sur 2 - Choisissez votre pays";case 2:return"Étape 2 sur 2 - Choisissez votre niveau";case 3:return"Configuration terminée";default:return""}},d=async()=>{try{g.value=!0,u.value=!1;const T=await Rs();l.value=T.data||T}catch{u.value=!0,n("Erreur lors du chargement des pays","error")}finally{g.value=!1}},h=async T=>{if(!T){c.value=[];return}try{f.value=!0;const v=await xs(T);c.value=v.data||v}catch{c.value=[],n("Erreur lors du chargement des niveaux","error")}finally{f.value=!1}},y=T=>{p.value=T.id,m.value=null},L=T=>{m.value=T.id},x=()=>{o.value===1&&p.value&&(o.value=2,h(p.value))},V=()=>{o.value===2&&(o.value=1,c.value=[],m.value=null)},B=async()=>{if(!(!p.value||!m.value))try{b.value=!0,await js(p.value,m.value),await a.fetchUser(),o.value=3,n("Configuration enregistrée avec succès !","success"),setTimeout(()=>{r("configuration-complete")},2e3)}catch{n("Erreur lors de l'enregistrement de la configuration","error")}finally{b.value=!1}};return Te(()=>s.isOpen,T=>{T&&l.value.length===0&&d()}),Te(p,T=>{T&&o.value===2&&h(T)}),be(()=>{s.isOpen&&d()}),(T,v)=>(_(),ne(Fe,{"is-open":e.isOpen,"can-close":!1,"show-header":!1},{default:ue(()=>[i("div",jr,[i("div",$r,[i("div",Xr,[i("div",{class:J(["progress-step",{active:o.value>=1,completed:o.value>1}])},v[0]||(v[0]=[i("span",{class:"step-number"},"1",-1),i("span",{class:"step-label"},"Pays",-1)]),2),i("div",{class:J(["progress-line",{completed:o.value>1}])},null,2),i("div",{class:J(["progress-step",{active:o.value>=2,completed:o.value>2}])},v[1]||(v[1]=[i("span",{class:"step-number"},"2",-1),i("span",{class:"step-label"},"Niveau",-1)]),2)]),v[2]||(v[2]=i("h2",null,"🎓 Configuration de votre profil d'apprentissage",-1)),i("p",Hr,D(I()),1)]),o.value===1?(_(),S("div",Qr,[v[7]||(v[7]=i("div",{class:"section-header"},[i("h3",null,"📍 Sélectionnez votre pays"),i("p",null,"Choisissez votre pays pour personnaliser le contenu selon votre système éducatif")],-1)),g.value?(_(),S("div",Wr,v[3]||(v[3]=[i("div",{class:"spinner"},null,-1),i("p",null,"Chargement des pays disponibles...",-1)]))):u.value?(_(),S("div",Kr,[v[4]||(v[4]=i("p",null,"❌ Erreur lors du chargement des pays",-1)),i("button",{onClick:d,class:"btn-retry"},"Réessayer")])):(_(),S("div",Jr,[(_(!0),S(pe,null,he(l.value,E=>(_(),S("div",{key:E.id,class:J(["pays-card",{selected:p.value===E.id}]),onClick:O=>y(E)},[i("div",Zr,D(E.drapeau_emoji),1),i("div",eo,[i("h4",null,D(E.nom),1),i("p",null,D(E.nombre_niveaux||0)+" niveaux disponibles",1)]),p.value===E.id?(_(),S("div",to,v[5]||(v[5]=[i("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none"},[i("path",{d:"M9 12L11 14L15 10",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]))):z("",!0)],10,Yr))),128))])),i("div",so,[i("button",{onClick:x,disabled:!p.value||f.value,class:"btn-primary"},[f.value?(_(),S("span",oo,"Chargement...")):(_(),S("span",ao,"Continuer")),v[6]||(v[6]=i("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none"},[i("path",{d:"M9 18L15 12L9 6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1))],8,ro)])])):z("",!0),o.value===2?(_(),S("div",no,[i("div",io,[v[8]||(v[8]=i("h3",null,"📚 Sélectionnez votre niveau scolaire",-1)),i("p",null,"Choisissez votre niveau pour "+D(F.value?.nom),1)]),f.value?(_(),S("div",lo,v[9]||(v[9]=[i("div",{class:"spinner"},null,-1),i("p",null,"Chargement des niveaux...",-1)]))):c.value.length===0?(_(),S("div",co,v[10]||(v[10]=[i("p",null,"Aucun niveau disponible pour ce pays",-1)]))):(_(),S("div",uo,[(_(!0),S(pe,null,he(c.value,E=>(_(),S("div",{key:E.id,class:J(["niveau-card",{selected:m.value===E.id}]),onClick:O=>L(E)},[i("div",{class:"niveau-color",style:rt({backgroundColor:E.couleur||"#667eea"})},null,4),i("div",fo,[i("h4",null,D(E.nom_local||E.nom),1),v[11]||(v[11]=i("p",null,"Niveau scolaire",-1))]),m.value===E.id?(_(),S("div",po,v[12]||(v[12]=[i("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none"},[i("path",{d:"M9 12L11 14L15 10",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]))):z("",!0)],10,mo))),128))])),i("div",ho,[i("button",{onClick:V,class:"btn-secondary"},v[13]||(v[13]=[i("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none"},[i("path",{d:"M15 18L9 12L15 6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),fe(" Retour ")])),i("button",{onClick:B,disabled:!m.value||b.value,class:"btn-primary"},[b.value?(_(),S("span",vo,"Enregistrement...")):(_(),S("span",_o,"Terminer la configuration"))],8,go)])])):z("",!0),o.value===3?(_(),S("div",yo,[i("div",Io,[v[16]||(v[16]=i("div",{class:"success-icon"},"✅",-1)),v[17]||(v[17]=i("h3",null,"Configuration terminée !",-1)),v[18]||(v[18]=i("p",null,"Votre profil a été configuré avec succès.",-1)),i("div",So,[i("div",Eo,[v[14]||(v[14]=i("span",{class:"label"},"Pays:",-1)),i("span",bo,D(F.value?.nom),1)]),i("div",ko,[v[15]||(v[15]=i("span",{class:"label"},"Niveau:",-1)),i("span",wo,D(w.value?.nom_local||w.value?.nom),1)])]),v[19]||(v[19]=i("p",{class:"redirect-message"},"Vous allez être redirigé vers votre tableau de bord...",-1))])])):z("",!0)])]),_:1},8,["is-open"]))}},To=K(Ao,[["__scopeId","data-v-d3ef1302"]]),Mo={name:"Toast",setup(){const{toasts:e,removeToast:t}=We();return{toasts:e,removeToast:t}}},Co={class:"toast-container"},Fo=["onClick"],Lo={class:"toast-content"},Ro={class:"toast-message"},xo=["onClick"];function Oo(e,t,s,r,a,n){return _(),S("div",Co,[j(St,{name:"toast",tag:"div",class:"toasts"},{default:ue(()=>[(_(!0),S(pe,null,he(r.toasts,o=>(_(),S("div",{key:o.id,class:J(["toast",o.type]),onClick:l=>r.removeToast(o.id)},[i("div",Lo,[i("span",Ro,D(o.message),1),i("button",{class:"toast-close",onClick:Ue(l=>r.removeToast(o.id),["stop"])}," × ",8,xo)])],10,Fo))),128))]),_:1})])}const Po=K(Mo,[["render",Oo],["__scopeId","data-v-90fbbd54"]]),No={key:0,class:"xp-notification-overlay"},Do={class:"xp-notification-card"},Vo={class:"xp-notification-content"},qo={class:"xp-message"},Uo={class:"xp-reward"},Bo={class:"xp-amount"},Go={__name:"XPRewardNotification",setup(e){const t=C(!1),s=C(""),r=C(0),a=l=>{s.value=`Objectif "${n(l.objectiveType)}" terminé !`,r.value=l.xpAmount,t.value=!0,setTimeout(()=>{t.value=!1},4e3)},n=l=>({quiz_easy:"Quiz simples",quiz_medium:"Quiz moyens",quiz_hard:"Quiz difficiles",quiz_perfect:"Quiz parfaits",quiz_streak:"Série de quiz"})[l]||"Objectif",o=l=>{a(l.detail)};return be(()=>{window.addEventListener("dailyObjectiveCompleted",o)}),ot(()=>{window.removeEventListener("dailyObjectiveCompleted",o)}),(l,c)=>(_(),ne(Be,{to:"body"},[j(at,{name:"notification"},{default:ue(()=>[t.value?(_(),S("div",No,[i("div",Do,[i("div",Vo,[c[1]||(c[1]=i("div",{class:"xp-icon"},"🎉",-1)),i("div",qo,[c[0]||(c[0]=i("h3",null,"Défi complété !",-1)),i("p",null,D(s.value),1)]),i("div",Uo,[i("span",Bo,"+"+D(r.value)+" XP",1)])]),c[2]||(c[2]=i("div",{class:"xp-progress-bar"},[i("div",{class:"xp-progress-fill",style:{width:"100%"}})],-1))])])):z("",!0)]),_:1})]))}},zo=K(Go,[["__scopeId","data-v-0e93c61c"]]),jo={key:0,class:"unlock-notification-overlay"},$o={class:"unlock-notification-card"},Xo={class:"unlock-notification-content"},Ho={class:"unlock-message"},Qo={class:"unlock-objective-icon"},Wo={__name:"ObjectiveUnlockedNotification",setup(e){const t=C(!1),s=C(""),r=C(""),a=o=>{s.value=`"${o.objective.name}" est maintenant disponible !`,r.value=o.objective.icon||"🎯",t.value=!0,setTimeout(()=>{t.value=!1},3e3)},n=o=>{a(o.detail)};return be(()=>{window.addEventListener("objectiveUnlocked",n)}),ot(()=>{window.removeEventListener("objectiveUnlocked",n)}),(o,l)=>(_(),ne(Be,{to:"body"},[j(at,{name:"unlock-notification"},{default:ue(()=>[t.value?(_(),S("div",jo,[i("div",$o,[i("div",Xo,[l[1]||(l[1]=i("div",{class:"unlock-icon"},"🔓",-1)),i("div",Ho,[l[0]||(l[0]=i("h3",null,"Nouvel objectif débloqué !",-1)),i("p",null,D(s.value),1)]),i("div",Qo,D(r.value),1)]),l[2]||(l[2]=i("div",{class:"unlock-progress-bar"},[i("div",{class:"unlock-progress-fill",style:{width:"100%"}})],-1))])])):z("",!0)]),_:1})]))}},Ko=K(Wo,[["__scopeId","data-v-25a66a03"]]),Jo={},Yo={class:"fullpage-spinner"};function Zo(e,t){return _(),S("div",Yo,t[0]||(t[0]=[i("span",{class:"spinner"},null,-1)]))}const ea=K(Jo,[["render",Zo],["__scopeId","data-v-b5fd4076"]]),Ke=ge("notifications",()=>{const e=C([]),t=C(1),s=R(()=>e.value.filter(d=>!d.read).length),r=R(()=>s.value>0),a={XP_GAINED:"xp_gained",LEVEL_UP:"level_up",EXERCISE_UNLOCKED:"exercise_unlocked",CHAPTER_COMPLETED:"chapter_completed",ACHIEVEMENT:"achievement",DAILY_STREAK:"daily_streak"},n={XP_GAINED:4e3,LEVEL_UP:6e3,EXERCISE_UNLOCKED:5e3,CHAPTER_COMPLETED:5e3,ACHIEVEMENT:7e3,DAILY_STREAK:5e3};function o({type:d,title:h,message:y,data:L={},autoRemove:x=!1}){const V={id:t.value++,type:d,title:h,message:y,data:L,read:!1,timestamp:new Date,autoRemove:x};if(e.value.unshift(V),x){const B=n[d]||5e3;setTimeout(()=>{F(V.id)},B)}return V}function l(d,h,y=1){const L=y===1,x=L?"🎉 XP Gagnés !":"🔄 Tentative Supplémentaire";let V;return L&&d>0?V=`+${d} XP pour "${h}"`:V=`Quiz "${h}" terminé (cooldown 1h30)`,o({type:a.XP_GAINED,title:x,message:V,data:{xpAmount:d,quizTitle:h,attempt:y,isFirstAttempt:L}})}function c(d,h,y){return o({type:a.LEVEL_UP,title:"🏆 Niveau Supérieur !",message:`Félicitations ! Vous êtes maintenant niveau ${d}`,data:{newLevel:d,totalXP:h,xpToNext:y}})}function p(d,h){return o({type:a.EXERCISE_UNLOCKED,title:"🔓 Nouvel Exercice !",message:`"${d}" disponible dans ${h}`,data:{exerciseTitle:d,chapterTitle:h}})}function m(d,h){return o({type:a.CHAPTER_COMPLETED,title:"✅ Chapitre Terminé !",message:`"${d}" complété à ${h}%`,data:{chapterTitle:d,completionRate:h}})}function g(d,h,y="🏅"){return o({type:a.ACHIEVEMENT,title:`${y} Réussite Débloquée !`,message:`${d}: ${h}`,data:{achievementTitle:d,description:h,icon:y}})}function f(d,h){const y=x=>x===1?"Première connexion aujourd'hui !":x<=5?`${x} jours consécutifs ! Bravo !`:`${x} jours de suite ! Incroyable série !`,L=x=>x===1?"🌟":x===2?"⭐":x===3?"🔥":x===4?"💫":x>=5?"🏆":"🌟";return o({type:a.DAILY_STREAK,title:`${L(d)} Série Quotidienne !`,message:`${y(d)} +${h} XP`,data:{streakDays:d,xpGained:h}})}async function u(d){const h=e.value.find(y=>y.id===d);if(h){h.read=!0;try{await gt(d)}catch{}}}async function b(){e.value.forEach(d=>d.read=!0);try{const d=await Hs()}catch{}}function F(d){const h=e.value.findIndex(y=>y.id===d);h>-1&&e.value.splice(h,1)}function w(){e.value=[]}function I(){e.value.length>20&&(e.value=e.value.sort((d,h)=>new Date(h.timestamp)-new Date(d.timestamp)).slice(0,20))}return{notifications:R(()=>e.value),unreadCount:s,hasUnread:r,NOTIFICATION_TYPES:a,loadFromServer:async()=>{try{const d=await Qe(),h=Array.isArray(d?.data)?d.data:d?.data?.results||[];e.value=h.map(L=>({id:L.id,type:L.type,title:L.title,message:L.message,data:L.data||{},read:!!L.read,timestamp:L.created_at?new Date(L.created_at):new Date}));const y=h.reduce((L,x)=>Math.max(L,Number(x.id||0)),0);t.value=Math.max(t.value,y+1)}catch{}},addNotification:o,markAsRead:u,markAllAsRead:b,removeNotification:F,clearAll:w,cleanupOld:I,notifyXPGained:l,notifyLevelUp:c,notifyExerciseUnlocked:p,notifyChapterCompleted:m,notifyAchievement:g,notifyDailyStreak:f}}),xe=C(!1),Oe=C(0),Pe=C("");function ta(){const e=oe(),t=Ke();function s(l=0,c="XP gagné !"){Oe.value=l,Pe.value=c,xe.value=!0}function r(){xe.value=!1,Oe.value=0,Pe.value=""}async function a(l=!1){try{const c=await $s(),p=c?.data?.data||c?.data||null;if(p){const m=Number(e.xp||0),g=Number(p.xp??e.xp??0),f=p.level,u=p.xp_to_next??p.next_level_xp??null,b=Ve(g),F=Number(f??b.level),w=Number(u??b.xp_to_next);return l||(e.xp=g,e.level=F,e.xp_to_next=w),{success:!0,gainedXp:g-m,newXp:g,newLevel:F,newXpToNext:w}}}catch(c){return{success:!1,error:c}}}async function n(l,c="streak_daily"){if(l==null)return{success:!1};const p=Number(e.xp||0),m=Number(e.level||0),g=p+Number(l),{level:f,xp_to_next:u}=Ve(g);e.xp=g,e.level=f,e.xp_to_next=u,await De();try{await Xs({xp_delta:l,reason:c})}catch{}const b=f>m;return b&&t.notifyLevelUp(f,g,u),{success:!0,oldXp:p,newXp:g,oldLevel:m,newLevel:f,levelUp:b}}async function o(l,c,p=1,m="Quiz"){if(t.notifyXPGained(c,m,p),c>0){let g="Quiz réussi !";p===1&&(g="Premier essai réussi !"),s(c,g);const f=await n(c,"quiz_completion");return await a(!0)}else p>1&&s(0,"Tentative supplémentaire (cooldown 1h30)");return{success:!0,gainedXp:0}}return{showXpNotification:xe,xpGained:Oe,xpMessage:Pe,showXpGain:s,hideXpNotification:r,refreshUserXP:a,updateUserXPInstantly:n,handleQuizCompletion:o}}function sa(){const e=oe(),t=Ke(),{updateUserXPInstantly:s}=ta(),r=C(0),a=C(null),n=C(!1);function o(w){return w<=0?0:w<=5?w:5}function l(w){if(!w)return!0;const I=new Date,d=new Date(w),h=I.toDateString(),y=d.toDateString();return h!==y}function c(w){if(!w)return!1;const I=new Date,d=new Date(w),h=I-d;return Math.floor(h/(1e3*60*60*24))<=1}async function p(){try{if(n.value)return{success:!0,alreadyChecked:!0};const w=new Date().toISOString().split("T")[0],I=localStorage.getItem("lastLoginDate"),d=parseInt(localStorage.getItem("currentStreak")||"0");if(!l(I))return n.value=!0,r.value=d,{success:!0,alreadyChecked:!0};let h=1;c(I)&&(h=d+1);const y=o(h);return r.value=h,a.value=w,n.value=!0,localStorage.setItem("currentStreak",h.toString()),localStorage.setItem("lastLoginDate",w),localStorage.setItem("streakCheckedToday","true"),y>0&&await s(y,"streak_daily"),t.notifyDailyStreak(h,y),{success:!0,streakDays:h,xpGained:y,isNewStreak:h===1&&!c(I)}}catch(w){return{success:!1,error:w}}}function m(){try{const w=parseInt(localStorage.getItem("currentStreak")||"0"),I=localStorage.getItem("lastLoginDate"),d=localStorage.getItem("streakCheckedToday")==="true";r.value=w,a.value=I,l(I)?(n.value=!1,localStorage.removeItem("streakCheckedToday")):n.value=d}catch{r.value=0,a.value=null,n.value=!1}}function g(){r.value=0,a.value=null,n.value=!1,localStorage.removeItem("currentStreak"),localStorage.removeItem("lastLoginDate"),localStorage.removeItem("streakCheckedToday")}async function f(){return e.isAuthenticated?(m(),await p()):{success:!1,reason:"not_authenticated"}}const u=R(()=>o(r.value+1)),b=R(()=>o(r.value)),F=R(()=>r.value===0?"Connectez-vous quotidiennement pour gagner des XP !":r.value<=5?`${r.value} jour${r.value>1?"s":""} de suite ! Prochain: +${u.value} XP`:`${r.value} jours consécutifs ! +5 XP quotidiens`);return{currentStreak:R(()=>r.value),lastLoginDate:R(()=>a.value),isStreakCheckedToday:R(()=>n.value),nextStreakXP:u,todayStreakXP:b,streakMessage:F,checkDailyStreak:f,updateStreak:p,initializeStreak:m,resetStreak:g,calculateStreakXP:o,isNewDay:l,isStreakValid:c}}const ra={key:1,id:"app"},oa={__name:"App",setup(e){const t=oe(),s=Le(),r=Ge(),{isModalOpen:a,closeModal:n,openModal:o}=ze(),{checkDailyStreak:l}=sa(),c=Ke(),p=C(!1),m=R(()=>a(G.LOGIN)),g=R(()=>a(G.REGISTER)),f=R(()=>a(G.FORGOT_PASSWORD)),u=()=>n(G.LOGIN),b=()=>n(G.REGISTER),F=()=>n(G.FORGOT_PASSWORD),w=()=>{p.value=!1},I=async()=>{if(t.isAuthenticated&&t.pays&&t.niveau_pays)try{await s.initialize()}catch{}},d=()=>{if(t.id){const E=`configurationCompleted_${t.id}`;localStorage.setItem(E,"true")}w(),t.fetchUser().then(()=>{I()})},h=E=>{E.provider==="google"||u()},y=()=>{u(),o(G.REGISTER)},L=()=>{u(),o(G.FORGOT_PASSWORD)},x=async E=>{E.provider==="google"||(b(),r.push("/dashboard"))},V=()=>{b(),F(),o(G.LOGIN)},B=()=>{},T=()=>{},v=()=>{if(t.isLoading||!t.isAuthenticated||!t.id)return;const E=t.pays!==null&&t.pays!==void 0,O=t.niveau_pays!==null&&t.niveau_pays!==void 0;if(!E||!O){const q=`configurationCompleted_${t.id}`;localStorage.getItem(q)==="true"&&(!E||!O)&&localStorage.removeItem(q),!localStorage.getItem(q)&&!p.value&&(p.value=!0)}};return Te(()=>t.isAuthenticated,E=>{E&&setTimeout(async()=>{try{await l()}catch{}v();try{await c.loadFromServer()}catch{}},200)},{immediate:!0}),Te([()=>t.pays,()=>t.niveau_pays,()=>t.isLoading],([E,O,q])=>{if(!q&&t.isAuthenticated&&t.id){const ie=E!=null,ce=O!=null;if(ie&&ce){p.value=!1;const Y=`configurationCompleted_${t.id}`;localStorage.setItem(Y,"true"),I()}else v()}}),be(async()=>{try{await l()}catch{}if(t.isAuthenticated){v(),t.pays&&t.niveau_pays&&I();try{await c.loadFromServer()}catch{}}}),(E,O)=>{const q=ee("router-view");return H(t).isLoading?(_(),ne(ea,{key:0})):(_(),S("div",ra,[j(q),j(pr,{"is-open":m.value,onClose:u,onLogin:h,onSignup:y,onForgotPassword:L},null,8,["is-open"]),j(Pr,{"is-open":g.value,onClose:b,onRegister:x,onLogin:V,onTerms:B,onPrivacy:T},null,8,["is-open"]),j(zr,{"is-open":f.value,onClose:F,onForgotPassword:L,onLogin:V},null,8,["is-open"]),j(To,{"is-open":p.value,onConfigurationComplete:d,onClose:w},null,8,["is-open"]),j(Po),j(zo),j(Ko)]))}}},aa={};if(typeof document<"u"){const e=document.createElement("style");e.textContent=`
    /* Cache le bouton menu (≡) et le toggle clavier virtuel */
    math-field::part(menu-toggle),
    math-field::part(virtual-keyboard-toggle) {
      display: none !important;
    }
  `,document.head.appendChild(e)}const na=Et(),Je=bt(oa);Je.use(na);Je.use(He);const ia=oe(),la=ye.cleanExpiredTokens(),ca=localStorage.getItem("access_token");if(import.meta&&aa){const e=()=>{};console.log=e,console.debug=e,console.info=e,console.warn=e}ca&&(ia.fetchUser(),setTimeout(()=>{ye.startTokenMonitoring()},1e3));Je.mount("#app");export{Ta as $,Xs as A,wa as B,Ct as C,et as D,ba as E,Kt as F,Ea as G,Sa as H,Us as I,qs as J,Vs as K,ls as L,G as M,Na as N,Ds as O,Ns as P,Pa as Q,Gs as R,Bs as S,Ps as T,Os as U,Oa as V,Ra as W,zo as X,Ca as Y,Ma as Z,K as _,sa as a,La as a0,Fa as a1,Aa as a2,xa as a3,xs as a4,ka as a5,Rs as a6,Ia as a7,Va as a8,qa as a9,Ga as aa,za as ab,Qe as ac,gt as ad,Hs as ae,Ws as af,Ks as ag,Js as ah,Ys as ai,Ka as aj,Zs as ak,tt as al,er as am,tr as an,_a as ao,A as b,ta as c,Le as d,$s as e,Ua as f,Ba as g,ja as h,$a as i,js as j,Da as k,We as l,ya as m,zs as n,Ya as o,ze as p,Ke as q,Xa as r,Qa as s,Ja as t,oe as u,Wa as v,ye as w,Ha as x,Qs as y,ht as z};
