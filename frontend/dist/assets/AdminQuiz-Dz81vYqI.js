import{a as p,c as q,B as W,b as s,d as t,g as D,k as d,K as v,L as S,F as T,p as k,j as f,t as o,w as M,o as a,n as X,h as Y,u as Z}from"./vendor-D171CWhe.js";import{d as ee,e as E,u as te,f as ie}from"./quiz-CwjmfWc_.js";import{_ as ne}from"./index-Egejfov0.js";import{a as le,g as oe}from"./curriculum-D6MgTj4l.js";import{A as re}from"./AdminActionsButtons-G7-9puBf.js";import"./ui-jaH5oyHW.js";import"./pdf-B39ievqC.js";import"./mathlive-B5k0jhbN.js";const ue={class:"form-group"},se=["value"],ae={key:0,class:"context-panel"},de={class:"context-row"},me={class:"context-row"},pe={class:"context-row"},ve={class:"context-row"},fe={class:"context-row"},ce={class:"context-row"},ye={class:"form-group"},ge={class:"form-group"},be={class:"form-group"},Ne={class:"form-group"},we={class:"form-group"},Ce={class:"form-group"},xe={class:"btn-primary",type:"submit"},he={class:"filters"},_e={class:"filter-group"},Qe=["value"],Ae={class:"admin-table"},qe={class:"ctx-cell"},De={key:0},Se={class:"modal-description"},Te={class:"modal-form"},ke={class:"form-group"},Ve=["value"],Fe={class:"form-group"},je={class:"modal-actions"},Be=["disabled"],Ue={__name:"AdminQuiz",setup(ze){const V=p([]),m=p([]),F=p([]),b=p(""),N=p(""),l=p({id:null,chapitre:"",titre:"",description:"",nombre_questions:10,temps_limite:30,difficulte:"moyen",questions_json:""}),w=p({chapitre:""}),C=p(!1),u=p({originalQuiz:null,newChapitre:"",newTitre:""}),j=q(()=>{let n=V.value;return w.value.chapitre&&(n=n.filter(e=>e.chapitre==w.value.chapitre)),n}),L=q(()=>{if(!b.value)return m.value;const n=b.value.toLowerCase();return m.value.filter(e=>Q(e).toLowerCase().includes(n))}),$=q(()=>{if(!N.value)return m.value;const n=N.value.toLowerCase();return m.value.filter(e=>Q(e).toLowerCase().includes(n))});async function x(){try{const[n,e,i]=await Promise.all([ee(),le(),oe()]);V.value=Array.isArray(n?.data)?n.data:Array.isArray(n)?n:[],m.value=Array.isArray(e)?e:e?.data||[],F.value=Array.isArray(i)?i:i?.data||[]}catch{V.value=[],m.value=[],F.value=[]}}W(x);function B(){l.value={id:null,chapitre:"",titre:"",description:"",nombre_questions:10,temps_limite:30,difficulte:"moyen",questions_json:""}}async function O(){if(!(!l.value.chapitre||!l.value.titre))try{const n={facile:"easy",moyen:"medium",difficile:"hard"};let e=[];if(l.value.questions_json&&l.value.questions_json.trim())try{e=JSON.parse(l.value.questions_json)}catch{e=[]}const i={chapitre:Number(l.value.chapitre),titre:l.value.titre,contenu:l.value.description||l.value.titre,duree_minutes:Number(l.value.temps_limite)||30,questions_data:Array.isArray(e)?e:[],difficulty:n[l.value.difficulte]||"medium"};l.value.id?await te(l.value.id,i):await E(i);const r=l.value.chapitre;B(),l.value.chapitre=r,await x()}catch{}}function I(n){const e={easy:"facile",medium:"moyen",hard:"difficile"},i=n.difficulte||n.difficulty||"medium",r=e[i]||"moyen";l.value={id:n.id,chapitre:n.chapitre,titre:n.titre||"",description:n.description||"",nombre_questions:n.nombre_questions||10,temps_limite:n.temps_limite||30,difficulte:r,questions_json:n.questions_data?JSON.stringify(n.questions_data,null,2):""}}async function J(n){try{await ie(n),await x()}catch{}}function P(n){J(n.id)}function G(n){u.value={originalQuiz:n,newChapitre:"",newTitre:`${n.titre}`},C.value=!0}async function K(){if(!u.value.newChapitre||!u.value.newTitre.trim()){alert("Veuillez sélectionner un chapitre et saisir un titre pour la copie.");return}try{const n=u.value.originalQuiz,e={facile:"easy",moyen:"medium",difficile:"hard"},i={chapitre:Number(u.value.newChapitre),titre:u.value.newTitre.trim(),contenu:n.contenu||n.description||"",duree_minutes:n.duree_minutes||n.temps_limite||30,questions_data:n.questions_data||[],difficulty:n.difficulty||e[n.difficulte]||"medium"};await E(i),await x(),C.value=!1,u.value={originalQuiz:null,newChapitre:"",newTitre:""},alert("Quiz dupliqué avec succès !")}catch{alert("Erreur lors de la duplication du quiz.")}}function U(){C.value=!1,u.value={originalQuiz:null,newChapitre:"",newTitre:""}}function R(n){const e=m.value.find(i=>String(i.id)===String(n));return e?e.nom:n}function h(n){return F.value.find(e=>String(e.id)===String(n))}function _(n){if(!n)return null;const e=h(n.notion);if(!e)return{themeNom:"",matiereNom:"",paysNom:"",niveauNom:""};const i=e.matiere_nom||e.contexte_detail&&e.contexte_detail.matiere_nom||"",r=e.theme_nom||"",A=e.contexte_detail&&e.contexte_detail.pays?e.contexte_detail.pays.nom:"",g=e.contexte_detail&&e.contexte_detail.niveau?e.contexte_detail.niveau.nom:"";return{matiereNom:i,themeNom:r,paysNom:A,niveauNom:g}}const c=q(()=>{const n=m.value.find(e=>String(e.id)===String(l.value.chapitre));return n?_(n):null});function Q(n){const e=h(n.notion),i=_(n);return[n.nom,e?`— ${e.nom}`:"",i&&i.matiereNom?`— ${i.matiereNom}`:"",i&&(i.paysNom||i.niveauNom)?`— ${[i.paysNom,i.niveauNom].filter(Boolean).join(" · ")}`:""].filter(Boolean).join(" ")}function y(n){return String(n||"").normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"")}function z(n){const e=m.value.find(g=>String(g.id)===String(n));if(!e)return"";const i=h(e.notion),r=_(e);return[r?.matiereNom,r?.themeNom,i?.nom,e.nom,r?.paysNom,r?.niveauNom].filter(Boolean).join(" › ")}function H(n){const e=m.value.find(g=>String(g.id)===String(n));if(!e)return"";const i=h(e.notion),r=_(e);return[y(i?.nom),y(r?.themeNom),y(r?.matiereNom),y(r?.paysNom),y(r?.niveauNom)].filter(Boolean).join("_")}return(n,e)=>(a(),s("div",null,[e[44]||(e[44]=t("h2",{class:"admin-title"},"Gestion des Quiz",-1)),t("form",{class:"admin-form",onSubmit:M(O,["prevent"])},[t("div",ue,[e[14]||(e[14]=t("label",null,"Chapitre:",-1)),d(t("input",{"onUpdate:modelValue":e[0]||(e[0]=i=>b.value=i),type:"text",placeholder:"Filtrer les chapitres...",class:"filter-input"},null,512),[[v,b.value]]),d(t("select",{"onUpdate:modelValue":e[1]||(e[1]=i=>l.value.chapitre=i),required:""},[e[13]||(e[13]=t("option",{value:""},"Choisir un chapitre",-1)),(a(!0),s(T,null,k(L.value,i=>(a(),s("option",{key:i.id,value:i.id},o(Q(i)),9,se))),128))],512),[[S,l.value.chapitre]])]),c.value?(a(),s("div",ae,[t("div",de,[e[15]||(e[15]=t("strong",null,"Matière:",-1)),e[16]||(e[16]=f()),t("span",null,o(c.value.matiereNom||"—"),1)]),t("div",me,[e[17]||(e[17]=t("strong",null,"Thème:",-1)),e[18]||(e[18]=f()),t("span",null,o(c.value.themeNom||"—"),1)]),t("div",pe,[e[19]||(e[19]=t("strong",null,"Pays:",-1)),e[20]||(e[20]=f()),t("span",null,o(c.value.paysNom||"—"),1)]),t("div",ve,[e[21]||(e[21]=t("strong",null,"Niveau:",-1)),e[22]||(e[22]=f()),t("span",null,o(c.value.niveauNom||"—"),1)]),t("div",fe,[e[23]||(e[23]=t("strong",null,"Chemin:",-1)),e[24]||(e[24]=f()),t("span",null,o(z(l.value.chapitre)),1)]),t("div",ce,[e[25]||(e[25]=t("strong",null,"Code:",-1)),e[26]||(e[26]=f()),t("code",null,o(H(l.value.chapitre)),1)])])):D("",!0),t("div",ye,[e[27]||(e[27]=t("label",null,"Titre du quiz:",-1)),d(t("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>l.value.titre=i),placeholder:"Titre du quiz",required:""},null,512),[[v,l.value.titre]])]),t("div",ge,[e[28]||(e[28]=t("label",null,"Description:",-1)),d(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=i=>l.value.description=i),rows:"3"},null,512),[[v,l.value.description]])]),t("div",be,[e[29]||(e[29]=t("label",null,"Nombre de questions:",-1)),d(t("input",{"onUpdate:modelValue":e[4]||(e[4]=i=>l.value.nombre_questions=i),type:"number",min:"1",max:"50"},null,512),[[v,l.value.nombre_questions,void 0,{number:!0}]])]),t("div",Ne,[e[30]||(e[30]=t("label",null,"Temps limite (minutes):",-1)),d(t("input",{"onUpdate:modelValue":e[5]||(e[5]=i=>l.value.temps_limite=i),type:"number",min:"1",max:"120"},null,512),[[v,l.value.temps_limite,void 0,{number:!0}]])]),t("div",we,[e[31]||(e[31]=t("label",null,"Questions (JSON) – optionnel",-1)),d(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=i=>l.value.questions_json=i),rows:"6",placeholder:`Exemple:\r
[\r
  {\r
    "type": "qcm",\r
    "enonce": "1/2 + 1/3 = ?",\r
    "choix": ["5/6", "2/5", "3/5", "4/5"],\r
    "bonne_reponse_index": 0,\r
    "points": 1\r
  },\r
  {\r
    "type": "entree-libre",\r
    "enonce": "Simplifier 6/8",\r
    "reponse_attendue": "3/4",\r
    "points": 1\r
  }\r
]`},null,512),[[v,l.value.questions_json]])]),t("div",Ce,[e[33]||(e[33]=t("label",null,"Difficulté:",-1)),d(t("select",{"onUpdate:modelValue":e[7]||(e[7]=i=>l.value.difficulte=i)},e[32]||(e[32]=[t("option",{value:"facile"},"Facile",-1),t("option",{value:"moyen"},"Moyen",-1),t("option",{value:"difficile"},"Difficile",-1)]),512),[[S,l.value.difficulte]])]),t("button",xe,o(l.value.id?"Mettre à jour":"Créer"),1),l.value.id?(a(),s("button",{key:1,class:"btn-secondary",type:"button",onClick:B},"Annuler")):D("",!0)],32),t("div",he,[t("div",_e,[e[35]||(e[35]=t("label",null,"Filtrer par chapitre:",-1)),d(t("input",{"onUpdate:modelValue":e[8]||(e[8]=i=>N.value=i),type:"text",placeholder:"Filtrer les chapitres...",class:"filter-input"},null,512),[[v,N.value]]),d(t("select",{"onUpdate:modelValue":e[9]||(e[9]=i=>w.value.chapitre=i)},[e[34]||(e[34]=t("option",{value:""},"Tous les chapitres",-1)),(a(!0),s(T,null,k($.value,i=>(a(),s("option",{key:i.id,value:i.id},o(i.nom)+" ("+o(i.notion_nom)+") ",9,Qe))),128))],512),[[S,w.value.chapitre]])])]),t("table",Ae,[e[37]||(e[37]=t("thead",null,[t("tr",null,[t("th",null,"ID"),t("th",null,"Titre"),t("th",null,"Chapitre"),t("th",null,"Contexte"),t("th",null,"Questions"),t("th",null,"Temps"),t("th",null,"Difficulté"),t("th",null,"Actions")])],-1)),t("tbody",null,[(a(!0),s(T,null,k(j.value,i=>(a(),s("tr",{key:i.id},[t("td",null,o(i.id),1),t("td",null,o(i.titre),1),t("td",null,o(R(i.chapitre)),1),t("td",qe,o(z(i.chapitre)),1),t("td",null,o(i.questions_data&&i.questions_data.length||i.nombre_questions||0),1),t("td",null,o(i.temps_limite||0)+" min",1),t("td",null,[t("span",{class:X(["difficulte-badge",`difficulte-${i.difficulte||i.difficulty||"moyen"}`])},o(i.difficulte||i.difficulty||"moyen"),3)]),t("td",null,[Y(Z(re),{item:i,actions:["edit","duplicate","delete"],"edit-label":"Éditer","duplicate-label":"Dupliquer","confirm-message":"Êtes-vous sûr de vouloir supprimer ce quiz ?",onEdit:I,onDuplicate:G,onDelete:P},null,8,["item"])])]))),128)),j.value.length===0?(a(),s("tr",De,e[36]||(e[36]=[t("td",{colspan:"8",style:{"text-align":"center","font-style":"italic"}},"Aucun quiz trouvé.",-1)]))):D("",!0)])]),C.value?(a(),s("div",{key:0,class:"modal-overlay",onClick:U},[t("div",{class:"modal-content",onClick:e[12]||(e[12]=M(()=>{},["stop"]))},[e[43]||(e[43]=t("h3",null,"Dupliquer le quiz",-1)),t("p",Se,[e[38]||(e[38]=f(' Créer une copie de "')),t("strong",null,o(u.value.originalQuiz?.titre),1),e[39]||(e[39]=f('" '))]),t("div",Te,[t("div",ke,[e[41]||(e[41]=t("label",null,"Nouveau chapitre:",-1)),d(t("select",{"onUpdate:modelValue":e[10]||(e[10]=i=>u.value.newChapitre=i),required:""},[e[40]||(e[40]=t("option",{value:""},"Choisir un chapitre",-1)),(a(!0),s(T,null,k(m.value,i=>(a(),s("option",{key:i.id,value:i.id},o(Q(i)),9,Ve))),128))],512),[[S,u.value.newChapitre]])]),t("div",Fe,[e[42]||(e[42]=t("label",null,"Nouveau titre:",-1)),d(t("input",{"onUpdate:modelValue":e[11]||(e[11]=i=>u.value.newTitre=i),placeholder:"Titre de la copie",required:""},null,512),[[v,u.value.newTitre]])])]),t("div",je,[t("button",{class:"btn-secondary",onClick:U},"Annuler"),t("button",{class:"btn-primary",onClick:K,disabled:!u.value.newChapitre||!u.value.newTitre.trim()}," Dupliquer ",8,Be)])])])):D("",!0)]))}},Ge=ne(Ue,[["__scopeId","data-v-24f4381b"]]);export{Ge as default};
