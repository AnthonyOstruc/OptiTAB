import{_ as P,q as E,h as y,c as r,a as s,d as l,t,u as c,b as f,F as _,e as N,o}from"./index-C20tTf3S.js";import{a as U,f as T}from"./matieres-Ce1WeeoH.js";const C={class:"test-filtrage-strict"},I={class:"user-info"},R={class:"test-section"},V=["disabled"],z={key:0,class:"result"},H={key:0,class:"matieres-list"},L={class:"matiere-header"},O=["innerHTML"],w={class:"matiere-nom"},B={class:"matiere-details"},D={key:1,class:"no-matieres"},j={class:"test-section"},Y=["disabled"],G={key:0,class:"result"},J={key:0,class:"matieres-list"},K={class:"matiere-header"},Q=["innerHTML"],W={class:"matiere-nom"},X={class:"matiere-type"},Z={__name:"TestFiltrageStrict",setup($){const u=E(),d=y(!1),a=y(null),v=y(null),M=async()=>{d.value=!0;try{const n=await U();a.value=n.data,console.log("Filtrage strict:",a.value)}catch(n){console.error("Erreur lors du test du filtrage strict:",n),a.value={error:n.message}}finally{d.value=!1}},A=async()=>{d.value=!0;try{const n=u.pays?.id,e=u.niveau_pays?.id,p=(n?await T(n,null):{data:{matieres:[]}}).data.matieres||[],m=(e?await T(null,e):{data:{matieres:[]}}).data.matieres||[],b=[...p,...m].filter((F,k,q)=>k===q.findIndex(x=>x.id===F.id));v.value=b,console.log("Ancien filtrage (simulation):",v.value)}catch(n){console.error("Erreur lors du test de l'ancien filtrage:",n),v.value=[]}finally{d.value=!1}},S=n=>{const e=u.pays?.id,i=u.niveau_pays?.id,p=n.pays_associes?.some(m=>m.id===e),g=n.niveaux_associes?.some(m=>m.id===i);return p&&g?"Pays ET Niveau":p?"Pays seulement":g?"Niveau seulement":"Aucun"};return(n,e)=>(o(),r("div",C,[e[20]||(e[20]=s("h1",null,"Test du Filtrage Strict des Matières",-1)),s("div",I,[e[4]||(e[4]=s("h2",null,"Configuration Utilisateur",-1)),s("p",null,[e[0]||(e[0]=s("strong",null,"Email:",-1)),l(" "+t(c(u).email),1)]),s("p",null,[e[1]||(e[1]=s("strong",null,"Pays:",-1)),l(" "+t(c(u).pays?.nom||"Non configuré")+" (ID: "+t(c(u).pays?.id)+")",1)]),s("p",null,[e[2]||(e[2]=s("strong",null,"Niveau:",-1)),l(" "+t(c(u).niveau_pays?.nom||"Non configuré")+" (ID: "+t(c(u).niveau_pays?.id)+")",1)]),s("p",null,[e[3]||(e[3]=s("strong",null,"Admin:",-1)),l(" "+t(c(u).isAdmin?"Oui":"Non"),1)])]),s("div",R,[e[14]||(e[14]=s("h2",null,"Test du Filtrage Strict",-1)),e[15]||(e[15]=s("p",{class:"info"},[s("strong",null,"Nouveau comportement :"),l(" Seules les matières qui correspondent AU PAYS ET AU NIVEAU de l'utilisateur seront affichées. ")],-1)),s("button",{onClick:M,disabled:d.value,class:"test-button"},t(d.value?"Test en cours...":"Tester le Filtrage Strict"),9,V),a.value?(o(),r("div",z,[e[12]||(e[12]=s("h3",null,"Résultats du Test",-1)),s("p",null,[e[5]||(e[5]=s("strong",null,"Status:",-1)),l(" "+t(a.value.status),1)]),s("p",null,[e[6]||(e[6]=s("strong",null,"Message:",-1)),l(" "+t(a.value.message),1)]),e[13]||(e[13]=s("p",null,[s("strong",null,"Filtres appliqués:")],-1)),s("ul",null,[s("li",null,"Pays: "+t(a.value.filtres_appliques?.pays?"Oui":"Non"),1),s("li",null,"Niveau: "+t(a.value.filtres_appliques?.niveau?"Oui":"Non"),1)]),s("p",null,[e[7]||(e[7]=s("strong",null,"Matières disponibles:",-1)),l(" "+t(a.value.matieres_disponibles?.length||0),1)]),a.value.matieres_disponibles&&a.value.matieres_disponibles.length>0?(o(),r("div",H,[e[10]||(e[10]=s("h4",null,"Matières filtrées (Pays ET Niveau):",-1)),(o(!0),r(_,null,N(a.value.matieres_disponibles,i=>(o(),r("div",{key:i.id,class:"matiere-item"},[s("div",L,[s("span",{class:"matiere-icon",innerHTML:i.svg_icon||"📚"},null,8,O),s("span",w,t(i.nom),1)]),s("div",B,[s("p",null,[e[8]||(e[8]=s("strong",null,"Pays associés:",-1)),l(" "+t(i.pays_associes?.map(p=>p.nom).join(", ")||"Aucun"),1)]),s("p",null,[e[9]||(e[9]=s("strong",null,"Niveaux associés:",-1)),l(" "+t(i.niveaux_associes?.map(p=>p.nom).join(", ")||"Aucun"),1)])])]))),128))])):(o(),r("div",D,e[11]||(e[11]=[s("p",null,"⚠️ Aucune matière ne correspond exactement à votre pays ET niveau.",-1),s("p",null,"Vérifiez que :",-1),s("ul",null,[s("li",null,"Votre pays et niveau sont correctement configurés"),s("li",null,"Il existe des matières associées à votre pays ET niveau")],-1)])))])):f("",!0)]),s("div",j,[e[18]||(e[18]=s("h2",null,"Comparaison avec l'Ancien Filtrage",-1)),e[19]||(e[19]=s("p",{class:"info"},[s("strong",null,"Ancien comportement :"),l(" Matières du pays OU du niveau (plus permissif) ")],-1)),s("button",{onClick:A,disabled:d.value,class:"test-button"},t(d.value?"Test en cours...":"Simuler l'Ancien Filtrage"),9,Y),v.value?(o(),r("div",G,[e[17]||(e[17]=s("h3",null,"Résultats de l'Ancien Filtrage (Simulation)",-1)),s("p",null,[e[16]||(e[16]=s("strong",null,"Matières (Pays OU Niveau):",-1)),l(" "+t(v.value.length),1)]),v.value.length>0?(o(),r("div",J,[(o(!0),r(_,null,N(v.value,i=>(o(),r("div",{key:i.id,class:"matiere-item old"},[s("div",K,[s("span",{class:"matiere-icon",innerHTML:i.svg_icon||"📚"},null,8,Q),s("span",W,t(i.nom),1),s("span",X,t(S(i)),1)])]))),128))])):f("",!0)])):f("",!0)]),e[21]||(e[21]=s("div",{class:"instructions"},[s("h2",null,"Instructions"),s("ol",null,[s("li",null,"Assurez-vous d'être connecté avec un utilisateur qui a un pays et un niveau configurés"),s("li",null,'Cliquez sur "Tester le Filtrage Strict" pour voir les matières qui correspondent exactement à votre configuration'),s("li",null,"Comparez avec l'ancien filtrage pour voir la différence"),s("li",null,[l("Vérifiez que le composant "),s("code",null,"SelectedMatiereHeader"),l(" utilise maintenant ce filtrage strict")])])],-1))]))}},ts=P(Z,[["__scopeId","data-v-2e38abee"]]);export{ts as default};
