const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/useDailyObjectives-DFD_NK92.js","assets/index-lv_OcPRH.js","assets/vendor-D171CWhe.js","assets/ui-jaH5oyHW.js","assets/pdf-B39ievqC.js","assets/mathlive-B5k0jhbN.js","assets/index-P4rN2wWs.css"])))=>i.map(i=>d[i]);
import{_ as A}from"./pdf-B39ievqC.js";import{a as v,c as j,f as D,A as k,i as M,o as p,M as P,B as R,y as L,d as i,h as y,b as g,t as O,u as V}from"./vendor-D171CWhe.js";import{w as F,_ as C,u as U}from"./index-lv_OcPRH.js";import{i as $}from"./curriculum-C0iqsaca.js";import{u as I,c as N,d as J,g as T}from"./exercices-alxWkPRG.js";import{D as z}from"./DashboardLayout-Bn3w_Qf_.js";import{E as Q}from"./ExerciceQCM-BMMMvHid.js";import{B as G}from"./BackButton-Camv1Z6e.js";import{P as w}from"./PDFDownloadButton-C5eDtz8G.js";import"./ui-jaH5oyHW.js";import"./mathlive-B5k0jhbN.js";import"./menuItems-D4F2gOe0.js";import"./matieres-HKHHhne_.js";function H(){const m=F(),a=v({}),l=v(!1),d=v("");async function h(){l.value=!0,d.value="";try{const{data:e}=await T(),t=Array.isArray(e)?e:e?.results||[];return a.value=Object.fromEntries(t.map(o=>[o.exercice,{status:o.est_correct?"acquired":"not_acquired",id:o.id}])),a.value}catch(e){throw d.value="Impossible de charger les statuts",e}finally{l.value=!1}}async function S(e,t){if(!e)throw new Error("ID exercice requis");try{const o=!!a.value[e];if(t){const f=a.value[e];if(f)await I(f.id,{exercice:e,reponse_donnee:t,est_correct:t==="acquired"}),a.value[e]={status:t,id:f.id};else{const q=await N({exercice:e,reponse_donnee:t,est_correct:t==="acquired",points_obtenus:t==="acquired"?1:0,temps_seconde:0}),B=q?.data?.id||q?.id;a.value[e]={status:t,id:B},t==="acquired"&&!o&&await E(e)}}else{const f=a.value[e];f&&await J(f.id),delete a.value[e]}}catch(o){throw t?a.value[e]={status:t,id:null}:delete a.value[e],o}}function b(e){return a.value[e]?.status||null}function r(e){return a.value[e]?.status==="acquired"}function u(e){return!!a.value[e]}const c=j(()=>{const e={acquired:0,not_acquired:0,total:0};return Object.values(a.value).forEach(({status:t})=>{t==="acquired"?e.acquired++:t==="not_acquired"&&e.not_acquired++,e.total++}),e});function _(e,t){if(!Array.isArray(e))return[];switch(t){case"acquired":return e.filter(o=>r(o.id));case"not_acquired":return e.filter(o=>a.value[o.id]?.status==="not_acquired");case"done":return e.filter(o=>u(o.id));case"all":return e.filter(o=>!u(o.id));default:return e}}function x(){a.value={},d.value=""}async function E(e){}function n(e,t){m.notifyExerciseUnlocked(e,t)}function s(e,t){m.notifyChapterCompleted(e,t)}return{statusMap:a,isLoadingStatuses:l,statusError:d,statusCounts:c,loadStatuses:h,updateExerciseStatus:S,getExerciseStatus:b,isExerciseAcquired:r,hasExerciseStatus:u,filterExercisesByStatus:_,resetStatuses:x,checkForUnlockedExercises:E,notifyExerciseUnlocked:n,notifyChapterCompleted:s}}const K={__name:"ExercisePageLayout",setup(m){return(a,l)=>(p(),D(z,null,{default:k(()=>[M(a.$slots,"default",{},void 0,!0)]),_:3}))}},W=C(K,[["__scopeId","data-v-fa4ed041"]]),X={class:"exercice-detail-section"},Y={key:0,class:"state-container"},Z={key:1,class:"state-container"},ee={key:2,class:"exercice-content"},te={class:"exercice-actions"},re={key:3,class:"state-container"},ae={__name:"ExerciceDetail",setup(m){const a=P(),l=L();U();const{statusMap:d,loadStatuses:h,updateExerciseStatus:S}=H(),b=a.params.exerciceId,r=v(null),u=v(!0),c=v(""),_=()=>{const n=r.value?.chapitre?{name:"Exercices",params:{chapitreId:String(r.value.chapitre)}}:{name:"Dashboard"};l.push(n)},x=async()=>{u.value=!0,c.value="";try{const n=await $(b);if(r.value=n?.data||n,!r.value){c.value="Exercice non trouv√©";return}await h()}catch{c.value="Impossible de charger l'exercice. Veuillez r√©essayer."}finally{u.value=!1}},E=async({exerciceId:n,status:s})=>{try{if(await S(n,s),s==="acquired"){const{useDailyObjectivesIntegration:e}=await A(async()=>{const{useDailyObjectivesIntegration:o}=await import("./useDailyObjectives-DFD_NK92.js");return{useDailyObjectivesIntegration:o}},__vite__mapDeps([0,1,2,3,4,5,6])),{onExerciseCompleted:t}=e();t({exerciceId:n,isSuccess:!0,status:"acquired"})}}catch{}};return R(x),(n,s)=>(p(),D(W,null,{default:k(()=>[i("section",X,[y(G,{text:"Retour aux exercices",customAction:_,position:"top-left"}),u.value?(p(),g("div",Y,s[0]||(s[0]=[i("div",{class:"loading-spinner"},null,-1),i("p",null,"Chargement de l'exercice...",-1)]))):c.value?(p(),g("div",Z,[s[1]||(s[1]=i("div",{class:"icon"},"‚ùå",-1)),s[2]||(s[2]=i("h3",null,"Erreur de chargement",-1)),i("p",null,O(c.value),1),i("button",{class:"btn-primary",onClick:x},"R√©essayer")])):r.value?(p(),g("div",ee,[i("div",te,[y(w,{type:"single",data:r.value,title:`Exercice_${r.value.id}_Enonce`,text:"üìÑ Exercice (PDF serveur)",useMathJax:!0,includeSolution:!1,class:"pdf-btn exercice-btn"},null,8,["data","title"]),y(w,{type:"single",data:r.value,title:`Exercice_${r.value.id}_Corrige`,text:"üìù Exercice + Corrig√© (PDF serveur)",useMathJax:!0,includeSolution:!0,class:"pdf-btn corrige-btn"},null,8,["data","title"])]),y(Q,{eid:r.value.id,titre:r.value.titre||r.value.nom,instruction:r.value.instruction||r.value.contenu||r.value.question,solution:r.value.solution||r.value.reponse_correcte||"",etapes:r.value.etapes||"",difficulty:r.value.difficulty||r.value.difficulte||"medium",current:V(d)[r.value.id]?.status,onStatusChanged:E},null,8,["eid","titre","instruction","solution","etapes","difficulty","current"])])):(p(),g("div",re,[s[3]||(s[3]=i("div",{class:"icon"},"üìù",-1)),s[4]||(s[4]=i("h3",null,"Exercice non trouv√©",-1)),s[5]||(s[5]=i("p",null,"L'exercice demand√© n'existe pas ou n'est plus disponible.",-1)),i("button",{class:"btn-primary",onClick:_},"Retour aux exercices")]))])]),_:1}))}},xe=C(ae,[["__scopeId","data-v-11764a8c"]]);export{xe as default};
