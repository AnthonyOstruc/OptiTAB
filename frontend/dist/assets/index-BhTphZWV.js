const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Home-Bwi2SJSw.js","assets/MainLayout-Dd3xEwz0.js","assets/vendor-CPU10QdV.js","assets/menuItems-sTa2MZDg.js","assets/matieres-BKndaZDR.js","assets/MainLayout-DL90Nqbk.css","assets/BaseCard-EilTDfhz.js","assets/BaseCard-BFEBIzVm.css","assets/ui-es3YBeq-.js","assets/pdf-OEFxGcL4.js","assets/mathlive-B5k0jhbN.js","assets/Home-BXA7CUkw.css","assets/Dashboard-DwM1naWj.js","assets/DashboardLayout-D1TcTAih.js","assets/DashboardLayout-BtLahMAQ.css","assets/curriculum-DPSaZDuo.js","assets/exercices-D4i9jcVH.js","assets/quiz-CRbLhkZQ.js","assets/useDailyObjectives-CeA3zzqF.js","assets/Dashboard-CCODqEgh.css","assets/ChildOverview-BWyNOYji.js","assets/ChildOverview-Ct9ZYVDo.css","assets/Account-BHPr-GJF.js","assets/niveaux-xkboOl0g.js","assets/Account-CgA5TqTV.css","assets/Pricing-CoVRRvkS.js","assets/Pricing-B0gC7E42.css","assets/Exercises-Bo1YbKHm.js","assets/themes-y5X3cFVH.js","assets/useSmartNavigation-CapyIuVL.js","assets/Exercises-WcHe1jvg.css","assets/OnlineCourses-DuWiVSAi.js","assets/OnlineCourses-WPMua6PN.css","assets/Quiz-CRWrzHY0.js","assets/Quiz-BaVQ_woE.css","assets/QuizNotions-CiC-aeDg.js","assets/ThemeNotionsView-DmEj73iv.js","assets/NotionCard-Cm_iWIJb.js","assets/NotionCard-3xgmImQY.css","assets/ThemeNotionsView-D9AlEkfP.css","assets/BackButton-CDufBbc2.js","assets/BackButton-C5yUIBdm.css","assets/QuizNotions-DdUBXDjX.css","assets/QuizChapitres-MY4xFZhb.js","assets/ChapitresListView-CAUiy5x3.js","assets/ChapitresListView-C2uEzUoL.css","assets/ChapterQuiz-Lccfq4GQ.js","assets/ChapterQuiz-DulUkX--.css","assets/CourseNotions-CMgUWmXi.js","assets/CourseNotions-eK-kCKK8.css","assets/CourseChapitres-C0d0y7Bv.js","assets/CourseChapitre-5gqMJbAw.js","assets/PDFDownloadButton-Cne_pttA.js","assets/PDFDownloadButton-D7sfzo-M.css","assets/scientificRenderer-BIHedVTI.js","assets/CourseChapitre-1As98nXp.css","assets/Cours-DoTouIJA.js","assets/Cours-BkIZ9rTK.css","assets/CoursDetail-CsRwYU2K.js","assets/CoursDetail-CZyP49zS.css","assets/Sheets-DdcwlPGV.js","assets/synthesis-Bxc-M4Zn.js","assets/Sheets-D4Zq-ef4.css","assets/About-DyxR1FM6.js","assets/About-BIGv8Rov.css","assets/CGV-BfjapDy7.js","assets/CGV-BgP3puIB.css","assets/CGU-Cm9wJvcX.js","assets/CGU-DdhkNJwG.css","assets/Confidentialite-BV1x7t8o.js","assets/Confidentialite-BBWG7fbl.css","assets/Conditions-tIcZiKZX.js","assets/Conditions-D7anzJ0L.css","assets/Notions-GiU36Iww.js","assets/notions-TUY5U38Z.js","assets/math-DsqdWQfm.js","assets/Notions-CFnzDeHu.css","assets/Themes-CTM993rO.js","assets/Themes-Cr3kAetO.css","assets/ThemeNotions-BtGJLGSw.js","assets/ThemeNotions-Bo2Ml055.css","assets/Chapitres-BOqtRZYY.js","assets/Chapitres-DMZqd22O.css","assets/ChapterExercises-DCTLe8uf.js","assets/ExerciceQCM-DPdUiY58.js","assets/ExerciceQCM-Bi28n1Dj.css","assets/ChapterExercises-BZ4hHnsf.css","assets/Tabs-DlI6u4ZP.css","assets/ExerciceDetail-BJGtUJJn.js","assets/ExerciceDetail-CYwV5da-.css","assets/Progress-CZ6TZUbv.js","assets/Progress-oXpKVhMa.css","assets/Calculator-B7QfTC3p.js","assets/calculator-CbtoceRh.js","assets/Calculator-Dy0zL-nw.css","assets/TestFiltrageStrict-DzrCIBLo.js","assets/TestFiltrageStrict-BeULsNWG.css","assets/AdminLayout-4O-2urnm.js","assets/AdminLayout-zRG-CH6Y.css","assets/AdminMatieres-CKHvjR-Q.js","assets/matiere-contextes-pncXluvE.js","assets/AdminActionsButtons-ClSGDHPQ.js","assets/AdminActionsButtons-Ccw6G07H.css","assets/AdminMatieres-BounX-DR.css","assets/AdminThemes-DS7fBtzf.js","assets/PaysNiveauxDisplay.vue_vue_type_style_index_0_scoped_821033d6_lang-l0sNRNKZ.js","assets/AdminThemes-DmoHKq9O.css","assets/AdminNotions-tHwU5h7K.js","assets/PaysNiveauxSelector.vue_vue_type_style_index_0_scoped_6652d9f9_lang-l0sNRNKZ.js","assets/AdminNotions-BRVcIwhA.css","assets/AdminChapitres-FhYI2xHj.js","assets/AdminChapitres-D90OGqFf.css","assets/AdminExercices-D6uwMQQY.js","assets/AdminExercices-Bpc5P7d5.css","assets/AdminExercicesPlus-D5_kBfE_.js","assets/AdminExercicesPlus-bUiW_IX6.css","assets/AdminCours-CQRO7l4W.js","assets/AdminCours-C7TDJ4kf.css","assets/AdminCoursPlus-BQJaOuw9.js","assets/AdminCoursPlus-p0gkJui6.css","assets/AdminSheets-CibWFYrr.js","assets/AdminSheets-BzsaFlZ6.css","assets/AdminQuiz-BVdDwNGp.js","assets/AdminQuiz-DTmX3DVu.css","assets/AdminQuizPlus-DOL7MhIS.js","assets/AdminQuizPlus-DTPGWjbX.css","assets/AdminNiveaux-J0N79_cP.js","assets/AdminNiveaux-BU2lQ2eA.css","assets/AdminPays-K6LHOZCT.js","assets/AdminPays-8Ot7-Z35.css","assets/NotFound-DAtgGU53.js","assets/NotFound-BRLCr2dc.css"])))=>i.map(i=>d[i]);
import{r as Ae,a as T,c as M,b as S,o as g,d as a,e as W,f as Z,g as U,t as D,h as q,i as qe,w as Le,n as Q,T as ze,j as pe,k as je,v as gt,l as _t,m as ot,F as ve,p as he,q as ge,u as j,s as yt,x as St,y as Ge,z as ne,A as be,B as Et,C as Ce,D as It,E as nt,G as at,H as bt,I as kt,J as Tt}from"./vendor-CPU10QdV.js";import{a as it}from"./ui-es3YBeq-.js";import{_ as k}from"./pdf-OEFxGcL4.js";import"./mathlive-B5k0jhbN.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function r(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=r(o);fetch(o.href,i)}})();const oe=Ae({}),fe=T([]);function $e(){return{modalStates:oe,activeModals:fe,openModal:(n,l={})=>{oe[n]={isOpen:!0,...l},fe.value.includes(n)||fe.value.push(n),document.body.style.overflow="hidden"},closeModal:n=>{oe[n]&&(oe[n].isOpen=!1);const l=fe.value.indexOf(n);l>-1&&fe.value.splice(l,1),fe.value.length===0&&(document.body.style.overflow="")},closeAllModals:()=>{Object.keys(oe).forEach(n=>{oe[n].isOpen=!1}),fe.value=[],document.body.style.overflow=""},isModalOpen:n=>oe[n]?.isOpen||!1,getModalState:n=>oe[n]||{isOpen:!1},updateModalOptions:(n,l)=>{oe[n]&&Object.assign(oe[n],l)}}}const ee={LOGIN:"login",REGISTER:"register",FORGOT_PASSWORD:"forgot-password",SIGNUP:"signup",CONFIRM_DELETE:"confirm-delete",SETTINGS:"settings",AUTO_NIVEAU:"auto-niveau"},$={required:e=>typeof e=="string"?e.trim().length>0||"Ce champ est requis":e!=null||"Ce champ est requis",email:e=>e?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)||"Format d'email invalide":!0,minLength:e=>t=>t?t.length>=e||`Minimum ${e} caractères requis`:!0,maxLength:e=>t=>t?t.length<=e||`Maximum ${e} caractères autorisés`:!0,password:e=>{if(!e)return!0;const t=/[A-Z]/.test(e),r=/[a-z]/.test(e),s=/\d/.test(e);return e.length>=8?t?r?s?!0:"Le mot de passe doit contenir au moins un chiffre":"Le mot de passe doit contenir au moins une minuscule":"Le mot de passe doit contenir au moins une majuscule":"Le mot de passe doit contenir au moins 8 caractères"},confirmPassword:e=>t=>t?e===t||"Les mots de passe ne correspondent pas":"Veuillez confirmer votre mot de passe"};function wt(e={},t={}){const r=Ae({...e}),s=Ae({}),o=Ae({}),i=T(!1),n=M(()=>Object.keys(s).length===0||Object.values(s).every(_=>!_)),l=M(()=>Object.values(s).some(_=>_)),u=(_,m)=>{const h=t[_];if(!h)return!0;for(const b of h){const R=b(m,void 0,r);if(R!==!0)return s[_]=R,!1}return delete s[_],!0},p=()=>{let _=!0;return Object.keys(t).forEach(m=>{u(m,r[m])||(_=!1)}),_};return{formData:r,errors:s,touched:o,isSubmitting:i,isValid:n,hasErrors:l,validateField:u,validateForm:p,setFieldValue:(_,m)=>{r[_]=m,o[_]&&u(_,m)},setFieldTouched:_=>{o[_]=!0,u(_,r[_])},resetForm:()=>{Object.keys(r).forEach(_=>{r[_]=e[_]||""}),Object.keys(s).forEach(_=>{delete s[_]}),Object.keys(o).forEach(_=>{delete o[_]}),i.value=!1},setErrors:_=>{Object.assign(s,_)},getFieldError:_=>s[_]||"",isFieldTouched:_=>o[_]||!1,handleSubmit:async _=>{if(!i.value){if(Object.keys(t).forEach(m=>{o[m]=!0}),!p())return!1;i.value=!0;try{return await _(r),!0}catch{return!1}finally{i.value=!1}}}}}const At={LOGIN:{fields:{email:{type:"email",label:"Email",placeholder:"votre@email.com",required:!0,autocomplete:"email",validation:[$.required,$.email]},password:{type:"password",label:"Mot de passe",placeholder:"Votre mot de passe",required:!0,autocomplete:"current-password",validation:[$.required,$.minLength(6)]},rememberMe:{type:"checkbox",label:"Se souvenir de moi",required:!1}},submitText:"Se connecter",socialText:"Continuer avec Google"},REGISTER:{fields:{firstName:{type:"text",label:"Prénom",placeholder:"Votre prénom",required:!0,autocomplete:"given-name",validation:[$.required,$.minLength(2)]},lastName:{type:"text",label:"Nom",placeholder:"Votre nom",required:!0,autocomplete:"family-name",validation:[$.required,$.minLength(2)]},email:{type:"email",label:"Email",placeholder:"votre@email.com",required:!0,autocomplete:"email",validation:[$.required,$.email]},password:{type:"password",label:"Mot de passe",placeholder:"Créez un mot de passe",required:!0,autocomplete:"new-password",validation:[$.required,$.password]},confirmPassword:{type:"password",label:"Confirmer le mot de passe",placeholder:"Confirmez votre mot de passe",required:!0,autocomplete:"new-password",validation:[$.required]},acceptTerms:{type:"checkbox",label:"J'accepte les conditions d'utilisation",required:!0,validation:[e=>e===!0||"Vous devez accepter les conditions d'utilisation"]},newsletter:{type:"checkbox",label:"Je souhaite recevoir les actualités et offres d'OptiTAB",required:!1}},submitText:"Créer mon compte",socialText:"Continuer avec Google"},FORGOT_PASSWORD:{fields:{email:{type:"email",label:"Email",placeholder:"votre@email.com",required:!0,autocomplete:"email",validation:[$.required,$.email]}},submitText:"Envoyer le lien de réinitialisation",socialText:"Continuer avec Google"}};function Xe(e){const t=At[e];if(!t)throw new Error(`Unknown form type: ${e}`);const r=Object.keys(t.fields).reduce((m,h)=>{const b=t.fields[h];return m[h]=b.type==="checkbox"?!1:"",m},{}),s=Object.keys(t.fields).reduce((m,h)=>{const b=t.fields[h];return b.validation&&(m[h]=b.validation),m},{});e==="REGISTER"&&s.confirmPassword.push((m,h,b)=>$.confirmPassword(b.password)(m));const{formData:o,errors:i,touched:n,isSubmitting:l,isValid:u,getFieldError:p,setFieldTouched:d,handleSubmit:v,resetForm:f}=wt(r,s);return{config:t,formData:o,errors:i,touched:n,isSubmitting:l,isValid:u,getFieldError:p,setFieldTouched:d,submitForm:async(m,h)=>await v(async R=>{try{return await m(R),!0}catch(x){return h?.(x),!1}}),resetForm:f,getFieldConfig:m=>t.fields[m]||null,getFieldNames:()=>Object.keys(t.fields),isFieldRequired:m=>t.fields[m]?.required||!1,getFieldType:m=>t.fields[m]?.type||"text"}}const X=(e,t)=>{const r=e.__vccOpts||e;for(const[s,o]of t)r[s]=o;return r},Mt={name:"CloseIcon"},Ct={class:"close-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"};function Ft(e,t,r,s,o,i){return g(),S("svg",Ct,t[0]||(t[0]=[a("line",{x1:"18",y1:"6",x2:"6",y2:"18"},null,-1),a("line",{x1:"6",y1:"6",x2:"18",y2:"18"},null,-1)]))}const Rt=X(Mt,[["render",Ft],["__scopeId","data-v-8853147e"]]),Lt={name:"Modal",components:{CloseIcon:Rt},props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:""},showHeader:{type:Boolean,default:!0},showCloseButton:{type:Boolean,default:!0},closeButtonLabel:{type:String,default:"Fermer"},closeOnOverlay:{type:Boolean,default:!0},canClose:{type:Boolean,default:!0},size:{type:String,default:"medium",validator:e=>["small","medium","large","full"].includes(e)},contentClass:{type:String,default:""}},emits:["close","overlay-click"],setup(e,{emit:t}){return{titleId:M(()=>e.title?`modal-title-${Date.now()}`:""),handleClose:()=>{t("close")},handleOverlayClick:()=>{e.closeOnOverlay&&e.canClose&&(t("overlay-click"),t("close"))}}}},xt={key:0,class:"modal-wrapper"},Ot=["aria-modal","aria-labelledby"],Dt={key:0,class:"modal-header"},Nt=["id"],Pt=["aria-label"],Vt={class:"modal-body"};function qt(e,t,r,s,o,i){const n=W("CloseIcon");return g(),Z(ze,{to:"body"},[r.isOpen?(g(),S("div",xt,[a("div",{class:"modal-overlay",onClick:t[0]||(t[0]=(...l)=>s.handleOverlayClick&&s.handleOverlayClick(...l)),role:"presentation"}),a("div",{class:Q(["modal-content",`modal-${r.size}`]),role:"dialog","aria-modal":r.isOpen,"aria-labelledby":s.titleId,onClick:t[2]||(t[2]=Le(()=>{},["stop"]))},[r.showHeader?(g(),S("div",Dt,[r.title?(g(),S("h2",{key:0,id:s.titleId,class:"modal-title"},D(r.title),9,Nt)):U("",!0),r.showCloseButton&&r.canClose?(g(),S("button",{key:1,class:"modal-close-btn",onClick:t[1]||(t[1]=(...l)=>s.handleClose&&s.handleClose(...l)),"aria-label":r.closeButtonLabel},[q(n)],8,Pt)):U("",!0)])):U("",!0),a("div",Vt,[qe(e.$slots,"default",{},void 0,!0)])],10,Ot)])):U("",!0)])}const ke=X(Lt,[["render",qt],["__scopeId","data-v-91224a14"]]),Ut={name:"FormInput",props:{modelValue:{type:[String,Number],default:""},type:{type:String,default:"text",validator:e=>["text","email","password","number","tel","url","date"].includes(e)},label:{type:String,default:""},placeholder:{type:String,default:""},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},autocomplete:{type:String,default:""},error:{type:String,default:""},helpText:{type:String,default:""}},emits:["update:modelValue","input","focus","blur","keydown"],setup(e,{emit:t}){const r=`input-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,s=M({get:()=>e.modelValue,set:p=>t("update:modelValue",p)}),o=M(()=>({"has-error":e.error,"is-disabled":e.disabled}));return{inputId:r,inputValue:s,inputClass:o,handleInput:p=>t("input",p),handleFocus:p=>t("focus",p),handleBlur:p=>t("blur",p),handleKeydown:p=>t("keydown",p)}}},Bt={class:"form-group"},zt=["for"],jt={key:0,class:"required-indicator"},Gt={class:"input-wrapper"},$t=["id","type","placeholder","required","disabled","autocomplete"],Xt={key:1,class:"form-error"},Ht={key:2,class:"form-help"};function Qt(e,t,r,s,o,i){return g(),S("div",Bt,[r.label?(g(),S("label",{key:0,for:s.inputId,class:"form-label"},[pe(D(r.label)+" ",1),r.required?(g(),S("span",jt,"*")):U("",!0)],8,zt)):U("",!0),a("div",Gt,[je(a("input",{id:s.inputId,"onUpdate:modelValue":t[0]||(t[0]=n=>s.inputValue=n),type:r.type,placeholder:r.placeholder,required:r.required,disabled:r.disabled,autocomplete:r.autocomplete,class:Q(["form-input",s.inputClass]),onInput:t[1]||(t[1]=(...n)=>s.handleInput&&s.handleInput(...n)),onFocus:t[2]||(t[2]=(...n)=>s.handleFocus&&s.handleFocus(...n)),onBlur:t[3]||(t[3]=(...n)=>s.handleBlur&&s.handleBlur(...n)),onKeydown:t[4]||(t[4]=(...n)=>s.handleKeydown&&s.handleKeydown(...n))},null,42,$t),[[gt,s.inputValue]])]),r.error?(g(),S("p",Xt,D(r.error),1)):U("",!0),r.helpText?(g(),S("p",Ht,D(r.helpText),1)):U("",!0)])}const Wt=X(Ut,[["render",Qt],["__scopeId","data-v-6cce9edd"]]),Kt={name:"FormField",components:{FormInput:Wt},props:{fieldName:{type:String,required:!0},fieldConfig:{type:Object,required:!0},modelValue:{type:[String,Number,Boolean],default:""},disabled:{type:Boolean,default:!1},getFieldError:{type:Function,required:!0}},emits:["update:modelValue","blur","input"],setup(e,{emit:t}){const r=M({get:()=>e.modelValue,set:l=>t("update:modelValue",l)}),s=M(()=>e.fieldConfig?["text","email","password","number","tel","url"].includes(e.fieldConfig.type):!1),o=M(()=>({"has-error":e.getFieldError(e.fieldName),"is-disabled":e.disabled}));return{fieldValue:r,isInputField:s,fieldClass:o,handleBlur:l=>{t("blur",{fieldName:e.fieldName,event:l})},handleInput:l=>{t("input",{fieldName:e.fieldName,event:l})}}}},Jt={key:1,class:"checkbox-field"},Yt={class:"checkbox-label"},Zt=["required","disabled"],er=["innerHTML"],tr={key:0,class:"form-error"},rr={key:2,class:"unsupported-field"},sr={class:"error-message"};function or(e,t,r,s,o,i){const n=W("FormInput");return r.fieldConfig?(g(),S("div",{key:0,class:Q(["form-field",s.fieldClass])},[s.isInputField?(g(),Z(n,{key:0,modelValue:s.fieldValue,"onUpdate:modelValue":t[0]||(t[0]=l=>s.fieldValue=l),type:r.fieldConfig.type,label:r.fieldConfig.label,placeholder:r.fieldConfig.placeholder,required:r.fieldConfig.required,disabled:r.disabled,autocomplete:r.fieldConfig.autocomplete,error:r.getFieldError(r.fieldName),"help-text":r.fieldConfig.helpText,onBlur:s.handleBlur,onInput:s.handleInput},null,8,["modelValue","type","label","placeholder","required","disabled","autocomplete","error","help-text","onBlur","onInput"])):r.fieldConfig.type==="checkbox"?(g(),S("div",Jt,[a("label",Yt,[je(a("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>s.fieldValue=l),type:"checkbox",class:"checkbox-input",required:r.fieldConfig.required,disabled:r.disabled},null,8,Zt),[[_t,s.fieldValue]]),a("span",{class:"checkbox-text",innerHTML:r.fieldConfig.label},null,8,er)]),r.getFieldError(r.fieldName)?(g(),S("p",tr,D(r.getFieldError(r.fieldName)),1)):U("",!0)])):(g(),S("div",rr,[a("p",sr,'Field type "'+D(r.fieldConfig.type)+'" is not supported',1)]))],2)):U("",!0)}const lt=X(Kt,[["render",or],["__scopeId","data-v-1ff0c9ba"]]),nr={name:"LoadingSpinner",props:{size:{type:String,default:"medium",validator:e=>["small","medium","large"].includes(e)},color:{type:String,default:"current"}},computed:{sizeClass(){return`spinner-${this.size}`},spinnerStyle(){return this.color==="current"?{}:{"--spinner-color":this.color}}}};function ar(e,t,r,s,o,i){return g(),S("div",{class:Q(["loading-spinner",i.sizeClass]),style:ot(i.spinnerStyle)},t[0]||(t[0]=[a("div",{class:"spinner-ring"},null,-1)]),6)}const ir=X(nr,[["render",ar],["__scopeId","data-v-f8c69cd1"]]),lr={name:"DynamicForm",components:{FormField:lt,LoadingSpinner:ir},props:{fieldNames:{type:Array,required:!0},getFieldConfig:{type:Function,required:!0},formData:{type:Object,required:!0},isSubmitting:{type:Boolean,default:!1},isValid:{type:Boolean,default:!0},getFieldError:{type:Function,required:!0},setFieldTouched:{type:Function,required:!0},submitText:{type:String,default:"Soumettre"}},emits:["submit","field-blur","field-input"],setup(e,{emit:t}){return{handleSubmit:()=>{t("submit")},handleFieldBlur:({fieldName:i,event:n})=>{e.setFieldTouched(i),t("field-blur",{fieldName:i,event:n})},handleFieldInput:({fieldName:i,event:n})=>{t("field-input",{fieldName:i,event:n})}}}},cr={class:"form-fields"},ur=["disabled"],dr={key:1};function mr(e,t,r,s,o,i){const n=W("FormField"),l=W("LoadingSpinner");return g(),S("form",{onSubmit:t[0]||(t[0]=Le((...u)=>s.handleSubmit&&s.handleSubmit(...u),["prevent"])),class:"dynamic-form"},[a("div",cr,[(g(!0),S(ve,null,he(r.fieldNames,u=>(g(),Z(n,{key:u,"field-name":u,"field-config":r.getFieldConfig(u),modelValue:r.formData[u],"onUpdate:modelValue":p=>r.formData[u]=p,disabled:r.isSubmitting,"get-field-error":r.getFieldError,onBlur:s.handleFieldBlur,onInput:s.handleFieldInput},null,8,["field-name","field-config","modelValue","onUpdate:modelValue","disabled","get-field-error","onBlur","onInput"]))),128))]),qe(e.$slots,"form-content",{},void 0,!0),a("button",{type:"submit",class:"form-submit-btn",disabled:r.isSubmitting||!r.isValid},[r.isSubmitting?(g(),Z(l,{key:0})):(g(),S("span",dr,D(r.submitText),1))],8,ur),qe(e.$slots,"form-actions",{},void 0,!0)],32)}const He=X(lr,[["render",mr],["__scopeId","data-v-6fbd3fc3"]]),fr="/icons/google.svg",pr="/icons/facebook.svg",ct=[{key:"google",label:"Continuer avec Google",icon:fr,btnClass:"google-btn",color:"#e5e7eb"},{key:"facebook",label:"Continuer avec Facebook",icon:pr,btnClass:"facebook-btn",color:"#1877f2"}];function Ue(e){if(e<=0)return{level:0,next_level_xp:10,xp_to_next:10};let t=0;for(;;){const o=(t+1)*(t+1)*10;if(e<o)break;t+=1}const r=(t+1)*(t+1)*10,s=r-e;return{level:t,next_level_xp:r,xp_to_next:s}}localStorage.removeItem("user");const re=ge("user",{state:()=>({id:null,firstName:"",lastName:"",email:"",telephone:"",date_naissance:"",niveau_pays:null,pays:null,role:"student",xp:0,level:0,xp_to_next:0,isAdmin:!1,isAuthenticated:!1,isLoading:!1}),actions:{setUser(e){this.id=e.id||e.user_id||null,this.firstName=e.first_name||"",this.lastName=e.last_name||"",this.email=e.email||"",this.telephone=e.telephone||"",this.date_naissance=e.date_naissance||"",this.niveau_pays=e.niveau_pays||null,this.pays=e.pays||null,this.role=e.role||"student";const t=Number(e.xp??0),r=Ue(t);this.xp=t,this.level=Number(r.level),this.xp_to_next=Number(r.xp_to_next);const s=["anthonytabet.c@gmail.com","admin@optitab.com"];this.isAdmin=e.is_staff||e.isAdmin||s.includes(e.email)||!1,this.isAuthenticated=!0,this.isLoading=!1},clearUser(){Ie.stopTokenMonitoring();const e=this.id;if(this.id=null,this.firstName="",this.lastName="",this.email="",this.telephone="",this.date_naissance="",this.niveau_pays=null,this.pays=null,this.role="student",this.xp=0,this.level=0,this.xp_to_next=0,this.isAdmin=!1,this.isAuthenticated=!1,this.isLoading=!1,e){const r=`configurationCompleted_${e}`;localStorage.removeItem(r)}["selectedMatieres","favoriteMatieresIds","activeMatiereId","selectedMatieresIds","access_token","refresh_token"].forEach(r=>localStorage.removeItem(r))},async fetchUser(){this.isLoading=!0;try{const e=localStorage.getItem("access_token"),t=localStorage.getItem("refresh_token"),r=await Ur(),s=r.data?.data||r.data,o=this.pays&&this.niveau_pays,i=s.pays&&s.niveau_pays;if(o&&!i&&this.id){const n=`configurationCompleted_${this.id}`;localStorage.removeItem(n),["selectedMatieres","favoriteMatieresIds","activeMatiereId","selectedMatieresIds"].forEach(u=>localStorage.removeItem(u))}this.setUser(s),setTimeout(()=>{Ie.startTokenMonitoring()},500)}catch(e){const t=e.response?.status,r=e.response?.data?.message||e.message;t===401?this.clearUser():t>=500?setTimeout(()=>{this.isAuthenticated||this.fetchUser()},5e3):this.clearUser()}finally{this.isLoading=!1}}}}),B={SELECTED_SUBJECT:"selected-subject",SELECTED_MATIERES:"selected-matieres-ids",FAVORITE_MATIERES:"favorite-matieres-ids",ACTIVE_MATIERE:"active-matiere-id"},Fe={MAX_SELECTED_MATIERES:10,MAX_FAVORITE_MATIERES:20},de={INVALID_ID:"ID de matière invalide",LIMIT_REACHED:"Limite atteinte"},ut={UNAUTHORIZED:401,NOT_FOUND:404},z=(e,t,r={})=>{const s={context:t,message:e.message,timestamp:new Date().toISOString(),...r};return e.response&&(e.response.status,ut.NOT_FOUND),s},dt=e=>{if(e==null)return!1;const t=Number(e);return!isNaN(t)&&t>0&&Number.isInteger(t)},Y=e=>dt(e)?Number(e):null,G=()=>!!localStorage.getItem("access_token"),J=(e,t)=>{try{return localStorage.setItem(e,JSON.stringify(t)),!0}catch{return!1}},Qe=(e,t,r=!0)=>{try{const s=localStorage.getItem(e);if(!s)return t;if(!r)return s;try{return JSON.parse(s)}catch{return s}}catch{return t}},Se=e=>Array.isArray(e)?e.filter(dt).map(Y):[],Ee=(e,t)=>e.response?.status===ut.UNAUTHORIZED,mt=(e,t)=>e<t,E=(e,t={},r="info")=>{const s={operation:e,timestamp:new Date().toISOString(),...t};switch(r){case"warn":break;case"error":break;default:}},vr=ge("subjects-favorites",()=>{const e=T([]),t=T(!1),r=T(null),s=M(()=>e.value.length),o=M(()=>mt(s.value,Fe.MAX_FAVORITE_MATIERES)),i=M(()=>f=>{const c=Y(f);return c!==null&&e.value.includes(c)}),n=async f=>{const c=Y(f);if(!c)return E("addFavoriteMatiere",{id:f,error:de.INVALID_ID},"warn"),!1;if(e.value.includes(c))return E("addFavoriteMatiere",{id:c,status:"already_favorite"}),!0;if(!o.value)return E("addFavoriteMatiere",{id:c,error:de.LIMIT_REACHED,currentCount:s.value,maxCount:Fe.MAX_FAVORITE_MATIERES},"warn"),!1;if(e.value.push(c),J(B.FAVORITE_MATIERES,e.value),E("addFavoriteMatiere",{id:c,status:"local_update",authenticated:G()}),!G())return!0;try{return t.value=!0,r.value=null,await xr(c),E("addFavoriteMatiere",{id:c,status:"backend_success"}),!0}catch(I){return Ee(I,"addFavoriteMatiere")?!0:(e.value=e.value.filter(w=>w!==c),J(B.FAVORITE_MATIERES,e.value),r.value=z(I,"addFavoriteMatiere",{matiereId:c}),!1)}finally{t.value=!1}},l=async f=>{const c=Y(f);if(!c)return E("removeFavoriteMatiere",{id:f,error:de.INVALID_ID},"warn"),!1;const I=e.value.indexOf(c);if(I===-1)return E("removeFavoriteMatiere",{id:c,status:"not_found"}),!0;if(e.value.splice(I,1),J(B.FAVORITE_MATIERES,e.value),E("removeFavoriteMatiere",{id:c,status:"local_update",authenticated:G()}),!G())return!0;try{return t.value=!0,r.value=null,await Or(c),E("removeFavoriteMatiere",{id:c,status:"backend_success"}),!0}catch(w){return Ee(w,"removeFavoriteMatiere")?!0:(e.value.splice(I,0,c),J(B.FAVORITE_MATIERES,e.value),r.value=z(w,"removeFavoriteMatiere",{matiereId:c}),!1)}finally{t.value=!1}};return{favoriteMatieresIds:e,isSyncing:t,lastSyncError:r,favoriteMatieresCount:s,canAddMoreFavorites:o,isFavoriteMatiere:i,addFavoriteMatiere:n,removeFavoriteMatiere:l,toggleFavoriteMatiere:async f=>{const c=Y(f);if(!c)return E("toggleFavoriteMatiere",{matiereId:f,error:de.INVALID_ID},"warn"),!1;try{return e.value.includes(c)?await l(c):await n(c)}catch(I){return r.value=z(I,"toggleFavoriteMatiere",{matiereId:c}),!1}},loadFavoriteMatieresIds:async()=>{try{const f=Qe(B.FAVORITE_MATIERES,[]),c=Se(f);e.value=c,E("loadFavoriteMatieresIds",{loadedCount:c.length,totalStored:f.length})}catch(f){r.value=z(f,"loadFavoriteMatieresIds"),e.value=[]}},clearFavorites:async()=>{try{const f=[...e.value];for(const c of f)await l(c);return E("clearFavorites",{clearedCount:f.length}),!0}catch(f){return r.value=z(f,"clearFavorites"),!1}},setFavoriteMatieresIds:f=>{const c=Se(f);e.value=c,J(B.FAVORITE_MATIERES,c),E("setFavoriteMatieresIds",{setCount:c.length,originalCount:f.length})}}}),hr=ge("subjects-selected",()=>{const e=T([]),t=T(!1),r=T(null),s=M(()=>e.value.length),o=M(()=>mt(s.value,Fe.MAX_SELECTED_MATIERES)),i=M(()=>f=>{const c=Y(f);return c!==null&&e.value.includes(c)}),n=async f=>{const c=Y(f);if(!c)return E("addMatiereId",{id:f,error:de.INVALID_ID},"warn"),!1;if(e.value.includes(c))return E("addMatiereId",{id:c,status:"already_selected"}),!0;if(!o.value)return E("addMatiereId",{id:c,error:de.LIMIT_REACHED,currentCount:s.value,maxCount:Fe.MAX_SELECTED_MATIERES},"warn"),!1;if(e.value.push(c),J(B.SELECTED_MATIERES,e.value),E("addMatiereId",{id:c,status:"local_update",authenticated:G()}),!G())return!0;try{return t.value=!0,r.value=null,await Dr(c),E("addMatiereId",{id:c,status:"backend_success"}),!0}catch(I){return Ee(I,"addMatiereId")?!0:(e.value=e.value.filter(w=>w!==c),J(B.SELECTED_MATIERES,e.value),r.value=z(I,"addMatiereId",{matiereId:c}),!1)}finally{t.value=!1}},l=async f=>{const c=Y(f);if(!c)return E("removeMatiereId",{id:f,error:de.INVALID_ID},"warn"),!1;const I=e.value.indexOf(c);if(I===-1)return E("removeMatiereId",{id:c,status:"not_found"}),!0;try{return e.value.splice(I,1),J(B.SELECTED_MATIERES,e.value),E("removeMatiereId",{id:c,status:"local_update",authenticated:G()}),G()&&(t.value=!0,r.value=null,await Nr(c),E("removeMatiereId",{id:c,status:"backend_success"})),!0}catch(w){return e.value.splice(I,0,c),J(B.SELECTED_MATIERES,e.value),r.value=z(w,"removeMatiereId",{matiereId:c}),!1}finally{t.value=!1}};return{selectedMatieresIds:e,isSyncing:t,lastSyncError:r,selectedMatieresCount:s,canAddMoreSelected:o,isSelectedMatiere:i,addMatiereId:n,removeMatiereId:l,loadSelectedMatieresIds:async()=>{try{const f=Qe(B.SELECTED_MATIERES,[]),c=Se(f);e.value=c,E("loadSelectedMatieresIds",{loadedCount:c.length,totalStored:f.length})}catch(f){r.value=z(f,"loadSelectedMatieresIds"),e.value=[]}},clearSelectedMatieres:async()=>{try{const f=[...e.value];for(const c of f)await l(c);return E("clearSelectedMatieres",{clearedCount:f.length}),!0}catch(f){return r.value=z(f,"clearSelectedMatieres"),!1}},setSelectedMatieresIds:f=>{const c=Se(f);e.value=c,J(B.SELECTED_MATIERES,c),E("setSelectedMatieresIds",{setCount:c.length,originalCount:f.length})},addMultipleMatieres:async f=>{try{const c=Se(f),w=(await Promise.all(c.map(_=>n(_)))).filter(Boolean).length,A=c.length;return E("addMultipleMatieres",{successCount:w,totalCount:A,successRate:`${(w/A*100).toFixed(1)}%`}),w===A}catch(c){return r.value=z(c,"addMultipleMatieres",{ids:f}),!1}}}}),gr=ge("subjects-active",()=>{const e=T(null),t=T(!1),r=T(null),s=M(()=>d=>{const v=Y(d);return v!==null&&e.value===v}),o=M(()=>e.value!==null),i=async d=>{const v=Y(d);if(!v)return E("setActiveMatiere",{id:d,error:de.INVALID_ID},"warn"),!1;if(e.value===v)return E("setActiveMatiere",{id:v,status:"already_active"}),!0;try{const f=e.value;return e.value=v,J(B.ACTIVE_MATIERE,v),E("setActiveMatiere",{id:v,previousId:f,status:"local_update",authenticated:G()}),G()&&(t.value=!0,r.value=null,await Pr(v),E("setActiveMatiere",{id:v,status:"backend_success"})),!0}catch(f){return e.value=previousId,previousId?J(B.ACTIVE_MATIERE,previousId):localStorage.removeItem(B.ACTIVE_MATIERE),r.value=z(f,"setActiveMatiere",{matiereId:v}),!1}finally{t.value=!1}};return{activeMatiereId:e,isSyncing:t,lastSyncError:r,isActiveMatiere:s,hasActiveMatiere:o,setActiveMatiere:i,clearActiveMatiere:async()=>{try{const d=e.value;return e.value=null,localStorage.removeItem(B.ACTIVE_MATIERE),E("clearActiveMatiere",{previousId:d,status:"cleared"}),!0}catch(d){return r.value=z(d,"clearActiveMatiere"),!1}},loadActiveMatiereId:async()=>{try{const d=Qe(B.ACTIVE_MATIERE,null),v=d!==null?Y(d):null;e.value=v,E("loadActiveMatiereId",{loadedId:v,storedValue:d})}catch(d){r.value=z(d,"loadActiveMatiereId"),e.value=null}},getOrSetSmartActiveMatiere:async(d=[])=>{try{if(e.value)return e.value;if(d.length>0){const v=d[0];if(await i(v))return v}return E("getOrSetSmartActiveMatiere",{status:"no_matiere_available",selectedCount:d.length}),null}catch(v){return r.value=z(v,"getOrSetSmartActiveMatiere"),null}},setActiveMatiereId:d=>{const v=Y(d);e.value=v,v?J(B.ACTIVE_MATIERE,v):localStorage.removeItem(B.ACTIVE_MATIERE),E("setActiveMatiereId",{id:v,status:"direct_set"})}}}),_r=ge("subjects-sync",()=>{const e=T(!1),t=T(null),r=T(null),s=async p=>{if(!G())return E("loadPreferencesFromServer",{status:"user_not_authenticated",message:"Utilisateur non connecté, chargement depuis localStorage uniquement"}),!1;try{e.value=!0,t.value=null,E("loadPreferencesFromServer",{status:"starting",authenticated:!0});const d=await qr();return d?(p.selectedStore&&p.selectedStore.setSelectedMatieresIds(d.selectedIds||[]),p.favoritesStore&&p.favoritesStore.setFavoriteMatieresIds(d.favoriteIds||[]),p.activeStore&&p.activeStore.setActiveMatiereId(d.activeId||null),r.value=new Date().toISOString(),E("loadPreferencesFromServer",{status:"success",selectedCount:d.selectedIds?.length||0,favoritesCount:d.favoriteIds?.length||0,activeId:d.activeId}),!0):(E("loadPreferencesFromServer",{status:"no_data",message:"Aucune donnée reçue du backend"}),!1)}catch(d){return Ee(d,"loadPreferencesFromServer")||(t.value=z(d,"loadPreferencesFromServer")),!1}finally{e.value=!1}},o=async()=>{if(!G())return E("syncWithBackend",{status:"user_not_authenticated",message:"Synchronisation ignorée (utilisateur non connecté)"}),!0;try{e.value=!0,t.value=null,E("syncWithBackend",{status:"starting",authenticated:!0});const p=await Vr();return p&&(r.value=new Date().toISOString(),E("syncWithBackend",{status:"success",timestamp:r.value})),p}catch(p){return Ee(p,"syncWithBackend")?!0:(t.value=z(p,"syncWithBackend"),!1)}finally{e.value=!1}};return{isSyncing:e,lastSyncError:t,lastSyncTimestamp:r,loadPreferencesFromServer:s,syncWithBackend:o,initializeAfterLogin:async p=>{if(!G())return E("initializeAfterLogin",{status:"user_not_authenticated",message:"initializeAfterLogin appelé sans authentification"},"warn"),!1;try{return E("initializeAfterLogin",{status:"starting",message:"Initialisation après connexion..."}),await s(p)||(p.selectedStore?.selectedMatieresCount>0||p.favoritesStore?.favoriteMatieresCount>0)&&(E("initializeAfterLogin",{status:"syncing_local_to_backend",message:"Synchronisation des données locales vers le backend..."}),await o()),E("initializeAfterLogin",{status:"completed",message:"Initialisation après connexion terminée"}),!0}catch(d){return E("initializeAfterLogin",{status:"error",error:d.message},"error"),!1}},getSyncStatus:()=>({isSyncing:e.value,lastSyncError:t.value,lastSyncTimestamp:r.value,isAuthenticated:G(),canSync:G()&&!e.value}),clearSyncErrors:()=>{t.value=null,E("clearSyncErrors",{status:"errors_cleared"})},forceSync:async p=>{try{E("forceSync",{status:"starting",message:"Synchronisation forcée..."});const d=await s(p),v=await o(),f=d||v;return E("forceSync",{status:f?"success":"partial_failure",loadSuccess:d,syncSuccess:v}),f}catch(d){return t.value=z(d,"forceSync"),!1}}}}),xe=ge("subjects",()=>{const e=vr(),t=hr(),r=gr(),s=_r(),o=M(()=>j(e.favoriteMatieresIds)),i=M(()=>j(t.selectedMatieresIds)),n=M(()=>j(r.activeMatiereId)),l=M(()=>j(e.favoriteMatieresCount)),u=M(()=>j(t.selectedMatieresCount)),p=M(()=>e.isFavoriteMatiere),d=M(()=>t.isSelectedMatiere),v=M(()=>r.isActiveMatiere),f=M(()=>j(r.hasActiveMatiere)),c=M(()=>j(e.canAddMoreFavorites)),I=M(()=>j(t.canAddMoreSelected)),w=M(()=>j(e.isSyncing)||j(t.isSyncing)||j(r.isSyncing)||j(s.isSyncing)),A=M(()=>j(e.lastSyncError)||j(t.lastSyncError)||j(r.lastSyncError)||j(s.lastSyncError)),_=async N=>await e.addFavoriteMatiere(N),m=async N=>await e.removeFavoriteMatiere(N),h=async N=>await e.toggleFavoriteMatiere(N),b=async N=>await t.addMatiereId(N),R=async N=>await t.removeMatiereId(N),x=async N=>await t.addMultipleMatieres(N),H=async N=>await r.setActiveMatiere(N),ae=async()=>await r.clearActiveMatiere(),C=async(N=[])=>await r.getOrSetSmartActiveMatiere(N),y=async()=>{const N={selectedStore:t,favoritesStore:e,activeStore:r};return await s.loadPreferencesFromServer(N)};return{favoriteMatieresIds:o,selectedMatieresIds:i,activeMatiereId:n,favoriteMatieresCount:l,selectedMatieresCount:u,isFavoriteMatiere:p,isSelectedMatiere:d,isActiveMatiere:v,hasActiveMatiere:f,canAddMoreFavorites:c,canAddMoreSelected:I,isSyncing:w,lastSyncError:A,addFavoriteMatiere:_,removeFavoriteMatiere:m,toggleFavoriteMatiere:h,addMatiereId:b,removeMatiereId:R,addMultipleMatieres:x,setActiveMatiere:H,clearActiveMatiere:ae,getOrSetSmartActiveMatiere:C,loadPreferencesFromServer:y,syncWithBackend:async()=>{const N={selectedStore:t,favoritesStore:e,activeStore:r};return await s.syncWithBackend(N)},initializeAfterLogin:async()=>{const N={selectedStore:t,favoritesStore:e,activeStore:r};return await s.initializeAfterLogin(N)},initialize:async()=>{try{E("initialize",{status:"starting"}),await Promise.all([e.loadFavoriteMatieresIds(),t.loadSelectedMatieresIds(),r.loadActiveMatiereId()]),G()&&await y(),E("initialize",{status:"success",favoritesCount:l.value,selectedCount:u.value,activeId:n.value})}catch(N){throw z(N,"initialize"),N}},clearAll:async()=>{try{await Promise.all([e.clearFavorites(),t.clearSelectedMatieres(),r.clearActiveMatiere()]),E("clearAll",{status:"success"})}catch(N){throw z(N,"clearAll"),N}},getSyncStatus:()=>s.getSyncStatus(),clearSyncErrors:()=>{e.lastSyncError=null,t.lastSyncError=null,r.lastSyncError=null,s.clearSyncErrors()},getStats:()=>({hasActiveMatiere:f.value,activeMatiereId:n.value,favoritesCount:l.value,selectedCount:u.value,canAddMoreFavorites:c.value,canAddMoreSelected:I.value,isSyncing:w.value,lastSyncError:A.value,favoriteMatieresIds:o.value,selectedMatieresIds:i.value,isAuthenticated:G(),timestamp:new Date().toISOString()}),loadFavoriteMatieresIds:async()=>await e.loadFavoriteMatieresIds(),loadSelectedMatieresIds:async()=>await t.loadSelectedMatieresIds(),loadActiveMatiereId:async()=>await r.loadActiveMatiereId(),stores:{favorites:e,selected:t,active:r,sync:s}}}),yr=["Exercises","Quiz","Sheets","OnlineCourses"],Sr={Exercises:e=>({name:"Notions",params:{matiereId:String(e)}}),Quiz:e=>({name:"QuizNotions",params:{matiereId:String(e)}}),Sheets:e=>({name:"Sheets",query:{matiereId:String(e)}}),OnlineCourses:e=>({name:"CourseNotions",params:{matiereId:String(e)}})},Te=(e,t,r)=>{try{const s=xe();if(!yr.includes(e.name)){Re(e,s),r();return}const o=e.params.matiereId||e.query.matiereId;if(o&&ft(o)){Re(e,s),r();return}const i=Er(s);if(i){const n=Sr[e.name];if(n){const l=n(i);r(l);return}}r()}catch{r()}},Re=(e,t)=>{try{const r=e.params.matiereId||e.query.matiereId;if(ft(r)){const s=Number(r);t.selectedMatieresIds.includes(s)||t.addMatiereId(s),t.setActiveMatiere(s)}}catch{}},Er=e=>{try{if(e.activeMatiereId)return e.activeMatiereId;if(e.selectedMatieresIds.length>0){const t=e.selectedMatieresIds[0];return e.setActiveMatiere(t),t}return null}catch{return null}},ft=e=>e!=null&&!isNaN(Number(e))&&Number(e)>0,ye=(e,t,r)=>{try{const s=xe();e.name==="Notions"&&e.params.matiereId&&Re(e,s),r()}catch{r()}},De=(e,t,r)=>{try{const s=xe();["QuizNotions","QuizChapitres","ChapterQuiz"].includes(e.name)&&e.params.matiereId&&Re(e,s),r()}catch{r()}};function Ir(e,t,r){const s=re();if(!s.isAuthenticated)return r();if(!s.niveau_pays&&e.name!=="Dashboard")return r({name:"Dashboard"});r()}const br=["Cours","Exercises","Quiz","Sheets","Themes","Notions","Chapitres","ChapterExercises","ChapterQuiz","ThemeNotions","CourseChapitres","CourseChapitre","CourseNotions","QuizChapitres","QuizNotions","Progress","Calculator"];function kr(e){return br.includes(e)}const Tr=[{path:"/",name:"Home",component:()=>k(()=>import("./Home-Bwi2SJSw.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))},{path:"/dashboard",name:"Dashboard",component:()=>k(()=>import("./Dashboard-DwM1naWj.js"),__vite__mapDeps([12,13,2,3,4,8,14,15,9,16,17,18,10,19]))},{path:"/child/:childId",name:"ChildOverview",component:()=>k(()=>import("./ChildOverview-BWyNOYji.js"),__vite__mapDeps([20,2,8,9,10,21])),meta:{requiresAuth:!0}},{path:"/account",name:"Account",component:()=>k(()=>import("./Account-BHPr-GJF.js"),__vite__mapDeps([22,2,13,3,4,8,14,23,9,10,24])),meta:{requiresAuth:!0}},{path:"/pricing",name:"Pricing",component:()=>k(()=>import("./Pricing-CoVRRvkS.js"),__vite__mapDeps([25,13,2,3,4,8,14,9,10,26])),meta:{requiresAuth:!0}},{path:"/exercises",name:"Exercises",component:()=>k(()=>import("./Exercises-Bo1YbKHm.js"),__vite__mapDeps([27,13,2,3,4,8,14,6,7,28,29,9,10,30])),meta:{requiresAuth:!0},beforeEnter:Te},{path:"/online-courses",name:"OnlineCourses",component:()=>k(()=>import("./OnlineCourses-DuWiVSAi.js"),__vite__mapDeps([31,13,2,3,4,8,14,6,7,29,9,10,32])),meta:{requiresAuth:!0},beforeEnter:Te},{path:"/quiz",name:"Quiz",component:()=>k(()=>import("./Quiz-CRWrzHY0.js"),__vite__mapDeps([33,13,2,3,4,8,14,6,7,29,9,10,34])),meta:{requiresAuth:!0},beforeEnter:Te},{path:"/quiz/:matiereId",name:"QuizNotions",component:()=>k(()=>import("./QuizNotions-CiC-aeDg.js"),__vite__mapDeps([35,2,13,3,4,8,14,36,28,37,38,39,40,41,9,10,42])),meta:{requiresAuth:!0},beforeEnter:De},{path:"/quiz-chapitres/:notionId",name:"QuizChapitres",component:()=>k(()=>import("./QuizChapitres-MY4xFZhb.js"),__vite__mapDeps([43,2,13,3,4,8,14,44,40,41,45,15,9,10])),meta:{requiresAuth:!0},beforeEnter:De},{path:"/quiz-exercices/:chapitreId",name:"ChapterQuiz",component:()=>k(()=>import("./ChapterQuiz-Lccfq4GQ.js"),__vite__mapDeps([46,2,13,3,4,8,14,17,15,9,18,10,40,41,47])),meta:{requiresAuth:!0},beforeEnter:De},{path:"/course-notions/:matiereId",name:"CourseNotions",component:()=>k(()=>import("./CourseNotions-CMgUWmXi.js"),__vite__mapDeps([48,2,13,3,4,8,14,40,41,36,28,37,38,39,9,10,49])),meta:{requiresAuth:!0}},{path:"/course-chapitres/:notionId",name:"CourseChapitres",component:()=>k(()=>import("./CourseChapitres-C0d0y7Bv.js"),__vite__mapDeps([50,2,13,3,4,8,14,44,40,41,45,15,9,10])),meta:{requiresAuth:!0}},{path:"/course/:chapitreId",name:"CourseChapitre",component:()=>k(()=>import("./CourseChapitre-5gqMJbAw.js"),__vite__mapDeps([51,2,13,3,4,8,14,40,41,52,9,53,15,54,10,55])),meta:{requiresAuth:!0}},{path:"/cours/:matiereId/:notionId/:chapitreId",name:"Cours",component:()=>k(()=>import("./Cours-DoTouIJA.js"),__vite__mapDeps([56,2,13,3,4,8,14,40,41,54,9,10,57])),meta:{requiresAuth:!0}},{path:"/cours/:matiereId/:notionId/:chapitreId/:coursId",name:"CoursDetail",component:()=>k(()=>import("./CoursDetail-CsRwYU2K.js"),__vite__mapDeps([58,2,13,3,4,8,14,40,41,54,9,10,59])),meta:{requiresAuth:!0}},{path:"/sheets",name:"Sheets",component:()=>k(()=>import("./Sheets-DdcwlPGV.js"),__vite__mapDeps([60,2,13,3,4,8,14,61,29,9,10,62])),meta:{requiresAuth:!0},beforeEnter:Te},{path:"/about",name:"About",component:()=>k(()=>import("./About-DyxR1FM6.js"),__vite__mapDeps([63,1,2,3,4,5,8,9,10,64]))},{path:"/cgv",name:"CGV",component:()=>k(()=>import("./CGV-BfjapDy7.js"),__vite__mapDeps([65,1,2,3,4,5,8,9,10,66]))},{path:"/cgu",name:"CGU",component:()=>k(()=>import("./CGU-Cm9wJvcX.js"),__vite__mapDeps([67,1,2,3,4,5,8,9,10,68]))},{path:"/confidentialite",name:"Confidentialite",component:()=>k(()=>import("./Confidentialite-BV1x7t8o.js"),__vite__mapDeps([69,1,2,3,4,5,8,9,10,70]))},{path:"/conditions",name:"Conditions",component:()=>k(()=>import("./Conditions-tIcZiKZX.js"),__vite__mapDeps([71,1,2,3,4,5,8,9,10,72]))},{path:"/notions/:matiereId",name:"Notions",component:()=>k(()=>import("./Notions-GiU36Iww.js"),__vite__mapDeps([73,2,13,3,4,8,14,74,28,75,40,41,9,10,76,38])),meta:{requiresAuth:!0},beforeEnter:ye},{path:"/themes/:matiereId",name:"Themes",component:()=>k(()=>import("./Themes-CTM993rO.js"),__vite__mapDeps([77,2,13,3,4,8,14,36,28,37,38,39,40,41,9,10,78])),meta:{requiresAuth:!0},beforeEnter:ye},{path:"/theme-notions/:themeId",name:"ThemeNotions",component:()=>k(()=>import("./ThemeNotions-BtGJLGSw.js"),__vite__mapDeps([79,2,13,3,4,8,14,15,9,37,38,40,41,10,80])),meta:{requiresAuth:!0},beforeEnter:ye},{path:"/chapitres/:notionId",name:"Chapitres",component:()=>k(()=>import("./Chapitres-BOqtRZYY.js"),__vite__mapDeps([81,2,13,3,4,8,14,15,9,44,40,41,45,10,82])),meta:{requiresAuth:!0},beforeEnter:ye},{path:"/exercices/:chapitreId",name:"Exercices",component:()=>k(()=>import("./ChapterExercises-DCTLe8uf.js"),__vite__mapDeps([83,9,2,13,3,4,8,14,15,16,84,85,40,41,52,53,10,86,87])),meta:{requiresAuth:!0},beforeEnter:ye},{path:"/exercice/:exerciceId",name:"ExerciceDetail",component:()=>k(()=>import("./ExerciceDetail-BJGtUJJn.js"),__vite__mapDeps([88,9,2,15,16,13,3,4,8,14,84,85,40,41,52,53,10,89])),meta:{requiresAuth:!0}},{path:"/progress",name:"Progress",component:()=>k(()=>import("./Progress-CZ6TZUbv.js"),__vite__mapDeps([90,13,2,3,4,8,14,15,9,16,10,91,87])),meta:{requiresAuth:!0}},{path:"/calculator",name:"Calculator",component:()=>k(()=>import("./Calculator-B7QfTC3p.js"),__vite__mapDeps([92,2,13,3,4,8,14,75,93,9,10,94]))},{path:"/test-filtrage-strict",name:"TestFiltrageStrict",component:()=>k(()=>import("./TestFiltrageStrict-DzrCIBLo.js"),__vite__mapDeps([95,4,2,8,9,10,96]))},{path:"/admin",component:()=>k(()=>import("./AdminLayout-4O-2urnm.js"),__vite__mapDeps([97,2,13,3,4,8,14,9,10,98])),meta:{requiresAdmin:!0},children:[{path:"matieres",name:"AdminMatieres",component:()=>k(()=>import("./AdminMatieres-CKHvjR-Q.js"),__vite__mapDeps([99,2,4,100,101,102,8,9,10,103]))},{path:"themes",name:"AdminThemes",component:()=>k(()=>import("./AdminThemes-DS7fBtzf.js"),__vite__mapDeps([104,2,28,100,105,101,102,8,9,10,106]))},{path:"notions",name:"AdminNotions",component:()=>k(()=>import("./AdminNotions-tHwU5h7K.js"),__vite__mapDeps([107,2,74,28,108,105,101,102,8,9,10,109]))},{path:"chapitres",name:"AdminChapitres",component:()=>k(()=>import("./AdminChapitres-FhYI2xHj.js"),__vite__mapDeps([110,2,15,9,101,102,8,10,111]))},{path:"exercices",name:"AdminExercices",component:()=>k(()=>import("./AdminExercices-D6uwMQQY.js"),__vite__mapDeps([112,2,15,9,108,105,101,102,84,16,85,8,10,113]))},{path:"exercices-plus",name:"AdminExercicesPlus",component:()=>k(()=>import("./AdminExercicesPlus-D5_kBfE_.js"),__vite__mapDeps([114,2,15,9,16,84,85,8,10,115]))},{path:"cours",name:"AdminCours",component:()=>k(()=>import("./AdminCours-CQRO7l4W.js"),__vite__mapDeps([116,2,54,15,9,101,102,8,10,117]))},{path:"cours-plus",name:"AdminCoursPlus",component:()=>k(()=>import("./AdminCoursPlus-BQJaOuw9.js"),__vite__mapDeps([118,2,15,9,54,8,10,119]))},{path:"sheets",name:"AdminSheets",component:()=>k(()=>import("./AdminSheets-CibWFYrr.js"),__vite__mapDeps([120,2,61,15,9,4,8,10,121]))},{path:"quiz",name:"AdminQuiz",component:()=>k(()=>import("./AdminQuiz-BVdDwNGp.js"),__vite__mapDeps([122,2,17,15,9,101,102,8,10,123]))},{path:"quiz-plus",name:"AdminQuizPlus",component:()=>k(()=>import("./AdminQuizPlus-DOL7MhIS.js"),__vite__mapDeps([124,2,15,9,17,8,10,125]))},{path:"niveaux",name:"AdminNiveaux",component:()=>k(()=>import("./AdminNiveaux-J0N79_cP.js"),__vite__mapDeps([126,2,101,102,23,8,9,10,127]))},{path:"pays",name:"AdminPays",component:()=>k(()=>import("./AdminPays-K6LHOZCT.js"),__vite__mapDeps([128,2,8,9,10,129]))},{path:"",redirect:{name:"AdminMatieres"}}]},{path:"/:pathMatch(.*)*",name:"NotFound",component:()=>k(()=>import("./NotFound-DAtgGU53.js"),__vite__mapDeps([130,2,8,9,10,131]))}],We=yt({history:St(),routes:Tr,scrollBehavior(){return{top:0}}});We.beforeEach(async(e,t,r)=>{const s=localStorage.getItem("access_token");localStorage.getItem("refresh_token");const o=re();let i=o.isAuthenticated,n=o.isAdmin;const l=u=>{if(!u)return!0;try{const p=JSON.parse(atob(u.split(".")[1])),d=Date.now()/1e3;return p.exp<d}catch{return!0}};if(s&&l(s)&&(localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),o.clearUser(),i=!1,n=!1),s&&!l(s)&&!i)try{await o.fetchUser(),i=o.isAuthenticated,n=o.isAdmin}catch{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),o.clearUser(),i=!1,n=!1}(e.meta.requiresAuth||e.name==="Dashboard")&&!i?r({name:"Home"}):e.meta.requiresAdmin&&(!i||!n)?r({name:"Home"}):i&&(e.name==="Home"||e.path==="/")?r({name:"Dashboard"}):i&&kr(e.name)?Ir(e,t,r):r()});function wr(){let e="https://optitab-backend.onrender.com".trim();return e?(/^https:\/\/(127\.0\.0\.1|localhost)(:\d+)?/i.test(e)&&(e=e.replace(/^https:/i,"http:")),e.replace(/\/+$/,"")):typeof window<"u"?window.location.origin:""}const te={BASE_URL:wr(),REFRESH_ENDPOINT:"/api/users/token/refresh/",REQUEST_TIMEOUT:1e4,REFRESH_TIMEOUT:5e3,MAX_RETRIES:3,RETRY_DELAY:1e3,LOGGING:{ENABLED:!1,LEVEL:"error",SENSITIVE_FIELDS:["password","token","refresh","access"]},DEFAULT_HEADERS:{"Content-Type":"application/json",Accept:"application/json"}};class L{static isDevelopment(){return!1}static isProduction(){return!0}static log(t,r,s={}){if(!this.isDevelopment())return;const o=this.sanitizeData(s),n={timestamp:new Date().toISOString(),level:t,message:r,data:o,source:"api-client"};switch(t){case"error":break;case"warn":break;case"info":break;default:}}static sanitizeData(t){if(!t||typeof t!="object")return t;const r={...t},s=te.LOGGING.SENSITIVE_FIELDS,o=i=>{for(const n in i)if(i.hasOwnProperty(n)){const l=n.toLowerCase();s.some(u=>l.includes(u))?i[n]="[MASKED]":typeof i[n]=="object"&&i[n]!==null&&o(i[n])}};return o(r),r}static error(t,r=null){if(this.isProduction())return;const s={message:r?.message,status:r?.response?.status,statusText:r?.response?.statusText,url:r?.config?.url,method:r?.config?.method};this.isDevelopment()&&(s.stack=r?.stack),this.log("error",t,s)}static warn(t,r={}){this.log("warn",t,r)}static info(t,r={}){this.log("info",t,r)}static debug(t,r={}){this.isDevelopment()&&this.log("debug",t,r)}static isLoggingEnabled(){return te.LOGGING.ENABLED}static secureLog(t,r,s={}){if(!this.isLoggingEnabled())return;const o=["debug","info","warn","error"],i=o.indexOf(t),n=o.indexOf(te.LOGGING.LEVEL);i>=n&&this.log(t,r,s)}}class Ar{constructor(){this.isRefreshing=!1,this.refreshSubscribers=[],this.refreshPromise=null}getAccessToken(){return localStorage.getItem("access_token")}getRefreshToken(){return localStorage.getItem("refresh_token")}setTokens(t,r=null){t&&localStorage.setItem("access_token",t),r&&localStorage.setItem("refresh_token",r)}clearTokens(){localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}isTokenExpired(t){if(!t)return!0;try{const r=JSON.parse(atob(t.split(".")[1])),s=Date.now()/1e3;return r.exp<s}catch(r){return L.warn("Impossible de décoder le token JWT",{error:r.message}),!0}}async refreshAccessToken(){if(this.isRefreshing)return this.refreshPromise;this.isRefreshing=!0,this.refreshPromise=this._performRefresh();try{return await this.refreshPromise}finally{this.isRefreshing=!1,this.refreshPromise=null}}async _performRefresh(t=3){const r=this.getRefreshToken();if(!r)throw new Error("Aucun token de rafraîchissement disponible");let s;for(let o=0;o<=t;o++)try{L.secureLog("info",`Tentative de rafraîchissement du token (essai ${o+1}/${t+1})`);const i=await it.post(`${te.BASE_URL}${te.REFRESH_ENDPOINT}`,{refresh:r},{timeout:te.REFRESH_TIMEOUT,headers:{"Content-Type":"application/json"}}),{access:n,refresh:l}=i.data;return this.setTokens(n,l),L.secureLog("info","Token rafraîchi avec succès"),n}catch(i){if(s=i,L.error(`Échec du rafraîchissement du token (essai ${o+1})`,i),i.response?.status>=400&&i.response?.status<500&&i.code!=="ECONNABORTED")break;if(o<t){const n=Math.min(1e3*Math.pow(2,o),1e4);L.secureLog("info",`Nouvelle tentative dans ${n}ms`),await this._sleep(n)}}throw this.clearTokens(),s}_sleep(t){return new Promise(r=>setTimeout(r,t))}onRefreshed(t){this.refreshSubscribers.forEach(r=>r(t)),this.refreshSubscribers=[]}addRefreshSubscriber(t){this.refreshSubscribers.push(t)}shouldRefreshToken(t,r=5){if(!t)return!1;try{const s=JSON.parse(atob(t.split(".")[1])),o=Date.now()/1e3,i=r*60;return s.exp-o<=i}catch(s){return L.warn("Impossible de vérifier l'expiration du token",{error:s.message}),!1}}async proactiveRefresh(){const t=this.getAccessToken(),r=this.getRefreshToken();if(!t||!r)return!1;if(this.shouldRefreshToken(t,5)){L.secureLog("info","Rafraîchissement proactif du token");try{return await this.refreshAccessToken(),!0}catch(s){return L.error("Échec du rafraîchissement proactif",s),!1}}return!1}}class pt{static async retryRequest(t,r=te.MAX_RETRIES){let s;for(let o=0;o<=r;o++)try{return await t()}catch(i){if(s=i,this.shouldNotRetry(i))throw i;if(o<r){const n=this.calculateDelay(o);L.secureLog("warn",`Tentative ${o+1} échouée, nouvelle tentative dans ${n}ms`,{error:i.message,status:i.response?.status}),await this.sleep(n)}}throw s}static shouldNotRetry(t){const r=t.response?.status;return r>=400&&r<500&&r!==429?!0:(t.code==="ECONNABORTED",!1)}static calculateDelay(t){return Math.min(te.RETRY_DELAY*Math.pow(2,t),1e4)}static sleep(t){return new Promise(r=>setTimeout(r,t))}}class Be{static logout(t="Session expirée"){L.secureLog("info","Déconnexion utilisateur",{reason:t}),V.clearTokens();try{re().clearUser()}catch(r){L.secureLog("warn","Erreur lors du nettoyage du store utilisateur",{error:r.message})}We.push("/")}}const V=new Ar;let _e=null;const F=it.create({baseURL:te.BASE_URL,timeout:te.REQUEST_TIMEOUT,headers:te.DEFAULT_HEADERS,withCredentials:!0});F.interceptors.request.use(e=>{const t=V.getAccessToken();return t&&!V.isTokenExpired(t)&&(e.headers.Authorization=`Bearer ${t}`,L.secureLog("info","Token ajouté à la requête",{url:e.url,method:e.method})),e},e=>(L.error("Erreur dans l'intercepteur de requête",e),Promise.reject(e)));F.interceptors.response.use(e=>(L.secureLog("info","Requête réussie",{url:e.config.url,method:e.config.method,status:e.status}),e),async e=>{const{config:t,response:r}=e;if(t?.url?.includes("/api/users/notifications/")&&r?.status===404?L.debug("Notification introuvable (404)",{url:t.url,method:t.method,status:r.status}):L.error("Erreur de requête",e),(r?.status===401||r?.status===403)&&!t.__isRetryRequest){const o=!!V.getAccessToken(),i=!!V.getRefreshToken(),n=r?.data?.code==="token_not_valid"||r?.data?.detail?.includes("token")||r?.data?.messages?.some(u=>u?.token?.includes("expired")),l=r?.data?.detail?.includes("refresh")||r?.data?.messages?.some(u=>u?.token?.includes("refresh"));if(o&&i&&(n||r?.status===401))return L.secureLog("info","Erreur de token détectée, tentative de rafraîchissement",{status:r.status,url:t.url,isTokenExpiredError:n,isRefreshTokenError:l}),rt(t,e);if(r?.status===403){if(L.secureLog("warn","Erreur 403 - Accès refusé",{url:t.url,hasAccessToken:o,hasRefreshToken:i}),o&&i&&!t.__isRetryRequest)return rt(t,e)}else L.secureLog("warn",`Erreur ${r?.status} sans tokens valides ou erreur d'authentification`,{url:t.url,status:r?.status,hasAccessToken:o,hasRefreshToken:i})}return!r&&(e.code==="ECONNABORTED"||e.code==="NETWORK_ERROR")?Mr(t):Promise.reject(e)});async function rt(e,t){try{if(!V.getRefreshToken())return L.secureLog("warn","Aucun token de rafraîchissement disponible"),Be.logout("Aucun token de rafraîchissement disponible"),Promise.reject(t);L.secureLog("info","Tentative de rafraîchissement du token",{url:e.url});const s=await V.refreshAccessToken();if(!s)throw new Error("Aucun nouveau token reçu");return V.onRefreshed(s),e.headers.Authorization=`Bearer ${s}`,e.__isRetryRequest=!0,L.secureLog("info","Requête retry avec le nouveau token",{url:e.url}),F(e)}catch(r){L.error("Échec du rafraîchissement du token",r);const s=r.response?.status;let o="Échec du rafraîchissement du token";return s===401?o="Token de rafraîchissement invalide ou expiré":s===400?o="Requête de rafraîchissement malformée":r.response||(o="Erreur réseau lors du rafraîchissement"),Be.logout(o),Promise.reject(t)}}async function Mr(e,t){return pt.retryRequest(()=>(L.secureLog("info","Retry de la requête réseau",{url:e.url}),F(e)))}const Ie={async request(e){return pt.retryRequest(()=>F(e))},isAuthenticated(){const e=V.getAccessToken();return e&&!V.isTokenExpired(e)},async refreshToken(){return V.refreshAccessToken()},logout(e){Be.logout(e)},getStats(){return{isRefreshing:V.isRefreshing,hasValidToken:this.isAuthenticated(),refreshSubscribersCount:V.refreshSubscribers.length}},cleanExpiredTokens(){const e=V.getAccessToken(),t=V.getRefreshToken();let r=!1;return e&&V.isTokenExpired(e)&&(L.secureLog("info","Nettoyage du token d'accès expiré"),localStorage.removeItem("access_token"),r=!0),t&&V.isTokenExpired(t)&&(L.secureLog("info","Nettoyage du token de rafraîchissement expiré"),localStorage.removeItem("refresh_token"),r=!0),r&&L.secureLog("info","Tokens expirés nettoyés automatiquement"),r},hasValidTokens(){const e=V.getAccessToken(),t=V.getRefreshToken(),r=e&&!V.isTokenExpired(e),s=t&&!V.isTokenExpired(t);return{hasAccess:r,hasRefresh:s,hasAnyValid:r||s}},startTokenMonitoring(){_e&&clearInterval(_e),_e=setInterval(async()=>{try{this.cleanExpiredTokens(),await V.proactiveRefresh()}catch(e){L.error("Erreur lors de la surveillance des tokens",e)}},3e4),L.secureLog("info","Surveillance automatique des tokens démarrée")},stopTokenMonitoring(){_e&&(clearInterval(_e),_e=null,L.secureLog("info","Surveillance automatique des tokens arrêtée"))},async proactiveTokenRefresh(){return V.proactiveRefresh()}},vn=Object.freeze(Object.defineProperty({__proto__:null,apiUtils:Ie,default:F},Symbol.toStringTag,{value:"Module"}));class st{constructor(t){this.endpoint=t}async getAll(t={}){try{return(await F.get(this.endpoint,{params:t})).data}catch(r){throw this.handleError("récupération",r),r}}async getById(t){try{return(await F.get(`${this.endpoint}${t}/`)).data}catch(r){throw this.handleError(`récupération de l'élément ${t}`,r),r}}async create(t){try{return(await F.post(this.endpoint,t)).data}catch(r){throw this.handleError("création",r),r}}async update(t,r){try{return(await F.patch(`${this.endpoint}${t}/`,r)).data}catch(s){throw this.handleError(`mise à jour de l'élément ${t}`,s),s}}async delete(t){try{await F.delete(`${this.endpoint}${t}/`)}catch(r){throw this.handleError(`suppression de l'élément ${t}`,r),r}}async getByFilter(t={}){return this.getAll(t)}async getByRelation(t,r,s={}){return this.getAll({...s,[t]:r})}async getHierarchical(t,r){try{return(await F.get(`${this.endpoint}${t}/${r}/`)).data}catch(s){throw this.handleError(`récupération hiérarchique ${r}`,s),s}}handleError(t,r){}async getHierarchy(t,r){try{const[s,o]=await Promise.all([this.getById(t),this.getHierarchical(t,r)]);return{parent:s,children:o}}catch(s){throw this.handleError(`récupération de la hiérarchie ${t}`,s),s}}}const vt={createEndpoint(e){return new st(e)},createCRUDFunctions(e){const t=new st(e);return{getAll:r=>t.getAll(r),getById:r=>t.getById(r),create:r=>t.create(r),update:(r,s)=>t.update(r,s),delete:r=>t.delete(r),getByFilter:r=>t.getByFilter(r),getByRelation:(r,s,o)=>t.getByRelation(r,s,o),getHierarchical:(r,s)=>t.getHierarchical(r,s),getHierarchy:(r,s)=>t.getHierarchy(r,s)}}},ce=()=>(ce._instance||(ce._instance=vt.createCRUDFunctions("/api/pays/")),ce._instance),hn=e=>ce().getAll(e),gn=e=>ce().create(e),_n=(e,t)=>ce().update(e,t),yn=e=>ce().delete(e),Cr=(e={})=>ce().getByFilter({...e,est_actif:!0}),Me=()=>(Me._instance||(Me._instance=vt.createCRUDFunctions("/api/niveaux/")),Me._instance),Sn=e=>Me().getAll(e),Fr=e=>ce().getHierarchical(e,"niveaux"),Rr=()=>F.get("/api/users/preferences/"),Lr=e=>F.post("/api/users/preferences/bulk-update/",e),xr=e=>F.post(`/api/users/favorites/add/${e}/`),Or=e=>F.delete(`/api/users/favorites/remove/${e}/`),Dr=e=>F.post(`/api/users/selected/add/${e}/`),Nr=e=>F.delete(`/api/users/selected/remove/${e}/`),Pr=e=>F.post(`/api/users/selected/set-active/${e}/`),Vr=async()=>{try{const e=JSON.parse(localStorage.getItem("selected-matieres-ids")||"[]"),t=JSON.parse(localStorage.getItem("favorite-matieres-ids")||"[]"),r=localStorage.getItem("active-matiere-id"),s={};return t.length>0&&(s.favorite_matiere_ids=t),e.length>0&&(s.selected_matieres=e.map((o,i)=>({matiere_id:parseInt(o),order:i,is_active:parseInt(o)===parseInt(r)}))),r&&(s.active_matiere_id=parseInt(r)),Object.keys(s).length>0&&await Lr(s),!0}catch{return!1}},qr=async()=>{try{const{data:e}=await Rr(),t=e.favorite_matieres?.map(o=>o.matiere.id)||[],r=e.selected_matieres||[],s=e.active_matiere_id;return localStorage.setItem("favorite-matieres-ids",JSON.stringify(t)),localStorage.setItem("selected-matieres-ids",JSON.stringify(r.map(o=>o.matiere.id))),s?localStorage.setItem("active-matiere-id",s.toString()):localStorage.removeItem("active-matiere-id"),{favoriteIds:t,selectedIds:r.map(o=>o.matiere.id),activeId:s,selectedMatieres:r}}catch{return null}},Ur=()=>F.get("/api/users/me/"),En=e=>F.patch("/api/users/me/update/",e),Br=(e,t)=>{let r,s;return typeof e=="object"&&e!==null?(r=e.pays_id??e.pays,s=e.niveau_id??e.niveau_pays_id??e.niveau):(r=e,s=t),F.patch("/api/users/me/pays-niveau/",{pays_id:r,niveau_pays_id:s})},zr=()=>F.get("/api/users/me/gamification/"),In=(e={})=>{const t=e.scope||"global",r=e.limit||20;return F.get("/api/users/leaderboard/",{params:{scope:t,limit:r}})},bn=()=>F.get("/api/users/me/overview/"),kn=()=>F.get("/api/users/me/children/"),Tn=e=>F.post("/api/users/me/children/add/",e),wn=e=>F.delete(`/api/users/me/children/${e}/remove/`),jr=e=>F.post("/api/users/me/update-xp/",e),Ke=(e={})=>F.get("/api/users/notifications/",{params:e}),ht=async e=>{try{return await F.patch(`/api/users/notifications/${e}/`,{read:!0})}catch(t){return{success:!1,error:t.response?.status||"unknown"}}},Gr=async()=>{const t=(await Ke({unread:1}))?.data||[];return{count:(await Promise.allSettled(t.map(o=>ht(o.id)))).filter(o=>o.status==="fulfilled"&&o.value.success!==!1).length}},$r=async e=>{try{return await F.delete(`/api/users/notifications/${e}/`)}catch(t){return{success:!1,error:t.response?.status||"unknown"}}},An=async()=>{const t=(await Ke())?.data||[];return{count:(await Promise.allSettled(t.map(o=>$r(o.id)))).filter(o=>o.status==="fulfilled"&&o.value.success!==!1).length}},Xr=e=>F.post("/api/users/register/",e),Hr=e=>({first_name:e.firstName,last_name:e.lastName,email:e.email,password:e.password,password2:e.confirmPassword}),Qr=e=>F.post("/api/users/login/",e),Wr=e=>({email:e.email,password:e.password}),Kr=e=>F.post("/api/users/verify-code/",e),Mn=e=>F.post("/api/users/logout/",e),Jr=e=>F.post("/api/users/auth/google/",e),we=T([]);let Yr=1;function Je(){const e=(n,l="info",u=5e3)=>{const p=Yr++,d={id:p,message:n,type:l,visible:!0};return we.value.push(d),setTimeout(()=>{t(p)},u),p},t=n=>{const l=we.value.findIndex(u=>u.id===n);l>-1&&we.value.splice(l,1)};return{toasts:we,showToast:e,removeToast:t,success:(n,l)=>e(n,"success",l),error:(n,l)=>e(n,"error",l),warning:(n,l)=>e(n,"warning",l),info:(n,l)=>e(n,"info",l)}}function Zr(){const e=Ge(),t=re(),{closeModal:r}=$e(),{showToast:s}=Je(),o=T(!1),i="demo-client-id.apps.googleusercontent.com",n=()=>{typeof google<"u"&&google.accounts.id.initialize({client_id:i,callback:l,context:"signin",ux_mode:"popup",auto_select:!1,cancel_on_tap_outside:!0,use_fedcm_for_prompt:!1})},l=async v=>{try{o.value=!0;const f=await Jr({access_token:v.credential}),{user:c,access:I,refresh:w}=f.data.data;localStorage.setItem("access_token",I),localStorage.setItem("refresh_token",w),t.setUser(c),await t.fetchUser(),r(ee.LOGIN),e.push("/dashboard"),s("Connexion réussie !","success")}catch(f){const c=f.response?.data?.message||"Erreur de connexion";s(c,"error")}finally{o.value=!1}},u=()=>{typeof google<"u"?google.accounts.id.prompt():s("Google Sign-In non disponible","error")},p=()=>new Promise((v,f)=>{if(typeof google<"u"){v();return}const c=document.createElement("script");c.src="https://accounts.google.com/gsi/client",c.async=!0,c.defer=!0,c.onload=()=>{v()},c.onerror=()=>{f(new Error("Failed to load Google script"))},document.head.appendChild(c)});return{isGoogleLoading:o,signInWithGoogle:u,setupGoogleSignIn:async()=>{try{await p(),n()}catch{}},loadGoogleScript:p,initializeGoogleSignIn:n}}const es={name:"LoginModal",components:{Modal:ke,DynamicForm:He},props:{isOpen:{type:Boolean,default:!1}},emits:["close","login","signup","forgot-password"],setup(e,{emit:t}){const r=Ge(),s=re(),{closeModal:o}=$e(),{setupGoogleSignIn:i,signInWithGoogle:n,isGoogleLoading:l}=Zr(),{config:u,formData:p,isSubmitting:d,isValid:v,getFieldError:f,setFieldTouched:c,submitForm:I,getFieldConfig:w,getFieldNames:A}=Xe("LOGIN"),_=A(),m=T("");be(async()=>{await i()});const h=()=>{m.value="",t("close")},b=()=>{m.value=""},R=async()=>{await I(x)},x=async y=>{const O=Wr(y);try{const K=await Qr(O),se=K.data.data||K.data,ie=se.access,me=se.refresh;if(!ie||!me)throw new Error("Tokens d'authentification manquants");localStorage.setItem("access_token",ie),localStorage.setItem("refresh_token",me);const P=se||K.data;(P.user_id||P.id)&&s.setUser(P),await s.fetchUser(),t("login",{email:y.email}),h(),o(ee.LOGIN),r.push("/dashboard")}catch(K){const se=K.response?.data?.detail||K.response?.data?.error;m.value=se||"Erreur lors de la connexion"}};return{config:u,fieldNames:_,socialProviders:ct,formData:p,isSubmitting:d,isValid:v,isGoogleLoading:l,getFieldError:f,setFieldTouched:c,getFieldConfig:w,handleClose:h,handleFormSubmit:R,handleSocialLogin:y=>{y==="google"?n():t("login",{provider:y})},handleSignUp:()=>{t("signup")},handleForgotPassword:()=>{t("forgot-password")},loginError:m,handleInput:b}}},ts={class:"signup-link signup-link-top"},rs={class:"form-options"},ss={key:0,class:"login-error"},os={class:"social-login"},ns={class:"social-btn-group"},as=["onClick","disabled"],is=["src","alt"];function ls(e,t,r,s,o,i){const n=W("DynamicForm"),l=W("Modal");return g(),Z(l,{"is-open":r.isOpen,title:"Connexion",size:"small",onClose:s.handleClose},{default:ne(()=>[a("div",ts,[a("p",null,[t[2]||(t[2]=pe(" Pas encore de compte ? ")),a("button",{type:"button",class:"signup-btn",onClick:t[0]||(t[0]=(...u)=>s.handleSignUp&&s.handleSignUp(...u))}," Créer un compte ")])]),q(n,{"field-names":s.fieldNames,"get-field-config":s.getFieldConfig,"form-data":s.formData,"is-submitting":s.isSubmitting,"is-valid":s.isValid,"get-field-error":s.getFieldError,"set-field-touched":s.setFieldTouched,"submit-text":s.config.submitText,onSubmit:s.handleFormSubmit,onInput:s.handleInput},{"form-content":ne(()=>[a("div",rs,[a("button",{type:"button",class:"forgot-password-btn",onClick:t[1]||(t[1]=(...u)=>s.handleForgotPassword&&s.handleForgotPassword(...u))}," Mot de passe oublié ? ")])]),_:1},8,["field-names","get-field-config","form-data","is-submitting","is-valid","get-field-error","set-field-touched","submit-text","onSubmit","onInput"]),s.loginError?(g(),S("div",ss,D(s.loginError),1)):U("",!0),t[3]||(t[3]=a("div",{class:"divider"},[a("span",{class:"divider-line"}),a("span",{class:"divider-text"},"ou"),a("span",{class:"divider-line"})],-1)),a("div",os,[a("div",ns,[(g(!0),S(ve,null,he(s.socialProviders,u=>(g(),S("button",{key:u.key,class:Q(["social-btn",u.btnClass]),onClick:()=>s.handleSocialLogin(u.key),disabled:s.isSubmitting||u.key==="google"&&s.isGoogleLoading},[a("img",{src:u.icon,alt:u.key,class:"social-icon"},null,8,is),pe(" "+D(u.label),1)],10,as))),128))])])]),_:1,__:[3]},8,["is-open","onClose"])}const cs=X(es,[["render",ls],["__scopeId","data-v-b9201d20"]]),us={name:"PasswordStrength",props:{password:{type:String,required:!0}},computed:{rules(){const e=this.password||"";return[{key:"length",label:"8+ caractères",passed:e.length>=8},{key:"uppercase",label:"Majuscule",passed:/[A-Z]/.test(e)},{key:"lowercase",label:"Minuscule",passed:/[a-z]/.test(e)},{key:"digit",label:"Chiffre",passed:/\d/.test(e)},{key:"special",label:"Caractère spécial",passed:/[^A-Za-z0-9]/.test(e)}]}}},ds={class:"password-strength"},ms={class:"icon"},fs={key:0,width:"16",height:"16",fill:"none",viewBox:"0 0 16 16"},ps={key:1,width:"16",height:"16",fill:"none",viewBox:"0 0 16 16"},vs={class:"label"};function hs(e,t,r,s,o,i){return g(),S("div",ds,[(g(!0),S(ve,null,he(i.rules,n=>(g(),S("div",{key:n.key,class:Q(["strength-box",{passed:n.passed}])},[a("span",ms,[n.passed?(g(),S("svg",fs,t[0]||(t[0]=[a("path",{d:"M4 8.5l3 3 5-5",stroke:"#10b981","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))):(g(),S("svg",ps,t[1]||(t[1]=[a("circle",{cx:"8",cy:"8",r:"7",stroke:"#d1d5db","stroke-width":"2"},null,-1)])))]),a("span",vs,D(n.label),1)],2))),128))])}const gs=X(us,[["render",hs],["__scopeId","data-v-5e920371"]]),_s={name:"RegisterModal",components:{Modal:ke,DynamicForm:He,FormField:lt,PasswordStrength:gs},props:{isOpen:{type:Boolean,default:!1}},emits:["close","register","login","terms","privacy"],setup(e,{emit:t}){const{config:r,formData:s,isSubmitting:o,isValid:i,getFieldError:n,setFieldTouched:l,submitForm:u,getFieldConfig:p,getFieldNames:d}=Xe("REGISTER"),v=re(),f=["firstName","lastName"],c=d().filter(C=>!["firstName","lastName","acceptTerms","newsletter"].includes(C)),I=T(""),w=T("");function A(C,y="error"){I.value=C,w.value=y,setTimeout(()=>{I.value="",w.value=""},4e3)}const _=()=>{t("close")},m=async()=>{const C=await u(h)},h=async C=>{const y=Hr(C);try{const O=await Xr(y);O&&O.data&&v.setUser(O.data),A("Compte créé avec succès!","success"),t("register",{...y}),setTimeout(_,1200)}catch(O){const K=O.response?.data?Object.entries(O.response.data).map(([se,ie])=>`${se}: ${Array.isArray(ie)?ie.join(", "):ie}`).join(" | "):O.message;A(K||"Erreur lors de la création du compte","error")}};return{config:r,formData:s,isSubmitting:o,isValid:i,getFieldError:n,setFieldTouched:l,submitForm:u,getFieldConfig:p,getFieldNames:d,nameFields:f,mainFieldNames:c,socialProviders:ct,handleClose:_,handleFormSubmit:m,handleFieldBlur:({fieldName:C,event:y})=>{l(C)},handleSocialRegister:C=>{t("register",{provider:C})},handleLogin:()=>{t("login")},handleTermsClick:()=>{t("terms")},handlePrivacyClick:()=>{t("privacy")},feedbackMessage:I,feedbackType:w,showFeedback:A}}},ys={class:"login-link login-link-top"},Ss={class:"top-fields"},Es={class:"name-fields"},Is={key:0,class:"password-strength-row"},bs={class:"terms-section"},ks={class:"newsletter-section"},Ts={class:"social-register"},ws={class:"social-btn-group"},As=["onClick","disabled"],Ms=["src","alt"];function Cs(e,t,r,s,o,i){const n=W("FormField"),l=W("PasswordStrength"),u=W("DynamicForm"),p=W("Modal");return g(),Z(p,{"is-open":r.isOpen,title:"Créer un compte",size:"medium",onClose:s.handleClose},{default:ne(()=>[a("div",ys,[a("p",null,[t[5]||(t[5]=pe(" Déjà un compte ? ")),a("button",{type:"button",class:"login-btn",onClick:t[0]||(t[0]=(...d)=>s.handleLogin&&s.handleLogin(...d))}," Se connecter ")])]),a("div",Ss,[a("div",Es,[q(n,{"field-name":"firstName","field-config":s.getFieldConfig("firstName"),modelValue:s.formData.firstName,"onUpdate:modelValue":t[1]||(t[1]=d=>s.formData.firstName=d),disabled:s.isSubmitting,"get-field-error":s.getFieldError,onBlur:s.handleFieldBlur},null,8,["field-config","modelValue","disabled","get-field-error","onBlur"]),q(n,{"field-name":"lastName","field-config":s.getFieldConfig("lastName"),modelValue:s.formData.lastName,"onUpdate:modelValue":t[2]||(t[2]=d=>s.formData.lastName=d),disabled:s.isSubmitting,"get-field-error":s.getFieldError,onBlur:s.handleFieldBlur},null,8,["field-config","modelValue","disabled","get-field-error","onBlur"])])]),q(u,{class:"register-dynamic-form","field-names":s.mainFieldNames,"get-field-config":s.getFieldConfig,"form-data":s.formData,"is-submitting":s.isSubmitting,"is-valid":s.isValid,"get-field-error":s.getFieldError,"set-field-touched":s.setFieldTouched,"submit-text":s.config.submitText,onSubmit:s.handleFormSubmit},{"form-content":ne(()=>[s.mainFieldNames.includes("password")?(g(),S("div",Is,[q(l,{password:s.formData.password},null,8,["password"])])):U("",!0),a("div",bs,[q(n,{"field-name":"acceptTerms","field-config":s.getFieldConfig("acceptTerms"),modelValue:s.formData.acceptTerms,"onUpdate:modelValue":t[3]||(t[3]=d=>s.formData.acceptTerms=d),disabled:s.isSubmitting,"get-field-error":s.getFieldError,onBlur:s.handleFieldBlur},null,8,["field-config","modelValue","disabled","get-field-error","onBlur"])]),a("div",ks,[q(n,{"field-name":"newsletter","field-config":s.getFieldConfig("newsletter"),modelValue:s.formData.newsletter,"onUpdate:modelValue":t[4]||(t[4]=d=>s.formData.newsletter=d),disabled:s.isSubmitting,"get-field-error":s.getFieldError,onBlur:s.handleFieldBlur},null,8,["field-config","modelValue","disabled","get-field-error","onBlur"])])]),_:1},8,["field-names","get-field-config","form-data","is-submitting","is-valid","get-field-error","set-field-touched","submit-text","onSubmit"]),s.feedbackMessage?(g(),S("div",{key:0,class:Q(["register-feedback",s.feedbackType])},D(s.feedbackMessage),3)):U("",!0),t[6]||(t[6]=a("div",{class:"divider"},[a("span",{class:"divider-line"}),a("span",{class:"divider-text"},"ou"),a("span",{class:"divider-line"})],-1)),a("div",Ts,[a("div",ws,[(g(!0),S(ve,null,he(s.socialProviders,d=>(g(),S("button",{key:d.key,class:Q(["social-btn",d.btnClass]),onClick:()=>s.handleSocialRegister(d.key),disabled:s.isSubmitting},[a("img",{src:d.icon,alt:d.key,class:"social-icon"},null,8,Ms),pe(" "+D(d.label),1)],10,As))),128))])])]),_:1,__:[6]},8,["is-open","onClose"])}const Fs=X(_s,[["render",Cs],["__scopeId","data-v-b20b530e"]]),Rs={name:"ForgotPasswordModal",components:{Modal:ke,DynamicForm:He},props:{isOpen:{type:Boolean,default:!1}},emits:["close","forgot-password","login"],setup(e,{emit:t}){const r=T(!1),{config:s,formData:o,isSubmitting:i,isValid:n,getFieldError:l,setFieldTouched:u,submitForm:p,getFieldConfig:d,getFieldNames:v,resetForm:f}=Xe("FORGOT_PASSWORD"),c=v(),I=()=>{t("close"),f(),r.value=!1},w=async()=>{const m=await p(async h=>{await new Promise(b=>setTimeout(b,1500)),t("forgot-password",{...h}),r.value=!0},h=>{})};return{isSuccess:r,config:s,fieldNames:c,formData:o,isSubmitting:i,isValid:n,getFieldError:l,setFieldTouched:u,getFieldConfig:d,handleClose:I,handleFormSubmit:w,handleBackToLogin:()=>{t("login")},handleResend:async()=>{r.value=!1,await w()}}}},Ls={key:0,class:"success-state"},xs={class:"success-message"},Os={class:"success-actions"},Ds={key:1},Ns={class:"back-to-login"};function Ps(e,t,r,s,o,i){const n=W("DynamicForm"),l=W("Modal");return g(),Z(l,{"is-open":r.isOpen,title:"Mot de passe oublié",size:"small",onClose:s.handleClose},{default:ne(()=>[s.isSuccess?(g(),S("div",Ls,[t[4]||(t[4]=a("div",{class:"success-icon"},[a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),a("polyline",{points:"22,4 12,14.01 9,11.01"})])],-1)),t[5]||(t[5]=a("h3",{class:"success-title"},"Email envoyé !",-1)),a("p",xs,[t[3]||(t[3]=pe(" Nous avons envoyé un lien de réinitialisation à ")),a("strong",null,D(s.formData.email),1)]),a("div",Os,[a("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=(...u)=>s.handleClose&&s.handleClose(...u))}," Fermer "),a("button",{type:"button",class:"btn btn-secondary",onClick:t[1]||(t[1]=(...u)=>s.handleResend&&s.handleResend(...u))}," Renvoyer l'email ")])])):(g(),S("div",Ds,[t[6]||(t[6]=a("div",{class:"instructions"},[a("p",{class:"instruction-text"}," Entrez votre adresse email et nous vous enverrons un lien pour réinitialiser votre mot de passe. ")],-1)),q(n,{"field-names":s.fieldNames,"get-field-config":s.getFieldConfig,"form-data":s.formData,"is-submitting":s.isSubmitting,"is-valid":s.isValid,"get-field-error":s.getFieldError,"set-field-touched":s.setFieldTouched,"submit-text":s.config.submitText,onSubmit:s.handleFormSubmit},null,8,["field-names","get-field-config","form-data","is-submitting","is-valid","get-field-error","set-field-touched","submit-text","onSubmit"]),a("div",Ns,[a("p",null,[a("button",{type:"button",class:"back-btn",onClick:t[2]||(t[2]=(...u)=>s.handleBackToLogin&&s.handleBackToLogin(...u))}," ← Retour à la connexion ")])])]))]),_:1},8,["is-open","onClose"])}const Vs=X(Rs,[["render",Ps],["__scopeId","data-v-57942d67"]]),qs={name:"VerifyCodeModal",components:{Modal:ke},props:{isOpen:{type:Boolean,default:!1},email:{type:String,required:!0}},emits:["close","verified"],data(){return{code:"",error:"",isSubmitting:!1}},methods:{async handleVerify(){this.error="",this.isSubmitting=!0;try{await Kr({email:this.email,code:this.code}),this.$emit("verified"),this.code=""}catch{this.error="Code invalide ou expiré."}finally{this.isSubmitting=!1}},handleClose(){this.$emit("close"),this.code="",this.error=""}}},Us=["disabled"],Bs={key:0,class:"verify-error"};function zs(e,t,r,s,o,i){const n=W("Modal");return g(),Z(n,{"is-open":r.isOpen,title:"Vérification du compte",size:"small",onClose:i.handleClose},{default:ne(()=>[a("form",{onSubmit:t[1]||(t[1]=Le((...l)=>i.handleVerify&&i.handleVerify(...l),["prevent"])),class:"verify-form"},[t[2]||(t[2]=a("label",{for:"code-input",class:"verify-label"},"Code reçu par email",-1)),je(a("input",{id:"code-input","onUpdate:modelValue":t[0]||(t[0]=l=>o.code=l),class:"verify-input",placeholder:"Entrez le code",required:"",autocomplete:"one-time-code"},null,512),[[Et,o.code]]),a("button",{type:"submit",class:"verify-btn",disabled:o.isSubmitting},D(o.isSubmitting?"Vérification...":"Valider"),9,Us),o.error?(g(),S("div",Bs,D(o.error),1)):U("",!0)],32)]),_:1},8,["is-open","onClose"])}const js=X(qs,[["render",zs],["__scopeId","data-v-c5b00a14"]]),Gs={class:"pays-niveau-selector"},$s={class:"modal-header"},Xs={class:"progress-bar"},Hs={class:"modal-subtitle"},Qs={key:0,class:"step-content"},Ws={key:0,class:"loading-state"},Ks={key:1,class:"error-state"},Js={key:2,class:"pays-grid"},Ys=["onClick"],Zs={class:"pays-flag"},eo={class:"pays-info"},to={key:0,class:"selected-indicator"},ro={class:"step-actions"},so=["disabled"],oo={key:0},no={key:1},ao={key:1,class:"step-content"},io={class:"section-header"},lo={key:0,class:"loading-state"},co={key:1,class:"empty-state"},uo={key:2,class:"niveaux-grid"},mo=["onClick"],fo={class:"niveau-info"},po={key:0,class:"selected-indicator"},vo={class:"step-actions"},ho=["disabled"],go={key:0},_o={key:1},yo={key:2,class:"step-content"},So={class:"confirmation-content"},Eo={class:"configuration-summary"},Io={class:"summary-item"},bo={class:"value"},ko={class:"summary-item"},To={class:"value"},wo={__name:"PaysNiveauSelector",props:{isOpen:{type:Boolean,default:!1}},emits:["configuration-complete","close"],setup(e,{emit:t}){const r=e,s=t,o=re(),{showToast:i}=Je(),n=T(1),l=T([]),u=T([]),p=T(null),d=T(null),v=T(!1),f=T(!1),c=T(!1),I=T(!1),w=M(()=>l.value.find(C=>C.id===p.value)),A=M(()=>u.value.find(C=>C.id===d.value)),_=()=>{switch(n.value){case 1:return"Étape 1 sur 2 - Choisissez votre pays";case 2:return"Étape 2 sur 2 - Choisissez votre niveau";case 3:return"Configuration terminée";default:return""}},m=async()=>{try{v.value=!0,c.value=!1;const C=await Cr();l.value=C.data||C}catch{c.value=!0,i("Erreur lors du chargement des pays","error")}finally{v.value=!1}},h=async C=>{if(!C){u.value=[];return}try{f.value=!0;const y=await Fr(C);u.value=y.data||y}catch{u.value=[],i("Erreur lors du chargement des niveaux","error")}finally{f.value=!1}},b=C=>{p.value=C.id,d.value=null},R=C=>{d.value=C.id},x=()=>{n.value===1&&p.value&&(n.value=2,h(p.value))},H=()=>{n.value===2&&(n.value=1,u.value=[],d.value=null)},ae=async()=>{if(!(!p.value||!d.value))try{I.value=!0,await Br(p.value,d.value),await o.fetchUser(),n.value=3,i("Configuration enregistrée avec succès !","success"),setTimeout(()=>{s("configuration-complete")},2e3)}catch{i("Erreur lors de l'enregistrement de la configuration","error")}finally{I.value=!1}};return Ce(()=>r.isOpen,C=>{C&&l.value.length===0&&m()}),Ce(p,C=>{C&&n.value===2&&h(C)}),be(()=>{r.isOpen&&m()}),(C,y)=>(g(),Z(ke,{"is-open":e.isOpen,"can-close":!1,"show-header":!1},{default:ne(()=>[a("div",Gs,[a("div",$s,[a("div",Xs,[a("div",{class:Q(["progress-step",{active:n.value>=1,completed:n.value>1}])},y[0]||(y[0]=[a("span",{class:"step-number"},"1",-1),a("span",{class:"step-label"},"Pays",-1)]),2),a("div",{class:Q(["progress-line",{completed:n.value>1}])},null,2),a("div",{class:Q(["progress-step",{active:n.value>=2,completed:n.value>2}])},y[1]||(y[1]=[a("span",{class:"step-number"},"2",-1),a("span",{class:"step-label"},"Niveau",-1)]),2)]),y[2]||(y[2]=a("h2",null,"🎓 Configuration de votre profil d'apprentissage",-1)),a("p",Hs,D(_()),1)]),n.value===1?(g(),S("div",Qs,[y[7]||(y[7]=a("div",{class:"section-header"},[a("h3",null,"📍 Sélectionnez votre pays"),a("p",null,"Choisissez votre pays pour personnaliser le contenu selon votre système éducatif")],-1)),v.value?(g(),S("div",Ws,y[3]||(y[3]=[a("div",{class:"spinner"},null,-1),a("p",null,"Chargement des pays disponibles...",-1)]))):c.value?(g(),S("div",Ks,[y[4]||(y[4]=a("p",null,"❌ Erreur lors du chargement des pays",-1)),a("button",{onClick:m,class:"btn-retry"},"Réessayer")])):(g(),S("div",Js,[(g(!0),S(ve,null,he(l.value,O=>(g(),S("div",{key:O.id,class:Q(["pays-card",{selected:p.value===O.id}]),onClick:K=>b(O)},[a("div",Zs,D(O.drapeau_emoji),1),a("div",eo,[a("h4",null,D(O.nom),1),a("p",null,D(O.nombre_niveaux||0)+" niveaux disponibles",1)]),p.value===O.id?(g(),S("div",to,y[5]||(y[5]=[a("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none"},[a("path",{d:"M9 12L11 14L15 10",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]))):U("",!0)],10,Ys))),128))])),a("div",ro,[a("button",{onClick:x,disabled:!p.value||f.value,class:"btn-primary"},[f.value?(g(),S("span",oo,"Chargement...")):(g(),S("span",no,"Continuer")),y[6]||(y[6]=a("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none"},[a("path",{d:"M9 18L15 12L9 6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1))],8,so)])])):U("",!0),n.value===2?(g(),S("div",ao,[a("div",io,[y[8]||(y[8]=a("h3",null,"📚 Sélectionnez votre niveau scolaire",-1)),a("p",null,"Choisissez votre niveau pour "+D(w.value?.nom),1)]),f.value?(g(),S("div",lo,y[9]||(y[9]=[a("div",{class:"spinner"},null,-1),a("p",null,"Chargement des niveaux...",-1)]))):u.value.length===0?(g(),S("div",co,y[10]||(y[10]=[a("p",null,"Aucun niveau disponible pour ce pays",-1)]))):(g(),S("div",uo,[(g(!0),S(ve,null,he(u.value,O=>(g(),S("div",{key:O.id,class:Q(["niveau-card",{selected:d.value===O.id}]),onClick:K=>R(O)},[a("div",{class:"niveau-color",style:ot({backgroundColor:O.couleur||"#667eea"})},null,4),a("div",fo,[a("h4",null,D(O.nom_local||O.nom),1),y[11]||(y[11]=a("p",null,"Niveau scolaire",-1))]),d.value===O.id?(g(),S("div",po,y[12]||(y[12]=[a("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none"},[a("path",{d:"M9 12L11 14L15 10",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]))):U("",!0)],10,mo))),128))])),a("div",vo,[a("button",{onClick:H,class:"btn-secondary"},y[13]||(y[13]=[a("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none"},[a("path",{d:"M15 18L9 12L15 6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),pe(" Retour ")])),a("button",{onClick:ae,disabled:!d.value||I.value,class:"btn-primary"},[I.value?(g(),S("span",go,"Enregistrement...")):(g(),S("span",_o,"Terminer la configuration"))],8,ho)])])):U("",!0),n.value===3?(g(),S("div",yo,[a("div",So,[y[16]||(y[16]=a("div",{class:"success-icon"},"✅",-1)),y[17]||(y[17]=a("h3",null,"Configuration terminée !",-1)),y[18]||(y[18]=a("p",null,"Votre profil a été configuré avec succès.",-1)),a("div",Eo,[a("div",Io,[y[14]||(y[14]=a("span",{class:"label"},"Pays:",-1)),a("span",bo,D(w.value?.nom),1)]),a("div",ko,[y[15]||(y[15]=a("span",{class:"label"},"Niveau:",-1)),a("span",To,D(A.value?.nom_local||A.value?.nom),1)])]),y[19]||(y[19]=a("p",{class:"redirect-message"},"Vous allez être redirigé vers votre tableau de bord...",-1))])])):U("",!0)])]),_:1},8,["is-open"]))}},Ao=X(wo,[["__scopeId","data-v-d3ef1302"]]),Mo={name:"Toast",setup(){const{toasts:e,removeToast:t}=Je();return{toasts:e,removeToast:t}}},Co={class:"toast-container"},Fo=["onClick"],Ro={class:"toast-content"},Lo={class:"toast-message"},xo=["onClick"];function Oo(e,t,r,s,o,i){return g(),S("div",Co,[q(It,{name:"toast",tag:"div",class:"toasts"},{default:ne(()=>[(g(!0),S(ve,null,he(s.toasts,n=>(g(),S("div",{key:n.id,class:Q(["toast",n.type]),onClick:l=>s.removeToast(n.id)},[a("div",Ro,[a("span",Lo,D(n.message),1),a("button",{class:"toast-close",onClick:Le(l=>s.removeToast(n.id),["stop"])}," × ",8,xo)])],10,Fo))),128))]),_:1})])}const Do=X(Mo,[["render",Oo],["__scopeId","data-v-90fbbd54"]]),No={key:0,class:"xp-notification-overlay"},Po={class:"xp-notification-card"},Vo={class:"xp-notification-content"},qo={class:"xp-message"},Uo={class:"xp-reward"},Bo={class:"xp-amount"},zo={__name:"XPRewardNotification",setup(e){const t=T(!1),r=T(""),s=T(0),o=l=>{r.value=`Objectif "${i(l.objectiveType)}" terminé !`,s.value=l.xpAmount,t.value=!0,setTimeout(()=>{t.value=!1},4e3)},i=l=>({quiz_easy:"Quiz simples",quiz_medium:"Quiz moyens",quiz_hard:"Quiz difficiles",quiz_perfect:"Quiz parfaits",quiz_streak:"Série de quiz"})[l]||"Objectif",n=l=>{o(l.detail)};return be(()=>{window.addEventListener("dailyObjectiveCompleted",n)}),nt(()=>{window.removeEventListener("dailyObjectiveCompleted",n)}),(l,u)=>(g(),Z(ze,{to:"body"},[q(at,{name:"notification"},{default:ne(()=>[t.value?(g(),S("div",No,[a("div",Po,[a("div",Vo,[u[1]||(u[1]=a("div",{class:"xp-icon"},"🎉",-1)),a("div",qo,[u[0]||(u[0]=a("h3",null,"Défi complété !",-1)),a("p",null,D(r.value),1)]),a("div",Uo,[a("span",Bo,"+"+D(s.value)+" XP",1)])]),u[2]||(u[2]=a("div",{class:"xp-progress-bar"},[a("div",{class:"xp-progress-fill",style:{width:"100%"}})],-1))])])):U("",!0)]),_:1})]))}},jo=X(zo,[["__scopeId","data-v-0e93c61c"]]),Go={key:0,class:"unlock-notification-overlay"},$o={class:"unlock-notification-card"},Xo={class:"unlock-notification-content"},Ho={class:"unlock-message"},Qo={class:"unlock-objective-icon"},Wo={__name:"ObjectiveUnlockedNotification",setup(e){const t=T(!1),r=T(""),s=T(""),o=n=>{r.value=`"${n.objective.name}" est maintenant disponible !`,s.value=n.objective.icon||"🎯",t.value=!0,setTimeout(()=>{t.value=!1},3e3)},i=n=>{o(n.detail)};return be(()=>{window.addEventListener("objectiveUnlocked",i)}),nt(()=>{window.removeEventListener("objectiveUnlocked",i)}),(n,l)=>(g(),Z(ze,{to:"body"},[q(at,{name:"unlock-notification"},{default:ne(()=>[t.value?(g(),S("div",Go,[a("div",$o,[a("div",Xo,[l[1]||(l[1]=a("div",{class:"unlock-icon"},"🔓",-1)),a("div",Ho,[l[0]||(l[0]=a("h3",null,"Nouvel objectif débloqué !",-1)),a("p",null,D(r.value),1)]),a("div",Qo,D(s.value),1)]),l[2]||(l[2]=a("div",{class:"unlock-progress-bar"},[a("div",{class:"unlock-progress-fill",style:{width:"100%"}})],-1))])])):U("",!0)]),_:1})]))}},Ko=X(Wo,[["__scopeId","data-v-25a66a03"]]),Jo={},Yo={class:"fullpage-spinner"};function Zo(e,t){return g(),S("div",Yo,t[0]||(t[0]=[a("span",{class:"spinner"},null,-1)]))}const en=X(Jo,[["render",Zo],["__scopeId","data-v-b5fd4076"]]),Ye=ge("notifications",()=>{const e=T([]),t=T(1),r=M(()=>e.value.filter(m=>!m.read).length),s=M(()=>r.value>0),o={XP_GAINED:"xp_gained",LEVEL_UP:"level_up",EXERCISE_UNLOCKED:"exercise_unlocked",CHAPTER_COMPLETED:"chapter_completed",ACHIEVEMENT:"achievement",DAILY_STREAK:"daily_streak"},i={XP_GAINED:4e3,LEVEL_UP:6e3,EXERCISE_UNLOCKED:5e3,CHAPTER_COMPLETED:5e3,ACHIEVEMENT:7e3,DAILY_STREAK:5e3};function n({type:m,title:h,message:b,data:R={},autoRemove:x=!1}){const H={id:t.value++,type:m,title:h,message:b,data:R,read:!1,timestamp:new Date,autoRemove:x};if(e.value.unshift(H),x){const ae=i[m]||5e3;setTimeout(()=>{w(H.id)},ae)}return H}function l(m,h,b=1){const R=b===1,x=R?"🎉 XP Gagnés !":"🔄 Tentative Supplémentaire";let H;return R&&m>0?H=`+${m} XP pour "${h}"`:H=`Quiz "${h}" terminé (cooldown 1h30)`,n({type:o.XP_GAINED,title:x,message:H,data:{xpAmount:m,quizTitle:h,attempt:b,isFirstAttempt:R}})}function u(m,h,b){return n({type:o.LEVEL_UP,title:"🏆 Niveau Supérieur !",message:`Félicitations ! Vous êtes maintenant niveau ${m}`,data:{newLevel:m,totalXP:h,xpToNext:b}})}function p(m,h){return n({type:o.EXERCISE_UNLOCKED,title:"🔓 Nouvel Exercice !",message:`"${m}" disponible dans ${h}`,data:{exerciseTitle:m,chapterTitle:h}})}function d(m,h){return n({type:o.CHAPTER_COMPLETED,title:"✅ Chapitre Terminé !",message:`"${m}" complété à ${h}%`,data:{chapterTitle:m,completionRate:h}})}function v(m,h,b="🏅"){return n({type:o.ACHIEVEMENT,title:`${b} Réussite Débloquée !`,message:`${m}: ${h}`,data:{achievementTitle:m,description:h,icon:b}})}function f(m,h){const b=x=>x===1?"Première connexion aujourd'hui !":x<=5?`${x} jours consécutifs ! Bravo !`:`${x} jours de suite ! Incroyable série !`,R=x=>x===1?"🌟":x===2?"⭐":x===3?"🔥":x===4?"💫":x>=5?"🏆":"🌟";return n({type:o.DAILY_STREAK,title:`${R(m)} Série Quotidienne !`,message:`${b(m)} +${h} XP`,data:{streakDays:m,xpGained:h}})}async function c(m){const h=e.value.find(b=>b.id===m);if(h){h.read=!0;try{await ht(m)}catch{}}}async function I(){e.value.forEach(m=>m.read=!0);try{const m=await Gr()}catch{}}function w(m){const h=e.value.findIndex(b=>b.id===m);h>-1&&e.value.splice(h,1)}function A(){e.value=[]}function _(){e.value.length>20&&(e.value=e.value.sort((m,h)=>new Date(h.timestamp)-new Date(m.timestamp)).slice(0,20))}return{notifications:M(()=>e.value),unreadCount:r,hasUnread:s,NOTIFICATION_TYPES:o,loadFromServer:async()=>{try{const m=await Ke(),h=Array.isArray(m?.data)?m.data:m?.data?.results||[];e.value=h.map(R=>({id:R.id,type:R.type,title:R.title,message:R.message,data:R.data||{},read:!!R.read,timestamp:R.created_at?new Date(R.created_at):new Date}));const b=h.reduce((R,x)=>Math.max(R,Number(x.id||0)),0);t.value=Math.max(t.value,b+1)}catch{}},addNotification:n,markAsRead:c,markAllAsRead:I,removeNotification:w,clearAll:A,cleanupOld:_,notifyXPGained:l,notifyLevelUp:u,notifyExerciseUnlocked:p,notifyChapterCompleted:d,notifyAchievement:v,notifyDailyStreak:f}}),Ne=T(!1),Pe=T(0),Ve=T("");function tn(){const e=re(),t=Ye();function r(l=0,u="XP gagné !"){Pe.value=l,Ve.value=u,Ne.value=!0}function s(){Ne.value=!1,Pe.value=0,Ve.value=""}async function o(l=!1){try{const u=await zr(),p=u?.data?.data||u?.data||null;if(p){const d=Number(e.xp||0),v=Number(p.xp??e.xp??0),f=p.level,c=p.xp_to_next??p.next_level_xp??null,I=Ue(v),w=Number(f??I.level),A=Number(c??I.xp_to_next);return l||(e.xp=v,e.level=w,e.xp_to_next=A),{success:!0,gainedXp:v-d,newXp:v,newLevel:w,newXpToNext:A}}}catch(u){return{success:!1,error:u}}}async function i(l,u="streak_daily"){if(l==null)return{success:!1};const p=Number(e.xp||0),d=Number(e.level||0),v=p+Number(l),{level:f,xp_to_next:c}=Ue(v);e.xp=v,e.level=f,e.xp_to_next=c,await bt();try{await jr({xp_delta:l,reason:u})}catch{}const I=f>d;return I&&t.notifyLevelUp(f,v,c),{success:!0,oldXp:p,newXp:v,oldLevel:d,newLevel:f,levelUp:I}}async function n(l,u,p=1,d="Quiz"){if(t.notifyXPGained(u,d,p),u>0){let v="Quiz réussi !";p===1&&(v="Premier essai réussi !"),r(u,v);const f=await i(u,"quiz_completion");return await o(!0)}else p>1&&r(0,"Tentative supplémentaire (cooldown 1h30)");return{success:!0,gainedXp:0}}return{showXpNotification:Ne,xpGained:Pe,xpMessage:Ve,showXpGain:r,hideXpNotification:s,refreshUserXP:o,updateUserXPInstantly:i,handleQuizCompletion:n}}function rn(){const e=re(),t=Ye(),{updateUserXPInstantly:r}=tn(),s=T(0),o=T(null),i=T(!1);function n(A){return A<=0?0:A<=5?A:5}function l(A){if(!A)return!0;const _=new Date,m=new Date(A),h=_.toDateString(),b=m.toDateString();return h!==b}function u(A){if(!A)return!1;const _=new Date,m=new Date(A),h=_-m;return Math.floor(h/(1e3*60*60*24))<=1}async function p(){try{if(i.value)return{success:!0,alreadyChecked:!0};const A=new Date().toISOString().split("T")[0],_=localStorage.getItem("lastLoginDate"),m=parseInt(localStorage.getItem("currentStreak")||"0");if(!l(_))return i.value=!0,s.value=m,{success:!0,alreadyChecked:!0};let h=1;u(_)&&(h=m+1);const b=n(h);return s.value=h,o.value=A,i.value=!0,localStorage.setItem("currentStreak",h.toString()),localStorage.setItem("lastLoginDate",A),localStorage.setItem("streakCheckedToday","true"),b>0&&await r(b,"streak_daily"),t.notifyDailyStreak(h,b),{success:!0,streakDays:h,xpGained:b,isNewStreak:h===1&&!u(_)}}catch(A){return{success:!1,error:A}}}function d(){try{const A=parseInt(localStorage.getItem("currentStreak")||"0"),_=localStorage.getItem("lastLoginDate"),m=localStorage.getItem("streakCheckedToday")==="true";s.value=A,o.value=_,l(_)?(i.value=!1,localStorage.removeItem("streakCheckedToday")):i.value=m}catch{s.value=0,o.value=null,i.value=!1}}function v(){s.value=0,o.value=null,i.value=!1,localStorage.removeItem("currentStreak"),localStorage.removeItem("lastLoginDate"),localStorage.removeItem("streakCheckedToday")}async function f(){return e.isAuthenticated?(d(),await p()):{success:!1,reason:"not_authenticated"}}const c=M(()=>n(s.value+1)),I=M(()=>n(s.value)),w=M(()=>s.value===0?"Connectez-vous quotidiennement pour gagner des XP !":s.value<=5?`${s.value} jour${s.value>1?"s":""} de suite ! Prochain: +${c.value} XP`:`${s.value} jours consécutifs ! +5 XP quotidiens`);return{currentStreak:M(()=>s.value),lastLoginDate:M(()=>o.value),isStreakCheckedToday:M(()=>i.value),nextStreakXP:c,todayStreakXP:I,streakMessage:w,checkDailyStreak:f,updateStreak:p,initializeStreak:d,resetStreak:v,calculateStreakXP:n,isNewDay:l,isStreakValid:u}}const sn={key:1,id:"app"},on={__name:"App",setup(e){const t=re(),r=xe(),s=Ge(),{isModalOpen:o,closeModal:i,openModal:n}=$e(),{checkDailyStreak:l}=rn(),u=Ye(),p=T(!1),d=T(""),v=T(!1),f=M(()=>o(ee.LOGIN)),c=M(()=>o(ee.REGISTER)),I=M(()=>o(ee.FORGOT_PASSWORD)),w=()=>i(ee.LOGIN),A=()=>i(ee.REGISTER),_=()=>i(ee.FORGOT_PASSWORD),m=()=>{v.value=!1},h=async()=>{if(t.isAuthenticated&&t.pays&&t.niveau_pays)try{await r.initialize()}catch{}},b=()=>{if(t.id){const P=`configurationCompleted_${t.id}`;localStorage.setItem(P,"true")}m(),t.fetchUser().then(()=>{h()})},R=P=>{d.value=P,p.value=!0},x=()=>{p.value=!1,d.value=""},H=P=>{P.provider==="google"||w()},ae=()=>{w(),n(ee.REGISTER)},C=()=>{w(),n(ee.FORGOT_PASSWORD)},y=async P=>{P.provider==="google"||(A(),R(P.email))},O=()=>{A(),_(),n(ee.LOGIN)},K=()=>{},se=()=>{},ie=()=>{x(),s.push("/dashboard")},me=()=>{if(t.isLoading||!t.isAuthenticated||!t.id)return;const P=t.pays!==null&&t.pays!==void 0,le=t.niveau_pays!==null&&t.niveau_pays!==void 0;if(!P||!le){const ue=`configurationCompleted_${t.id}`;localStorage.getItem(ue)==="true"&&(!P||!le)&&localStorage.removeItem(ue),!localStorage.getItem(ue)&&!v.value&&(v.value=!0)}};return Ce(()=>t.isAuthenticated,P=>{P&&setTimeout(async()=>{try{await l()}catch{}me();try{await u.loadFromServer()}catch{}},200)},{immediate:!0}),Ce([()=>t.pays,()=>t.niveau_pays,()=>t.isLoading],([P,le,ue])=>{if(!ue&&t.isAuthenticated&&t.id){const Oe=P!=null,et=le!=null;if(Oe&&et){v.value=!1;const tt=`configurationCompleted_${t.id}`;localStorage.setItem(tt,"true"),h()}else me()}}),be(async()=>{try{await l()}catch{}if(t.isAuthenticated){me(),t.pays&&t.niveau_pays&&h();try{await u.loadFromServer()}catch{}}}),(P,le)=>{const ue=W("router-view");return j(t).isLoading?(g(),Z(en,{key:0})):(g(),S("div",sn,[q(ue),q(cs,{"is-open":f.value,onClose:w,onLogin:H,onSignup:ae,onForgotPassword:C},null,8,["is-open"]),q(Fs,{"is-open":c.value,onClose:A,onRegister:y,onLogin:O,onTerms:K,onPrivacy:se},null,8,["is-open"]),q(Vs,{"is-open":I.value,onClose:_,onForgotPassword:C,onLogin:O},null,8,["is-open"]),q(js,{"is-open":p.value,email:d.value,onClose:x,onVerified:ie},null,8,["is-open","email"]),q(Ao,{"is-open":v.value,onConfigurationComplete:b,onClose:m},null,8,["is-open"]),q(Do),q(jo),q(Ko)]))}}},nn={};if(typeof document<"u"){const e=document.createElement("style");e.textContent=`
    /* Cache le bouton menu (≡) et le toggle clavier virtuel */
    math-field::part(menu-toggle),
    math-field::part(virtual-keyboard-toggle) {
      display: none !important;
    }
  `,document.head.appendChild(e)}const an=kt(),Ze=Tt(on);Ze.use(an);Ze.use(We);const ln=re(),cn=Ie.cleanExpiredTokens(),un=localStorage.getItem("access_token");if(import.meta&&nn){const e=()=>{};console.log=e,console.debug=e,console.info=e}un&&(ln.fetchUser(),setTimeout(()=>{Ie.startTokenMonitoring()},1e3));Ze.mount("#app");export{_n as A,st as B,Rt as C,gn as D,vn as E,Wt as F,ir as L,ee as M,jo as X,X as _,rn as a,F as b,tn as c,xe as d,zr as e,In as f,bn as g,kn as h,Tn as i,Br as j,Je as k,hn as l,Ur as m,En as n,$e as o,Ye as p,Mn as q,wn as r,An as s,$r as t,re as u,vt as v,jr as w,Ie as x,Sn as y,yn as z};
