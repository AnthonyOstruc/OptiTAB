import{a as m,c as _,B as fe,b as a,d as t,g as C,k as f,K as h,L as U,F as w,p as b,j as y,t as r,w as W,n as z,z as ge,o as s,h as ye,u as Ce}from"./vendor-D171CWhe.js";import{g as he,u as X,c as J,d as we}from"./cours-CXkJGuuq.js";import{_ as be}from"./index-Bvm2JEkS.js";import{a as xe,g as Ne}from"./curriculum-Ch8J6CLY.js";import{A as _e}from"./AdminActionsButtons-D-mCqUkd.js";import{a as Ae,r as Me}from"./scientificRenderer-SJJ6pUZd.js";import"./ui-jaH5oyHW.js";import"./pdf-B39ievqC.js";import"./mathlive-B5k0jhbN.js";const ke={class:"form-group"},Ie=["value"],Te={key:0,class:"context-panel"},De={class:"context-row"},Se={class:"context-row"},Ee={class:"context-row"},$e={class:"context-row"},Fe={class:"context-row"},Le={class:"context-row"},Ue={class:"form-group"},Ve={class:"form-group"},je={class:"form-group"},Be={key:0,class:"selected-images"},ze=["src","alt"],Pe={class:"image-name"},Ge=["onClick"],qe={class:"form-group"},Re={class:"form-group"},Oe={class:"btn-primary",type:"submit"},He={key:0,class:"preview-section"},We={class:"preview-item"},Xe={key:0,class:"preview-image-info"},Je={class:"image-indicator"},Ke={class:"image-status-list"},Ye={class:"preview-cours"},Ze={class:"preview-header"},Qe={class:"ordre-badge"},et=["innerHTML"],tt={class:"filters"},it={class:"filter-group"},lt=["value"],nt={class:"admin-table"},ot={class:"ctx-cell"},rt={key:0},at={class:"modal-description"},st={class:"modal-form"},ut={class:"form-group"},dt=["value"],ct={class:"form-group"},mt={class:"modal-actions"},pt=["disabled"],vt=10*1024*1024,ft={__name:"AdminCours",setup(gt){const K=["image/jpeg","image/jpg","image/png","image/gif","image/webp","image/svg+xml"],A=m([]),v=m([]),V=m([]),M=m(""),k=m(""),n=m({id:null,chapitre:"",titre:"",contenu:"",ordre:0,difficulte:"moyen"}),I=m({chapitre:""}),T=m(!1),d=m(null),g=m([]),j=m(null),D=m(!1),u=m({originalCours:null,newChapitre:"",newTitre:""}),P=_(()=>{let l=A.value;return I.value.chapitre&&(l=l.filter(e=>e.chapitre==I.value.chapitre)),l.sort((e,i)=>(e.ordre||0)-(i.ordre||0))}),Y=_(()=>{if(!M.value)return v.value;const l=M.value.toLowerCase();return v.value.filter(e=>L(e).toLowerCase().includes(l))}),Z=_(()=>{if(!k.value)return v.value;const l=k.value.toLowerCase();return v.value.filter(e=>L(e).toLowerCase().includes(l))});async function S(){try{const[l,e,i]=await Promise.all([xe(),Ne(),he()]);v.value=Array.isArray(l)?l:l?.data||[],V.value=Array.isArray(e)?e:e?.data||[],A.value=Array.isArray(i?.data)?i.data:Array.isArray(i)?i:[]}catch{A.value=[],v.value=[],V.value=[]}}fe(S);function G(){n.value={id:null,chapitre:"",titre:"",contenu:"",ordre:0,difficulte:"moyen"},T.value=!1,d.value=null,g.value=[],j.value&&(j.value.value="")}function Q(l){Array.from(l.target.files).forEach(i=>{try{if(!K.includes(i.type)){alert(`Type de fichier non support√©: ${i.name}. Utilisez JPG, PNG, GIF, WebP ou SVG.`);return}if(i.size>vt){alert(`Fichier trop volumineux: ${i.name}. Taille maximale: 10MB.`);return}g.value.push(i)}catch{alert(`Erreur lors de l'ajout de ${i.name}`)}})}function ee(l){g.value.splice(l,1)}function te(l){return URL.createObjectURL(l)}function ie(l){return{easy:"Facile",medium:"Moyen",hard:"Difficile"}[l]||l}async function le(){if(!(!n.value.chapitre||!n.value.titre||!n.value.contenu))try{const l={facile:"easy",moyen:"medium",difficile:"hard"},e={chapitre:Number(n.value.chapitre),titre:n.value.titre,contenu:n.value.contenu,ordre:n.value.ordre,difficulty:l[n.value.difficulte]||"medium"};n.value.id?await X(n.value.id,e):await J(e);const i=n.value.chapitre;G(),n.value.chapitre=i,await S()}catch{}}function ne(l){const e={easy:"facile",medium:"moyen",hard:"difficile"},i=l.difficulte||l.difficulty||"medium",o=e[i]||"moyen";n.value={id:l.id,chapitre:l.chapitre,titre:l.titre||"",contenu:l.contenu||"",ordre:l.ordre||0,difficulte:o},T.value=!1,d.value=null}async function oe(l){try{await we(l),await S()}catch{}}function re(l){oe(l.id)}function ae(l){u.value={originalCours:l,newChapitre:"",newTitre:`${l.titre}`},D.value=!0}async function se(){if(!u.value.newChapitre||!u.value.newTitre.trim()){alert("Veuillez s√©lectionner un chapitre et saisir un titre pour la copie.");return}try{const l=u.value.originalCours,e={facile:"easy",moyen:"medium",difficile:"hard"},i={chapitre:Number(u.value.newChapitre),titre:u.value.newTitre.trim(),contenu:l.contenu,ordre:l.ordre||0,difficulty:l.difficulty||e[l.difficulte]||"medium"},o=A.value.find(c=>c.chapitre==u.value.newChapitre);if(o){if(!confirm(`Le chapitre "${R(u.value.newChapitre)}" a d√©j√† un cours.

Titre actuel: "${o.titre}"
Nouveau titre: "${u.value.newTitre.trim()}"

Voulez-vous remplacer le cours existant ?`))return;await X(o.id,i)}else await J(i);await S(),D.value=!1,u.value={originalCours:null,newChapitre:"",newTitre:""},alert("Cours dupliqu√© avec succ√®s !")}catch{alert("Erreur lors de la duplication du cours.")}}function q(){D.value=!1,u.value={originalCours:null,newChapitre:"",newTitre:""}}function ue(){if(!n.value.titre||!n.value.contenu){alert("Veuillez remplir au moins le titre et le contenu pour pr√©visualiser");return}const l=g.value.map(e=>e.name).join(",");d.value={titre:n.value.titre,contenu:n.value.contenu,ordre:n.value.ordre||0,difficulte:n.value.difficulte||"moyen",difficulty:n.value.difficulte==="facile"?"easy":n.value.difficulte==="moyen"?"medium":"hard",image:l,images:g.value},T.value=!0,ge(()=>{Me()})}function R(l){const e=v.value.find(i=>String(i.id)===String(l));return e?e.nom:l}function E(l){return V.value.find(e=>String(e.id)===String(l))}function $(l){if(!l)return null;const e=E(l.notion);if(!e)return{themeNom:"",matiereNom:"",paysNom:"",niveauNom:""};const i=e.matiere_nom||e.contexte_detail&&e.contexte_detail.matiere_nom||"",o=e.theme_nom||"",c=e.contexte_detail&&e.contexte_detail.pays?e.contexte_detail.pays.nom:"",p=e.contexte_detail&&e.contexte_detail.niveau?e.contexte_detail.niveau.nom:"";return{matiereNom:i,themeNom:o,paysNom:c,niveauNom:p}}const x=_(()=>{const l=v.value.find(e=>String(e.id)===String(n.value.chapitre));return l?$(l):null});function de(l,e=null){return(l||"").split(",").map(o=>o.trim()).filter(Boolean).map((o,c)=>{const p=F(o);return{id:`preview-${c}`,image:p?URL.createObjectURL(p):o,image_type:"illustration",position:c+1}})}function F(l){return g.value.find(e=>e.name===l)}function ce(l){const e=de(l.image,l);let i=l.contenu;const o=(l.image||"").split(",").map(c=>c.trim()).filter(Boolean);return i=i.replace(/\[IMAGE_(\d+)\]/g,(c,p)=>{const ve=parseInt(p)-1,B=o[ve],H=F(B);return H?`
        <div class="preview-image-container" style="text-align: center; margin: 2em 0;">
          <img src="${URL.createObjectURL(H)}" alt="Image ${p}" class="preview-image" style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);" />
          <div class="image-info" style="margin-top: 0.5rem; font-size: 0.875rem; color: #28a745; font-weight: 500;">‚úÖ ${B}</div>
        </div>
      `:`
        <div class="preview-image-placeholder">
          <div class="placeholder-icon">üñºÔ∏è</div>
          <div class="placeholder-text">Image manquante: ${B||`IMAGE_${p}`}</div>
          <div class="placeholder-hint">Uploadez cette image dans la section ci-dessus</div>
        </div>
      `}),Ae(i,e)}const me=_(()=>d.value?.contenu?ce(d.value):"");function L(l){const e=E(l.notion),i=$(l);return[l.nom,e?`‚Äî ${e.nom}`:"",i&&i.matiereNom?`‚Äî ${i.matiereNom}`:"",i&&(i.paysNom||i.niveauNom)?`‚Äî ${[i.paysNom,i.niveauNom].filter(Boolean).join(" ¬∑ ")}`:""].filter(Boolean).join(" ")}function N(l){return String(l||"").normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"")}function O(l){const e=v.value.find(p=>String(p.id)===String(l));if(!e)return"";const i=E(e.notion),o=$(e);return[o?.matiereNom,o?.themeNom,i?.nom,e.nom,o?.paysNom,o?.niveauNom].filter(Boolean).join(" ‚Ä∫ ")}function pe(l){const e=v.value.find(p=>String(p.id)===String(l));if(!e)return"";const i=E(e.notion),o=$(e);return[N(i?.nom),N(o?.themeNom),N(o?.matiereNom),N(o?.paysNom),N(o?.niveauNom)].filter(Boolean).join("_")}return(l,e)=>(s(),a("div",null,[e[44]||(e[44]=t("h2",{class:"admin-title"},"Gestion des Cours",-1)),t("form",{class:"admin-form",onSubmit:W(le,["prevent"])},[t("div",ke,[e[12]||(e[12]=t("label",null,"Chapitre:",-1)),f(t("input",{"onUpdate:modelValue":e[0]||(e[0]=i=>M.value=i),type:"text",placeholder:"Filtrer les chapitres...",class:"filter-input"},null,512),[[h,M.value]]),f(t("select",{"onUpdate:modelValue":e[1]||(e[1]=i=>n.value.chapitre=i),required:""},[e[11]||(e[11]=t("option",{value:""},"Choisir un chapitre",-1)),(s(!0),a(w,null,b(Y.value,i=>(s(),a("option",{key:i.id,value:i.id},r(L(i)),9,Ie))),128))],512),[[U,n.value.chapitre]])]),x.value?(s(),a("div",Te,[t("div",De,[e[13]||(e[13]=t("strong",null,"Mati√®re:",-1)),e[14]||(e[14]=y()),t("span",null,r(x.value.matiereNom||"‚Äî"),1)]),t("div",Se,[e[15]||(e[15]=t("strong",null,"Th√®me:",-1)),e[16]||(e[16]=y()),t("span",null,r(x.value.themeNom||"‚Äî"),1)]),t("div",Ee,[e[17]||(e[17]=t("strong",null,"Pays:",-1)),e[18]||(e[18]=y()),t("span",null,r(x.value.paysNom||"‚Äî"),1)]),t("div",$e,[e[19]||(e[19]=t("strong",null,"Niveau:",-1)),e[20]||(e[20]=y()),t("span",null,r(x.value.niveauNom||"‚Äî"),1)]),t("div",Fe,[e[21]||(e[21]=t("strong",null,"Chemin:",-1)),e[22]||(e[22]=y()),t("span",null,r(O(n.value.chapitre)),1)]),t("div",Le,[e[23]||(e[23]=t("strong",null,"Code:",-1)),e[24]||(e[24]=y()),t("code",null,r(pe(n.value.chapitre)),1)])])):C("",!0),t("div",Ue,[e[25]||(e[25]=t("label",null,"Titre du cours:",-1)),f(t("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>n.value.titre=i),placeholder:"Titre du cours",required:""},null,512),[[h,n.value.titre]])]),t("div",Ve,[e[26]||(e[26]=t("label",null,"Contenu:",-1)),f(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=i=>n.value.contenu=i),rows:"6",required:""},null,512),[[h,n.value.contenu]]),e[27]||(e[27]=t("small",{style:{color:"#666","font-size":"0.875rem"}}," Supporte HTML, LaTeX ($formule$), et images avec [IMAGE_1], [IMAGE_2], etc. ",-1))]),t("div",je,[e[29]||(e[29]=t("label",null,"Images (optionnel):",-1)),t("input",{type:"file",ref_key:"imagesInput",ref:j,onChange:Q,accept:"image/*",multiple:"",class:"images-file-input"},null,544),e[30]||(e[30]=t("small",{style:{color:"#666","font-size":"0.875rem"}}," S√©lectionnez les images qui seront r√©f√©renc√©es dans le contenu avec [IMAGE_1], [IMAGE_2], etc. ",-1)),g.value.length>0?(s(),a("div",Be,[e[28]||(e[28]=t("h5",null,"Images s√©lectionn√©es :",-1)),(s(!0),a(w,null,b(g.value,(i,o)=>(s(),a("div",{key:o,class:"selected-image-item"},[t("img",{src:te(i),alt:i.name,class:"image-preview"},null,8,ze),t("span",Pe,r(i.name),1),t("button",{type:"button",class:"btn-remove",onClick:c=>ee(o)},"√ó",8,Ge)]))),128))])):C("",!0)]),t("div",qe,[e[31]||(e[31]=t("label",null,"Ordre d'affichage:",-1)),f(t("input",{"onUpdate:modelValue":e[4]||(e[4]=i=>n.value.ordre=i),type:"number",min:"0"},null,512),[[h,n.value.ordre,void 0,{number:!0}]])]),t("div",Re,[e[33]||(e[33]=t("label",null,"Difficult√©:",-1)),f(t("select",{"onUpdate:modelValue":e[5]||(e[5]=i=>n.value.difficulte=i)},e[32]||(e[32]=[t("option",{value:"facile"},"Facile",-1),t("option",{value:"moyen"},"Moyen",-1),t("option",{value:"difficile"},"Difficile",-1)]),512),[[U,n.value.difficulte]])]),t("button",Oe,r(n.value.id?"Mettre √† jour":"Cr√©er"),1),n.value.id?(s(),a("button",{key:1,class:"btn-secondary",type:"button",onClick:G},"Annuler")):C("",!0),t("button",{class:"btn-secondary",type:"button",onClick:ue},"Pr√©visualiser")],32),T.value&&d.value?(s(),a("div",He,[t("h3",null,"Aper√ßu du cours "+r(n.value.id?"(Mode √©dition)":"(Mode cr√©ation)"),1),t("div",We,[t("h4",null,r(d.value.titre),1),d.value.image?(s(),a("div",Xe,[t("span",Je,"üñºÔ∏è Images: "+r(d.value.image),1),t("div",Ke,[(s(!0),a(w,null,b(d.value.image.split(",").map(i=>i.trim()).filter(Boolean),i=>(s(),a("span",{key:i,class:z(["image-status",F(i)?"available":"missing"])},r(i)+": "+r(F(i)?"‚úÖ Disponible":"‚ùå Manquante - Assurez-vous d'avoir upload√© cette image"),3))),128))])])):C("",!0),t("div",Ye,[t("div",Ze,[t("span",{class:z(["difficulty-badge",d.value.difficulty])},r(ie(d.value.difficulty)),3),t("span",Qe,"Ordre: "+r(d.value.ordre),1)]),t("div",{class:"preview-content",innerHTML:me.value},null,8,et)])])])):C("",!0),t("div",tt,[t("div",it,[e[35]||(e[35]=t("label",null,"Filtrer par chapitre:",-1)),f(t("input",{"onUpdate:modelValue":e[6]||(e[6]=i=>k.value=i),type:"text",placeholder:"Filtrer les chapitres...",class:"filter-input"},null,512),[[h,k.value]]),f(t("select",{"onUpdate:modelValue":e[7]||(e[7]=i=>I.value.chapitre=i)},[e[34]||(e[34]=t("option",{value:""},"Tous les chapitres",-1)),(s(!0),a(w,null,b(Z.value,i=>(s(),a("option",{key:i.id,value:i.id},r(i.nom)+" ("+r(i.notion_nom)+") ",9,lt))),128))],512),[[U,I.value.chapitre]])])]),t("table",nt,[e[37]||(e[37]=t("thead",null,[t("tr",null,[t("th",null,"ID"),t("th",null,"Titre"),t("th",null,"Chapitre"),t("th",null,"Contexte"),t("th",null,"Ordre"),t("th",null,"Difficult√©"),t("th",null,"Actions")])],-1)),t("tbody",null,[(s(!0),a(w,null,b(P.value,i=>(s(),a("tr",{key:i.id},[t("td",null,r(i.id),1),t("td",null,r(i.titre),1),t("td",null,r(R(i.chapitre)),1),t("td",ot,r(O(i.chapitre)),1),t("td",null,r(i.ordre||0),1),t("td",null,[t("span",{class:z(["difficulte-badge",`difficulte-${i.difficulte||i.difficulty||"moyen"}`])},r(i.difficulte||i.difficulty||"moyen"),3)]),t("td",null,[ye(Ce(_e),{item:i,actions:["edit","duplicate","delete"],"edit-label":"√âditer","duplicate-label":"Dupliquer","confirm-message":"√ätes-vous s√ªr de vouloir supprimer ce cours ?",onEdit:ne,onDuplicate:ae,onDelete:re},null,8,["item"])])]))),128)),P.value.length===0?(s(),a("tr",rt,e[36]||(e[36]=[t("td",{colspan:"7",style:{"text-align":"center","font-style":"italic"}},"Aucun cours trouv√©.",-1)]))):C("",!0)])]),D.value?(s(),a("div",{key:1,class:"modal-overlay",onClick:q},[t("div",{class:"modal-content",onClick:e[10]||(e[10]=W(()=>{},["stop"]))},[e[43]||(e[43]=t("h3",null,"Dupliquer le cours",-1)),t("p",at,[e[38]||(e[38]=y(' Cr√©er une copie de "')),t("strong",null,r(u.value.originalCours?.titre),1),e[39]||(e[39]=y('" '))]),t("div",st,[t("div",ut,[e[41]||(e[41]=t("label",null,"Nouveau chapitre:",-1)),f(t("select",{"onUpdate:modelValue":e[8]||(e[8]=i=>u.value.newChapitre=i),required:""},[e[40]||(e[40]=t("option",{value:""},"Choisir un chapitre",-1)),(s(!0),a(w,null,b(v.value,i=>(s(),a("option",{key:i.id,value:i.id},r(L(i)),9,dt))),128))],512),[[U,u.value.newChapitre]])]),t("div",ct,[e[42]||(e[42]=t("label",null,"Nouveau titre:",-1)),f(t("input",{"onUpdate:modelValue":e[9]||(e[9]=i=>u.value.newTitre=i),placeholder:"Titre de la copie",required:""},null,512),[[h,u.value.newTitre]])])]),t("div",mt,[t("button",{class:"btn-secondary",onClick:q},"Annuler"),t("button",{class:"btn-primary",onClick:se,disabled:!u.value.newChapitre||!u.value.newTitre.trim()}," Dupliquer ",8,pt)])])])):C("",!0)]))}},Mt=be(ft,[["__scopeId","data-v-dcf3ac5a"]]);export{Mt as default};
