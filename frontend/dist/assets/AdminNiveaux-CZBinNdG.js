import{_ as P,c as i,b as k,a as s,t as l,r as E,l as T,o as n,i as S,d as V,F as x,e as C,w as q,Z as B,h as y,m as h,p as L,O as Q,P as Z,n as J,j as K,k as b,v as N,z as R,V as W}from"./index-C20tTf3S.js";import{A as X}from"./AdminActionsButtons-BF654C6o.js";import{a as Y,u as $,c as ss,d as es}from"./niveaux-BM1EBO4x.js";const os={class:"modal-header"},as={class:"modal-body"},ts={key:0,class:"modal-footer"},ls={__name:"SimpleModal",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Modal"}},emits:["close"],setup(d,{emit:e}){const _=e,o=()=>{_("close")};return(m,v)=>d.isOpen?(n(),i("div",{key:0,class:"modal-overlay",onClick:o},[s("div",{class:"modal-content",onClick:v[0]||(v[0]=T(()=>{},["stop"]))},[s("div",os,[s("h3",null,l(d.title),1),s("button",{onClick:o,class:"close-btn"},"Ã—")]),s("div",as,[E(m.$slots,"default",{},void 0,!0)]),m.$slots.footer?(n(),i("div",ts,[E(m.$slots,"footer",{},void 0,!0)])):k("",!0)])])):k("",!0)}},rs=P(ls,[["__scopeId","data-v-57ebf5bf"]]),is={name:"AdminNiveaux",components:{SimpleModal:rs,AdminActionsButtons:X},setup(){const{showToast:d}=Q(),e=y([]),_=y([]),o=y(!1),m=y(!1),v=y(!1),g=y(!1),f=y({nom:"",description:"",pays:null,ordre:0,couleur:"#3b82f6",est_actif:!0}),t=h(()=>e.value.filter(a=>a.est_actif).length),r=h(()=>e.value.reduce((a,u)=>a+(u.statistiques?.matieres||0),0)),U=h(()=>e.value.reduce((a,u)=>a+(u.statistiques?.cours||0),0)),z=h(()=>{const a=new Map;for(const c of e.value){const p=c.pays??`p-${c.pays_nom}`;a.has(p)||a.set(p,{pays_id:c.pays??p,pays_nom:c.pays_nom||"Pays",pays_drapeau:c.pays_drapeau||"",niveaux:[]}),a.get(p).niveaux.push(c)}const u=Array.from(a.values()).sort((c,p)=>c.pays_nom.localeCompare(p.pays_nom));return u.forEach(c=>c.niveaux.sort((p,H)=>(p.ordre??0)-(H.ordre??0))),u}),M=async()=>{try{o.value=!0;const a=await Y();e.value=Array.isArray(a)?a:a?.results||[]}catch(a){console.error("Erreur lors du chargement des niveaux:",a),d("Erreur lors du chargement des niveaux","error")}finally{o.value=!1}},w=async()=>{try{console.log("ðŸŒ Chargement des pays...");const a=await Z();console.log("ðŸŒ Pays rÃ©cupÃ©rÃ©s:",a),_.value=a,console.log("ðŸŒ Pays stockÃ©s dans pays.value:",_.value)}catch(a){console.error("Erreur lors du chargement des pays:",a),d("Erreur lors du chargement des pays","error")}},O=async()=>{console.log("ðŸŽ¯ Bouton Nouveau Niveau cliquÃ©"),console.log("showCreateModal avant:",v.value),console.log("ðŸŒ Appel de loadPays()..."),await w(),v.value=!0,console.log("showCreateModal aprÃ¨s:",v.value)},I=async a=>{console.log("âœï¸ Ã‰dition du niveau:",a),await w(),f.value={id:a.id,nom:a.nom,description:a.description||"",pays:a.pays||null,ordre:a.ordre,couleur:a.couleur,est_actif:a.est_actif},g.value=!0},F=async()=>{try{if(m.value=!0,g.value){const{id:a,...u}=f.value;await $(a,u),d("Niveau modifiÃ© avec succÃ¨s","success")}else await ss(f.value),d("Niveau crÃ©Ã© avec succÃ¨s","success");A(),M()}catch(a){console.error("Erreur lors de la sauvegarde:",a),d("Erreur lors de la sauvegarde","error")}finally{m.value=!1}},j=a=>{D(a.id)},G=a=>{D(a.id)},D=async a=>{try{await es(a),d("Niveau supprimÃ© avec succÃ¨s","success"),M()}catch(u){console.error("Erreur lors de la suppression:",u),d("Erreur lors de la suppression","error")}},A=()=>{v.value=!1,g.value=!1,f.value={nom:"",description:"",pays:null,ordre:0,couleur:"#3b82f6",est_actif:!0}};return L(()=>{M()}),{niveaux:e,pays:_,loading:o,saving:m,showCreateModal:v,showEditModal:g,formData:f,niveauxActifs:t,totalMatieres:r,totalCours:U,niveauxByPays:z,openCreateModal:O,editNiveau:I,saveNiveau:F,confirmDeleteNiveau:j,handleDeleteNiveau:G,closeModal:A}}},ns={class:"admin-niveaux"},ds={class:"header"},us={key:0,class:"loading-state"},cs={key:1,class:"stats-grid"},vs={class:"stat-card"},ms={class:"stat-number"},ps={class:"stat-card"},fs={class:"stat-number"},ys={class:"stat-card"},_s={class:"stat-number"},gs={class:"stat-card"},bs={class:"stat-number"},hs={key:2},Ns={class:"pays-header"},Ms={class:"pays-title"},xs={class:"niveaux-list"},Cs={class:"niveau-header"},ks={class:"niveau-info"},ws={class:"niveau-actions"},Ds={class:"niveau-stats"},As={class:"stat-item"},Es={class:"stat-value"},Ss={class:"stat-item"},Vs={class:"stat-value"},qs={class:"stat-item"},Bs={class:"stat-value"},Ps={class:"stat-item"},Ts={class:"stat-value"},Us={class:"niveau-status"},zs={class:"ordre-badge"},Os={class:"form-group"},Is={class:"form-group"},Fs=["value"],js={class:"form-group"},Gs={class:"form-row"},Hs={class:"form-group"},Ls={class:"form-group"},Qs={class:"form-group"},Zs={class:"checkbox-label"},Js=["disabled"],Ks={key:0},Rs={key:1};function Ws(d,e,_,o,m,v){const g=B("AdminActionsButtons"),f=B("SimpleModal");return n(),i("div",ns,[s("div",ds,[e[11]||(e[11]=s("h1",null,"Gestion des Niveaux",-1)),s("button",{onClick:e[0]||(e[0]=(...t)=>o.openCreateModal&&o.openCreateModal(...t)),class:"btn-primary"},e[10]||(e[10]=[s("i",{class:"fas fa-plus"},null,-1),V(" Nouveau Niveau ")]))]),o.loading?(n(),i("div",us,e[12]||(e[12]=[s("div",{class:"spinner"},null,-1),s("p",null,"Chargement des niveaux...",-1)]))):(n(),i("div",cs,[s("div",vs,[e[13]||(e[13]=s("h3",null,"Total Niveaux",-1)),s("p",ms,l(o.niveaux.length),1)]),s("div",ps,[e[14]||(e[14]=s("h3",null,"Niveaux Actifs",-1)),s("p",fs,l(o.niveauxActifs),1)]),s("div",ys,[e[15]||(e[15]=s("h3",null,"Total MatiÃ¨res",-1)),s("p",_s,l(o.totalMatieres),1)]),s("div",gs,[e[16]||(e[16]=s("h3",null,"Total Cours",-1)),s("p",bs,l(o.totalCours),1)])])),o.loading?k("",!0):(n(),i("div",hs,[(n(!0),i(x,null,C(o.niveauxByPays,t=>(n(),i("div",{key:t.pays_id,class:"pays-group"},[s("div",Ns,[s("h2",Ms,l(t.pays_nom),1)]),s("div",xs,[(n(!0),i(x,null,C(t.niveaux,r=>(n(),i("div",{key:r.id,class:"niveau-card"},[s("div",Cs,[s("div",ks,[s("div",{class:"niveau-color",style:J({backgroundColor:r.couleur})},null,4),s("div",null,[s("h3",null,l(r.nom),1),s("p",null,l(r.description||"Aucune description"),1)])]),s("div",ws,[S(g,{item:r,actions:["edit","delete"],"edit-label":"Modifier","confirm-message":"ÃŠtes-vous sÃ»r de vouloir supprimer ce niveau ?",onEdit:o.editNiveau,onDelete:o.handleDeleteNiveau},null,8,["item","onEdit","onDelete"])])]),s("div",Ds,[s("div",As,[e[17]||(e[17]=s("span",{class:"stat-label"},"MatiÃ¨res:",-1)),s("span",Es,l(r.statistiques?.matieres||0),1)]),s("div",Ss,[e[18]||(e[18]=s("span",{class:"stat-label"},"Cours:",-1)),s("span",Vs,l(r.statistiques?.cours||0),1)]),s("div",qs,[e[19]||(e[19]=s("span",{class:"stat-label"},"Exercices:",-1)),s("span",Bs,l(r.statistiques?.exercices||0),1)]),s("div",Ps,[e[20]||(e[20]=s("span",{class:"stat-label"},"Quiz:",-1)),s("span",Ts,l(r.statistiques?.quiz||0),1)])]),s("div",Us,[s("span",{class:K(["status-badge",r.est_actif?"active":"inactive"])},l(r.est_actif?"Actif":"Inactif"),3),s("span",zs,"Ordre: "+l(r.ordre),1)])]))),128))])]))),128))])),S(f,{"is-open":o.showCreateModal||o.showEditModal,title:o.showEditModal?"Modifier le Niveau":"Nouveau Niveau",onClose:o.closeModal},{footer:q(()=>[s("button",{onClick:e[8]||(e[8]=(...t)=>o.closeModal&&o.closeModal(...t)),class:"btn-secondary"},"Annuler"),s("button",{onClick:e[9]||(e[9]=(...t)=>o.saveNiveau&&o.saveNiveau(...t)),class:"btn-primary",disabled:o.saving},[o.saving?(n(),i("span",Ks,"Enregistrement...")):(n(),i("span",Rs,l(o.showEditModal?"Modifier":"CrÃ©er"),1))],8,Js)]),default:q(()=>[s("form",{onSubmit:e[7]||(e[7]=T((...t)=>o.saveNiveau&&o.saveNiveau(...t),["prevent"])),class:"niveau-form"},[s("div",Os,[e[21]||(e[21]=s("label",{for:"nom"},"Nom du niveau *",-1)),b(s("input",{id:"nom","onUpdate:modelValue":e[1]||(e[1]=t=>o.formData.nom=t),type:"text",required:"",placeholder:"ex: 6Ã¨me"},null,512),[[N,o.formData.nom]])]),s("div",Is,[e[23]||(e[23]=s("label",{for:"pays"},"Pays *",-1)),b(s("select",{id:"pays","onUpdate:modelValue":e[2]||(e[2]=t=>o.formData.pays=t),required:""},[e[22]||(e[22]=s("option",{value:""},"SÃ©lectionner un pays",-1)),(n(!0),i(x,null,C(o.pays,t=>(n(),i("option",{key:t.id,value:t.id},l(t.nom),9,Fs))),128))],512),[[R,o.formData.pays]])]),s("div",js,[e[24]||(e[24]=s("label",{for:"description"},"Description",-1)),b(s("textarea",{id:"description","onUpdate:modelValue":e[3]||(e[3]=t=>o.formData.description=t),placeholder:"Description du niveau...",rows:"3"},null,512),[[N,o.formData.description]])]),s("div",Gs,[s("div",Hs,[e[25]||(e[25]=s("label",{for:"ordre"},"Ordre d'affichage",-1)),b(s("input",{id:"ordre","onUpdate:modelValue":e[4]||(e[4]=t=>o.formData.ordre=t),type:"number",min:"0",placeholder:"0"},null,512),[[N,o.formData.ordre,void 0,{number:!0}]])]),s("div",Ls,[e[26]||(e[26]=s("label",{for:"couleur"},"Couleur",-1)),b(s("input",{id:"couleur","onUpdate:modelValue":e[5]||(e[5]=t=>o.formData.couleur=t),type:"color",class:"color-picker"},null,512),[[N,o.formData.couleur]])])]),s("div",Qs,[s("label",Zs,[b(s("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.formData.est_actif=t),type:"checkbox"},null,512),[[W,o.formData.est_actif]]),e[27]||(e[27]=V(" Niveau actif "))])])],32)]),_:1},8,["is-open","title","onClose"])])}const se=P(is,[["render",Ws],["__scopeId","data-v-f64f10ec"]]);export{se as default};
