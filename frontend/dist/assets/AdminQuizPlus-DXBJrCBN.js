import{a as x,c as F,B as ue,C as O,b as c,a1 as ce,d as i,g as f,k as T,K as D,L as me,F as z,p as C,t as d,j as $,z as S,o as m,n as G}from"./vendor-D171CWhe.js";import{_ as de}from"./index-Bvm2JEkS.js";import{a as pe,g as ge}from"./curriculum-Ch8J6CLY.js";import{e as ve,h as he,u as fe}from"./quiz-C0dQ8Pww.js";import"./ui-jaH5oyHW.js";import"./pdf-B39ievqC.js";import"./mathlive-B5k0jhbN.js";const xe={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_URL:"http://localhost:8000",VITE_GOOGLE_CLIENT_ID:"151259305565-a03g822b5qhoaia71gju8hl9cbnu9lp4.apps.googleusercontent.com"},_e={class:"bulk-form"},ye={class:"form-row"},Ie=["value"],be={class:"stats"},qe={key:0,class:"stat-item"},$e={key:0,class:"context-panel"},we={class:"context-row"},Ne={class:"context-row"},ze={class:"context-row"},Ce={class:"context-row"},Ee={class:"images-upload-section"},ke={key:0,class:"selected-images"},Qe=["src","alt"],Me={class:"image-name"},Ae=["onClick"],Le={class:"btn-group"},Te=["disabled"],Se=["disabled"],We={key:0,class:"success-msg"},Ue={key:1,class:"error-msg"},Be={key:2,class:"preview-section"},je={class:"preview-header"},Pe={class:"preview-title"},Re={class:"quiz-grid"},Ve={class:"quiz-header"},Fe={class:"quiz-title"},Oe={class:"quiz-instructions"},De={class:"questions-summary"},Ge={class:"questions-count"},Je={key:0,class:"explanations-count"},He={key:1,class:"images-count"},Ke={class:"questions-preview"},Xe={class:"question-header"},Ye=["innerHTML"],Ze={class:"options-mini"},et=["innerHTML"],tt={key:0,class:"explanation-section"},st={key:0,class:"explanation-mini"},it=["innerHTML"],at={key:1,class:"no-explanation"},nt={key:0,class:"more-questions"},rt={key:0},ot=10*1024*1024,lt={__name:"AdminQuizPlus",setup(ut){const E=x([]),W=x([]),k=x(""),_=x(""),y=x(""),b=x(""),h=x(""),v=x([]),q=x(!0),w=x([]),M=x(null),J=["image/jpeg","image/jpg","image/png","image/gif","image/webp"];class H{constructor(){this.images=new Map,this.imageTypes=new Map}addImage(e){if(!this.validateImage(e))throw new Error(`Image invalide: ${e.name}`);this.images.set(e.name,e)}removeImage(e){this.images.delete(e),this.imageTypes.delete(e)}validateImage(e){return!(!J.includes(e.type)||e.size>ot)}getImage(e){let t=this.images.get(e);if(t)return t;for(const[a,n]of this.images)if(a.toLowerCase()===e.toLowerCase())return n;return null}parseImageString(e){return e?e.split(",").map(t=>t.trim()).filter(Boolean):[]}validateImageReferences(e){const t=this.parseImageString(e),a=[];for(const n of t)this.getImage(n)||a.push(n);return{valid:a.length===0,missing:a}}determineImageType(e,t){return"question"}}class K{constructor(e){this.imageManager=e}async createQuizWithImages(e){try{const t=await ve({chapitre:Number(e.chapitre),titre:e.titre,contenu:e.instruction||e.titre||"Quiz",difficulty:e.difficulty||"medium",questions_data:Array.isArray(e.questions)?e.questions:[]}),a=t&&t.data&&t.data.id?t.data.id:t&&t.id?t.id:null;return e.image&&await this.addImagesToQuiz(a,e),{success:!0,quizId:a}}catch(t){return{success:!1,error:t.response?.data?JSON.stringify(t.response.data):t.message||"Erreur inconnue"}}}async addImagesToQuiz(e,t){const a=this.imageManager.parseImageString(t.image),n=[],u=new Map;for(let r=0;r<a.length;r++){const g=a[r],o=this.imageManager.getImage(g);if(o)try{const Q=this.imageManager.determineImageType(t,r+1),l=await he({quiz:e,image:o,image_type:Q,position:r+1});if(l?.data?.image){let p=l.data.image;if(!/^https?:\/\//i.test(p)){const V=xe?.VITE_API_BASE_URL||"http://127.0.0.1:8000";p.startsWith("/")?p=V+p:p=V+"/media/"+p}u.set(r+1,p)}}catch{n.push(`Image ${g} non ajout√©e`)}else n.push(`Image ${g} non trouv√©e`)}if(u.size>0)try{await this.updateQuizQuestionsWithImageUrls(e,t,u)}catch{n.push("Erreur lors de la mise √† jour des URLs d'images dans les questions")}return n}async updateQuizQuestionsWithImageUrls(e,t,a){const n=t.questions.map(u=>{const r={...u};return r.question&&(r.question=this.replaceImageMarkersWithUrls(r.question,a)),r.options&&(r.options=r.options.map(g=>this.replaceImageMarkersWithUrls(g,a))),r.explanation&&(r.explanation=this.replaceImageMarkersWithUrls(r.explanation,a)),r});await fe(e,{questions_data:n})}replaceImageMarkersWithUrls(e,t){return e&&e.replace(/\[IMAGE_(\d+)\]/g,(a,n)=>{const u=parseInt(n),r=t.get(u);return r?`<img src="${r}" alt="Image ${u}" style="max-width: 300px; height: auto; border-radius: 6px; margin: 8px 0; border: 1px solid #e5e7eb;" />`:a})}}const I=new H,X=new K(I);async function Y(){try{const[s,e]=await Promise.all([pe(),ge()]);E.value=Array.isArray(s)?s:s?.data||[],W.value=Array.isArray(e)?e:e?.data||[]}catch{}}const Z=F(()=>{if(!k.value)return E.value;const s=k.value.toLowerCase();return E.value.filter(e=>j(e).toLowerCase().includes(s))});ue(Y);function U(s){return W.value.find(e=>String(e.id)===String(s))}function B(s){if(!s)return null;const e=U(s.notion);if(!e)return{themeNom:"",matiereNom:"",paysNom:"",niveauNom:""};const t=e.matiere_nom||e.contexte_detail&&e.contexte_detail.matiere_nom||"",a=e.theme_nom||"",n=e.contexte_detail&&e.contexte_detail.pays?e.contexte_detail.pays.nom:"",u=e.contexte_detail&&e.contexte_detail.niveau?e.contexte_detail.niveau.nom:"";return{matiereNom:t,themeNom:a,paysNom:n,niveauNom:u}}const N=F(()=>{const s=E.value.find(e=>String(e.id)===String(_.value));return s?B(s):null});function j(s){const e=U(s.notion),t=B(s);return[s.nom,e?`‚Äî ${e.nom}`:"",t&&t.matiereNom?`‚Äî ${t.matiereNom}`:"",t&&(t.paysNom||t.niveauNom)?`‚Äî ${[t.paysNom,t.niveauNom].filter(Boolean).join(" ¬∑ ")}`:""].filter(Boolean).join(" ")}function ee(s){return{easy:"‚≠ê Facile",medium:"‚≠ê‚≠ê Moyen",hard:"‚≠ê‚≠ê‚≠ê Difficile"}[s]||s}function P(){return v.value.reduce((s,e)=>s+e.questions.length,0)}const A=()=>{S(()=>{window.MathJax&&window.MathJax.typesetPromise()})};O(v,()=>{v.value.length>0&&A()},{deep:!0}),O(q,()=>{v.value.length>0&&S(()=>{setTimeout(()=>A(),100)})});function R(){const s=y.value.trim();return s?s.includes("===")?te(s):se(s):[]}function te(s){return s.split(/^={3,}\s*$/m).map(t=>t.trim()).filter(Boolean).map(t=>{let a="",n="",u="medium",r="";const g=[];let o=null;const Q=t.split(`
`).map(l=>l.trim());for(const l of Q)if(l.startsWith("Titre:"))a=l.slice(6).trim();else if(l.startsWith("Instructions:"))n=l.slice(12).trim();else if(l.startsWith("Difficult√©:")||l.startsWith("Difficulty:"))u=l.split(":")[1].trim().toLowerCase();else if(l.startsWith("Images:"))r=l.slice(7).trim();else if(l.startsWith("Question:"))o&&o.question&&g.push({...o}),o={question:l.slice(9).trim(),options:[],correct_answer:0,explanation:""};else if(l.match(/^[A-F]:/))o&&o.options.push(l.slice(2).trim());else if(l.startsWith("Correct:")){if(o){const p=l.slice(8).trim().toUpperCase();o.correct_answer=p.charCodeAt(0)-65}}else if(l.startsWith("Explication:")){if(o){let p=l.slice(12).trim();p=p.replace(/\\/g,"\\"),o.explanation=p}}else if(o&&o.explanation&&l.trim()){let p=l.trim();p=p.replace(/\\/g,"\\"),o.explanation+=" "+p}else if(o&&l.trim()){const p=l.trim();o.question=o.question?o.question+`
`+p:p}return o&&o.question&&g.push({...o}),{titre:a||"Quiz sans titre",instruction:n||"Quiz",difficulty:u,image:r,questions:g,chapitre:Number(_.value)}})}function se(s){return s.split(`
`).map(t=>t.trim()).filter(Boolean).map(t=>{const a=t.split(";;").map(u=>u.trim());let n=[];try{n=a[3]?JSON.parse(a[3]):[]}catch{}return{titre:a[0]||"Quiz sans titre",instruction:a[1]||"Quiz",difficulty:(a[2]||"medium").toLowerCase(),questions:n,chapitre:Number(_.value)}})}async function ie(){h.value="",b.value="";try{const s=R().filter(r=>r.titre&&r.questions.length>0);if(s.length===0){h.value="Aucun quiz valide trouv√©. V√©rifiez le format.";return}let e=0,t=0,a=[];for(const r of s){if(r.image){const o=I.validateImageReferences(r.image);if(!o.valid){a.push(`Images manquantes pour "${r.titre}": ${o.missing.join(", ")}`);continue}}const g=await X.createQuizWithImages(r);g.success?(e++,t+=Array.isArray(r.questions)?r.questions.length:0):a.push(`Erreur pour "${r.titre}": ${g.error}`)}let n=`${e} quiz cr√©√©s avec ${t} questions au total !`;a.length>0&&(n+=`

Erreurs : ${a.join(" | ")}`,h.value=`Certains quiz n'ont pas pu √™tre cr√©√©s : ${a.join(" | ")}`);const u=_.value;b.value=n,y.value="",v.value=[],_.value=u}catch(s){const e=s?.response?.data;if(e)try{h.value=typeof e=="string"?e:JSON.stringify(e)}catch{h.value="Erreur lors de la cr√©ation des quiz."}else h.value="Erreur lors de la cr√©ation des quiz."}}function ae(){h.value="",b.value="";try{const s=R().filter(e=>e.titre&&e.questions.length>0);v.value=s,s.forEach(e=>{e.questions.forEach((t,a)=>{t.explanation})}),s.length===0?h.value="Aucun quiz valide trouv√©. V√©rifiez le format.":S(()=>A())}catch{h.value="Erreur lors du parsing. V√©rifiez le format."}}function ne(){y.value="",v.value=[],b.value="",h.value=""}function re(s){Array.from(s.target.files).forEach(t=>{try{I.addImage(t)}catch(a){h.value=a.message}}),w.value=Array.from(I.images.values())}function oe(s){const e=w.value[s];I.removeImage(e.name),w.value.splice(s,1),M.value&&(M.value.value="")}function le(s){return URL.createObjectURL(s)}function L(s,e){if(!s||!e)return s;const t=I.parseImageString(e);return s.replace(/\[IMAGE_(\d+)\]/g,(a,n)=>{const u=parseInt(n)-1;if(u>=0&&u<t.length){const r=t[u],g=I.getImage(r);if(g)return`<img src="${URL.createObjectURL(g)}" alt="${r}" class="quiz-preview-image" style="max-width: 300px; height: auto; border-radius: 6px; margin: 8px 0; border: 1px solid #e5e7eb; display: block;" />`}return`<span class="image-placeholder" style="background: #fee2e2; color: #dc2626; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; border: 1px dashed #dc2626;">üñºÔ∏è Image ${n} manquante</span>`})}return(s,e)=>(m(),c("div",null,[e[18]||(e[18]=ce(`<h2 class="admin-title" data-v-1db5e708>üöÄ Bulk ‚Äì Cr√©ation de Quiz QCM</h2><div class="help-section" data-v-1db5e708><p data-v-1db5e708><strong data-v-1db5e708>1.</strong> S√©lectionnez le chapitre ‚Ä¢ <strong data-v-1db5e708>2.</strong> Collez vos quiz au format structur√©</p><details class="format-help" data-v-1db5e708><summary data-v-1db5e708>üìñ Guide du format (cliquez pour voir)</summary><div class="format-examples" data-v-1db5e708><h4 data-v-1db5e708>Format recommand√© avec blocs ===</h4><pre data-v-1db5e708><code data-v-1db5e708>Titre: Quiz D√©riv√©es - Niveau 1
Instructions: Testez vos connaissances sur les d√©riv√©es
Difficult√©: medium
Images: image1.png, image2.jpg

Question: Quelle est la d√©riv√©e de $f(x) = x^2$ ?
A: $2x$
B: $x$
C: $2$
D: $x^2$
Correct: A
Explication: La d√©riv√©e de $x^2$ est $2x$ d&#39;apr√®s la r√®gle...

Question: Quelle est la d√©riv√©e de $f(x) = \\\\sin(x)$ ?
A: $-\\\\cos(x)$
B: $\\\\cos(x)$
C: $\\\\sin(x)$
D: $-\\\\sin(x)$
Correct: B
Explication: La d√©riv√©e de $\\\\sin(x)$ est $\\\\cos(x)$...
===
Titre: Quiz Int√©grales - Niveau 1
Instructions: Quiz sur les int√©grales simples
...
===</code></pre><h4 data-v-1db5e708>Support des images</h4><ul data-v-1db5e708><li data-v-1db5e708>Uploadez vos images via la section &quot;üìÅ Images pour les quiz&quot;</li><li data-v-1db5e708>R√©f√©rencez les images avec : <code data-v-1db5e708>Images: nom_image1.png, nom_image2.jpg</code></li><li data-v-1db5e708>Types support√©s : JPG, PNG, GIF, WebP (max 10MB)</li><li data-v-1db5e708>Les images seront associ√©es aux questions du quiz</li></ul><h4 data-v-1db5e708>Format alternatif (une ligne par quiz)</h4><p data-v-1db5e708><code data-v-1db5e708>Titre ;; Instructions ;; Difficult√© ;; JSON_Questions</code></p></div></details></div>`,2)),i("div",_e,[T(i("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>k.value=t),type:"text",placeholder:"Filtrer les chapitres...",class:"filter-input"},null,512),[[D,k.value]]),i("div",ye,[T(i("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>_.value=t),required:"",class:"chapter-select"},[e[4]||(e[4]=i("option",{disabled:"",value:""},"üìö Choisir le chapitre",-1)),(m(!0),c(z,null,C(Z.value,t=>(m(),c("option",{key:t.id,value:t.id},d(j(t)),9,Ie))),128))],512),[[me,_.value]]),i("div",be,[v.value.length?(m(),c("span",qe," üìä "+d(v.value.length)+" quiz ‚Ä¢ "+d(P())+" questions ",1)):f("",!0)])]),N.value?(m(),c("div",$e,[i("div",we,[e[5]||(e[5]=i("strong",null,"Mati√®re:",-1)),e[6]||(e[6]=$()),i("span",null,d(N.value.matiereNom||"‚Äî"),1)]),i("div",Ne,[e[7]||(e[7]=i("strong",null,"Th√®me:",-1)),e[8]||(e[8]=$()),i("span",null,d(N.value.themeNom||"‚Äî"),1)]),i("div",ze,[e[9]||(e[9]=i("strong",null,"Pays:",-1)),e[10]||(e[10]=$()),i("span",null,d(N.value.paysNom||"‚Äî"),1)]),i("div",Ce,[e[11]||(e[11]=i("strong",null,"Niveau:",-1)),e[12]||(e[12]=$()),i("span",null,d(N.value.niveauNom||"‚Äî"),1)])])):f("",!0),i("div",Ee,[e[14]||(e[14]=i("h4",null,"üìÅ Images pour les quiz",-1)),e[15]||(e[15]=i("p",{class:"upload-help"},"Uploadez les images qui seront r√©f√©renc√©es dans vos quiz :",-1)),i("input",{type:"file",ref_key:"imagesInput",ref:M,onChange:re,accept:"image/*",multiple:"",class:"images-file-input"},null,544),w.value.length>0?(m(),c("div",ke,[e[13]||(e[13]=i("h5",null,"Images s√©lectionn√©es :",-1)),(m(!0),c(z,null,C(w.value,(t,a)=>(m(),c("div",{key:a,class:"selected-image-item"},[i("img",{src:le(t),alt:t.name,class:"image-preview"},null,8,Qe),i("span",Me,d(t.name),1),i("button",{type:"button",class:"btn-remove",onClick:n=>oe(a)},"√ó",8,Ae)]))),128))])):f("",!0)]),T(i("textarea",{"onUpdate:modelValue":e[2]||(e[2]=t=>y.value=t),placeholder:`üìù Collez vos quiz ici au format structur√©...\r
\r
Exemple rapide :\r
Titre: Quiz Exemple\r
Instructions: Quiz d'exemple\r
Difficult√©: easy\r
\r
Question: Combien font 2+2 ?\r
A: 3\r
B: 4\r
C: 5\r
D: 6\r
Correct: B\r
Explication: 2+2=4, c'est math√©matique !\r
===`,class:"quiz-textarea"},null,512),[[D,y.value]]),i("div",Le,[i("button",{class:"btn-preview",onClick:ae,disabled:!y.value.trim()}," üëÅÔ∏è Pr√©visualiser ",8,Te),i("button",{class:"btn-create",onClick:ie,disabled:!_.value||!v.value.length}," ‚ú® Cr√©er "+d(v.value.length||"")+" quiz ",9,Se),y.value||v.value.length?(m(),c("button",{key:0,class:"btn-clear",onClick:ne}," üóëÔ∏è Vider ")):f("",!0)])]),b.value?(m(),c("div",We,"‚úÖ "+d(b.value),1)):f("",!0),h.value?(m(),c("div",Ue,"‚ùå "+d(h.value),1)):f("",!0),v.value.length?(m(),c("div",Be,[i("div",je,[i("h3",Pe," üéØ Aper√ßu ("+d(v.value.length)+" quiz ‚Ä¢ "+d(P())+" questions total) ",1),i("button",{class:"btn-toggle-explanations",onClick:e[3]||(e[3]=t=>q.value=!q.value)},d(q.value?"üôà Masquer":"üëÅÔ∏è Voir")+" explications ",1)]),i("div",Re,[(m(!0),c(z,null,C(v.value,(t,a)=>(m(),c("div",{key:a,class:"quiz-preview-card"},[i("div",Ve,[i("h4",Fe,d(t.titre),1),i("span",{class:G(["difficulty-badge",t.difficulty])},d(ee(t.difficulty)),3)]),i("p",Oe,d(t.instruction),1),i("div",De,[i("span",Ge,"üìù "+d(t.questions.length)+" questions",1),t.questions.some(n=>n.explanation)?(m(),c("span",Je,"üí° "+d(t.questions.filter(n=>n.explanation).length)+" explications",1)):f("",!0),t.image?(m(),c("span",He,"üñºÔ∏è "+d(t.image.split(",").length)+" images",1)):f("",!0)]),i("div",Ke,[(m(!0),c(z,null,C(t.questions.slice(0,2),(n,u)=>(m(),c("div",{key:u,class:"question-mini"},[i("div",Xe,[i("strong",null,"Q"+d(u+1)+":",1),i("div",{innerHTML:L(n.question,t.image)},null,8,Ye)]),i("div",Ze,[(m(!0),c(z,null,C(n.options,(r,g)=>(m(),c("span",{key:g,class:G(["option-mini",{correct:g===n.correct_answer}])},[$(d(String.fromCharCode(65+g))+": ",1),i("span",{innerHTML:L(r,t.image)},null,8,et)],2))),128))]),q.value?(m(),c("div",tt,[n.explanation?(m(),c("div",st,[e[16]||(e[16]=i("strong",null,"üí° Explication:",-1)),i("div",{innerHTML:L(n.explanation,t.image)},null,8,it)])):(m(),c("div",at,e[17]||(e[17]=[i("em",null,"‚ö†Ô∏è Aucune explication fournie pour cette question",-1)])))])):f("",!0)]))),128)),t.questions.length>2?(m(),c("div",nt,[$(" ... et "+d(t.questions.length-2)+" autres questions ",1),q.value?(m(),c("span",rt," ("+d(t.questions.slice(2).filter(n=>n.explanation).length)+" explications dans les autres questions) ",1)):f("",!0)])):f("",!0)])]))),128))])])):f("",!0)]))}},ft=de(lt,[["__scopeId","data-v-1db5e708"]]);export{ft as default};
