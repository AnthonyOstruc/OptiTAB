import{c as E,M as T,a as c,A as V,f as A,z as F,y as H,o as v,d as a,b as S,t as L}from"./vendor-C_Y2k9EH.js";import{D as R}from"./DashboardLayout-Bf4-SQY0.js";import{_ as j,d as P,u as z}from"./index-BKOtkL97.js";import{h as I,e as N,b as x}from"./curriculum-V8_ImaXo.js";import{C as J}from"./ChapitresListView-BiShYCdP.js";import"./menuItems-QcQMPWTp.js";import"./matieres-DitvPObI.js";import"./ui-jaH5oyHW.js";import"./pdf-B39ievqC.js";import"./mathlive-B5k0jhbN.js";import"./BackButton-5BtKBZ8O.js";const O={class:"chapitres-section"},K={key:0,class:"chapitres-loader"},U={key:1,class:"chapitres-error"},Z=12e4,$={__name:"Chapitres",setup(q){const f=T(),y=H(),C=P();z(),E(()=>C.activeMatiereId||f.params.matiereId);const l=c(null);function M(){const t=l.value||C.activeMatiereId||f.params.matiereId;t?y.push({name:"Themes",params:{matiereId:String(t)}}):y.push({name:"Exercises"})}const o=c([]),u=c(""),p=c(!0),h=c("");function g(t){return`chapitres_meta:${t}`}function B(t){try{const e=localStorage.getItem(g(t));if(!e)return null;const r=JSON.parse(e);return!r?.t||!r?.v||Date.now()-r.t>Z?null:r.v}catch{return null}}function m(t,e){try{localStorage.setItem(g(t),JSON.stringify({t:Date.now(),v:e}))}catch{}}async function _(){const t=f.params.notionId;if(t){p.value=!0,h.value="";try{const e=B(t);if(e){u.value=e.notion?.nom||e.notion?.titre||"Notion",l.value=e.notion?.matiere||null,o.value=Array.isArray(e.chapitres)?e.chapitres:[],p.value=!1,I(t).then(i=>{const n=i?.data||i,w=n?.notion||{},b=n?.chapitres||[];w&&Array.isArray(b)&&m(t,{notion:w,chapitres:b})}).catch(async()=>{try{const[i,n]=await Promise.all([N(t),x(t)]);m(t,{notion:i,chapitres:Array.isArray(n)?n:[]})}catch{}});return}const r=await I(t),s=r?.data||r,d=s?.notion||{},k=s?.chapitres||[];u.value=d?.nom||d?.titre||"Notion",l.value=d?.matiere||null,o.value=Array.isArray(k)?k:[],m(t,{notion:d,chapitres:o.value})}catch{try{const[r,s]=await Promise.all([N(t),x(t)]);u.value=r?.nom||r?.titre||"Notion",l.value=r?.matiere||null,o.value=Array.isArray(s)?s:[],m(t,{notion:r,chapitres:o.value})}catch{h.value="Impossible de charger les chapitres. Veuillez réessayer."}}finally{p.value=!1}}}V(()=>{_()});function D(t){y.push({name:"Exercices",params:{chapitreId:t}})}return(t,e)=>(v(),A(R,null,{default:F(()=>[a("section",O,[p.value?(v(),S("div",K,e[0]||(e[0]=[a("div",{class:"loader-spinner"},null,-1),a("p",null,"Chargement des chapitres...",-1)]))):h.value?(v(),S("div",U,[e[1]||(e[1]=a("div",{class:"error-icon"},[a("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[a("path",{d:"M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),e[2]||(e[2]=a("h3",null,"Erreur de chargement",-1)),a("p",null,L(h.value),1),a("button",{class:"retry-button",onClick:_}," Réessayer ")])):(v(),A(J,{key:2,title:u.value,chapitres:o.value,"back-button-text":"Retour aux thèmes","back-action":M,"on-chapitre-click":D},null,8,["title","chapitres"]))])]),_:1}))}},it=j($,[["__scopeId","data-v-ce9b4c1f"]]);export{it as default};
