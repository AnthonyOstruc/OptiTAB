import{y as J,a as f,A as K,B as O,ap as P,b as a,o as s,d as i,a1 as F,t as g,F as b,p as S,g as W,f as M}from"./vendor-C_Y2k9EH.js";import{_ as G,u as Q}from"./index-BKOtkL97.js";import{a as X}from"./themes-CuKcvHof.js";import{N as R}from"./NotionCard-eBmfYLKP.js";const Y={class:"tnv-wrapper"},Z={key:0,class:"tnv-state tnv-loading"},tt={key:1,class:"tnv-state tnv-error"},et={key:2,class:"tnv-content"},ot={key:0,class:"tnv-themes"},nt={class:"tnv-theme-header"},rt={class:"tnv-theme-title"},st={class:"tnv-theme-count"},it={class:"tnv-notions-grid"},at={key:0,class:"tnv-no-notions"},lt={key:1,class:"tnv-fallback"},ct={class:"tnv-notions-grid"},L=12e4,dt={__name:"ThemeNotionsView",props:{matiereId:{type:[Number,String],required:!0},notionRouteName:{type:String,required:!0}},setup(T){const w=T,U=J(),A=Q(),h=f(!1),m=f(""),u=f([]),l=f({}),y=f([]);function B(o){U.push({name:w.notionRouteName,params:{notionId:o}})}const $=new Map;function E(o){return`tnv_cache:${V(o)}`}function q(o){try{const e=localStorage.getItem(E(o));if(!e)return null;const t=JSON.parse(e);return!t||!t.t||!t.v||Date.now()-t.t>L?null:t}catch{return null}}function z(o,e){try{const t=JSON.stringify({t:Date.now(),v:e});localStorage.setItem(E(o),t)}catch{}}function V(o){const e=A.niveau_pays?.id||"n",t=A.pays?.id||"p";return`${o}|${e}|${t}`}let d=null;async function _(o){if(!o)return;m.value="";const e=V(o),t=$.get(e)||q(o);t&&Date.now()-t.t<L?(u.value=t.v.themes,l.value=t.v.themeToNotions,y.value=t.v.directNotions,h.value=!1):h.value=!0;try{if(d)try{d.abort()}catch{}d=new AbortController;const{data:r}=await X({matiere:o,signal:d.signal}),N=Array.isArray(r?.themes)?r.themes:[],H=[...N].sort((n,c)=>{const v=Number(n?.ordre??0),p=Number(c?.ordre??0);if(v!==p)return v-p;const C=(n?.nom??n?.titre??"").toString(),x=(c?.nom??c?.titre??"").toString();return C.localeCompare(x)}),j=Array.isArray(r?.notions)?r.notions:[],D=(n,c)=>{const v=Number(n?.ordre??0),p=Number(c?.ordre??0);if(v!==p)return v-p;const C=(n?.nom??n?.titre??"").toString(),x=(c?.nom??c?.titre??"").toString();return C.localeCompare(x)},k={};for(const n of[...j].sort(D))k[n.theme]||(k[n.theme]=[]),k[n.theme].push(n);u.value=H,l.value=k,y.value=N.length===0?[...j.filter(n=>!n.theme)].sort(D):[];const I={themes:u.value,themeToNotions:l.value,directNotions:y.value};$.set(e,{t:Date.now(),v:I}),z(o,I)}catch(r){if(r?.name==="CanceledError"||r?.name==="AbortError")return;m.value="Erreur lors du chargement des concepts"}finally{h.value=!1}}return K(()=>_(w.matiereId)),O(()=>w.matiereId,o=>_(o)),P(()=>{if(d)try{d.abort()}catch{}}),(o,e)=>(s(),a("div",Y,[h.value?(s(),a("div",Z,e[1]||(e[1]=[i("div",{class:"tnv-spinner"},null,-1),i("p",null,"Chargement des concepts...",-1)]))):m.value?(s(),a("div",tt,[e[2]||(e[2]=F('<div class="tnv-error-icon" data-v-cf46582f><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-cf46582f><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" data-v-cf46582f></circle><line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2" data-v-cf46582f></line><line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2" data-v-cf46582f></line></svg></div>',1)),i("p",null,g(m.value),1),i("button",{class:"tnv-retry",onClick:e[0]||(e[0]=t=>_(T.matiereId))},"Réessayer")])):(s(),a("div",et,[u.value.length>0?(s(),a("div",ot,[(s(!0),a(b,null,S(u.value,t=>(s(),a("div",{key:t.id,class:"tnv-theme-block"},[i("div",nt,[i("h2",rt,g(t.nom),1),i("div",st,g((l.value[t.id]||[]).length)+" concept"+g((l.value[t.id]||[]).length>1?"s":""),1)]),i("div",it,[(s(!0),a(b,null,S(l.value[t.id]||[],r=>(s(),M(R,{key:r.id,title:r.nom,description:r.description||"",onClick:N=>B(r.id)},null,8,["title","description","onClick"]))),128)),l.value[t.id]&&l.value[t.id].length?W("",!0):(s(),a("div",at,e[3]||(e[3]=[F('<div class="tnv-empty-icon" data-v-cf46582f><svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-cf46582f><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-cf46582f></path><polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-cf46582f></polyline><line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-cf46582f></line><line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-cf46582f></line><polyline points="10,9 9,9 8,9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-cf46582f></polyline></svg></div><p data-v-cf46582f>Aucun concept disponible</p>',2)])))])]))),128))])):(s(),a("div",lt,[e[4]||(e[4]=i("div",{class:"tnv-fallback-header"},[i("h3",null,"Concepts disponibles"),i("p",null,"Explorez les concepts fondamentaux de cette matière")],-1)),i("div",ct,[(s(!0),a(b,null,S(y.value,t=>(s(),M(R,{key:t.id,title:t.nom,description:t.description||"",onClick:r=>B(t.id)},null,8,["title","description","onClick"]))),128))])]))]))]))}},ht=G(dt,[["__scopeId","data-v-cf46582f"]]);export{ht as T};
