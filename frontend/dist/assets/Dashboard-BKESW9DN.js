import{D as be}from"./DashboardLayout-CioqXtbg.js";import{_ as ae,u as ce,f as ke,a as ye,b as me,X as xe,c as Ce,d as Se,e as we,g as Me,h as ge,i as De,r as je}from"./index-DCsGFNRY.js";import{a as y,c as F,D as ze,e as re,b as a,o as s,d as e,n as P,i as S,l as B,x as q,t,F as A,s as K,q as ve,h as le,C as G,G as Pe,w as _e,A as pe,f as Ne,j as ie,m as de,K as ue,J as Ee}from"./vendor-1gmgAmFu.js";import{g as Te,a as Ie}from"./curriculum-snq3CWRS.js";import{g as Re}from"./matieres-D5ssBX4k.js";import{g as Xe}from"./exercices-DZNA1MYX.js";import{B as $e}from"./BaseHistory-BP2m3P1M.js";import{c as fe}from"./quiz-8lezawii.js";import{useDailyObjectives as Le}from"./useDailyObjectives-DdBBXN9a.js";import"./menuItems-C0wivC9l.js";import"./ui-jaH5oyHW.js";import"./pdf-B39ievqC.js";import"./mathlive-B5k0jhbN.js";const qe={class:"leaderboard-card"},Ve={class:"leaderboard-header"},Ae={class:"leaderboard-tabs"},Qe=["disabled"],He={key:0,class:"flag"},Be=["disabled"],Oe={key:0,class:"leaderboard-body"},Fe={class:"leaderboard-content"},Ue={key:0,class:"leaderboard-item me-item"},Je={class:"rank"},We={class:"me-rank"},Ge={class:"me-sub"},Ke={class:"user"},Ye={class:"info"},Ze={class:"meta"},et={key:0,class:"flag"},tt={key:1,class:"niveau"},st={class:"xp"},at={class:"me-xp"},ot={class:"me-percent"},it={class:"leaderboard-list"},nt={class:"rank"},rt={key:0,class:"trophy gold"},lt={key:1,class:"trophy silver"},ct={key:2,class:"trophy bronze"},dt={key:3},ut={class:"user"},vt={class:"avatar"},_t={class:"info"},pt={class:"name"},mt={key:0,class:"flag name-flag"},ht={class:"first-name"},gt={class:"last-name"},ft={key:0,class:"meta"},yt={class:"xp"},$t={key:1,class:"expanded-section"},bt={class:"expanded-header"},kt={class:"expanded-count"},xt={class:"leaderboard-list"},Ct={class:"rank"},St={class:"user"},wt={class:"avatar"},Mt={class:"info"},Dt={class:"name"},jt={key:0,class:"flag name-flag"},zt={class:"first-name"},Pt={class:"last-name"},Nt={key:0,class:"meta"},Et={class:"xp"},Tt={key:0,class:"leaderboard-actions"},It=["disabled"],Rt={key:1,class:"empty-state"},Xt={key:1,class:"leaderboard-loading"},Lt={__name:"LeaderboardWidget",setup(Z){const b=ce(),m=y("global"),E=y(!0);y([]);const k=y(null),M=y(!1),D=y([]),$=F(()=>!!b?.pays?.id),d=F(()=>!!b?.niveau_pays?.id);function _(X){X==="pays"&&!$.value||X==="niveau"&&!d.value||(m.value=X)}function j(X){if(!X)return"U";const c=String(X).trim().split(/\s+/);return c.length===1?c[0].substring(0,2).toUpperCase():(c[0].substring(0,1)+c[1].substring(0,1)).toUpperCase()}function N(X){const c=String(X||"").trim();if(!c)return{firstName:"",lastName:""};const v=c.split(/\s+/),x=v[0]||"",i=v.slice(1).join(" ")||"";return{firstName:x,lastName:i}}async function L(){E.value=!0;try{const c=(await ke({scope:m.value,limit:50}))?.data?.data||{},v=c.leaderboard||[];D.value=v.slice(0,50),k.value=c.me||null,M.value=!1}catch{D.value=[],k.value=null}finally{E.value=!1}}async function I(){M.value=!0}function V(){M.value=!1}return ze(m,()=>L()),re(()=>L()),(X,c)=>(s(),a("div",qe,[e("div",Ve,[c[4]||(c[4]=e("h3",{class:"leaderboard-title"},"Classement",-1)),e("div",Ae,[e("button",{class:P(["tab",{active:m.value==="global"}]),onClick:c[0]||(c[0]=v=>_("global"))},"Global",2),e("button",{class:P(["tab",{active:m.value==="pays"}]),onClick:c[1]||(c[1]=v=>_("pays")),disabled:!$.value},[q(b).pays?.drapeau_emoji?(s(),a("span",He,t(q(b).pays?.drapeau_emoji),1)):S("",!0),c[3]||(c[3]=B(" Pays "))],10,Qe),e("button",{class:P(["tab",{active:m.value==="niveau"}]),onClick:c[2]||(c[2]=v=>_("niveau")),disabled:!d.value}," Niveau ",10,Be)])]),E.value?(s(),a("div",Xt,[c[10]||(c[10]=e("div",{class:"skeleton me"},null,-1)),(s(),a(A,null,K(6,v=>e("div",{class:"skeleton row",key:v})),64))])):(s(),a("div",Oe,[e("div",Fe,[k.value?(s(),a("div",Ue,[e("div",Je,[e("div",We,"#"+t(k.value.rank),1),e("div",Ge,"sur "+t(k.value.total),1)]),e("div",Ke,[e("div",Ye,[c[5]||(c[5]=e("div",{class:"name"},"Vous",-1)),e("div",Ze,[k.value.pays_flag?(s(),a("span",et,t(k.value.pays_flag),1)):S("",!0),k.value.niveau?(s(),a("span",tt,t(k.value.niveau),1)):S("",!0)])])]),e("div",st,[e("div",at,t(k.value.xp)+" XP",1),e("div",ot,"Top "+t(k.value.percentile)+"%",1)])])):S("",!0),e("ul",it,[(s(!0),a(A,null,K(D.value.slice(0,5),v=>(s(),a("li",{key:v.id,class:"leaderboard-item"},[e("div",nt,[v.rank===1?(s(),a("span",rt,"🥇")):v.rank===2?(s(),a("span",lt,"🥈")):v.rank===3?(s(),a("span",ct,"🥉")):(s(),a("span",dt,"#"+t(v.rank),1))]),e("div",ut,[e("div",vt,t(j(v.display_name)),1),e("div",_t,[e("div",pt,[v.pays_flag?(s(),a("span",mt,t(v.pays_flag),1)):S("",!0),e("span",ht,t(N(v.display_name).firstName),1),e("span",gt,t(N(v.display_name).lastName),1)]),v.niveau?(s(),a("div",ft,t(v.niveau),1)):S("",!0)])]),e("div",yt,t(v.xp)+" XP",1)]))),128))]),M.value&&D.value.length>5?(s(),a("div",$t,[e("div",bt,[c[6]||(c[6]=e("span",{class:"expanded-title"},"Autres classés",-1)),e("span",kt,t(Math.min(D.value.length-5,45))+" utilisateurs",1)]),e("ul",xt,[(s(!0),a(A,null,K(D.value.slice(5,50),v=>(s(),a("li",{key:v.id,class:"leaderboard-item expanded-item"},[e("div",Ct," #"+t(v.rank),1),e("div",St,[e("div",wt,t(j(v.display_name)),1),e("div",Mt,[e("div",Dt,[v.pays_flag?(s(),a("span",jt,t(v.pays_flag),1)):S("",!0),e("span",zt,t(N(v.display_name).firstName),1),e("span",Pt,t(N(v.display_name).lastName),1)]),v.niveau?(s(),a("div",Nt,t(v.niveau),1)):S("",!0)])]),e("div",Et,t(v.xp)+" XP",1)]))),128))])])):S("",!0)]),D.value.length>0?(s(),a("div",Tt,[M.value?(s(),a("button",{key:1,onClick:V,class:"btn-see-less"},c[8]||(c[8]=[e("span",{class:"btn-text"},"Voir moins",-1)]))):(s(),a("button",{key:0,onClick:I,class:"btn-see-more",disabled:E.value||D.value.length<=5},c[7]||(c[7]=[e("span",{class:"btn-text"},"Voir plus",-1)]),8,It))])):S("",!0),D.value.length?S("",!0):(s(),a("div",Rt,c[9]||(c[9]=[e("div",null,"Pas encore de classement pour ce filtre.",-1)])))]))]))}},qt=ae(Lt,[["__scopeId","data-v-32a3f080"]]),Vt={class:"xp-card"},At={class:"xp-header"},Qt={class:"xp-level"},Ht={class:"xp-ring"},Bt={viewBox:"0 0 36 36",class:"circular-chart"},Ot=["stroke-dasharray"],Ft={x:"18",y:"20.35",class:"percentage"},Ut={class:"xp-next"},Jt={class:"streak-section"},Wt={class:"streak-header"},Gt={class:"streak-icon-container"},Kt={key:0,class:"streak-badge"},Yt={class:"streak-info"},Zt={class:"streak-subtitle"},es={key:0,class:"streak-next-xp"},ts={class:"streak-xp-display"},ss={class:"xp-icon"},as={class:"xp-value"},os={class:"streak-progress-container"},is={class:"streak-progress-bar"},ns={class:"streak-progress-text"},rs={key:0,class:"streak-motivation"},ls={class:"motivation-text"},cs={__name:"XPBadges",setup(Z){const b=ce(),{initializeStreak:m,currentStreak:E,nextStreakXP:k}=ye(),M=F(()=>b.level||0),D=F(()=>b.xp||0),$=F(()=>b.xp_to_next||0),d=F(()=>E.value),_=F(()=>d.value===0?0:d.value<=7?d.value/7*100:((d.value-1)%7+1)/7*100),j=F(()=>{if(d.value===0)return"Commencez votre streak !";if(d.value<=7)return`${d.value}/7 jours`;const c=(d.value-1)%7+1,v=Math.floor((d.value-1)/7)+1;return`${c}/7 jours (semaine ${v})`}),N=()=>d.value===0?"Connectez-vous chaque jour pour gagner des XP":d.value===1?"Excellent début ! Continuez demain":d.value<7?`${d.value} jours consécutifs`:d.value<30?`${d.value} jours - Vous êtes régulier !`:`${d.value} jours - Vous êtes un champion !`,L=()=>{const c=["Continuez comme ça ! Chaque jour compte.","Vous construisez une habitude d'apprentissage solide !","Impressionnant ! Votre persévérance paie.","Vous êtes sur la bonne voie vers la maîtrise !","Chaque jour d'apprentissage vous rapproche de vos objectifs."],v=Math.min(Math.floor(d.value/5),c.length-1);return c[v]},I=()=>d.value===0?1:d.value<=5?d.value:5,V=()=>{const c=I();return c>=5?"👑":c>=3?"🏆":c>=2?"⭐":"💎"},X=F(()=>{const c=Number(M.value||0),v=Number(D.value||0),x=c*c*10,i=(c+1)*(c+1)*10,w=Math.max(v,x)-x,W=Math.max(1,i-x);return`${Math.min(100,Math.round(w/W*100))}, 100`});return re(()=>{m()}),(c,v)=>(s(),a("div",Vt,[e("div",At,[v[0]||(v[0]=e("div",{class:"xp-title"},"Progression XP",-1)),e("div",Qt,"Niveau "+t(M.value),1)]),e("div",Ht,[(s(),a("svg",Bt,[v[1]||(v[1]=e("path",{class:"circle-bg",d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"},null,-1)),e("path",{class:"circle","stroke-dasharray":X.value,d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"},null,8,Ot),e("text",Ft,t(D.value)+" XP",1)]))]),e("div",Ut,t($.value)+" XP pour le prochain niveau",1),e("div",Jt,[e("div",Wt,[e("div",Gt,[e("span",{class:P(["streak-icon",{"streak-active":d.value>0}])},"🔥",2),d.value>0?(s(),a("div",Kt,t(d.value),1)):S("",!0)]),e("div",Yt,[v[2]||(v[2]=e("h4",{class:"streak-title"},"Streak Quotidien",-1)),e("p",Zt,t(N()),1),d.value>0?(s(),a("p",es,"Prochain: +"+t(q(k))+" XP",1)):S("",!0)]),e("div",ts,[e("span",ss,t(V()),1),e("span",as,"+"+t(I())+" XP",1)])]),e("div",os,[e("div",is,[e("div",{class:"streak-progress-fill",style:ve({width:_.value+"%"})},null,4)]),e("div",ns,t(j.value),1)]),d.value>0?(s(),a("div",rs,[e("p",ls,t(L()),1)])):S("",!0)])]))}},ds=ae(cs,[["__scopeId","data-v-b0d85bb8"]]),us={key:0,class:"game-reset-notification"},vs={__name:"GameResetNotification",props:{autoHide:{type:Number,default:8e3}},setup(Z){const b=Z,m=y(!1);function E(){m.value=!1,localStorage.setItem("game-reset-notification-seen","true")}return re(()=>{localStorage.getItem("game-reset-notification-seen")||(m.value=!0,b.autoHide>0&&setTimeout(()=>{m.value&&E()},b.autoHide))}),(k,M)=>(s(),le(Pe,{name:"notification",appear:""},{default:G(()=>[m.value?(s(),a("div",us,[M[0]||(M[0]=e("div",{class:"notification-icon"},[e("span",null,"🎮")],-1)),M[1]||(M[1]=e("div",{class:"notification-content"},[e("div",{class:"notification-title"}," Système de gamification mis à jour ! "),e("div",{class:"notification-message"},[e("p",null,[B("🎯 "),e("strong",null,"Nouveau :"),B(" Seuls les "),e("strong",null,"quiz"),B(" donnent maintenant des XP")]),e("p",null,"📚 Les exercices guidés restent éducatifs (0 XP)"),e("p",null,"🏆 Tous les compteurs ont été remis à zéro pour un restart équitable")])],-1)),e("button",{onClick:E,class:"notification-close"}," ✕ ")])):S("",!0)]),_:1}))}},_s=ae(vs,[["__scopeId","data-v-64a66099"]]),ps={class:"stats-grid"},ms={class:"stat-card quiz-completed"},hs={class:"stat-value"},gs={class:"stat-card quiz-average"},fs={class:"stat-value"},ys={class:"stat-card quiz-notions"},$s={class:"stat-value"},bs={class:"summary-table"},ks={class:"summary-header"},xs={class:"summary-row"},Cs={class:"cell matiere"},Ss={class:"cell notion"},ws=["onClick"],Ms={class:"notion-label"},Ds={class:"cell count"},js={class:"cell correct"},zs={class:"cell incorrect"},Ps={key:0,class:"summary-details-row"},Ns={class:"details-cell"},Es={class:"chapter-table"},Ts={key:0,class:"chapter-loading"},Is={key:1,class:"chapter-error"},Rs={key:2},Xs={class:"cell chapitre"},Ls={class:"cell count"},qs={class:"cell correct"},Vs={class:"cell incorrect"},As={class:"cell ratio"},Qs={class:"cell unlock"},Hs={class:"matiere-grid"},Bs={class:"matiere-name"},Os={class:"matiere-info"},Fs={class:"matiere-average"},Us={class:"matiere-count"},Js=["onClick"],Ws={key:0,class:"inline-mastery-icon"},Gs={class:"inline-mastery-label"},Ks=["onClick"],Ys={class:"quiz-card-title-section"},Zs=["onClick","title"],ea={class:"quiz-breadcrumb-compact"},ta={class:"quiz-card-actions"},sa=["title"],aa={key:0,class:"retry-indicator"},oa={key:0,class:"quiz-card-details"},ia={class:"quiz-breadcrumb"},na={class:"breadcrumb-item"},ra={class:"breadcrumb-item"},la={class:"breadcrumb-item"},ca={class:"quiz-meta"},da={class:"quiz-attempt"},ua={key:0,class:"total-attempts"},va={class:"quiz-date"},_a={key:0,class:"quiz-time"},pa={__name:"QuizHistoryRefactored",setup(Z,{expose:b}){const m=pe(),E=y("all"),k=y([]),M=y(new Map),D=y([]),$=y("count"),d=y("desc"),_=y(new Set),j=y({}),N=[{value:"all",label:"Tous",icon:"",class:"all"},{value:"mastered",label:"Maîtrisés",icon:"✅",class:"mastered"},{value:"average",label:"Moyens",icon:"⚠️",class:"average"},{value:"poor",label:"Non maîtrisés",icon:"❌",class:"poor"}],L=F(()=>{let n=k.value;return E.value!=="all"&&(n=n.filter(r=>{const u=r.score_on_10;switch(E.value){case"mastered":return u>=7;case"average":return u>=5&&u<7;case"poor":return u<5;default:return!0}})),n}),I=F(()=>[...D.value||[]].sort((u,g)=>{const R=u[$.value]||0,T=g[$.value]||0;return d.value==="asc"?R-T:T-R})),V=n=>{$.value===n?d.value=d.value==="asc"?"desc":"asc":($.value=n,d.value="desc")},X=n=>n===0?"0%":`${Math.round(n)}%`,c=n=>n>=90?"excellent":n>=75?"good":n>=50?"average":"poor",v=n=>{const r=Array.isArray(n.quiz_list)?n.quiz_list:[];k.value=r.slice(0,6),D.value=l(r),o(k.value)},x=n=>{},i=n=>n>=7?"score-good":n>=5?"score-average":"score-poor",o=async n=>{const r=new Map(M.value);await Promise.all((n||[]).map(async u=>{try{const g=await fe(u.quiz_id);r.set(u.quiz_id,g)}catch{}})),M.value=r},w=n=>{const r=M.value.get(n.quiz_id);return r&&r.can_attempt===!1},W=n=>{const r=M.value.get(n.quiz_id);return!r||r.can_attempt!==!1?"":r.time_remaining_formatted||r.message||"Verrouillé"},ee=n=>{if(w(n)){alert(W(n)||"Quiz verrouillé");return}z(n)},se=()=>{m.push({name:"QuizzesHistory"})},oe=n=>`${n.matiere.id}-${n.notion.id}`,ne=n=>_.value.has(oe(n)),te=n=>{const r=oe(n);return j.value[r]||(j.value[r]={loading:!1,error:"",chapters:[]}),j.value[r]},Q=async n=>{const r=oe(n);if(_.value.has(r)){_.value.delete(r);return}_.value.add(r);const u=te(n);u.chapters&&u.chapters.length>0||await H(n.matiere.id,n.notion.id)},H=async(n,r)=>{const u=`${n}-${r}`;j.value[u]={loading:!0,error:"",chapters:[]};try{const g=await me.get("/api/suivis/quiz/stats/",{params:{matiere:n,notion:r}}),R=Array.isArray(g?.data?.quiz_list)?g.data.quiz_list:[],T=await U(R);j.value[u]={loading:!1,error:"",chapters:T}}catch(g){const R=g?.response?.data?.error||"Erreur lors du chargement des détails";j.value[u]={loading:!1,error:R,chapters:[]}}},U=async n=>{const r=new Map,u=new Map,g=new Map;for(const T of n){const f=T?.chapitre||{},O=f?.id;if(!O)continue;r.has(O)||r.set(O,{chapitre:{id:O,titre:f?.titre||"Chapitre"},count:0,correct_count:0,incorrect_count:0,sum_score_10:0});const Y=r.get(O);Y.count+=1,Y.sum_score_10+=Number(T.score_on_10||0),(T.score_on_10||0)>=7?Y.correct_count+=1:Y.incorrect_count+=1}await Promise.all(n.map(async T=>{try{const f=await fe(T.quiz_id);if(f&&f.can_attempt===!1){const O=T?.chapitre?.id;if(!O)return;u.set(O,(u.get(O)||0)+1);const Y=Number(f.time_remaining_seconds||0),he=g.get(O);(!he||Y<he)&&g.set(O,Y)}}catch{}}));const R=Array.from(r.values()).map(T=>{const f=T.count>0?T.correct_count/T.count:0,O=T.count>0?T.sum_score_10/T.count:0,Y=g.get(T.chapitre.id)||0;return{...T,ratio_percent:f*100,average_10:Math.round(O*10)/10,average_percent:f*100,locked_count:u.get(T.chapitre.id)||0,next_unlock_seconds:Y,next_unlock_formatted:Y>0?p(Y):""}});return R.sort((T,f)=>String(T.chapitre.titre).localeCompare(String(f.chapitre.titre),"fr",{sensitivity:"base"})),R},p=n=>{const r=Math.floor(n/3600),u=Math.floor(n%3600/60);return r>0?`${r}h${String(u).padStart(2,"0")}min`:`${u}min`},l=n=>{const r=new Map;for(const g of n){const R=g?.matiere||{},T=g?.notion||{},f=`${R.id}-${T.id}`;r.has(f)||r.set(f,{matiere:{id:R.id,titre:R.titre||""},notion:{id:T.id,titre:T.titre||""},count:0,correct_count:0,incorrect_count:0});const O=r.get(f);O.count+=1,(g.score_on_10||0)>=7?O.correct_count+=1:O.incorrect_count+=1}const u=Array.from(r.values()).map(g=>({...g,average_percent:g.count>0?g.correct_count/g.count*100:0}));return u.sort((g,R)=>String(g.matiere.titre).localeCompare(String(R.matiere.titre),"fr",{sensitivity:"base"})||String(g.notion.titre).localeCompare(String(R.notion.titre),"fr",{sensitivity:"base"})),u},z=async n=>{try{const r=n.chapitre.id,u=n.quiz_id;await m.push({path:`/quiz-exercices/${r}`,query:{quizId:u,autoStart:"true"}})}catch{}},h=n=>{E.value=n},C=n=>new Date(n).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),J=n=>{const r=Math.floor(n/60),u=n%60;return`${r}:${u.toString().padStart(2,"0")}`};return b({updateSelectedMastery:h}),(n,r)=>(s(),le($e,{title:"🧠 Historique des Quiz","list-title":"📝 Quiz effectués","loading-text":"Chargement des quiz...","api-endpoint":"/api/suivis/quiz/stats/","extra-params":{limit:6},"custom-filters":N,"navigation-handler":z,"items-per-page":6,"filtered-items":L.value,onDataLoaded:v,onFilterChanged:x},{"header-actions":G(()=>[e("button",{class:"view-history-btn",onClick:se,title:"Voir tout l'historique","aria-label":"Voir tout l'historique"}," Voir l'historique ")]),"global-stats":G(({stats:u})=>[e("div",ps,[e("div",ms,[r[4]||(r[4]=e("span",{class:"stat-label"},"Quiz effectués",-1)),e("span",hs,t(u.completed||0),1)]),e("div",gs,[r[5]||(r[5]=e("span",{class:"stat-label"},"Note moyenne",-1)),e("span",fs,t(u.average||0)+"/10",1)]),e("div",ys,[r[6]||(r[6]=e("span",{class:"stat-label"},"Notions maîtrisées",-1)),e("span",$s,t(u.masteredNotions||0),1)])])]),"matiere-notion-stats":G(()=>[e("div",bs,[e("div",ks,[r[11]||(r[11]=e("div",null,"Matière",-1)),r[12]||(r[12]=e("div",null,"Notion",-1)),e("div",{class:"sortable-header",onClick:r[0]||(r[0]=u=>V("count"))},[r[7]||(r[7]=B(" Faits ")),e("span",{class:P(["sort-icon",{active:$.value==="count"}])},t($.value==="count"&&d.value==="asc"?"↑":"↓"),3)]),e("div",{class:"sortable-header",onClick:r[1]||(r[1]=u=>V("correct_count"))},[r[8]||(r[8]=B(" Réussis ")),e("span",{class:P(["sort-icon",{active:$.value==="correct_count"}])},t($.value==="correct_count"&&d.value==="asc"?"↑":"↓"),3)]),e("div",{class:"sortable-header",onClick:r[2]||(r[2]=u=>V("incorrect_count"))},[r[9]||(r[9]=B(" Ratés ")),e("span",{class:P(["sort-icon",{active:$.value==="incorrect_count"}])},t($.value==="incorrect_count"&&d.value==="asc"?"↑":"↓"),3)]),e("div",{class:"sortable-header",onClick:r[3]||(r[3]=u=>V("average_percent"))},[r[10]||(r[10]=B(" Moyenne ")),e("span",{class:P(["sort-icon",{active:$.value==="average_percent"}])},t($.value==="average_percent"&&d.value==="asc"?"↑":"↓"),3)])]),(s(!0),a(A,null,K(I.value,u=>(s(),a(A,{key:`${u.matiere.id}-${u.notion.id}`},[e("div",xs,[e("div",Cs,t(u.matiere.titre),1),e("div",Ss,[e("button",{class:"notion-toggle",onClick:g=>Q(u)},[e("span",Ms,t(u.notion.titre),1),(s(),a("svg",{class:P(["chevron",{expanded:ne(u)}]),width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},r[13]||(r[13]=[e("polyline",{points:"6,9 12,15 18,9"},null,-1)]),2))],8,ws)]),e("div",Ds,t(u.count),1),e("div",js,t(u.correct_count),1),e("div",zs,t(u.incorrect_count),1),e("div",{class:P(["cell average",c(u.average_percent)])},t(X(u.average_percent)),3)]),ne(u)?(s(),a("div",Ps,[e("div",Ns,[e("div",Es,[r[14]||(r[14]=e("div",{class:"chapter-header"},[e("div",null,"Chapitre"),e("div",null,"Faits"),e("div",null,"Réussis"),e("div",null,"Ratés"),e("div",null,"Réussite"),e("div",null,"Verrouillés"),e("div",null,"Déverrouillage"),e("div",null,"Moyenne")],-1)),te(u).loading?(s(),a("div",Ts,"Chargement des détails...")):te(u).error?(s(),a("div",Is,t(te(u).error),1)):(s(),a("div",Rs,[(s(!0),a(A,null,K(te(u).chapters,g=>(s(),a("div",{key:g.chapitre.id,class:"chapter-row"},[e("div",Xs,t(g.chapitre.titre),1),e("div",Ls,t(g.count),1),e("div",qs,t(g.correct_count),1),e("div",Vs,t(g.incorrect_count),1),e("div",As,t(Math.round(g.ratio_percent))+"%",1),e("div",{class:P(["cell locked",{haslock:(g.locked_count||0)>0}])},t(g.locked_count||0),3),e("div",Qs,t(g.next_unlock_formatted||"-"),1),e("div",{class:P(["cell average",c(g.average_percent)])},t(Math.round(g.average_10*10)/10)+"/10",3)]))),128))]))])])])):S("",!0)],64))),128))])]),"matiere-stats":G(({stats:u})=>[r[15]||(r[15]=e("h4",{class:"section-subtitle"},"📊 Moyennes par matière",-1)),e("div",Hs,[(s(!0),a(A,null,K(u,g=>(s(),a("div",{key:g.id,class:"matiere-card"},[e("div",Bs,t(g.titre),1),e("div",Os,[e("span",Fs,t(g.average)+"/10",1),e("span",Us,t(g.quiz_count)+" quiz",1)])]))),128))])]),"custom-filters":G(({filters:u,selected:g})=>[(s(!0),a(A,null,K(u,R=>(s(),a("button",{key:R.value,onClick:T=>h(R.value),class:P(["inline-mastery-btn",{active:g===R.value},R.class])},[R.icon?(s(),a("span",Ws,t(R.icon),1)):S("",!0),e("span",Gs,t(R.label),1)],10,Js))),128))]),"items-list":G(({items:u,toggleDetails:g,isExpanded:R,navigateToItem:T})=>[(s(!0),a(A,null,K(u,f=>(s(),a("div",{key:f.id,class:P(["quiz-card",{"multiple-attempts":f.total_attempts>1,locked:w(f)}])},[e("div",{class:"quiz-card-header",onClick:O=>g(f.id)},[e("div",Ys,[e("h5",{class:P(["quiz-card-title clickable-title",{locked:w(f)}]),onClick:_e(O=>ee(f),["stop"]),title:w(f)?"Verrouillé":"Accéder au quiz: "+f.quiz_titre},[B(t(f.quiz_titre)+" ",1),r[16]||(r[16]=e("svg",{class:"navigation-icon",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M7 17l9.2-9.2M17 17V7H7"})],-1))],10,Zs),e("div",ea,t(f.matiere.titre)+" → "+t(f.notion.titre),1)]),e("div",ta,[w(f)?(s(),a("div",{key:0,class:"lock-badge",title:W(f)}," 🔒 "+t(W(f)),9,sa)):(s(),a("div",{key:1,class:P(["quiz-score",i(f.score_on_10)])},[B(t(f.score_on_10)+"/10 ",1),f.total_attempts>1?(s(),a("span",aa,"↻")):S("",!0)],2)),e("button",{class:P(["expand-toggle",{expanded:R(f.id)}])},r[17]||(r[17]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"6,9 12,15 18,9"})],-1)]),2)])],8,Ks),R(f.id)?(s(),a("div",oa,[e("div",ia,[e("span",na,t(f.matiere.titre),1),r[18]||(r[18]=e("span",{class:"breadcrumb-separator"},"→",-1)),e("span",ra,t(f.notion.titre),1),r[19]||(r[19]=e("span",{class:"breadcrumb-separator"},"→",-1)),e("span",la,t(f.chapitre.titre),1)]),e("div",ca,[e("span",da,[B(" Tentative #"+t(f.tentative_numero)+" ",1),f.total_attempts>1?(s(),a("span",ua," ("+t(f.total_attempts)+" au total) ",1)):S("",!0)]),e("span",va,t(C(f.date_creation)),1),f.temps_total_seconde?(s(),a("span",_a,t(J(f.temps_total_seconde)),1)):S("",!0)])])):S("",!0)],2))),128))]),"empty-state":G(()=>r[20]||(r[20]=[e("p",null,"Aucun quiz trouvé avec ces filtres",-1)])),_:1},8,["filtered-items"]))}},ma=ae(pa,[["__scopeId","data-v-0024384f"]]),ha={class:"stats-grid"},ga={class:"stat-card exercice-completed"},fa={class:"stat-value"},ya={class:"stat-card exercice-correct"},$a={class:"stat-value"},ba={class:"stat-card exercice-percentage"},ka={class:"stat-value"},xa={class:"stat-card exercice-notions"},Ca={class:"stat-value"},Sa={class:"matiere-grid"},wa={class:"matiere-name"},Ma={class:"matiere-info"},Da={class:"matiere-average"},ja={class:"matiere-count"},za={class:"summary-table"},Pa={class:"summary-header"},Na={class:"summary-row"},Ea={class:"cell matiere"},Ta={class:"cell notion"},Ia=["onClick"],Ra={class:"notion-label"},Xa={class:"cell count"},La={class:"cell correct"},qa={class:"cell incorrect"},Va={key:0,class:"summary-details-row"},Aa={class:"details-cell"},Qa={class:"chapter-table"},Ha={key:0,class:"chapter-loading"},Ba={key:1,class:"chapter-error"},Oa={key:2},Fa={class:"cell chapitre"},Ua={class:"cell count"},Ja={class:"cell correct"},Wa={class:"cell incorrect"},Ga={class:"cell ratio"},Ka={class:"inline-mastery-filters"},Ya=["onClick","title","aria-label"],Za={class:"inline-mastery-icon"},eo={class:"inline-mastery-label"},to=["onClick"],so={class:"exercice-card-title-section"},ao=["onClick","title"],oo={class:"exercice-breadcrumb-compact"},io={class:"exercice-card-actions"},no={key:0,class:"exercice-card-details"},ro={class:"exercice-breadcrumb"},lo={class:"breadcrumb-item"},co={class:"breadcrumb-item"},uo={class:"breadcrumb-item"},vo={class:"exercice-meta"},_o={class:"exercice-date"},po={key:0,class:"exercice-time"},mo={key:1,class:"exercice-points"},ho={__name:"ExercicesHistory",setup(Z,{expose:b}){const m=pe(),E=y(null),k=[{value:"all",label:"Tous",icon:"",class:"all"},{value:"correct",label:"Réussis",icon:"✅",class:"correct"},{value:"incorrect",label:"Ratés",icon:"❌",class:"incorrect"}],M=y("all"),D=y([]),$=y("exercice_count"),d=y("desc"),_=y([]),j=y(new Set),N=y({}),L=F(()=>{let p=D.value;return M.value!=="all"&&(p=p.filter(l=>{switch(M.value){case"correct":return l.est_correct===!0;case"incorrect":return l.est_correct===!1;default:return!0}})),p}),I=p=>{const l=Array.isArray(p.exercice_list)?p.exercice_list:[];D.value=l.slice(0,6),_.value=Array.isArray(p.matiere_notion_stats)?p.matiere_notion_stats:[]},V=p=>{},X=p=>p?"status-correct":"status-incorrect",c=async p=>{try{const l=p.exercice_id;await m.push({name:"ExerciceDetail",params:{exerciceId:String(l)}})}catch{}},v=()=>{m.push({name:"ExercisesHistory"})},x=F(()=>_.value.length?[..._.value.map(z=>({...z,average:z.exercice_count>0?z.correct_count/z.exercice_count*100:0}))].sort((z,h)=>{const C=z[$.value]||0,J=h[$.value]||0;return d.value==="asc"?C-J:J-C}):[]),i=p=>{$.value===p?d.value=d.value==="asc"?"desc":"asc":($.value=p,d.value="desc")},o=p=>p===0?"0%":`${Math.round(p)}%`,w=p=>p>=90?"excellent":p>=75?"good":p>=50?"average":"poor",W=p=>`${p.matiere.id}-${p.notion.id}`,ee=p=>j.value.has(W(p)),se=p=>{const l=W(p);return N.value[l]||(N.value[l]={loading:!1,error:"",chapters:[]}),N.value[l]},oe=async p=>{const l=W(p);if(j.value.has(l)){j.value.delete(l);return}j.value.add(l);const z=se(p);z.chapters&&z.chapters.length>0||await ne(p.matiere.id,p.notion.id)},ne=async(p,l)=>{const z=`${p}-${l}`;N.value[z]={loading:!0,error:"",chapters:[]};try{const h=await me.get("/api/suivis/exercices/stats/",{params:{matiere:p,notion:l}}),C=Array.isArray(h?.data?.exercice_list)?h.data.exercice_list:[],J=te(C);N.value[z]={loading:!1,error:"",chapters:J}}catch(h){const C=h?.response?.data?.error||"Erreur lors du chargement des détails";N.value[z]={loading:!1,error:C,chapters:[]}}},te=p=>{const l=new Map;for(const h of p){const C=h?.chapitre||{},J=C?.id;if(!J)continue;l.has(J)||l.set(J,{chapitre:{id:J,titre:C?.titre||"Chapitre"},exercice_count:0,correct_count:0,incorrect_count:0});const n=l.get(J);n.exercice_count+=1,h.est_correct?n.correct_count+=1:n.incorrect_count+=1}const z=Array.from(l.values()).map(h=>{const C=h.exercice_count>0?h.correct_count/h.exercice_count:0,J=Math.round(C*10*10)/10;return{...h,ratio_percent:C*100,average_10:J}});return z.sort((h,C)=>String(h.chapitre.titre).localeCompare(String(C.chapitre.titre),"fr",{sensitivity:"base"})),z},Q=p=>new Date(p).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),H=p=>{const l=Math.floor(p/60),z=p%60;return`${l}:${z.toString().padStart(2,"0")}`},U=p=>{M.value=p};return b({updateSelectedMastery:U}),(p,l)=>(s(),le($e,{ref_key:"baseHistoryRef",ref:E,title:"🧭 Historique des Exercices","list-title":"📝 Exercices effectués","loading-text":"Chargement des exercices...","api-endpoint":"/api/suivis/exercices/stats/","extra-params":{limit:6},"custom-filters":k,"navigation-handler":c,"items-per-page":6,"filtered-items":L.value,onDataLoaded:I,onFilterChanged:V},{"header-actions":G(()=>[e("button",{class:"view-history-btn",onClick:v,title:"Voir tout l'historique","aria-label":"Voir tout l'historique"}," Voir l'historique ")]),"global-stats":G(({stats:z})=>[e("div",ha,[e("div",ga,[l[4]||(l[4]=e("span",{class:"stat-label"},"Exercices effectués",-1)),e("span",fa,t(z.completed||0),1)]),e("div",ya,[l[5]||(l[5]=e("span",{class:"stat-label"},"Exercices réussis",-1)),e("span",$a,t(z.correct||0),1)]),e("div",ba,[l[6]||(l[6]=e("span",{class:"stat-label"},"Taux de réussite",-1)),e("span",ka,t(z.percentage||0)+"%",1)]),e("div",xa,[l[7]||(l[7]=e("span",{class:"stat-label"},"Notions maîtrisées",-1)),e("span",Ca,t(z.masteredNotions||0),1)])])]),"matiere-stats":G(({stats:z})=>[l[8]||(l[8]=e("h4",{class:"section-subtitle"},"📊 Moyennes par matière",-1)),e("div",Sa,[(s(!0),a(A,null,K(z,h=>(s(),a("div",{key:h.id,class:"matiere-card"},[e("div",wa,t(h.titre),1),e("div",Ma,[e("span",Da,t(h.average)+"/10",1),e("span",ja,t(h.exercice_count)+" exercices",1)])]))),128))])]),"matiere-notion-stats":G(({stats:z})=>[e("div",za,[e("div",Pa,[l[13]||(l[13]=e("div",null,"Matière",-1)),l[14]||(l[14]=e("div",null,"Notion",-1)),e("div",{class:"sortable-header",onClick:l[0]||(l[0]=h=>i("exercice_count"))},[l[9]||(l[9]=B(" Faits ")),e("span",{class:P(["sort-icon",{active:$.value==="exercice_count"}])},t($.value==="exercice_count"&&d.value==="asc"?"↑":"↓"),3)]),e("div",{class:"sortable-header",onClick:l[1]||(l[1]=h=>i("correct_count"))},[l[10]||(l[10]=B(" Réussis ")),e("span",{class:P(["sort-icon",{active:$.value==="correct_count"}])},t($.value==="correct_count"&&d.value==="asc"?"↑":"↓"),3)]),e("div",{class:"sortable-header",onClick:l[2]||(l[2]=h=>i("incorrect_count"))},[l[11]||(l[11]=B(" Ratés ")),e("span",{class:P(["sort-icon",{active:$.value==="incorrect_count"}])},t($.value==="incorrect_count"&&d.value==="asc"?"↑":"↓"),3)]),e("div",{class:"sortable-header",onClick:l[3]||(l[3]=h=>i("average"))},[l[12]||(l[12]=B(" Moyenne ")),e("span",{class:P(["sort-icon",{active:$.value==="average"}])},t($.value==="average"&&d.value==="asc"?"↑":"↓"),3)])]),(s(!0),a(A,null,K(x.value,h=>(s(),a(A,{key:`${h.matiere.id}-${h.notion.id}`},[e("div",Na,[e("div",Ea,t(h.matiere.titre),1),e("div",Ta,[e("button",{class:"notion-toggle",onClick:C=>oe(h)},[e("span",Ra,t(h.notion.titre),1),(s(),a("svg",{class:P(["chevron",{expanded:ee(h)}]),width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},l[15]||(l[15]=[e("polyline",{points:"6,9 12,15 18,9"},null,-1)]),2))],8,Ia)]),e("div",Xa,t(h.exercice_count),1),e("div",La,t(h.correct_count),1),e("div",qa,t(h.incorrect_count),1),e("div",{class:P(["cell average",w(h.average)])},t(o(h.average)),3)]),ee(h)?(s(),a("div",Va,[e("div",Aa,[e("div",Qa,[l[16]||(l[16]=e("div",{class:"chapter-header"},[e("div",null,"Chapitre"),e("div",null,"Faits"),e("div",null,"Réussis"),e("div",null,"Ratés"),e("div",null,"Réussite"),e("div",null,"Moyenne")],-1)),se(h).loading?(s(),a("div",Ha,"Chargement des détails...")):se(h).error?(s(),a("div",Ba,t(se(h).error),1)):(s(),a("div",Oa,[(s(!0),a(A,null,K(se(h).chapters,C=>(s(),a("div",{key:C.chapitre.id,class:"chapter-row"},[e("div",Fa,t(C.chapitre.titre),1),e("div",Ua,t(C.exercice_count),1),e("div",Ja,t(C.correct_count),1),e("div",Wa,t(C.incorrect_count),1),e("div",Ga,t(Math.round(C.ratio_percent))+"%",1),e("div",{class:P(["cell average",w(C.average_10*10)])},t(C.average_10)+"/10",3)]))),128))]))])])])):S("",!0)],64))),128))])]),"custom-filters":G(({filters:z,selected:h})=>[e("div",Ka,[(s(!0),a(A,null,K(z,C=>(s(),a("button",{key:C.value,onClick:_e(J=>U(C.value),["stop"]),class:P(["inline-mastery-btn",C.class,{active:M.value===C.value}]),title:C.label,"aria-label":C.label},[e("span",Za,t(C.icon),1),e("span",eo,t(C.label),1)],10,Ya))),128))])]),"items-list":G(({items:z,toggleDetails:h,isExpanded:C,navigateToItem:J})=>[(s(!0),a(A,null,K(z,n=>(s(),a("div",{key:n.id,class:P(["exercice-card",{correct:n.est_correct,incorrect:!n.est_correct}])},[e("div",{class:"exercice-card-header",onClick:r=>h(n.id)},[e("div",so,[e("h5",{class:"exercice-card-title clickable-title",onClick:_e(r=>J(n),["stop"]),title:"Accéder à l'exercice: "+n.exercice_titre},[B(t(n.exercice_titre)+" ",1),l[17]||(l[17]=e("svg",{class:"navigation-icon",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M7 17l9.2-9.2M17 17V7H7"})],-1))],8,ao),e("div",oo,t(n.matiere.titre)+" → "+t(n.notion.titre),1)]),e("div",io,[e("div",{class:P(["exercice-status",X(n.est_correct)])},t(n.est_correct?"✅":"❌"),3),e("button",{class:P(["expand-toggle",{expanded:C(n.id)}])},l[18]||(l[18]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"6,9 12,15 18,9"})],-1)]),2)])],8,to),C(n.id)?(s(),a("div",no,[e("div",ro,[e("span",lo,t(n.matiere.titre),1),l[19]||(l[19]=e("span",{class:"breadcrumb-separator"},"→",-1)),e("span",co,t(n.notion.titre),1),l[20]||(l[20]=e("span",{class:"breadcrumb-separator"},"→",-1)),e("span",uo,t(n.chapitre.titre),1)]),e("div",vo,[e("span",_o,t(Q(n.date_creation)),1),n.temps_seconde?(s(),a("span",po,t(H(n.temps_seconde)),1)):S("",!0),n.points_obtenus?(s(),a("span",mo,t(n.points_obtenus)+" points ",1)):S("",!0)])])):S("",!0)],2))),128))]),"empty-state":G(()=>l[21]||(l[21]=[e("p",null,"Aucun exercice trouvé avec ces filtres",-1),e("p",{class:"empty-hint"},"Essayez de modifier vos filtres ou commencez à faire des exercices !",-1)])),_:1},8,["filtered-items"]))}},go=ae(ho,[["__scopeId","data-v-1974ba44"]]),fo={class:"daily-objectives-card"},yo={key:0,class:"current-objective"},$o={class:"objective-icon"},bo={class:"objective-content"},ko={class:"objective-text"},xo={class:"objective-progress"},Co={class:"progress-bar"},So={class:"progress-text"},wo={key:1,class:"no-objective"},Mo={key:2,class:"completion-badge"},Do={class:"objectives-list"},jo={class:"objective-info"},zo={class:"objective-icon-small"},Po={class:"objective-details"},No={class:"objective-text-small"},Eo={class:"objective-description"},To={class:"objective-reward"},Io={class:"objective-status"},Ro={class:"progress-info"},Xo={class:"progress-bar-modal"},Lo={key:0,class:"status-completed"},qo={class:"modal-footer"},Vo={class:"daily-summary"},Ao={class:"summary-stat"},Qo={class:"stat-value"},Ho={class:"summary-stat"},Bo={class:"stat-value"},Oo={__name:"DailyObjectives",setup(Z){const b=y(!1),{currentObjective:m,unlockedObjectivesList:E,allObjectives:k,loadTodayStats:M,isInitialized:D,simulateQuizEasy:$,simulateQuizMedium:d,simulateQuizHard:_,simulateQuizPerfect:j,simulateExerciseCompleted:N,simulateQuizStreak:L}=Le(),I=F(()=>E.value.filter(Q=>Q.isCompleted).length),V=F(()=>E.value.filter(Q=>Q.isCompleted).reduce((Q,H)=>Q+H.xpReward,0)),X=()=>{b.value=!0},c=()=>{b.value=!1},v=F(()=>{if(!m.value)return 0;const Q=m.value.progress,H=m.value.target;return Math.min(Q/H*100,100)}),x=Q=>Q>=100?"completed":Q>=75?"almost-done":Q>=25?"half-way":Q>0?"starting":"",i=()=>$(),o=()=>d(),w=()=>_(),W=()=>j(),ee=()=>N(),se=()=>L(Math.floor(Math.random()*8)+1),oe=Q=>{M(),setTimeout(()=>{m.value},100)},ne=Q=>{},te=Q=>{};return re(()=>{window.addEventListener("dailyObjectiveProgress",oe),window.addEventListener("objectiveUnlocked",ne),window.addEventListener("dailyObjectiveCompleted",te)}),Ne(()=>{window.removeEventListener("dailyObjectiveProgress",oe),window.removeEventListener("objectiveUnlocked",ne),window.removeEventListener("dailyObjectiveCompleted",te)}),window.testDailyObjectives={quizEasy:i,quizMedium:o,quizHard:w,quizPerfect:W,exerciseCompleted:ee,quizStreak:se},(Q,H)=>(s(),a(A,null,[e("div",fo,[e("div",{class:"objective-header"},[H[1]||(H[1]=e("div",{class:"objective-title"},"🎯 Défi du jour",-1)),e("button",{class:"see-more-btn",onClick:X}," Voir tous les défis ")]),q(D)&&q(m)?(s(),a("div",yo,[e("div",$o,t(q(m).icon),1),e("div",bo,[e("div",ko,t(q(m).text),1),e("div",xo,[e("div",Co,[e("div",{class:P(["progress-fill",x(v.value)]),style:ve({width:v.value+"%"})},null,6)]),e("div",So,t(q(m).progress)+" / "+t(q(m).target),1)])])])):(s(),a("div",wo,[q(D)?(s(),a(A,{key:0},[B(" 🎉 Tous les défis du jour sont terminés ! Revenez demain pour de nouveaux défis. ")],64)):(s(),a(A,{key:1},[B(" ⏳ Chargement des défis du jour... ")],64))])),q(m)&&q(m).isCompleted?(s(),a("div",Mo," ✅ Défi complété ! +"+t(q(m).xpReward)+" XP ",1)):S("",!0)]),b.value?(s(),a("div",{key:0,class:"modal-overlay",onClick:c},[e("div",{class:"modal-content",onClick:H[0]||(H[0]=_e(()=>{},["stop"]))},[e("div",{class:"modal-header"},[H[2]||(H[2]=e("h3",null,"🎯 Vos défis journaliers",-1)),e("button",{class:"close-btn",onClick:c},"×")]),e("div",Do,[(s(!0),a(A,null,K(q(k),(U,p)=>(s(),a("div",{key:p,class:P(["objective-item",{completed:U.isCompleted,locked:!U.isUnlocked}])},[e("div",jo,[e("div",zo,t(U.icon),1),e("div",Po,[e("div",No,t(U.name),1),e("div",Eo,t(U.text),1),e("div",To,"+"+t(U.xpReward)+" XP",1)])]),e("div",Io,[e("div",Ro,t(U.progress)+" / "+t(U.target),1),e("div",Xo,[e("div",{class:P(["progress-fill-modal",{completed:U.isCompleted}]),style:ve({width:U.percentage+"%"})},null,6)]),U.isCompleted?(s(),a("div",Lo," ✅ Terminé ")):S("",!0)])],2))),128))]),e("div",qo,[e("div",Vo,[e("div",Ao,[H[3]||(H[3]=e("span",{class:"stat-label"},"Défis complétés :",-1)),e("span",Qo,t(I.value)+" / "+t(q(k).length),1)]),e("div",Ho,[H[4]||(H[4]=e("span",{class:"stat-label"},"XP gagnés aujourd'hui :",-1)),e("span",Bo,"+"+t(V.value),1)])]),H[5]||(H[5]=e("p",{class:"modal-note"}," Tous les défis se réinitialisent chaque jour à minuit. Bonne chance ! ",-1))])])])):S("",!0),ie(xe)],64))}},Fo=ae(Oo,[["__scopeId","data-v-a56e4f19"]]),Uo={class:"streak-test-container"},Jo={class:"status-grid"},Wo={class:"status-card"},Go={class:"status-content"},Ko={class:"status-value"},Yo={class:"status-card"},Zo={class:"status-content"},ei={class:"status-value"},ti={class:"status-card"},si={class:"status-content"},ai={class:"status-value"},oi={class:"status-card"},ii={class:"status-content"},ni={class:"simulation-section"},ri={class:"simulation-buttons"},li={key:0,class:"test-results"},ci={class:"results-list"},di={class:"result-time"},ui={class:"result-message"},vi={__name:"StreakTestButton",setup(Z){const b=ce(),{currentStreak:m,isStreakCheckedToday:E,checkDailyStreak:k,resetStreak:M,initializeStreak:D}=ye(),{updateUserXPInstantly:$}=Ce(),d=y([]),_=(i,o="info")=>{const w=new Date().toLocaleTimeString();d.value.unshift({timestamp:w,message:i,type:o}),d.value.length>8&&(d.value=d.value.slice(0,8))},j=i=>{try{_(`🎭 Simulation du jour ${i}...`,"info");const o=new Date,w=new Date(o);w.setDate(o.getDate()-1);const W=w.toISOString().split("T")[0],ee=i-1;localStorage.setItem("lastLoginDate",W),localStorage.setItem("currentStreak",ee.toString()),localStorage.removeItem("streakCheckedToday"),m.value=ee,E.value=!1,_(`✅ Streak de ${i} jours simulé (dernière connexion: ${W})`,"success"),setTimeout(()=>{I()},500)}catch(o){_(`❌ Erreur simulation jour ${i}: ${o.message}`,"error")}},N=()=>{try{_("💔 Simulation rupture de streak...","warning");const i=new Date,o=new Date(i);o.setDate(i.getDate()-3);const w=o.toISOString().split("T")[0];localStorage.setItem("lastLoginDate",w),localStorage.setItem("currentStreak","0"),localStorage.removeItem("streakCheckedToday"),m.value=0,E.value=!1,_("✅ Rupture de streak simulée (3 jours d'écart)","warning"),setTimeout(()=>{I()},500)}catch(i){_(`❌ Erreur simulation rupture: ${i.message}`,"error")}},L=()=>{try{_("🔄 Reset de la simulation...","info");const i=new Date().toISOString().split("T")[0];localStorage.setItem("lastLoginDate",i),localStorage.setItem("currentStreak","0"),localStorage.removeItem("streakCheckedToday"),m.value=0,E.value=!1,_("✅ Simulation remise à aujourd'hui (streak: 0)","success")}catch(i){_(`❌ Erreur reset simulation: ${i.message}`,"error")}},I=async()=>{try{_("🔄 Vérification du streak...","info");const i=await k();i.success?i.alreadyChecked?_("✅ Streak déjà vérifié aujourd'hui","success"):_(`🎉 Streak: ${i.streakDays} jours, +${i.xpGained} XP`,"success"):_(`❌ Erreur: ${i.reason||"inconnue"}`,"error")}catch(i){_(`❌ Erreur: ${i.message}`,"error")}},V=async()=>{try{_("➕ Test +5 XP...","info");const i=b.xp||0;if((await $(5,"test_manual")).success){const w=b.xp||0;_(`✅ XP: ${i} → ${w} (+5)`,"success")}else _("❌ Échec mise à jour XP","error")}catch(i){_(`❌ Erreur: ${i.message}`,"error")}},X=async()=>{try{_("➖ Test -5 XP...","info");const i=b.xp||0;if((await $(-5,"test_manual_decrease")).success){const w=b.xp||0;_(`✅ XP: ${i} → ${w} (-5)`,"success")}else _("❌ Échec diminution XP","error")}catch(i){_(`❌ Erreur: ${i.message}`,"error")}},c=()=>{try{M(),_("🗑️ Streak remis à zéro","warning")}catch(i){_(`❌ Erreur reset: ${i.message}`,"error")}},v=async()=>{try{_("🔄 Rafraîchissement...","info"),D(),_("✅ Données rafraîchies","success")}catch(i){_(`❌ Erreur: ${i.message}`,"error")}},x=()=>{d.value=[]};return re(()=>{_("🚀 Test Badges & Streak chargé","info")}),(i,o)=>(s(),a("div",Uo,[o[18]||(o[18]=e("div",{class:"test-header"},[e("h3",null,"🧪 Test Badges & Streak"),e("p",{class:"test-subtitle"},"Interface de test pour administrateur")],-1)),e("div",Jo,[e("div",Wo,[o[8]||(o[8]=e("span",{class:"status-icon"},"🔥",-1)),e("div",Go,[o[7]||(o[7]=e("span",{class:"status-label"},"Streak",-1)),e("span",Ko,t(q(m))+" jours",1)])]),e("div",Yo,[o[10]||(o[10]=e("span",{class:"status-icon"},"⭐",-1)),e("div",Zo,[o[9]||(o[9]=e("span",{class:"status-label"},"XP",-1)),e("span",ei,t(q(b).xp||0),1)])]),e("div",ti,[o[12]||(o[12]=e("span",{class:"status-icon"},"🏆",-1)),e("div",si,[o[11]||(o[11]=e("span",{class:"status-label"},"Niveau",-1)),e("span",ai,t(q(b).level||0),1)])]),e("div",oi,[o[14]||(o[14]=e("span",{class:"status-icon"},"📅",-1)),e("div",ii,[o[13]||(o[13]=e("span",{class:"status-label"},"Vérifié",-1)),e("span",{class:P(["status-value",{checked:q(E)}])},t(q(E)?"Oui":"Non"),3)])])]),e("div",ni,[o[15]||(o[15]=e("h4",null,"🎭 Simulation de Jours",-1)),o[16]||(o[16]=e("p",{class:"simulation-info"},"Simulez différents jours pour tester le streak",-1)),e("div",ri,[e("button",{onClick:o[0]||(o[0]=w=>j(1)),class:"sim-btn day-1"}," 📅 Jour 1 "),e("button",{onClick:o[1]||(o[1]=w=>j(2)),class:"sim-btn day-2"}," 📅 Jour 2 "),e("button",{onClick:o[2]||(o[2]=w=>j(3)),class:"sim-btn day-3"}," 📅 Jour 3 "),e("button",{onClick:o[3]||(o[3]=w=>j(4)),class:"sim-btn day-4"}," 📅 Jour 4 "),e("button",{onClick:o[4]||(o[4]=w=>j(5)),class:"sim-btn day-5"}," 📅 Jour 5 "),e("button",{onClick:o[5]||(o[5]=w=>j(7)),class:"sim-btn day-7"}," 📅 Jour 7 "),e("button",{onClick:o[6]||(o[6]=w=>j(10)),class:"sim-btn day-10"}," 📅 Jour 10 ")]),e("div",{class:"simulation-controls"},[e("button",{onClick:N,class:"sim-btn break"}," 💔 Casser le Streak "),e("button",{onClick:L,class:"sim-btn reset"}," 🔄 Reset Simulation ")])]),e("div",{class:"test-actions"},[e("button",{onClick:I,class:"test-btn primary"}," 🔄 Vérifier Streak "),e("button",{onClick:V,class:"test-btn success"}," ➕ +5 XP "),e("button",{onClick:X,class:"test-btn danger"}," ➖ -5 XP "),e("button",{onClick:c,class:"test-btn warning"}," 🗑️ Reset "),e("button",{onClick:v,class:"test-btn info"}," 🔄 Refresh ")]),d.value.length>0?(s(),a("div",li,[e("div",{class:"results-header"},[o[17]||(o[17]=e("h4",null,"📊 Résultats des tests",-1)),e("button",{onClick:x,class:"clear-btn"},"🗑️")]),e("div",ci,[(s(!0),a(A,null,K(d.value,(w,W)=>(s(),a("div",{key:W,class:P(["result-item",w.type])},[e("span",di,t(w.timestamp),1),e("span",ui,t(w.message),1)],2))),128))])])):S("",!0)]))}},_i=ae(vi,[["__scopeId","data-v-d8c0f382"]]),pi={class:"dashboard-content"},mi={class:"dashboard-center-top"},hi={key:0,class:"dashboard-spinner"},gi={key:1},fi={class:"section leaderboard-section"},yi={class:"leaderboard-grid"},$i={class:"leaderboard-container"},bi={class:"level-container"},ki={key:0,class:"dashboard-spinner"},xi={key:1,class:"section"},Ci={__name:"DashboardStudent",setup(Z){const b=ce();Se(),pe();const m=y({done:0,acquired:0,not_acquired:0}),E=y(!0),k=y([]),M=y([]),D=y([]),$=y({}),d=y({}),_=y([]),j=y(null);F(()=>k.value.length?[...k.value].sort((I,V)=>new Date(V.date_creation)-new Date(I.date_creation))[0]:null);function N(){$.value=Object.fromEntries(M.value.map(L=>[L.id,L])),d.value=Object.fromEntries(D.value.map(L=>[L.id,L]))}return re(async()=>{try{const[L,I,V,X,c,v]=await Promise.all([Te({}),Ie({}),Xe(),Re(),we().catch(()=>null),Me().catch(()=>null)]),x=o=>Array.isArray(o)?o:o?.results||[];M.value=x(L),D.value=x(I),k.value=x(V?.data),_.value=x(X?.data??X),j.value=v?.data?.data||null;const i=c?.data?.data;i&&(b.xp=i.xp??b.xp,b.level=i.level??b.level,b.xp_to_next=i.xp_to_next??i.next_level_xp-i.xp),N(),m.value.done=k.value.length,m.value.acquired=k.value.filter(o=>o.est_correct===!0).length,m.value.not_acquired=k.value.filter(o=>o.est_correct===!1).length}catch{}E.value=!1}),(L,I)=>(s(),a("div",pi,[ie(_s),e("div",mi,[q(b).isLoading?(s(),a("div",hi,I[0]||(I[0]=[e("span",{class:"spinner"},null,-1)]))):(s(),a("h1",gi," Bienvenue "+t(q(b).firstName)+" sur votre tableau de bord ",1))]),e("div",fi,[e("div",yi,[e("div",$i,[ie(qt)]),e("div",bi,[ie(ds),ie(Fo)])])]),ie(ma),ie(go),E.value?(s(),a("div",ki,I[1]||(I[1]=[e("span",{class:"spinner"},null,-1)]))):S("",!0),q(b).isAdmin?(s(),a("div",xi,[I[2]||(I[2]=e("div",{class:"section-header"},[e("h3",{class:"section-title"},"🧪 Tests (Admin uniquement)")],-1)),ie(_i)])):S("",!0)]))}},Si=ae(Ci,[["__scopeId","data-v-f5e088ef"]]),wi={class:"parent-dashboard"},Mi={class:"add-child"},Di=["disabled"],ji={key:0,class:"hint"},zi={class:"create-child"},Pi={class:"form-row"},Ni={class:"form-row"},Ei=["disabled"],Ti={key:0,class:"hint"},Ii={key:1,class:"temp-pass"},Ri={key:0,class:"loading"},Xi={key:1},Li={key:0,class:"empty"},qi={key:1,class:"children-grid"},Vi={class:"child-header"},Ai={class:"avatar"},Qi={class:"child-info"},Hi={class:"name"},Bi={key:0,class:"flag"},Oi={class:"meta"},Fi={key:0},Ui={class:"xp"},Ji={class:"xp-value"},Wi={class:"level"},Gi={class:"child-body"},Ki={class:"metrics-grid"},Yi={class:"metric"},Zi={class:"bar"},en={class:"hint"},tn={class:"metric small"},sn={class:"kpi"},an={class:"metric small ok"},on={class:"kpi"},nn={class:"metric small ko"},rn={class:"kpi"},ln={key:0,class:"last-activity"},cn={class:"activity-line"},dn={class:"activity-title"},un={key:0,class:"activity-meta"},vn={class:"actions"},_n=["onClick"],pn=["onClick","disabled"],mn={__name:"DashboardParent",setup(Z){const b=y(!0),m=y([]),E=pe(),k=y(""),M=y(!1),D=y(""),$=y(null),d=y(!1),_=y(""),j=y(""),N=y({first_name:"",last_name:"",email:""});function L(x){if(!x)return"E";const i=String(x).trim().split(/\s+/);return i.length===1?i[0].substring(0,2).toUpperCase():(i[0].substring(0,1)+i[1].substring(0,1)).toUpperCase()}function I(x){E.push({name:"ChildOverview",params:{childId:String(x)}})}re(async()=>{try{const i=(await ge())?.data?.data||{};m.value=i.children||[]}catch{m.value=[]}finally{b.value=!1}});async function V(){try{const i=(await ge())?.data?.data||{};m.value=i.children||[]}catch{m.value=[]}}async function X(){D.value="";const x=String(k.value||"").trim();if(!x){D.value="Renseignez l'email de l'élève";return}M.value=!0;try{await De({email:x}),k.value="",D.value="Élève ajouté ✅",await V()}catch{D.value="Impossible d'ajouter cet élève"}finally{M.value=!1,setTimeout(()=>{D.value=""},2500)}}async function c(x){$.value=x;try{await je(x),await V()}catch{}$.value=null}async function v(){_.value="",j.value="";const x={first_name:String(N.value.first_name||"").trim(),last_name:String(N.value.last_name||"").trim(),email:String(N.value.email||"").trim().toLowerCase()};if(!x.first_name||!x.last_name||!x.email){_.value="Renseignez prénom, nom et email";return}d.value=!0;try{const o=(await me.post("/api/users/me/children/create/",x))?.data?.data||{};j.value=o.temp_password||"",_.value="Compte créé et lié ✅",N.value={first_name:"",last_name:"",email:""},await V()}catch{_.value="Création impossible (email déjà utilisé?)"}finally{d.value=!1,setTimeout(()=>{_.value=""},3e3)}}return(x,i)=>(s(),a("div",wi,[i[13]||(i[13]=e("div",{class:"header"},[e("h1",null,"Tableau de bord Parent"),e("p",{class:"subtitle"},"Suivez la progression de vos enfants, simplement.")],-1)),e("div",Mi,[de(e("input",{"onUpdate:modelValue":i[0]||(i[0]=o=>k.value=o),type:"email",placeholder:"Email de l'élève",class:"input"},null,512),[[ue,k.value]]),e("button",{class:"btn",disabled:M.value,onClick:X},"Ajouter",8,Di),D.value?(s(),a("span",ji,t(D.value),1)):S("",!0)]),e("div",zi,[e("details",null,[i[5]||(i[5]=e("summary",null,"Créer un compte pour un enfant",-1)),e("div",Pi,[de(e("input",{"onUpdate:modelValue":i[1]||(i[1]=o=>N.value.first_name=o),class:"input",placeholder:"Prénom"},null,512),[[ue,N.value.first_name]]),de(e("input",{"onUpdate:modelValue":i[2]||(i[2]=o=>N.value.last_name=o),class:"input",placeholder:"Nom"},null,512),[[ue,N.value.last_name]])]),e("div",Ni,[de(e("input",{"onUpdate:modelValue":i[3]||(i[3]=o=>N.value.email=o),class:"input",placeholder:"Email"},null,512),[[ue,N.value.email]])]),e("button",{class:"btn",disabled:d.value,onClick:v},"Créer le compte",8,Ei),_.value?(s(),a("div",Ti,t(_.value),1)):S("",!0),j.value?(s(),a("div",Ii,[i[4]||(i[4]=B("Mot de passe temporaire: ")),e("code",null,t(j.value),1)])):S("",!0)])]),b.value?(s(),a("div",Ri,i[6]||(i[6]=[e("span",{class:"spinner"},null,-1)]))):(s(),a("div",Xi,[m.value.length===0?(s(),a("div",Li,i[7]||(i[7]=[e("p",null,"Aucun enfant rattaché pour le moment.",-1)]))):(s(),a("div",qi,[(s(!0),a(A,null,K(m.value,o=>(s(),a("div",{class:"child-card",key:o.id},[e("div",Vi,[e("div",Ai,t(L(o.display_name)),1),e("div",Qi,[e("div",Hi,[o.pays_flag?(s(),a("span",Bi,t(o.pays_flag),1)):S("",!0),B(" "+t(o.display_name),1)]),e("div",Oi,[o.niveau?(s(),a("span",Fi,t(o.niveau),1)):S("",!0)])]),e("div",Ui,[e("div",Ji,t(o.xp)+" XP",1),e("div",Wi,"Niveau "+t(o.level),1)])]),e("div",Gi,[e("div",Ki,[e("div",Yi,[i[8]||(i[8]=e("div",{class:"label"},"Objectif hebdo",-1)),e("div",Zi,[e("div",{class:"fill",style:ve({width:(o.metrics?.weekly_progress||0)+"%"})},null,4)]),e("div",en,t(o.metrics?o.metrics.weekly_done+" / "+o.metrics.weekly_goal:"—"),1)]),e("div",tn,[e("div",sn,t(o.metrics?.done_total??"—"),1),i[9]||(i[9]=e("div",{class:"kpi-label"},"Exercices",-1))]),e("div",an,[e("div",on,t(o.metrics?.acquired_count??"—"),1),i[10]||(i[10]=e("div",{class:"kpi-label"},"Acquis",-1))]),e("div",nn,[e("div",rn,t(o.metrics?.not_acquired_count??"—"),1),i[11]||(i[11]=e("div",{class:"kpi-label"},"À revoir",-1))])]),o.last_activity?(s(),a("div",ln,[i[12]||(i[12]=e("div",{class:"label"},"Dernière activité",-1)),e("div",cn,[e("span",dn,t(o.last_activity.exercice_title),1),o.last_activity.chapitre_title?(s(),a("span",un,"• "+t(o.last_activity.chapitre_title),1)):S("",!0)])])):S("",!0),e("div",vn,[e("button",{class:"btn",onClick:w=>I(o.id)},"Voir détails",8,_n),e("button",{class:"btn secondary",onClick:w=>c(o.id),disabled:$.value===o.id},"Retirer",8,pn)])])]))),128))]))]))]))}},hn=ae(mn,[["__scopeId","data-v-bec17232"]]),zn={__name:"Dashboard",setup(Z){const b=ce(),m=F(()=>b.role==="parent"?hn:Si);return(E,k)=>(s(),le(be,null,{default:G(()=>[(s(),le(Ee(m.value)))]),_:1}))}};export{zn as default};
