import{b as c,o as l,d as e,y as ee,M as ne,c as z,A as X,E as te,g as k,n as q,h as I,u as x,F as Q,p as K,f as Y,K as ve,t as C,a as N,C as O,m as oe,z as ue,G as Ae,k as me,ad as Ee,w as F,T as Me,H as he,ae as Pe,D as Fe,j as le,P as He,B as Oe,af as xe,e as ze,i as Be}from"./vendor-CPU10QdV.js";import{m as Ve,b as Re,c as B,d as V,e as Qe,f as R}from"./menuItems-sTa2MZDg.js";import{_ as j,u as fe,d as Te,q as Ne,p as Ue,s as Ke,t as We}from"./index-BhTphZWV.js";import{a as Ce}from"./matieres-BKndaZDR.js";import{a as Ie}from"./ui-es3YBeq-.js";function Xe(n,s){return l(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9"})])}function Ze(n,s){return l(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0"})])}function Je(n,s){return l(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})])}function Ge(n,s){return l(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Z"})])}function Ye(n,s){return l(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"})])}function et(n,s){return l(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})])}function tt(n,s){return l(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}const st=Ve.filter(n=>["dashboard","cours","calculator","exercices","quiz","fiches"].includes(n.key));function pe(n,s){const d=n?n[0].toUpperCase():"",v=s?s[0].toUpperCase():"";return(d+(v?"."+v:"")).trim()}const at={class:"sidebar-menu"},ot={class:"sidebar-menu-container"},nt=["title"],it={class:"sidebar-icon"},rt={key:0,class:"sidebar-label"},lt=["onClick","title"],ct={class:"sidebar-icon"},dt={key:0,class:"sidebar-label"},ut={key:0,class:"sidebar-section-header"},ht=["title"],pt={class:"sidebar-icon"},vt={key:0,class:"sidebar-label"},mt=["title"],ft={class:"sidebar-icon"},gt={key:0,class:"sidebar-label"},bt=["title"],_t={class:"sidebar-icon"},yt={key:0,class:"sidebar-label"},kt=["title"],wt={class:"sidebar-icon"},$t={key:0,class:"sidebar-label"},Mt=["title"],xt={class:"sidebar-icon"},Ct={key:0,class:"sidebar-label"},It=["title"],St={class:"sidebar-icon"},At={key:0,class:"sidebar-label"},Et=["title"],zt={class:"sidebar-icon"},Tt={key:0,class:"sidebar-label"},Nt={__name:"Sidebar",props:{collapsed:Boolean},emits:["navigation","toggle-collapsed"],setup(n,{expose:s,emit:d}){const v=n,r=d,u=fe(),o=ee(),p=ne(),h=Te(),f=z(()=>st.filter($=>$.key!=="dashboard")),b=$=>{const _=p.path,M={dashboard:"/dashboard",cours:["/online-courses","/course-notions","/course-chapitres","/course","/cours"],exercices:["/exercises","/notions","/themes","/theme-notions","/chapitres","/exercices","/chapter-exercises"],fiches:["/sheets"],quiz:["/quiz","/quiz-notions","/quiz-chapitres","/quiz-exercices","/chapter-quiz"],progress:"/progress",calculator:"/calculator"}[$];return M?Array.isArray(M)?M.some(y=>_.startsWith(y)):_===M:!1};async function g($){if($.key==="calculator")o.push("/calculator");else if($.key==="dashboard")o.push("/dashboard");else if(["exercices","fiches","quiz","cours"].includes($.key)){const _=h.activeMatiereId||h.selectedMatieresIds?.[0]||null;$.key==="exercices"?_?o.push({name:"Themes",params:{matiereId:String(_)}}):o.push({name:"Exercises"}):$.key==="fiches"?_?o.push({name:"Sheets",query:{matiereId:String(_)}}):o.push({name:"Sheets"}):$.key==="quiz"?_?o.push({name:"QuizNotions",params:{matiereId:String(_)}}):o.push({name:"Quiz"}):$.key==="cours"&&(_?o.push({name:"CourseNotions",params:{matiereId:String(_)}}):o.push({name:"OnlineCourses"}))}}z(()=>(u.firstName+" "+u.lastName).trim()),z(()=>pe(u.firstName,u.lastName)),u.firstName+""+u.lastName,pe(u.firstName,u.lastName);let A=null,L=null;const E=()=>window.innerWidth<1024,D=()=>{A&&clearTimeout(A),A=setTimeout(()=>{(E()&&!v.collapsed||!E()&&v.collapsed)&&r("toggle-collapsed")},30)};return X(()=>{E()&&!v.collapsed&&setTimeout(()=>{r("toggle-collapsed")},10),window.addEventListener("resize",D),window.ResizeObserver&&(L=new ResizeObserver(()=>{D()}),L.observe(document.body))}),te(()=>{window.removeEventListener("resize",D),A&&clearTimeout(A),L&&L.disconnect()}),s({isActiveRoute:b,handleSidebarClick:g,handleLogout:async()=>{const $=localStorage.getItem("refresh_token");if($&&$!=="null"&&$!=="undefined"&&$.trim()!=="")try{await Ne({refresh:$})}catch{}localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),u.clearUser(),o.push("/")}}),($,_)=>(l(),c("aside",{class:q(["sidebar",{collapsed:n.collapsed}])},[e("nav",at,[e("div",ot,[e("ul",null,[e("li",{class:q(["sidebar-item",{active:b("dashboard")}]),onClick:_[0]||(_[0]=m=>g({key:"dashboard"})),title:n.collapsed?"Tableau de bord":""},[e("span",it,[I(x(Re))]),n.collapsed?k("",!0):(l(),c("span",rt,"Tableau de bord"))],10,nt),(l(!0),c(Q,null,K(f.value,m=>(l(),c("li",{class:q(["sidebar-item",{active:b(m.key)}]),key:m.key,onClick:M=>g(m),title:n.collapsed?m.text:""},[e("span",ct,[(l(),Y(ve(m.icon)))]),n.collapsed?k("",!0):(l(),c("span",dt,C(m.text),1))],10,lt))),128)),x(u).isAdmin?(l(),c(Q,{key:0},[n.collapsed?k("",!0):(l(),c("li",ut,_[8]||(_[8]=[e("span",{class:"section-title"},"⚙️ Administration",-1)]))),e("li",{class:"sidebar-item",onClick:_[1]||(_[1]=m=>x(o).push("/admin/matieres")),title:n.collapsed?"Matières":""},[e("span",pt,[I(x(B),{class:"h-6 w-6"})]),n.collapsed?k("",!0):(l(),c("span",vt,"Matières"))],8,ht),e("li",{class:"sidebar-item",onClick:_[2]||(_[2]=m=>x(o).push("/admin/notions")),title:n.collapsed?"Notions":""},[e("span",ft,[I(x(Ye),{class:"h-6 w-6"})]),n.collapsed?k("",!0):(l(),c("span",gt,"Notions"))],8,mt),e("li",{class:"sidebar-item",onClick:_[3]||(_[3]=m=>x(o).push("/admin/chapitres")),title:n.collapsed?"Chapitres":""},[e("span",_t,[I(x(V),{class:"h-6 w-6"})]),n.collapsed?k("",!0):(l(),c("span",yt,"Chapitres"))],8,bt),e("li",{class:"sidebar-item",onClick:_[4]||(_[4]=m=>x(o).push("/admin/exercices")),title:n.collapsed?"Exercices":""},[e("span",wt,[I(x(et),{class:"h-6 w-6"})]),n.collapsed?k("",!0):(l(),c("span",$t,"Exercices"))],8,kt),e("li",{class:"sidebar-item",onClick:_[5]||(_[5]=m=>x(o).push("/admin/exercices-plus")),title:n.collapsed?"Exercices+":""},[e("span",xt,[I(x(tt))]),n.collapsed?k("",!0):(l(),c("span",Ct,"Exercices+"))],8,Mt),e("li",{class:"sidebar-item",onClick:_[6]||(_[6]=m=>x(o).push("/admin/fiches")),title:n.collapsed?"Fiches":""},[e("span",St,[I(x(Qe),{class:"h-6 w-6"})]),n.collapsed?k("",!0):(l(),c("span",At,"Fiches"))],8,It),e("li",{class:"sidebar-item",onClick:_[7]||(_[7]=m=>x(o).push("/admin/quiz")),title:n.collapsed?"Quiz":""},[e("span",zt,[I(x(R),{class:"h-6 w-6"})]),n.collapsed?k("",!0):(l(),c("span",Tt,"Quiz"))],8,Et)],64)):k("",!0)])])])],2))}},Lt=j(Nt,[["__scopeId","data-v-f86d1804"]]),qt=["aria-expanded"],Dt={class:"user-info"},jt=["aria-label"],Pt={class:"user-avatar"},Ft={class:"user-details"},Ht={class:"user-name"},Ot={class:"user-title"},Bt={key:0,class:"user-xp-bar"},Vt={key:0,class:"user-menu-dropdown"},Rt={class:"menu-avatar"},Qt={class:"menu-user-info"},Ut={class:"menu-full-name"},Kt={class:"menu-email"},Wt={class:"menu-options"},Xt={class:"option-icon"},Zt={class:"option-icon"},Jt={class:"option-icon"},Gt={__name:"UserMenu",emits:["logout"],setup(n,{emit:s}){const d=s,v=fe(),r=ee(),u=N(!1),o=N(null),p=z(()=>`${v.firstName} ${v.lastName}`.trim()||"Utilisateur"),h=z(()=>pe(v.firstName,v.lastName)),f=z(()=>{if(!v.isAuthenticated)return"";const y=v.level??0,T=v.xp??0;return`Niveau ${y} · ${T} XP`}),b=z(()=>v.isAuthenticated),g=z(()=>{const y=Number(v.level||0),T=Number(v.xp||0),H=y*y*10,W=(y+1)*(y+1)*10,se=Math.max(T,H)-H,ie=Math.max(1,W-H);return Math.min(100,Math.round(se/ie*100))}),A=z(()=>v.email||"email@exemple.com"),L=()=>{u.value=!u.value},E=()=>{u.value=!1},D=()=>{E(),r.push("/account")},P=()=>{E(),r.push("/pricing")},$=()=>{E(),r.push("/account")},_=async()=>{E();try{const y=localStorage.getItem("refresh_token");if(y&&y!=="null"&&y!=="undefined"&&y.trim()!=="")try{await Ne({refresh:y})}catch{}localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),v.clearUser(),d("logout"),r.push("/")}catch{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),v.clearUser(),r.push("/")}},m=y=>{o.value&&!o.value.contains(y.target)&&E()},M=y=>{y.key==="Escape"&&u.value&&E()};return O(()=>[v.xp,v.level,v.xp_to_next],(y,T)=>{},{deep:!0}),X(()=>{document.addEventListener("click",m),document.addEventListener("keydown",M)}),te(()=>{document.removeEventListener("click",m),document.removeEventListener("keydown",M)}),(y,T)=>(l(),c("div",{class:"user-menu-container",ref_key:"menuContainer",ref:o},[e("button",{class:"user-menu-trigger",onClick:L,"aria-expanded":u.value,"aria-label":"Menu utilisateur"},[e("div",Dt,[e("div",{class:"avatar-progress",style:oe({"--progress":g.value+"%"}),role:"img","aria-label":`Progression de niveau: ${g.value}%`,title:"Progression vers le prochain niveau"},[e("span",Pt,C(h.value),1)],12,jt),e("div",Ft,[e("span",Ht,C(p.value),1),e("span",Ot,C(f.value),1),b.value?(l(),c("div",Bt,[e("div",{class:"user-xp-fill",style:oe({width:g.value+"%"})},null,4)])):k("",!0)])])],8,qt),I(Ae,{name:"menu-dropdown"},{default:ue(()=>[u.value?(l(),c("div",Vt,[e("button",{class:"menu-header",onClick:$},[e("span",Rt,C(h.value),1),e("div",Qt,[e("div",Ut,C(p.value),1),e("div",Kt,C(A.value),1)])]),e("div",Wt,[e("button",{class:"menu-option",onClick:D},[e("span",Xt,[I(x(Je),{class:"user-menu-heroicon"})]),T[0]||(T[0]=e("span",{class:"option-label"},"Mon compte",-1))]),e("button",{class:"menu-option",onClick:P},[e("span",Zt,[I(x(Ge),{class:"user-menu-heroicon"})]),T[1]||(T[1]=e("span",{class:"option-label"},"Abonnement",-1))]),e("button",{class:"menu-option logout-option",onClick:_},[e("span",Jt,[I(x(Xe),{class:"user-menu-heroicon"})]),T[2]||(T[2]=e("span",{class:"option-label"},"Déconnexion",-1))])])])):k("",!0)]),_:1})],512))}},Yt=j(Gt,[["__scopeId","data-v-1c6e40ed"]]),es={class:"subject-filters"},ts=["onClick"],ss={__name:"SubjectFilters",props:{subjects:{type:Array,default:()=>[{id:"maths",name:"Mathématiques"},{id:"physics",name:"Physique"},{id:"chemistry",name:"Chimie"}]},initialSubject:{type:String,default:"maths"}},emits:["subject-changed"],setup(n,{expose:s,emit:d}){const v=n,r=d,u=N(v.initialSubject),o=p=>{u.value=p,r("subject-changed",p)};return O(()=>v.initialSubject,p=>{u.value=p}),s({selectedSubject:u}),(p,h)=>(l(),c("div",es,[(l(!0),c(Q,null,K(n.subjects,f=>(l(),c("button",{key:f.id,class:q(["subject-btn",{active:u.value===f.id}]),onClick:b=>o(f.id)},C(f.name),11,ts))),128))]))}},as=j(ss,[["__scopeId","data-v-15ed2311"]]),os={class:"chapter-navigation","aria-label":"Navigation des chapitres"},ns=["aria-pressed","aria-label","onClick"],is={class:"chapter-nav-label"},rs={__name:"ChapterNavigation",props:{chapitreId:{type:[String,Number],required:!1,default:null}},setup(n){const s=n,d=ne(),v=ee(),r=z(()=>{const h=d.path,f=d.params.notionId,b=s.chapitreId||d.params.chapitreId,g=d.params.matiereId;return b&&b!==null?[{key:"cours",label:"Cours",icon:V,route:`/course/${b}`},{key:"exercices",label:"Exercices",icon:B,route:`/exercices/${b}`},{key:"quiz",label:"Quiz",icon:R,route:`/quiz-exercices/${b}`}]:f&&h.includes("/chapitres/")&&!h.includes("/quiz-chapitres/")&&!h.includes("/course-chapitres/")?[{key:"cours",label:"Cours",icon:V,route:`/course-chapitres/${f}`},{key:"exercices",label:"Exercices",icon:B,route:`/chapitres/${f}`},{key:"quiz",label:"Quiz",icon:R,route:`/quiz-chapitres/${f}`}]:g&&h.includes("/notions/")?[{key:"cours",label:"Cours",icon:V,route:`/course-notions/${g}`},{key:"exercices",label:"Exercices",icon:B,route:`/notions/${g}`},{key:"quiz",label:"Quiz",icon:R,route:`/quiz/${g}`}]:f&&h.includes("/course-chapitres/")?[{key:"cours",label:"Cours",icon:V,route:`/course-chapitres/${f}`},{key:"exercices",label:"Exercices",icon:B,route:`/chapitres/${f}`},{key:"quiz",label:"Quiz",icon:R,route:`/quiz-chapitres/${f}`}]:f&&h.includes("/quiz-chapitres/")?[{key:"cours",label:"Cours",icon:V,route:`/course-chapitres/${f}`},{key:"exercices",label:"Exercices ",icon:B,route:`/chapitres/${f}`},{key:"quiz",label:"Quiz",icon:R,route:`/quiz-chapitres/${f}`}]:g&&h.includes("/course-notions/")?[{key:"cours",label:"Cours",icon:V,route:`/course-notions/${g}`},{key:"exercices",label:"Exercices",icon:B,route:`/notions/${g}`},{key:"quiz",label:"Quiz",icon:R,route:`/quiz/${g}`}]:g&&h.includes("/quiz/")?[{key:"cours",label:"Cours",icon:V,route:`/course-notions/${g}`},{key:"exercices",label:"Exercices ",icon:B,route:`/notions/${g}`},{key:"quiz",label:"Quiz",icon:R,route:`/quiz/${g}`}]:[{key:"cours",label:"Cours",icon:V,route:"/online-courses"},{key:"exercices",label:"Exercices",icon:B,route:"/exercises"},{key:"quiz",label:"Quiz",icon:R,route:"/quiz"}]}),u=N("exercices");function o(){const h=d.path,f=s.chapitreId||d.params.chapitreId;f&&f!==null?h.includes(`/course/${f}`)?u.value="cours":h.includes(`/exercices/${f}`)?u.value="exercices":h.includes(`/quiz-exercices/${f}`)?u.value="quiz":u.value="exercices":h.includes("/course/")||h.includes("/course-chapitres/")||h.includes("/course-notions/")?u.value="cours":h.includes("/exercices/")||h.includes("/chapitres/")&&!h.includes("/quiz-chapitres/")&&!h.includes("/course-chapitres/")||h.includes("/notions/")?u.value="exercices":h.includes("/quiz-exercices/")||h.includes("/quiz-chapitres/")||h.includes("/quiz/")&&d.params.matiereId?u.value="quiz":u.value="exercices"}X(()=>{o()}),O(()=>d.path,()=>{o()});function p(h){const f=r.value.find(b=>b.key===h);f&&(u.value=h,v.push({path:f.route,replace:!1}).catch(b=>{o()}))}return(h,f)=>(l(),c("nav",os,[(l(!0),c(Q,null,K(r.value,b=>(l(),c("button",{key:b.key,class:q(["chapter-nav-btn",{active:b.key===u.value}]),"aria-pressed":b.key===u.value,"aria-label":b.label,onClick:g=>p(b.key)},[(l(),Y(ve(b.icon),{class:"chapter-nav-icon"})),e("span",is,C(b.label),1)],10,ns))),128))]))}},ls=j(rs,[["__scopeId","data-v-e4438b84"]]),cs={class:"context-menu-icon"},ds={class:"context-menu-text"},us={__name:"ContextMenu",props:{visible:{type:Boolean,default:!1},x:{type:Number,default:0},y:{type:Number,default:0},isFavorite:{type:Boolean,default:!1},matiereId:{type:[Number,String,null],default:null}},emits:["favorite-toggle","close"],setup(n,{emit:s}){const d=n,v=s,r=z(()=>({position:"fixed",left:`${d.x}px`,top:`${d.y}px`,zIndex:12006}));function u(){d.matiereId!==null&&v("favorite-toggle",d.matiereId),v("close")}function o(h){d.visible&&v("close")}function p(h){h.key==="Escape"&&d.visible&&v("close")}return X(()=>{document.addEventListener("click",o),document.addEventListener("keydown",p)}),te(()=>{document.removeEventListener("click",o),document.removeEventListener("keydown",p)}),(h,f)=>me((l(),c("div",{class:"context-menu",style:oe(r.value),onClick:f[0]||(f[0]=F(()=>{},["stop"]))},[e("div",{class:"context-menu-item",onClick:u},[e("span",cs,C(n.isFavorite?"⭐":"☆"),1),e("span",ds,C(n.isFavorite?"Retirer des favoris":"Ajouter aux favoris"),1)])],4)),[[Ee,n.visible]])}},hs=j(us,[["__scopeId","data-v-6f3586a5"]]),ps={class:"selected-matiere-header"},vs={key:0,class:"loading-state"},ms={key:1,class:"matieres-tabs"},fs={class:"tabs-container"},gs=["disabled"],bs=["onClick","onMousedown","onContextmenu","title","aria-label","aria-selected"],_s={class:"tab-name"},ys=["onClick","title","aria-label","disabled"],ks=["disabled"],ws=["onClick","onContextmenu","title"],$s={class:"dropdown-content-left"},Ms=["innerHTML"],xs={class:"dropdown-name"},Cs=["onClick","title","aria-label","disabled"],Is={class:"star-icon"},Ss={key:0,class:"dropdown-empty"},As={key:0,class:"favorites-bar"},Es={class:"favorites-container"},zs={class:"favorites-list"},Ts=["onClick","onContextmenu","title","aria-label","disabled"],Ns=["innerHTML"],Ls={class:"favorite-name"},qs=["title","aria-label"],ce=5,Se=6,de="matieres_disponibles_cache",Ds=600*1e3,js={__name:"SelectedMatiereHeader",props:{matiereId:{type:[Number,String],default:null,validator:n=>n===null||!isNaN(Number(n))&&Number(n)>0}},emits:["matiere-changed"],setup(n,{emit:s}){const d=n;O(()=>d.matiereId,t=>{o.value.matiereId=t||null});const v=s;ee();const r=Te(),u=fe(),o=N({visible:!1,x:0,y:0,matiereId:d.matiereId||null,isFavorite:!1}),p=N([]),h=N(!1),f=N(null),b=N(null),g=N(null),A=N(!1),L=N(!1),E=N(null),D=N({}),P=z(()=>p.value.filter(t=>t&&t.id&&r.selectedMatieresIds.includes(t.id))),$=z(()=>p.value.filter(t=>t&&t.id&&!r.selectedMatieresIds.includes(t.id))),_=z(()=>{const t=p.value.filter(a=>a&&a.id&&r.isFavoriteMatiere(a.id));return!L.value&&t.length>ce?t.slice(0,ce):t});z(()=>p.value.find(t=>t&&t.id===g.value));const m=(t,a)=>{},M=t=>t!=null&&!isNaN(Number(t))&&Number(t)>0,y=()=>{try{const t=localStorage.getItem(de);if(!t)return null;const a=JSON.parse(t);return!a||!Array.isArray(a.data)?null:a}catch{return null}},T=t=>{try{const a={niveauId:u.niveau_pays?.id||null,ts:Date.now(),data:t};localStorage.setItem(de,JSON.stringify(a))}catch{}},H=()=>{try{localStorage.removeItem(de)}catch{}},W=async()=>{try{if(!u.niveau_pays?.id)return;const t=await Ce();if(t&&t.data&&t.data.matieres_disponibles){const a=t.data.matieres_disponibles.filter(S=>S&&S.id&&S.nom),i=(p.value||[]).map(S=>S.id).join(","),w=a.map(S=>S.id).join(",");i!==w&&(p.value=a),T(a)}}catch{}},U=async({useCache:t=!0}={})=>{if(!h.value){if(t){const a=y(),i=a?.niveauId===(u.niveau_pays?.id||null),w=a&&Date.now()-a.ts<Ds;if(a&&i&&w){p.value=a.data.filter(S=>S&&S.id&&S.nom),W();return}}h.value=!0;try{if(!u.niveau_pays?.id){p.value=[];return}const a=await Ce();if(a&&a.data&&a.data.matieres_disponibles){const i=a.data.matieres_disponibles.filter(w=>w&&w.id&&w.nom);p.value=i,T(i)}else throw new Error("Format de réponse API invalide")}catch(a){m(a,"loadMatieres"),p.value=[]}finally{h.value=!1}}},se=async t=>{if(!(!M(t)||h.value))try{if(A.value&&Z(),r.removeMatiereId(t),g.value===t){const a=P.value.filter(i=>i.id!==t);a.length>0?(await he(),G(a[0].id)):(g.value=null,v("matiere-changed",null))}}catch(a){m(a,"removeMatiere")}},ie=(t,a)=>{if(t.button===1){t.preventDefault(),t.stopPropagation(),se(a);return}},G=t=>{if(!(!M(t)||h.value||f.value===t))try{g.value=t,r.setActiveMatiere(t),v("matiere-changed",t)}catch(a){m(a,"setActiveMatiere")}},ge=(t=null)=>{const a=t||E.value;if(!a||typeof a.getBoundingClientRect!="function")return{};try{const i=a.getBoundingClientRect(),w=window.innerHeight,S=window.innerWidth;let J={position:"fixed",top:`${i.bottom+Se}px`,left:`${i.left}px`,minWidth:`${Math.max(i.width,280)}px`,maxWidth:`${Math.min(400,S-20)}px`,zIndex:12005};return i.bottom+300>w&&(J.top=`${i.top-300-Se}px`,J.bottom="auto"),i.left+280>S&&(J.left=`${S-300}px`),J}catch(i){return m(i,"calculateDropdownPosition"),{}}},be=async t=>{if(!h.value)try{if(A.value=!A.value,A.value){await he();const a=t&&t.currentTarget||E.value||null;D.value=ge(a)}else D.value={}}catch(a){m(a,"toggleMatiereDropdown")}},Z=()=>{A.value=!1,D.value={}},_e=async t=>{if(!(!t?.id||h.value||f.value===t.id)){f.value=t.id;try{r.selectedMatieresIds.includes(t.id)||r.addMatiereId(t.id),g.value=t.id,r.setActiveMatiere(t.id),v("matiere-changed",t.id),A.value&&Z()}catch(a){m(a,"selectMatiere")}finally{f.value=null}}},re=(t,a)=>{t.preventDefault(),o.value={visible:!0,x:t.clientX,y:t.clientY,matiereId:a.id,isFavorite:r.isFavoriteMatiere(a.id)}},Le=()=>{o.value.visible=!1},qe=async t=>{await ye(t)},ye=async t=>{if(!(!M(t)||b.value===t)){b.value=t;try{r.toggleFavoriteMatiere(t);const a=p.value.find(w=>w.id===t),i=r.isFavoriteMatiere(t)}catch(a){m(a,"toggleFavorite")}finally{b.value=null}}},De=()=>{L.value=!L.value},ke=t=>{if(A.value)try{const a=document.querySelector(".matiere-dropdown"),i=E.value,w=a&&a.contains(t.target),S=i&&i.contains(t.target),J=t.target.classList&&t.target.classList.contains("tab-close");(!w&&!S||J)&&Z()}catch(a){m(a,"handleClickOutside")}},we=t=>{try{t.key==="Escape"&&A.value&&(t.preventDefault(),Z())}catch(a){m(a,"handleKeydown")}},je=t=>{try{const a=document.querySelectorAll(".dropdown-item:not(:disabled)"),i=Array.from(a).findIndex(w=>w===document.activeElement);switch(t.key){case"ArrowDown":t.preventDefault();const w=i<a.length-1?i+1:0;a[w]?.focus();break;case"ArrowUp":t.preventDefault();const S=i>0?i-1:a.length-1;a[S]?.focus();break;case"Enter":case" ":t.preventDefault(),document.activeElement.classList.contains("dropdown-item")&&document.activeElement.click();break;case"Escape":t.preventDefault(),Z(),E.value?.focus();break}}catch(a){m(a,"handleDropdownKeydown")}};X(async()=>{try{await Promise.all([U({useCache:!0}),r.loadSelectedMatieresIds(),r.loadFavoriteMatieresIds(),r.loadActiveMatiereId()]),p.value.length>0&&r.selectedMatieresIds.length===0&&(r.addMatiereId(p.value[0].id),G(p.value[0].id)),r.activeMatiereId&&(g.value=r.activeMatiereId),document.addEventListener("click",ke,{passive:!0}),document.addEventListener("keydown",we,{passive:!0}),ae=()=>{A.value&&(D.value=ge(E.value||null))},window.addEventListener("resize",ae,{passive:!0});const t=()=>{H(),U({useCache:!1})};window.addEventListener("matieres-cache:invalidate",t),$e.push(t)}catch(t){m(t,"onMounted")}});const $e=[];let ae=null;return te(()=>{try{document.removeEventListener("click",ke),document.removeEventListener("keydown",we),ae&&window.removeEventListener("resize",ae);for(const t of $e)window.removeEventListener("matieres-cache:invalidate",t)}catch(t){m(t,"onUnmounted")}}),O(()=>d.matiereId,async t=>{if(M(t))try{p.value.length===0&&await U(),r.selectedMatieresIds.includes(Number(t))||r.addMatiereId(t),g.value||G(Number(t))}catch(a){m(a,"watch matiereId")}},{immediate:!0}),O(()=>P.value,(t,a)=>{try{if(!g.value&&t.length>0){const i=r.activeMatiereId;i&&t.find(w=>w.id===i)&&(g.value=i)}}catch(i){m(i,"watch selectedMatieres")}}),O(()=>u.niveau_pays,async t=>{if(t)try{await U();const a=p.value.map(i=>i.id);r.selectedMatieresIds=r.selectedMatieresIds.filter(i=>a.includes(i)),r.selectedMatieresIds.length===0&&p.value.length>0&&(r.addMatiereId(p.value[0].id),G(p.value[0].id))}catch(a){m(a,"watch userStore.niveau_pays")}},{immediate:!1}),O(()=>r.activeMatiereId,t=>{try{t!==g.value&&(t&&P.value.find(a=>a.id===t)?(g.value=t,v("matiere-changed",t)):t&&!r.selectedMatieresIds.includes(t)&&r.addMatiereId(t))}catch(a){m(a,"watch store activeMatiereId")}},{immediate:!1}),(t,a)=>(l(),c("div",ps,[(l(),Y(Me,{to:"body"},[I(hs,{visible:o.value.visible,x:o.value.x,y:o.value.y,"is-favorite":o.value.isFavorite,"matiere-id":o.value.matiereId,onFavoriteToggle:qe,onClose:Le},null,8,["visible","x","y","is-favorite","matiere-id"])])),h.value&&p.value.length===0?(l(),c("div",vs,a[2]||(a[2]=[e("div",{class:"loading-spinner"},null,-1),e("span",null,"Chargement des matières...",-1)]))):(l(),c("div",ms,[e("div",fs,[P.value.length===0?(l(),c("button",{key:0,class:"matiere-tab new-tab",onClick:a[0]||(a[0]=i=>be(i)),disabled:h.value,title:"Ajouter une nouvelle matière",ref_key:"newMatiereButton",ref:E,"aria-label":"Ajouter une nouvelle matière"},a[3]||(a[3]=[e("span",{class:"tab-icon","aria-hidden":"true"},"+",-1),e("span",{class:"tab-name"},"New Matière",-1)]),8,gs)):k("",!0),(l(!0),c(Q,null,K(P.value,i=>(l(),c("div",{key:`tab-${i.id}`,class:q(["matiere-tab",{active:g.value===i.id,loading:f.value===i.id}]),onClick:w=>G(i.id),onMousedown:w=>ie(w,i.id),onContextmenu:F(w=>re(w,i),["prevent"]),title:`Voir ${i.nom}`,"aria-label":`Matière ${i.nom}`,"aria-selected":g.value===i.id,role:"tab"},[e("span",_s,C(i.nom),1),e("button",{class:"tab-close",onClick:F(w=>se(i.id),["stop"]),title:`Fermer ${i.nom}`,"aria-label":`Fermer l'onglet ${i.nom}`,disabled:h.value}," × ",8,ys)],42,bs))),128)),P.value.length>0?(l(),c("button",{key:1,class:"matiere-tab new-tab-small",onClick:a[1]||(a[1]=i=>be(i)),disabled:h.value||$.value.length===0,title:"Ajouter une nouvelle matière",ref_key:"newMatiereButton",ref:E,"aria-label":"Ajouter une nouvelle matière"},a[4]||(a[4]=[e("span",{class:"tab-icon","aria-hidden":"true"},"+",-1)]),8,ks)):k("",!0)]),(l(),Y(Me,{to:"body"},[A.value?(l(),c("div",{key:0,class:"matiere-dropdown",style:oe(D.value),role:"listbox","aria-label":"Liste des matières disponibles",onKeydown:je},[e("div",{class:"dropdown-header"},[a[5]||(a[5]=e("span",{class:"dropdown-title"},"Matières disponibles",-1)),e("button",{class:"dropdown-close",onClick:Z,"aria-label":"Fermer la liste"}," × ")]),(l(!0),c(Q,null,K($.value,(i,w)=>(l(),c("div",{key:`dropdown-${i.id}`,class:q(["dropdown-item",{"last-item":w===$.value.length-1,loading:f.value===i.id}]),onClick:S=>_e(i),onContextmenu:F(S=>re(S,i),["prevent"]),role:"option","aria-selected":!1,title:`Ouvrir ${i.nom}`},[e("div",$s,[e("span",{class:"dropdown-icon",innerHTML:i.svg_icon||"📚","aria-hidden":"true"},null,8,Ms),e("span",xs,C(i.nom),1)]),e("button",{class:q(["dropdown-star",{favorite:x(r).isFavoriteMatiere(i.id),loading:b.value===i.id}]),onClick:F(S=>ye(i.id),["stop"]),title:x(r).isFavoriteMatiere(i.id)?"Retirer des favoris":"Ajouter aux favoris","aria-label":x(r).isFavoriteMatiere(i.id)?`Retirer ${i.nom} des favoris`:`Ajouter ${i.nom} aux favoris`,disabled:b.value===i.id},[e("span",Is,C(x(r).isFavoriteMatiere(i.id)?"⭐":"☆"),1)],10,Cs)],42,ws))),128)),$.value.length===0?(l(),c("div",Ss,a[6]||(a[6]=[e("span",{class:"empty-icon"},"📚",-1),e("span",{class:"empty-text"},"Toutes les matières sont déjà ouvertes",-1)]))):k("",!0)],36)):k("",!0)])),_.value.length>0?(l(),c("div",As,[e("div",Es,[a[7]||(a[7]=e("div",{class:"favorites-label"},[e("span",{class:"favorites-icon","aria-hidden":"true"},"⭐"),e("span",{class:"favorites-text"},"Favoris:")],-1)),e("div",zs,[(l(!0),c(Q,null,K(_.value,i=>(l(),c("button",{key:`favorite-${i.id}`,class:q(["favorite-item",{active:g.value===i.id,loading:f.value===i.id}]),onClick:w=>_e(i),onContextmenu:F(w=>re(w,i),["prevent"]),title:`Ouvrir ${i.nom}`,"aria-label":`Ouvrir la matière favorite ${i.nom}`,disabled:f.value===i.id},[e("span",{class:"favorite-icon",innerHTML:i.svg_icon||"📚","aria-hidden":"true"},null,8,Ns),e("span",Ls,C(i.nom),1)],42,Ts))),128))]),_.value.length>ce?(l(),c("button",{key:0,class:"favorites-toggle",onClick:De,title:L.value?"Réduire les favoris":"Voir tous les favoris","aria-label":L.value?"Réduire la liste des favoris":"Voir tous les favoris"},C(L.value?"‹":"›"),9,qs)):k("",!0)])])):k("",!0)]))]))}},Ps=j(js,[["__scopeId","data-v-ac06c28c"]]),Fs={class:"header-center"},Hs={__name:"ConditionalHeader",props:{subjectPages:{type:Array,default:()=>["Calculator","Exercises","Sheets"]},searchPages:{type:Array,default:()=>["Dashboard","Chapitres","Notions"]},chapterPages:{type:Array,default:()=>["Exercices","ChapterQuiz","CourseChapitre","QuizChapitres","CourseChapitres","Chapitres"]},matierePages:{type:Array,default:()=>["Dashboard","Themes","Notions","Exercises","OnlineCourses","CourseNotions","Quiz","QuizNotions","Sheets"]},subjectProps:{type:Object,default:()=>({})},searchProps:{type:Object,default:()=>({})},chapterProps:{type:Object,default:()=>({})},matiereProps:{type:Object,default:()=>({})}},emits:["subject-changed","search"],setup(n,{emit:s}){const d=n,v=s,r=ne(),u=z(()=>{const h=r.name;return h==="Quiz"||h==="QuizNotions"||h==="Dashboard"||d.matierePages.includes(h)?Ps:d.chapterPages.includes(h)?ls:d.subjectPages.includes(h)?as:null}),o=z(()=>{const h=r.name;return h==="Quiz"||h==="QuizNotions"||h==="Dashboard"||d.matierePages.includes(h)?{matiereId:d.matiereProps.matiereId,...d.matiereProps}:d.chapterPages.includes(h)?{chapitreId:r.params.chapitreId,...d.chapterProps}:d.subjectPages.includes(h)?{...d.subjectProps}:{...d.searchProps}}),p=h=>{v("subject-changed",h)};return(h,f)=>(l(),c("div",Fs,[(l(),Y(ve(u.value),Pe(o.value,{onSubjectChanged:p}),null,16))]))}},Os=j(Hs,[["__scopeId","data-v-887afde6"]]),Bs={class:"notification-center"},Vs={key:0,class:"notification-badge"},Rs={class:"notification-header"},Qs={class:"notification-actions"},Us={class:"notification-list"},Ks=["onClick"],Ws={class:"notification-item-icon"},Xs={class:"icon"},Zs={class:"notification-item-content"},Js={class:"notification-item-title"},Gs={class:"notification-item-message"},Ys={class:"notification-item-time"},ea={key:0,class:"unread-indicator"},ta=["onClick"],sa={key:0,class:"notification-empty"},aa={__name:"NotificationCenter",setup(n){const s=Ue(),d=N(!1),v=z(()=>s.notifications),r=z(()=>s.unreadCount),u=z(()=>s.hasUnread);function o(){d.value=!d.value}function p(){d.value=!1}const{markAsRead:h,markAllAsRead:f,removeNotification:b,clearAll:g,loadFromServer:A}=s;async function L(m){if(!m.read)try{await h(m.id)}catch{}m.type}async function E(m){b(m);try{await We(m)}catch{}}async function D(){g();try{await Ke()}catch{}}function P(m){return{xp_gained:"⭐",level_up:"🏆",exercise_unlocked:"🔓",chapter_completed:"✅",achievement:"🏅",daily_streak:"🔥"}[m]||"🔔"}function $(m){const M=new Date,y=new Date(m),T=M-y,H=Math.floor(T/(1e3*60)),W=Math.floor(H/60),U=Math.floor(W/24);return H<1?"À l'instant":H<60?`Il y a ${H}min`:W<24?`Il y a ${W}h`:U<7?`Il y a ${U}j`:y.toLocaleDateString("fr-FR",{day:"numeric",month:"short"})}function _(m){m.key==="Escape"&&d.value&&p()}return X(()=>{document.addEventListener("keydown",_);try{A()}catch{}}),te(()=>{document.removeEventListener("keydown",_)}),(m,M)=>(l(),c("div",Bs,[e("button",{class:q(["notification-trigger",{"has-notifications":u.value}]),onClick:o,"aria-label":"Notifications",title:"Notifications"},[I(x(Ze),{class:"notification-icon"}),r.value>0?(l(),c("span",Vs,C(r.value>99?"99+":r.value),1)):k("",!0)],2),I(Ae,{name:"notification-panel"},{default:ue(()=>[d.value?(l(),c("div",{key:0,class:"notification-panel",onClick:M[1]||(M[1]=F(()=>{},["stop"]))},[e("div",Rs,[M[2]||(M[2]=e("h3",{class:"notification-title"},"Notifications",-1)),e("div",Qs,[u.value?(l(),c("button",{key:0,onClick:M[0]||(M[0]=(...y)=>x(f)&&x(f)(...y)),class:"btn-mark-all-read",title:"Tout marquer comme lu"}," ✓ Tout lire ")):k("",!0),e("button",{onClick:D,class:"btn-clear-all",title:"Effacer tout"}," 🗑️ "),e("button",{onClick:p,class:"btn-close",title:"Fermer"}," ✕ ")])]),e("div",Us,[I(Fe,{name:"notification-item",tag:"div"},{default:ue(()=>[(l(!0),c(Q,null,K(v.value,y=>(l(),c("div",{key:y.id,class:q(["notification-item",[`type-${y.type}`,{unread:!y.read}]]),onClick:T=>L(y)},[e("div",Ws,[e("span",Xs,C(P(y.type)),1)]),e("div",Zs,[e("h4",Js,C(y.title),1),e("p",Gs,C(y.message),1),e("time",Ys,C($(y.timestamp)),1)]),y.read?k("",!0):(l(),c("div",ea)),e("button",{onClick:F(T=>E(y.id),["stop"]),class:"btn-remove-notification",title:"Supprimer"}," ✕ ",8,ta)],10,Ks))),128))]),_:1}),v.value.length===0?(l(),c("div",sa,M[3]||(M[3]=[e("div",{class:"empty-icon"},"🔔",-1),e("p",{class:"empty-message"},"Aucune notification",-1),e("p",{class:"empty-subtitle"},"Vous recevrez des notifications pour vos progrès !",-1)]))):k("",!0)])])):k("",!0)]),_:1}),d.value?(l(),c("div",{key:0,class:"notification-overlay",onClick:p})):k("",!0)]))}},oa=j(aa,[["__scopeId","data-v-89ab5c85"]]),na={class:"dashboard-header"},ia={class:"header-right"},ra={__name:"DashboardHeader",emits:["toggle-sidebar","subject-changed","search"],setup(n,{emit:s}){const d=s;ee();const v=o=>{d("subject-changed",o)},r=o=>{d("search",o)},u=()=>{};return(o,p)=>(l(),c("header",na,[e("button",{class:"burger-btn-fixed",onClick:p[0]||(p[0]=h=>o.$emit("toggle-sidebar")),"aria-label":"Ouvrir ou fermer le menu"},p[1]||(p[1]=[e("span",{class:"burger-icon-fixed"},"☰",-1)])),I(Os,{"matiere-props":{matiereId:null},onSubjectChanged:v,onSearch:r}),e("div",ia,[I(oa),I(Yt,{onLogout:u})])]))}},la=j(ra,[["__scopeId","data-v-622cc6f9"]]),ca={name:"AIAssistant",props:{autoFocus:{type:Boolean,default:!1}},data(){return{currentMessage:"",selectedModel:"gpt-3.5-turbo",messages:[],isLoading:!1,error:null,conversationId:null}},watch:{currentMessage:{handler(){this.$nextTick(()=>{this.autoResizeTextarea()})}}},async mounted(){await this.loadConversationHistory(),this.autoFocus&&this.$refs.messageInput&&this.$nextTick(()=>{this.$refs.messageInput.focus()})},methods:{async sendMessage(n){if(!this.currentMessage.trim()||this.isLoading)return;const s={role:"user",content:this.currentMessage.trim(),timestamp:new Date};this.messages.push(s);const d=this.currentMessage.trim();this.currentMessage="",this.$nextTick(()=>{this.scrollToBottom()}),await this.sendToAI(d)},async sendSuggestion(n){this.currentMessage=n,await this.sendMessage()},async sendToAI(n){this.isLoading=!0,this.error=null;try{const s=await Ie.post("/api/ai/ask/",{message:n,model:this.selectedModel},{headers:{Authorization:`Bearer ${this.getAuthToken()}`}}),d={role:"assistant",content:s.data.ai_response,timestamp:new Date,tokens:s.data.tokens_used};this.messages.push(d),this.$nextTick(()=>{this.scrollToBottom()})}catch(s){this.error=s.response?.data?.error||s.response?.data?.message||"Erreur lors de la requête IA";const d={role:"assistant",content:"Désolé, une erreur s'est produite. Veuillez réessayer.",timestamp:new Date,isError:!0};this.messages.push(d)}finally{this.isLoading=!1}},async loadConversationHistory(){try{const n=this.getAuthToken();if(!n)return;const s=await Ie.get("/api/ai/history/",{headers:{Authorization:`Bearer ${n}`}});this.messages=[],Array.isArray(s.data)?s.data.forEach((d,v)=>{this.messages.push({role:"user",content:d.message,timestamp:new Date(d.created_at)}),this.messages.push({role:"assistant",content:d.ai_response,timestamp:new Date(d.created_at),tokens:d.tokens_used})}):s.data&&typeof s.data=="object"&&s.data.results&&Array.isArray(s.data.results)&&s.data.results.forEach(d=>{this.messages.push({role:"user",content:d.message,timestamp:new Date(d.created_at)}),this.messages.push({role:"assistant",content:d.ai_response,timestamp:new Date(d.created_at),tokens:d.tokens_used})}),this.$nextTick(()=>{this.scrollToBottom()})}catch(n){n.response?n.response.status===401||n.response.status:n.request,this.messages=[]}},clearChat(){this.messages=[],this.conversationId=null},addNewLine(){this.currentMessage+=`
`},scrollToBottom(){this.$refs.messagesContainer&&(this.$refs.messagesContainer.scrollTop=this.$refs.messagesContainer.scrollHeight)},autoResizeTextarea(){const n=this.$refs.messageInput;n&&(n.style.height="auto",n.style.height=Math.min(n.scrollHeight,120)+"px")},formatMessage(n){return n.replace(/\n/g,"<br>")},formatTime(n){return n.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})},getAuthToken(){return localStorage.getItem("access_token")||""}}},da={class:"chatgpt-container"},ua={class:"chat-header"},ha={class:"header-info"},pa={class:"header-text"},va={class:"status"},ma={class:"header-actions"},fa={class:"messages-container",ref:"messagesContainer"},ga={key:0,class:"welcome-message"},ba={class:"welcome-content"},_a={key:0,class:"auth-warning"},ya={class:"suggestions"},ka={class:"suggestion-tags"},wa={class:"message-avatar"},$a={key:0,class:"avatar-icon user"},Ma={key:1,class:"avatar-icon ai"},xa={class:"message-content"},Ca={class:"message-bubble"},Ia={key:0,class:"message-text"},Sa=["innerHTML"],Aa={key:2,class:"message-meta"},Ea={class:"tokens-info"},za={key:0,class:"message-time"},Ta={key:1,class:"message-wrapper ai-message"},Na={class:"input-container"},La={class:"input-wrapper"},qa=["disabled"],Da=["disabled"],ja={key:0,class:"loading-spinner"},Pa={key:1},Fa={key:0,class:"error-toast"};function Ha(n,s,d,v,r,u){return l(),c("div",da,[e("div",ua,[e("div",ha,[s[10]||(s[10]=e("div",{class:"ai-avatar"},[e("span",{class:"avatar-icon"},"🤖")],-1)),e("div",pa,[s[9]||(s[9]=e("h3",null,"Assistant IA OptiTAB",-1)),e("span",va,[e("span",{class:q(["status-dot",{online:!r.isLoading}])},null,2),le(" "+C(r.isLoading?"En train d'écrire...":"En ligne"),1)])])]),e("div",ma,[e("button",{onClick:s[0]||(s[0]=(...o)=>u.clearChat&&u.clearChat(...o)),class:"clear-btn",title:"Nouvelle conversation"}," 🗑️ ")])]),e("div",fa,[r.messages.length===0?(l(),c("div",ga,[e("div",ba,[s[13]||(s[13]=e("h4",null,"👋 Bonjour ! Je suis votre assistant pédagogique IA",-1)),s[14]||(s[14]=e("p",null,"Je peux vous aider avec vos questions de mathématiques en me basant sur les exercices et cours disponibles dans OptiTAB.",-1)),u.getAuthToken()?k("",!0):(l(),c("div",_a,s[11]||(s[11]=[e("p",null,[le("⚠️ "),e("strong",null,"Connexion requise :"),le(" Connectez-vous pour utiliser l'assistant IA")],-1)]))),e("div",ya,[s[12]||(s[12]=e("p",null,"Essayez de me demander :",-1)),e("div",ka,[e("span",{onClick:s[1]||(s[1]=o=>u.sendSuggestion("Explique-moi les dérivées")),class:"tag"},"Explique-moi les dérivées"),e("span",{onClick:s[2]||(s[2]=o=>u.sendSuggestion("Donne-moi un exercice sur les intégrales")),class:"tag"},"Exercice sur les intégrales"),e("span",{onClick:s[3]||(s[3]=o=>u.sendSuggestion("Comment résoudre une équation du second degré")),class:"tag"},"Équation du second degré")])])])])):k("",!0),(l(!0),c(Q,null,K(r.messages,(o,p)=>(l(),c("div",{key:p,class:q(["message-wrapper",{"user-message":o.role==="user","ai-message":o.role==="assistant"}])},[e("div",wa,[o.role==="user"?(l(),c("span",$a,"👤")):(l(),c("span",Ma,"🤖"))]),e("div",xa,[e("div",Ca,[o.role==="user"?(l(),c("div",Ia,C(o.content),1)):(l(),c("div",{key:1,class:"message-text",innerHTML:u.formatMessage(o.content)},null,8,Sa)),o.role==="assistant"&&o.tokens?(l(),c("div",Aa,[e("span",Ea,C(o.tokens)+" tokens utilisés",1)])):k("",!0)]),o.role==="assistant"?(l(),c("div",za,C(u.formatTime(o.timestamp)),1)):k("",!0)])],2))),128)),r.isLoading?(l(),c("div",Ta,s[15]||(s[15]=[He('<div class="message-avatar" data-v-bc149a32><span class="avatar-icon ai" data-v-bc149a32>🤖</span></div><div class="message-content" data-v-bc149a32><div class="message-bubble typing" data-v-bc149a32><div class="typing-dots" data-v-bc149a32><span data-v-bc149a32></span><span data-v-bc149a32></span><span data-v-bc149a32></span></div></div></div>',2)]))):k("",!0)],512),e("div",Na,[e("div",La,[me(e("textarea",{"onUpdate:modelValue":s[4]||(s[4]=o=>r.currentMessage=o),onKeydown:[s[5]||(s[5]=xe(F((...o)=>n.simpleSend&&n.simpleSend(...o),["exact","prevent"]),["enter"])),s[6]||(s[6]=xe(F((...o)=>u.addNewLine&&u.addNewLine(...o),["shift","exact"]),["enter"]))],placeholder:"Posez votre question sur les mathématiques... (Enter pour envoyer)",class:"message-input",disabled:r.isLoading,rows:"1",ref:"messageInput"},null,40,qa),[[Oe,r.currentMessage]]),e("button",{onClick:s[7]||(s[7]=(...o)=>n.simpleSend&&n.simpleSend(...o)),class:q(["send-btn",{active:r.currentMessage.trim()}]),disabled:!r.currentMessage.trim()||r.isLoading,title:"Envoyer le message"},[r.isLoading?(l(),c("span",ja,"⏳")):(l(),c("span",Pa,"📤"))],10,Da)])]),r.error?(l(),c("div",Fa,[s[16]||(s[16]=e("span",{class:"error-icon"},"⚠️",-1)),e("span",null,C(r.error),1),e("button",{onClick:s[8]||(s[8]=o=>r.error=null),class:"error-close"},"✕")])):k("",!0)])}const Oa=j(ca,[["render",Ha],["__scopeId","data-v-bc149a32"]]),Ba={name:"AIModal",components:{AIAssistant:Oa},props:{showModal:{type:Boolean,default:!1}},methods:{closeModal(){this.$emit("close")}}},Va={class:"ai-modal-header"};function Ra(n,s,d,v,r,u){const o=ze("AIAssistant");return d.showModal?(l(),c("div",{key:0,class:"ai-modal-overlay",onClick:s[2]||(s[2]=(...p)=>u.closeModal&&u.closeModal(...p))},[e("div",{class:"ai-modal-content",onClick:s[1]||(s[1]=F(()=>{},["stop"]))},[e("div",Va,[s[3]||(s[3]=e("h3",null,"🤖 Assistant IA OptiTAB",-1)),e("button",{onClick:s[0]||(s[0]=(...p)=>u.closeModal&&u.closeModal(...p)),class:"close-btn"},"✕")]),I(o,{"auto-focus":!0})])])):k("",!0)}const Qa=j(Ba,[["render",Ra],["__scopeId","data-v-6287401f"]]),Ua={name:"AIFloatingButton",components:{AIModal:Qa},props:{},data(){return{showModal:!1}},methods:{toggleModal(){this.showModal=!this.showModal},closeModal(){this.showModal=!1}}},Ka={class:"ai-floating-container"};function Wa(n,s,d,v,r,u){const o=ze("AIModal");return l(),c("div",Ka,[e("button",{onClick:s[0]||(s[0]=(...p)=>u.toggleModal&&u.toggleModal(...p)),class:q(["ai-floating-btn",{active:r.showModal}]),title:"Assistant IA OptiTAB"},s[1]||(s[1]=[e("span",{class:"ai-icon"},"🤖",-1),e("span",{class:"ai-text"},"IA",-1)]),2),I(o,{"show-modal":r.showModal,onClose:u.closeModal},null,8,["show-modal","onClose"])])}const Xa=j(Ua,[["render",Wa],["__scopeId","data-v-b7e93243"]]),Za={class:"dashboard-layout"},Ja={class:"dashboard-main-container"},Ga={class:"dashboard-content"},Ya={class:"dashboard-main"},eo={__name:"DashboardLayout",emits:["sidebar-toggle","navigation","subject-changed"],setup(n,{emit:s}){const d=s,v=N(null),r=ne(),u=N(!0),o=N(!1),p=()=>{o.value=!o.value,localStorage.setItem("sidebar-collapsed",o.value.toString())},h=b=>{d("navigation",b)},f=b=>{d("subject-changed",b)};return X(async()=>{const b=localStorage.getItem("sidebar-open");b!==null&&(u.value=b==="true");const g=localStorage.getItem("sidebar-collapsed");g!==null&&(o.value=g==="true"),await he(),v.value}),O(()=>r.path,(b,g)=>{},{immediate:!1}),O(()=>o.value,(b,g)=>{},{immediate:!1}),(b,g)=>(l(),c("div",Za,[I(la,{sidebarOpen:u.value,onToggleSidebar:p,onSubjectChanged:f},null,8,["sidebarOpen"]),e("div",Ja,[me(I(Lt,{collapsed:o.value,onNavigation:h,onToggleCollapsed:p,ref_key:"sidebarRef",ref:v},null,8,["collapsed"]),[[Ee,u.value]]),k("",!0),e("div",Ga,[e("main",Ya,[Be(b.$slots,"default",{},void 0,!0)])])]),I(Xa)]))}},io=j(eo,[["__scopeId","data-v-11fbf57a"]]);export{io as D,Je as r};
