import{a as d,c as D,B as j,b as o,d as a,k as y,g as b,K as g,L as S,F as c,p as v,t as r,w as F,o as i,j as L,h as U,u as G}from"./vendor-D171CWhe.js";import{b as P,u as T,c as q,d as z}from"./matieres-HKHHhne_.js";import{_ as I,B as K}from"./index-lv_OcPRH.js";import{c as O,g as R,d as $}from"./matiere-contextes-DbkYd_BX.js";import{A as H}from"./AdminActionsButtons-CuAf-izV.js";import"./ui-jaH5oyHW.js";import"./pdf-B39ievqC.js";import"./mathlive-B5k0jhbN.js";const J={class:"contextes-panel"},Q={class:"contextes-actions"},W=["label"],X=["value","disabled"],Y=["disabled"],Z={key:0},ee={key:1},te={key:0,class:"chips"},ae=["onClick","disabled"],se={class:"btn-primary",type:"submit"},ne={class:"admin-table"},oe={class:"pays-badges"},ie=["title"],le={class:"pays-flag"},re={class:"pays-name"},ue={key:0,class:"pays-empty"},de={__name:"AdminMatieres",setup(ce){const _=d([]),k=d([]),p=d({}),u=d({niveau:""}),m=d(!1),f=d(null),w=D(()=>{const s=new Map;for(const t of k.value||[]){const e=t.pays||t.pays_id||t.pays_nom;s.has(e)||s.set(e,{pays_id:e,pays_nom:t.pays_nom||"Pays",niveaux:[]}),s.get(e).niveaux.push(t)}return Array.from(s.values()).sort((t,e)=>t.pays_nom.localeCompare(e.pays_nom))});function M(s){return(p.value[n.value.id]||[]).some(e=>e.niveau?.id===s||e.niveau===s)}const n=d({id:null,nom:"",description:"",svg_icon:""});async function x(){try{const{data:s}=await P();_.value=s||[],k.value=await K({est_actif:!0}),await h()}catch{_.value=[]}}j(x);function C(){n.value={id:null,nom:"",description:"",svg_icon:""},u.value.niveau=""}async function A(){if(n.value.nom)try{n.value.id?await T(n.value.id,n.value):await q(n.value),C(),await x()}catch{}}function E(s){n.value={id:s.id,nom:s.nom||s.titre||"",description:s.description||"",svg_icon:s.svg_icon||""},u.value.niveau=""}async function V(s){try{await z(s.id),await x()}catch{}}async function h(){try{const s=await R(),t={};for(const e of s)t[e.matiere]||(t[e.matiere]=[]),t[e.matiere].push(e);p.value=t}catch{}}async function B(){if(!(!n.value.id||!u.value.niveau))try{m.value=!0,await O({matiere:n.value.id,niveau:u.value.niveau}),await h(),u.value.niveau=""}catch{}finally{m.value=!1}}async function N(s){try{f.value=s,await $(s),await h()}catch{}finally{f.value=null}}return(s,t)=>(i(),o("div",null,[t[8]||(t[8]=a("h2",{class:"admin-title"},"Gestion des Mati√®res",-1)),a("form",{class:"admin-form",onSubmit:F(A,["prevent"])},[y(a("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.value.nom=e),placeholder:"Nom de la mati√®re",required:""},null,512),[[g,n.value.nom]]),y(a("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>n.value.description=e),placeholder:"Description"},null,512),[[g,n.value.description]]),y(a("textarea",{"onUpdate:modelValue":t[2]||(t[2]=e=>n.value.svg_icon=e),placeholder:"Code SVG"},null,512),[[g,n.value.svg_icon]]),a("div",J,[t[5]||(t[5]=a("h3",null,"Contextes (Mati√®re + Niveau)",-1)),a("div",Q,[y(a("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>u.value.niveau=e),class:"select"},[t[4]||(t[4]=a("option",{value:""},"S√©lectionner un niveau",-1)),(i(!0),o(c,null,v(w.value,e=>(i(),o("optgroup",{key:e.pays_id,label:e.pays_nom},[(i(!0),o(c,null,v(e.niveaux,l=>(i(),o("option",{key:l.id,value:l.id,disabled:M(l.id)},r(l.nom),9,X))),128))],8,W))),128))],512),[[S,u.value.niveau]]),a("button",{class:"btn-primary",type:"button",onClick:B,disabled:!n.value.id||!u.value.niveau||m.value},[m.value?(i(),o("span",Z,"Ajout...")):(i(),o("span",ee,"Ajouter"))],8,Y)]),(p.value[n.value.id]||[]).length?(i(),o("div",te,[(i(!0),o(c,null,v(p.value[n.value.id],e=>(i(),o("span",{class:"chip",key:e.id},[L(r(e.pays.nom)+" - "+r(e.niveau.nom)+" ",1),a("button",{class:"chip-remove",title:"Retirer",onClick:l=>N(e.id),disabled:f.value===e.id},"√ó",8,ae)]))),128))])):b("",!0),t[6]||(t[6]=a("small",{class:"hint"},"Cr√©ez des contextes pour lier cette mati√®re √† des niveaux/pays.",-1))]),a("button",se,r(n.value.id?"Mettre √† jour":"Cr√©er"),1),n.value.id?(i(),o("button",{key:0,class:"btn-secondary",type:"button",onClick:C},"Annuler")):b("",!0)],32),a("table",ne,[t[7]||(t[7]=a("thead",null,[a("tr",null,[a("th",null,"ID"),a("th",null,"Nom"),a("th",null,"Description"),a("th",null,"Contextes (aper√ßu)"),a("th",null,"Actions")])],-1)),a("tbody",null,[(i(!0),o(c,null,v(_.value,e=>(i(),o("tr",{key:e.id},[a("td",null,r(e.id),1),a("td",null,r(e.nom),1),a("td",null,r(e.description),1),a("td",null,[a("div",oe,[(i(!0),o(c,null,v(e.contextes||[],l=>(i(),o("span",{key:l.id,class:"pays-badge",title:(l.pays?.nom||"")+" - "+(l.niveau?.nom||"")},[a("span",le,r(l.pays?.drapeau_emoji||"üè≥Ô∏è"),1),a("span",re,r((l.pays?.nom||"")+" - "+(l.niveau?.nom||"")),1)],8,ie))),128)),e.contextes&&e.contextes.length?b("",!0):(i(),o("span",ue,"Aucun"))])]),a("td",null,[U(G(H),{item:e,actions:["edit","delete"],"edit-label":"√âditer","confirm-message":"√ätes-vous s√ªr de vouloir supprimer cette mati√®re ?",onEdit:E,onDelete:V},null,8,["item"])])]))),128))])])]))}},be=I(de,[["__scopeId","data-v-20d0a1d6"]]);export{be as default};
