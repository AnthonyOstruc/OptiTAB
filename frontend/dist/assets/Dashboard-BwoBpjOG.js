import{D as ve}from"./DashboardLayout-DOJbCPaM.js";import{_ as J,u as se,f as _e,a as de,b as le,X as pe,c as me,d as he,e as ge,g as ye,h as ce,i as fe,r as $e}from"./index-DdsjLnq7.js";import{a as y,c as V,D as be,e as K,b as o,o as a,d as e,n as z,i as $,l as I,x as T,t as s,F as X,s as B,q as ie,h as te,C as O,G as ke,w as ne,A as re,f as xe,j as W,m as ae,K as oe,J as Ce}from"./vendor-1gmgAmFu.js";import{g as Se,a as we}from"./curriculum-6-VMzQHc.js";import{g as je}from"./matieres-DVwPPJpo.js";import{g as De}from"./exercices-C-wjej7k.js";import{B as ue}from"./BaseHistory-ZQpMzJp2.js";import{useDailyObjectives as ze}from"./useDailyObjectives-BmxeqRqv.js";import"./menuItems-C0wivC9l.js";import"./ui-jaH5oyHW.js";import"./pdf-B39ievqC.js";import"./mathlive-B5k0jhbN.js";const Pe={class:"leaderboard-card"},Me={class:"leaderboard-header"},Ne={class:"leaderboard-tabs"},Ee=["disabled"],Te={key:0,class:"flag"},qe=["disabled"],Xe={key:0,class:"leaderboard-body"},Re={class:"leaderboard-content"},Ie={key:0,class:"leaderboard-item me-item"},Le={class:"rank"},Ae={class:"me-rank"},Ve={class:"me-sub"},He={class:"user"},Oe={class:"info"},Be={class:"meta"},Qe={key:0,class:"flag"},Fe={key:1,class:"niveau"},Ue={class:"xp"},Je={class:"me-xp"},We={class:"me-percent"},Ge={class:"leaderboard-list"},Ke={class:"rank"},Ye={key:0,class:"trophy gold"},Ze={key:1,class:"trophy silver"},et={key:2,class:"trophy bronze"},tt={key:3},st={class:"user"},at={class:"avatar"},ot={class:"info"},it={class:"name"},nt={key:0,class:"flag name-flag"},rt={class:"first-name"},lt={class:"last-name"},ct={key:0,class:"meta"},dt={class:"xp"},ut={key:1,class:"expanded-section"},vt={class:"expanded-header"},_t={class:"expanded-count"},pt={class:"leaderboard-list"},mt={class:"rank"},ht={class:"user"},gt={class:"avatar"},yt={class:"info"},ft={class:"name"},$t={key:0,class:"flag name-flag"},bt={class:"first-name"},kt={class:"last-name"},xt={key:0,class:"meta"},Ct={class:"xp"},St={key:0,class:"leaderboard-actions"},wt=["disabled"],jt={key:1,class:"empty-state"},Dt={key:1,class:"leaderboard-loading"},zt={__name:"LeaderboardWidget",setup(Q){const f=se(),h=y("global"),w=y(!0);y([]);const b=y(null),j=y(!1),g=y([]),x=V(()=>!!f?.pays?.id),_=V(()=>!!f?.niveau_pays?.id);function p(N){N==="pays"&&!x.value||N==="niveau"&&!_.value||(h.value=N)}function M(N){if(!N)return"U";const u=String(N).trim().split(/\s+/);return u.length===1?u[0].substring(0,2).toUpperCase():(u[0].substring(0,1)+u[1].substring(0,1)).toUpperCase()}function D(N){const u=String(N||"").trim();if(!u)return{firstName:"",lastName:""};const v=u.split(/\s+/),k=v[0]||"",r=v.slice(1).join(" ")||"";return{firstName:k,lastName:r}}async function E(){w.value=!0;try{const u=(await _e({scope:h.value,limit:50}))?.data?.data||{},v=u.leaderboard||[];g.value=v.slice(0,50),b.value=u.me||null,j.value=!1}catch{g.value=[],b.value=null}finally{w.value=!1}}async function P(){j.value=!0}function L(){j.value=!1}return be(h,()=>E()),K(()=>E()),(N,u)=>(a(),o("div",Pe,[e("div",Me,[u[4]||(u[4]=e("h3",{class:"leaderboard-title"},"Classement",-1)),e("div",Ne,[e("button",{class:z(["tab",{active:h.value==="global"}]),onClick:u[0]||(u[0]=v=>p("global"))},"Global",2),e("button",{class:z(["tab",{active:h.value==="pays"}]),onClick:u[1]||(u[1]=v=>p("pays")),disabled:!x.value},[T(f).pays?.drapeau_emoji?(a(),o("span",Te,s(T(f).pays?.drapeau_emoji),1)):$("",!0),u[3]||(u[3]=I(" Pays "))],10,Ee),e("button",{class:z(["tab",{active:h.value==="niveau"}]),onClick:u[2]||(u[2]=v=>p("niveau")),disabled:!_.value}," Niveau ",10,qe)])]),w.value?(a(),o("div",Dt,[u[10]||(u[10]=e("div",{class:"skeleton me"},null,-1)),(a(),o(X,null,B(6,v=>e("div",{class:"skeleton row",key:v})),64))])):(a(),o("div",Xe,[e("div",Re,[b.value?(a(),o("div",Ie,[e("div",Le,[e("div",Ae,"#"+s(b.value.rank),1),e("div",Ve,"sur "+s(b.value.total),1)]),e("div",He,[e("div",Oe,[u[5]||(u[5]=e("div",{class:"name"},"Vous",-1)),e("div",Be,[b.value.pays_flag?(a(),o("span",Qe,s(b.value.pays_flag),1)):$("",!0),b.value.niveau?(a(),o("span",Fe,s(b.value.niveau),1)):$("",!0)])])]),e("div",Ue,[e("div",Je,s(b.value.xp)+" XP",1),e("div",We,"Top "+s(b.value.percentile)+"%",1)])])):$("",!0),e("ul",Ge,[(a(!0),o(X,null,B(g.value.slice(0,5),v=>(a(),o("li",{key:v.id,class:"leaderboard-item"},[e("div",Ke,[v.rank===1?(a(),o("span",Ye,"🥇")):v.rank===2?(a(),o("span",Ze,"🥈")):v.rank===3?(a(),o("span",et,"🥉")):(a(),o("span",tt,"#"+s(v.rank),1))]),e("div",st,[e("div",at,s(M(v.display_name)),1),e("div",ot,[e("div",it,[v.pays_flag?(a(),o("span",nt,s(v.pays_flag),1)):$("",!0),e("span",rt,s(D(v.display_name).firstName),1),e("span",lt,s(D(v.display_name).lastName),1)]),v.niveau?(a(),o("div",ct,s(v.niveau),1)):$("",!0)])]),e("div",dt,s(v.xp)+" XP",1)]))),128))]),j.value&&g.value.length>5?(a(),o("div",ut,[e("div",vt,[u[6]||(u[6]=e("span",{class:"expanded-title"},"Autres classés",-1)),e("span",_t,s(Math.min(g.value.length-5,45))+" utilisateurs",1)]),e("ul",pt,[(a(!0),o(X,null,B(g.value.slice(5,50),v=>(a(),o("li",{key:v.id,class:"leaderboard-item expanded-item"},[e("div",mt," #"+s(v.rank),1),e("div",ht,[e("div",gt,s(M(v.display_name)),1),e("div",yt,[e("div",ft,[v.pays_flag?(a(),o("span",$t,s(v.pays_flag),1)):$("",!0),e("span",bt,s(D(v.display_name).firstName),1),e("span",kt,s(D(v.display_name).lastName),1)]),v.niveau?(a(),o("div",xt,s(v.niveau),1)):$("",!0)])]),e("div",Ct,s(v.xp)+" XP",1)]))),128))])])):$("",!0)]),g.value.length>0?(a(),o("div",St,[j.value?(a(),o("button",{key:1,onClick:L,class:"btn-see-less"},u[8]||(u[8]=[e("span",{class:"btn-text"},"Voir moins",-1)]))):(a(),o("button",{key:0,onClick:P,class:"btn-see-more",disabled:w.value||g.value.length<=5},u[7]||(u[7]=[e("span",{class:"btn-text"},"Voir plus",-1)]),8,wt))])):$("",!0),g.value.length?$("",!0):(a(),o("div",jt,u[9]||(u[9]=[e("div",null,"Pas encore de classement pour ce filtre.",-1)])))]))]))}},Pt=J(zt,[["__scopeId","data-v-32a3f080"]]),Mt={class:"xp-card"},Nt={class:"xp-header"},Et={class:"xp-level"},Tt={class:"xp-ring"},qt={viewBox:"0 0 36 36",class:"circular-chart"},Xt=["stroke-dasharray"],Rt={x:"18",y:"20.35",class:"percentage"},It={class:"xp-next"},Lt={class:"streak-section"},At={class:"streak-header"},Vt={class:"streak-icon-container"},Ht={key:0,class:"streak-badge"},Ot={class:"streak-info"},Bt={class:"streak-subtitle"},Qt={key:0,class:"streak-next-xp"},Ft={class:"streak-xp-display"},Ut={class:"xp-icon"},Jt={class:"xp-value"},Wt={class:"streak-progress-container"},Gt={class:"streak-progress-bar"},Kt={class:"streak-progress-text"},Yt={key:0,class:"streak-motivation"},Zt={class:"motivation-text"},es={__name:"XPBadges",setup(Q){const f=se(),{initializeStreak:h,currentStreak:w,nextStreakXP:b}=de(),j=V(()=>f.level||0),g=V(()=>f.xp||0),x=V(()=>f.xp_to_next||0),_=V(()=>w.value),p=V(()=>_.value===0?0:_.value<=7?_.value/7*100:((_.value-1)%7+1)/7*100),M=V(()=>{if(_.value===0)return"Commencez votre streak !";if(_.value<=7)return`${_.value}/7 jours`;const u=(_.value-1)%7+1,v=Math.floor((_.value-1)/7)+1;return`${u}/7 jours (semaine ${v})`}),D=()=>_.value===0?"Connectez-vous chaque jour pour gagner des XP":_.value===1?"Excellent début ! Continuez demain":_.value<7?`${_.value} jours consécutifs`:_.value<30?`${_.value} jours - Vous êtes régulier !`:`${_.value} jours - Vous êtes un champion !`,E=()=>{const u=["Continuez comme ça ! Chaque jour compte.","Vous construisez une habitude d'apprentissage solide !","Impressionnant ! Votre persévérance paie.","Vous êtes sur la bonne voie vers la maîtrise !","Chaque jour d'apprentissage vous rapproche de vos objectifs."],v=Math.min(Math.floor(_.value/5),u.length-1);return u[v]},P=()=>_.value===0?1:_.value<=5?_.value:5,L=()=>{const u=P();return u>=5?"👑":u>=3?"🏆":u>=2?"⭐":"💎"},N=V(()=>{const u=Number(j.value||0),v=Number(g.value||0),k=u*u*10,r=(u+1)*(u+1)*10,S=Math.max(v,k)-k,A=Math.max(1,r-k);return`${Math.min(100,Math.round(S/A*100))}, 100`});return K(()=>{h()}),(u,v)=>(a(),o("div",Mt,[e("div",Nt,[v[0]||(v[0]=e("div",{class:"xp-title"},"Progression XP",-1)),e("div",Et,"Niveau "+s(j.value),1)]),e("div",Tt,[(a(),o("svg",qt,[v[1]||(v[1]=e("path",{class:"circle-bg",d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"},null,-1)),e("path",{class:"circle","stroke-dasharray":N.value,d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"},null,8,Xt),e("text",Rt,s(g.value)+" XP",1)]))]),e("div",It,s(x.value)+" XP pour le prochain niveau",1),e("div",Lt,[e("div",At,[e("div",Vt,[e("span",{class:z(["streak-icon",{"streak-active":_.value>0}])},"🔥",2),_.value>0?(a(),o("div",Ht,s(_.value),1)):$("",!0)]),e("div",Ot,[v[2]||(v[2]=e("h4",{class:"streak-title"},"Streak Quotidien",-1)),e("p",Bt,s(D()),1),_.value>0?(a(),o("p",Qt,"Prochain: +"+s(T(b))+" XP",1)):$("",!0)]),e("div",Ft,[e("span",Ut,s(L()),1),e("span",Jt,"+"+s(P())+" XP",1)])]),e("div",Wt,[e("div",Gt,[e("div",{class:"streak-progress-fill",style:ie({width:p.value+"%"})},null,4)]),e("div",Kt,s(M.value),1)]),_.value>0?(a(),o("div",Yt,[e("p",Zt,s(E()),1)])):$("",!0)])]))}},ts=J(es,[["__scopeId","data-v-b0d85bb8"]]),ss={key:0,class:"game-reset-notification"},as={__name:"GameResetNotification",props:{autoHide:{type:Number,default:8e3}},setup(Q){const f=Q,h=y(!1);function w(){h.value=!1,localStorage.setItem("game-reset-notification-seen","true")}return K(()=>{localStorage.getItem("game-reset-notification-seen")||(h.value=!0,f.autoHide>0&&setTimeout(()=>{h.value&&w()},f.autoHide))}),(b,j)=>(a(),te(ke,{name:"notification",appear:""},{default:O(()=>[h.value?(a(),o("div",ss,[j[0]||(j[0]=e("div",{class:"notification-icon"},[e("span",null,"🎮")],-1)),j[1]||(j[1]=e("div",{class:"notification-content"},[e("div",{class:"notification-title"}," Système de gamification mis à jour ! "),e("div",{class:"notification-message"},[e("p",null,[I("🎯 "),e("strong",null,"Nouveau :"),I(" Seuls les "),e("strong",null,"quiz"),I(" donnent maintenant des XP")]),e("p",null,"📚 Les exercices guidés restent éducatifs (0 XP)"),e("p",null,"🏆 Tous les compteurs ont été remis à zéro pour un restart équitable")])],-1)),e("button",{onClick:w,class:"notification-close"}," ✕ ")])):$("",!0)]),_:1}))}},os=J(as,[["__scopeId","data-v-219bed78"]]),is={class:"stats-grid"},ns={class:"stat-card quiz-completed"},rs={class:"stat-value"},ls={class:"stat-card quiz-average"},cs={class:"stat-value"},ds={class:"stat-card quiz-notions"},us={class:"stat-value"},vs={class:"summary-table"},_s={class:"summary-header"},ps={class:"summary-row"},ms={class:"cell matiere"},hs={class:"cell notion"},gs=["onClick"],ys={class:"notion-label"},fs={class:"cell count"},$s={class:"cell correct"},bs={class:"cell incorrect"},ks={key:0,class:"summary-details-row"},xs={class:"details-cell"},Cs={class:"chapter-table"},Ss={key:0,class:"chapter-loading"},ws={key:1,class:"chapter-error"},js={key:2},Ds={class:"cell chapitre"},zs={class:"cell count"},Ps={class:"cell correct"},Ms={class:"cell incorrect"},Ns={class:"cell ratio"},Es={class:"matiere-grid"},Ts={class:"matiere-name"},qs={class:"matiere-info"},Xs={class:"matiere-average"},Rs={class:"matiere-count"},Is=["onClick"],Ls={key:0,class:"inline-mastery-icon"},As={class:"inline-mastery-label"},Vs=["onClick"],Hs={class:"quiz-card-title-section"},Os=["onClick","title"],Bs={class:"quiz-breadcrumb-compact"},Qs={class:"quiz-card-actions"},Fs={key:0,class:"retry-indicator"},Us={key:0,class:"quiz-card-details"},Js={class:"quiz-breadcrumb"},Ws={class:"breadcrumb-item"},Gs={class:"breadcrumb-item"},Ks={class:"breadcrumb-item"},Ys={class:"quiz-meta"},Zs={class:"quiz-attempt"},ea={key:0,class:"total-attempts"},ta={class:"quiz-date"},sa={key:0,class:"quiz-time"},aa={__name:"QuizHistoryRefactored",setup(Q,{expose:f}){const h=re(),w=y("all"),b=y([]),j=y([]),g=y("count"),x=y("desc"),_=y(new Set),p=y({}),M=[{value:"all",label:"Tous",icon:"",class:"all"},{value:"mastered",label:"Maîtrisés",icon:"✅",class:"mastered"},{value:"average",label:"Moyens",icon:"⚠️",class:"average"},{value:"poor",label:"Non maîtrisés",icon:"❌",class:"poor"}],D=V(()=>{let i=b.value;return w.value!=="all"&&(i=i.filter(t=>{const c=t.score_on_10;switch(w.value){case"mastered":return c>=7;case"average":return c>=5&&c<7;case"poor":return c<5;default:return!0}})),i}),E=V(()=>[...j.value||[]].sort((c,l)=>{const d=c[g.value]||0,C=l[g.value]||0;return x.value==="asc"?d-C:C-d})),P=i=>{g.value===i?x.value=x.value==="asc"?"desc":"asc":(g.value=i,x.value="desc")},L=i=>i===0?"0%":`${Math.round(i)}%`,N=i=>i>=90?"excellent":i>=75?"good":i>=50?"average":"poor",u=i=>{const t=Array.isArray(i.quiz_list)?i.quiz_list:[];b.value=t.slice(0,6),j.value=Z(t)},v=i=>{},k=i=>i>=7?"score-good":i>=5?"score-average":"score-poor",r=()=>{h.push({name:"QuizzesHistory"})},n=i=>`${i.matiere.id}-${i.notion.id}`,S=i=>_.value.has(n(i)),A=i=>{const t=n(i);return p.value[t]||(p.value[t]={loading:!1,error:"",chapters:[]}),p.value[t]},F=async i=>{const t=n(i);if(_.value.has(t)){_.value.delete(t);return}_.value.add(t);const c=A(i);c.chapters&&c.chapters.length>0||await U(i.matiere.id,i.notion.id)},U=async(i,t)=>{const c=`${i}-${t}`;p.value[c]={loading:!0,error:"",chapters:[]};try{const l=await le.get("/api/suivis/quiz/stats/",{params:{matiere:i,notion:t}}),d=Array.isArray(l?.data?.quiz_list)?l.data.quiz_list:[],C=Y(d);p.value[c]={loading:!1,error:"",chapters:C}}catch(l){const d=l?.response?.data?.error||"Erreur lors du chargement des détails";p.value[c]={loading:!1,error:d,chapters:[]}}},Y=i=>{const t=new Map;for(const l of i){const d=l?.chapitre||{},C=d?.id;if(!C)continue;t.has(C)||t.set(C,{chapitre:{id:C,titre:d?.titre||"Chapitre"},count:0,correct_count:0,incorrect_count:0,sum_score_10:0});const m=t.get(C);m.count+=1,m.sum_score_10+=Number(l.score_on_10||0),(l.score_on_10||0)>=7?m.correct_count+=1:m.incorrect_count+=1}const c=Array.from(t.values()).map(l=>{const d=l.count>0?l.correct_count/l.count:0,C=l.count>0?l.sum_score_10/l.count:0;return{...l,ratio_percent:d*100,average_10:Math.round(C*10)/10,average_percent:d*100}});return c.sort((l,d)=>String(l.chapitre.titre).localeCompare(String(d.chapitre.titre),"fr",{sensitivity:"base"})),c},Z=i=>{const t=new Map;for(const l of i){const d=l?.matiere||{},C=l?.notion||{},m=`${d.id}-${C.id}`;t.has(m)||t.set(m,{matiere:{id:d.id,titre:d.titre||""},notion:{id:C.id,titre:C.titre||""},count:0,correct_count:0,incorrect_count:0});const G=t.get(m);G.count+=1,(l.score_on_10||0)>=7?G.correct_count+=1:G.incorrect_count+=1}const c=Array.from(t.values()).map(l=>({...l,average_percent:l.count>0?l.correct_count/l.count*100:0}));return c.sort((l,d)=>String(l.matiere.titre).localeCompare(String(d.matiere.titre),"fr",{sensitivity:"base"})||String(l.notion.titre).localeCompare(String(d.notion.titre),"fr",{sensitivity:"base"})),c},ee=async i=>{try{const t=i.chapitre.id,c=i.quiz_id;await h.push({path:`/quiz-exercices/${t}`,query:{quizId:c,autoStart:"true"}})}catch{}},q=i=>{w.value=i},R=i=>new Date(i).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),H=i=>{const t=Math.floor(i/60),c=i%60;return`${t}:${c.toString().padStart(2,"0")}`};return f({updateSelectedMastery:q}),(i,t)=>(a(),te(ue,{title:"🧠 Historique des Quiz","list-title":"📝 Quiz effectués","loading-text":"Chargement des quiz...","api-endpoint":"/api/suivis/quiz/stats/","extra-params":{limit:6},"custom-filters":M,"navigation-handler":ee,"items-per-page":6,"filtered-items":D.value,onDataLoaded:u,onFilterChanged:v},{"header-actions":O(()=>[e("button",{class:"view-history-btn",onClick:r,title:"Voir tout l'historique","aria-label":"Voir tout l'historique"}," Voir l'historique ")]),"global-stats":O(({stats:c})=>[e("div",is,[e("div",ns,[t[4]||(t[4]=e("span",{class:"stat-label"},"Quiz effectués",-1)),e("span",rs,s(c.completed||0),1)]),e("div",ls,[t[5]||(t[5]=e("span",{class:"stat-label"},"Note moyenne",-1)),e("span",cs,s(c.average||0)+"/10",1)]),e("div",ds,[t[6]||(t[6]=e("span",{class:"stat-label"},"Notions maîtrisées",-1)),e("span",us,s(c.masteredNotions||0),1)])])]),"matiere-notion-stats":O(()=>[e("div",vs,[e("div",_s,[t[11]||(t[11]=e("div",null,"Matière",-1)),t[12]||(t[12]=e("div",null,"Notion",-1)),e("div",{class:"sortable-header",onClick:t[0]||(t[0]=c=>P("count"))},[t[7]||(t[7]=I(" Faits ")),e("span",{class:z(["sort-icon",{active:g.value==="count"}])},s(g.value==="count"&&x.value==="asc"?"↑":"↓"),3)]),e("div",{class:"sortable-header",onClick:t[1]||(t[1]=c=>P("correct_count"))},[t[8]||(t[8]=I(" Réussis ")),e("span",{class:z(["sort-icon",{active:g.value==="correct_count"}])},s(g.value==="correct_count"&&x.value==="asc"?"↑":"↓"),3)]),e("div",{class:"sortable-header",onClick:t[2]||(t[2]=c=>P("incorrect_count"))},[t[9]||(t[9]=I(" Ratés ")),e("span",{class:z(["sort-icon",{active:g.value==="incorrect_count"}])},s(g.value==="incorrect_count"&&x.value==="asc"?"↑":"↓"),3)]),e("div",{class:"sortable-header",onClick:t[3]||(t[3]=c=>P("average_percent"))},[t[10]||(t[10]=I(" Moyenne ")),e("span",{class:z(["sort-icon",{active:g.value==="average_percent"}])},s(g.value==="average_percent"&&x.value==="asc"?"↑":"↓"),3)])]),(a(!0),o(X,null,B(E.value,c=>(a(),o(X,{key:`${c.matiere.id}-${c.notion.id}`},[e("div",ps,[e("div",ms,s(c.matiere.titre),1),e("div",hs,[e("button",{class:"notion-toggle",onClick:l=>F(c)},[e("span",ys,s(c.notion.titre),1),(a(),o("svg",{class:z(["chevron",{expanded:S(c)}]),width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},t[13]||(t[13]=[e("polyline",{points:"6,9 12,15 18,9"},null,-1)]),2))],8,gs)]),e("div",fs,s(c.count),1),e("div",$s,s(c.correct_count),1),e("div",bs,s(c.incorrect_count),1),e("div",{class:z(["cell average",N(c.average_percent)])},s(L(c.average_percent)),3)]),S(c)?(a(),o("div",ks,[e("div",xs,[e("div",Cs,[t[14]||(t[14]=e("div",{class:"chapter-header"},[e("div",null,"Chapitre"),e("div",null,"Faits"),e("div",null,"Réussis"),e("div",null,"Ratés"),e("div",null,"Réussite"),e("div",null,"Moyenne")],-1)),A(c).loading?(a(),o("div",Ss,"Chargement des détails...")):A(c).error?(a(),o("div",ws,s(A(c).error),1)):(a(),o("div",js,[(a(!0),o(X,null,B(A(c).chapters,l=>(a(),o("div",{key:l.chapitre.id,class:"chapter-row"},[e("div",Ds,s(l.chapitre.titre),1),e("div",zs,s(l.count),1),e("div",Ps,s(l.correct_count),1),e("div",Ms,s(l.incorrect_count),1),e("div",Ns,s(Math.round(l.ratio_percent))+"%",1),e("div",{class:z(["cell average",N(l.average_percent)])},s(Math.round(l.average_10*10)/10)+"/10",3)]))),128))]))])])])):$("",!0)],64))),128))])]),"matiere-stats":O(({stats:c})=>[t[15]||(t[15]=e("h4",{class:"section-subtitle"},"📊 Moyennes par matière",-1)),e("div",Es,[(a(!0),o(X,null,B(c,l=>(a(),o("div",{key:l.id,class:"matiere-card"},[e("div",Ts,s(l.titre),1),e("div",qs,[e("span",Xs,s(l.average)+"/10",1),e("span",Rs,s(l.quiz_count)+" quiz",1)])]))),128))])]),"custom-filters":O(({filters:c,selected:l})=>[(a(!0),o(X,null,B(c,d=>(a(),o("button",{key:d.value,onClick:C=>q(d.value),class:z(["inline-mastery-btn",{active:l===d.value},d.class])},[d.icon?(a(),o("span",Ls,s(d.icon),1)):$("",!0),e("span",As,s(d.label),1)],10,Is))),128))]),"items-list":O(({items:c,toggleDetails:l,isExpanded:d,navigateToItem:C})=>[(a(!0),o(X,null,B(c,m=>(a(),o("div",{key:m.id,class:z(["quiz-card",{"multiple-attempts":m.total_attempts>1}])},[e("div",{class:"quiz-card-header",onClick:G=>l(m.id)},[e("div",Hs,[e("h5",{class:"quiz-card-title clickable-title",onClick:ne(G=>C(m),["stop"]),title:"Accéder au quiz: "+m.quiz_titre},[I(s(m.quiz_titre)+" ",1),t[16]||(t[16]=e("svg",{class:"navigation-icon",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M7 17l9.2-9.2M17 17V7H7"})],-1))],8,Os),e("div",Bs,s(m.matiere.titre)+" → "+s(m.notion.titre),1)]),e("div",Qs,[e("div",{class:z(["quiz-score",k(m.score_on_10)])},[I(s(m.score_on_10)+"/10 ",1),m.total_attempts>1?(a(),o("span",Fs,"↻")):$("",!0)],2),e("button",{class:z(["expand-toggle",{expanded:d(m.id)}])},t[17]||(t[17]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"6,9 12,15 18,9"})],-1)]),2)])],8,Vs),d(m.id)?(a(),o("div",Us,[e("div",Js,[e("span",Ws,s(m.matiere.titre),1),t[18]||(t[18]=e("span",{class:"breadcrumb-separator"},"→",-1)),e("span",Gs,s(m.notion.titre),1),t[19]||(t[19]=e("span",{class:"breadcrumb-separator"},"→",-1)),e("span",Ks,s(m.chapitre.titre),1)]),e("div",Ys,[e("span",Zs,[I(" Tentative #"+s(m.tentative_numero)+" ",1),m.total_attempts>1?(a(),o("span",ea," ("+s(m.total_attempts)+" au total) ",1)):$("",!0)]),e("span",ta,s(R(m.date_creation)),1),m.temps_total_seconde?(a(),o("span",sa,s(H(m.temps_total_seconde)),1)):$("",!0)])])):$("",!0)],2))),128))]),"empty-state":O(()=>t[20]||(t[20]=[e("p",null,"Aucun quiz trouvé avec ces filtres",-1)])),_:1},8,["filtered-items"]))}},oa=J(aa,[["__scopeId","data-v-fb22ffc6"]]),ia={class:"stats-grid"},na={class:"stat-card exercice-completed"},ra={class:"stat-value"},la={class:"stat-card exercice-correct"},ca={class:"stat-value"},da={class:"stat-card exercice-percentage"},ua={class:"stat-value"},va={class:"stat-card exercice-notions"},_a={class:"stat-value"},pa={class:"matiere-grid"},ma={class:"matiere-name"},ha={class:"matiere-info"},ga={class:"matiere-average"},ya={class:"matiere-count"},fa={class:"summary-table"},$a={class:"summary-header"},ba={class:"summary-row"},ka={class:"cell matiere"},xa={class:"cell notion"},Ca=["onClick"],Sa={class:"notion-label"},wa={class:"cell count"},ja={class:"cell correct"},Da={class:"cell incorrect"},za={key:0,class:"summary-details-row"},Pa={class:"details-cell"},Ma={class:"chapter-table"},Na={key:0,class:"chapter-loading"},Ea={key:1,class:"chapter-error"},Ta={key:2},qa={class:"cell chapitre"},Xa={class:"cell count"},Ra={class:"cell correct"},Ia={class:"cell incorrect"},La={class:"cell ratio"},Aa={class:"inline-mastery-filters"},Va=["onClick","title","aria-label"],Ha={class:"inline-mastery-icon"},Oa={class:"inline-mastery-label"},Ba=["onClick"],Qa={class:"exercice-card-title-section"},Fa=["onClick","title"],Ua={class:"exercice-breadcrumb-compact"},Ja={class:"exercice-card-actions"},Wa={key:0,class:"exercice-card-details"},Ga={class:"exercice-breadcrumb"},Ka={class:"breadcrumb-item"},Ya={class:"breadcrumb-item"},Za={class:"breadcrumb-item"},eo={class:"exercice-meta"},to={class:"exercice-date"},so={key:0,class:"exercice-time"},ao={key:1,class:"exercice-points"},oo={__name:"ExercicesHistory",setup(Q,{expose:f}){const h=re(),w=y(null),b=[{value:"all",label:"Tous",icon:"",class:"all"},{value:"correct",label:"Réussis",icon:"✅",class:"correct"},{value:"incorrect",label:"Ratés",icon:"❌",class:"incorrect"}],j=y("all"),g=y([]),x=y("exercice_count"),_=y("desc"),p=y([]),M=y(new Set),D=y({}),E=V(()=>{let i=g.value;return j.value!=="all"&&(i=i.filter(t=>{switch(j.value){case"correct":return t.est_correct===!0;case"incorrect":return t.est_correct===!1;default:return!0}})),i}),P=i=>{const t=Array.isArray(i.exercice_list)?i.exercice_list:[];g.value=t.slice(0,6),p.value=Array.isArray(i.matiere_notion_stats)?i.matiere_notion_stats:[]},L=i=>{},N=i=>i?"status-correct":"status-incorrect",u=async i=>{try{const t=i.exercice_id;await h.push({name:"ExerciceDetail",params:{exerciceId:String(t)}})}catch{}},v=()=>{h.push({name:"ExercisesHistory"})},k=V(()=>p.value.length?[...p.value.map(c=>({...c,average:c.exercice_count>0?c.correct_count/c.exercice_count*100:0}))].sort((c,l)=>{const d=c[x.value]||0,C=l[x.value]||0;return _.value==="asc"?d-C:C-d}):[]),r=i=>{x.value===i?_.value=_.value==="asc"?"desc":"asc":(x.value=i,_.value="desc")},n=i=>i===0?"0%":`${Math.round(i)}%`,S=i=>i>=90?"excellent":i>=75?"good":i>=50?"average":"poor",A=i=>`${i.matiere.id}-${i.notion.id}`,F=i=>M.value.has(A(i)),U=i=>{const t=A(i);return D.value[t]||(D.value[t]={loading:!1,error:"",chapters:[]}),D.value[t]},Y=async i=>{const t=A(i);if(M.value.has(t)){M.value.delete(t);return}M.value.add(t);const c=U(i);c.chapters&&c.chapters.length>0||await Z(i.matiere.id,i.notion.id)},Z=async(i,t)=>{const c=`${i}-${t}`;D.value[c]={loading:!0,error:"",chapters:[]};try{const l=await le.get("/api/suivis/exercices/stats/",{params:{matiere:i,notion:t}}),d=Array.isArray(l?.data?.exercice_list)?l.data.exercice_list:[],C=ee(d);D.value[c]={loading:!1,error:"",chapters:C}}catch(l){const d=l?.response?.data?.error||"Erreur lors du chargement des détails";D.value[c]={loading:!1,error:d,chapters:[]}}},ee=i=>{const t=new Map;for(const l of i){const d=l?.chapitre||{},C=d?.id;if(!C)continue;t.has(C)||t.set(C,{chapitre:{id:C,titre:d?.titre||"Chapitre"},exercice_count:0,correct_count:0,incorrect_count:0});const m=t.get(C);m.exercice_count+=1,l.est_correct?m.correct_count+=1:m.incorrect_count+=1}const c=Array.from(t.values()).map(l=>{const d=l.exercice_count>0?l.correct_count/l.exercice_count:0,C=Math.round(d*10*10)/10;return{...l,ratio_percent:d*100,average_10:C}});return c.sort((l,d)=>String(l.chapitre.titre).localeCompare(String(d.chapitre.titre),"fr",{sensitivity:"base"})),c},q=i=>new Date(i).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),R=i=>{const t=Math.floor(i/60),c=i%60;return`${t}:${c.toString().padStart(2,"0")}`},H=i=>{j.value=i};return f({updateSelectedMastery:H}),(i,t)=>(a(),te(ue,{ref_key:"baseHistoryRef",ref:w,title:"🧭 Historique des Exercices","list-title":"📝 Exercices effectués","loading-text":"Chargement des exercices...","api-endpoint":"/api/suivis/exercices/stats/","extra-params":{limit:6},"custom-filters":b,"navigation-handler":u,"items-per-page":6,"filtered-items":E.value,onDataLoaded:P,onFilterChanged:L},{"header-actions":O(()=>[e("button",{class:"view-history-btn",onClick:v,title:"Voir tout l'historique","aria-label":"Voir tout l'historique"}," Voir l'historique ")]),"global-stats":O(({stats:c})=>[e("div",ia,[e("div",na,[t[4]||(t[4]=e("span",{class:"stat-label"},"Exercices effectués",-1)),e("span",ra,s(c.completed||0),1)]),e("div",la,[t[5]||(t[5]=e("span",{class:"stat-label"},"Exercices réussis",-1)),e("span",ca,s(c.correct||0),1)]),e("div",da,[t[6]||(t[6]=e("span",{class:"stat-label"},"Taux de réussite",-1)),e("span",ua,s(c.percentage||0)+"%",1)]),e("div",va,[t[7]||(t[7]=e("span",{class:"stat-label"},"Notions maîtrisées",-1)),e("span",_a,s(c.masteredNotions||0),1)])])]),"matiere-stats":O(({stats:c})=>[t[8]||(t[8]=e("h4",{class:"section-subtitle"},"📊 Moyennes par matière",-1)),e("div",pa,[(a(!0),o(X,null,B(c,l=>(a(),o("div",{key:l.id,class:"matiere-card"},[e("div",ma,s(l.titre),1),e("div",ha,[e("span",ga,s(l.average)+"/10",1),e("span",ya,s(l.exercice_count)+" exercices",1)])]))),128))])]),"matiere-notion-stats":O(({stats:c})=>[e("div",fa,[e("div",$a,[t[13]||(t[13]=e("div",null,"Matière",-1)),t[14]||(t[14]=e("div",null,"Notion",-1)),e("div",{class:"sortable-header",onClick:t[0]||(t[0]=l=>r("exercice_count"))},[t[9]||(t[9]=I(" Faits ")),e("span",{class:z(["sort-icon",{active:x.value==="exercice_count"}])},s(x.value==="exercice_count"&&_.value==="asc"?"↑":"↓"),3)]),e("div",{class:"sortable-header",onClick:t[1]||(t[1]=l=>r("correct_count"))},[t[10]||(t[10]=I(" Réussis ")),e("span",{class:z(["sort-icon",{active:x.value==="correct_count"}])},s(x.value==="correct_count"&&_.value==="asc"?"↑":"↓"),3)]),e("div",{class:"sortable-header",onClick:t[2]||(t[2]=l=>r("incorrect_count"))},[t[11]||(t[11]=I(" Ratés ")),e("span",{class:z(["sort-icon",{active:x.value==="incorrect_count"}])},s(x.value==="incorrect_count"&&_.value==="asc"?"↑":"↓"),3)]),e("div",{class:"sortable-header",onClick:t[3]||(t[3]=l=>r("average"))},[t[12]||(t[12]=I(" Moyenne ")),e("span",{class:z(["sort-icon",{active:x.value==="average"}])},s(x.value==="average"&&_.value==="asc"?"↑":"↓"),3)])]),(a(!0),o(X,null,B(k.value,l=>(a(),o(X,{key:`${l.matiere.id}-${l.notion.id}`},[e("div",ba,[e("div",ka,s(l.matiere.titre),1),e("div",xa,[e("button",{class:"notion-toggle",onClick:d=>Y(l)},[e("span",Sa,s(l.notion.titre),1),(a(),o("svg",{class:z(["chevron",{expanded:F(l)}]),width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},t[15]||(t[15]=[e("polyline",{points:"6,9 12,15 18,9"},null,-1)]),2))],8,Ca)]),e("div",wa,s(l.exercice_count),1),e("div",ja,s(l.correct_count),1),e("div",Da,s(l.incorrect_count),1),e("div",{class:z(["cell average",S(l.average)])},s(n(l.average)),3)]),F(l)?(a(),o("div",za,[e("div",Pa,[e("div",Ma,[t[16]||(t[16]=e("div",{class:"chapter-header"},[e("div",null,"Chapitre"),e("div",null,"Faits"),e("div",null,"Réussis"),e("div",null,"Ratés"),e("div",null,"Réussite"),e("div",null,"Moyenne")],-1)),U(l).loading?(a(),o("div",Na,"Chargement des détails...")):U(l).error?(a(),o("div",Ea,s(U(l).error),1)):(a(),o("div",Ta,[(a(!0),o(X,null,B(U(l).chapters,d=>(a(),o("div",{key:d.chapitre.id,class:"chapter-row"},[e("div",qa,s(d.chapitre.titre),1),e("div",Xa,s(d.exercice_count),1),e("div",Ra,s(d.correct_count),1),e("div",Ia,s(d.incorrect_count),1),e("div",La,s(Math.round(d.ratio_percent))+"%",1),e("div",{class:z(["cell average",S(d.average_10*10)])},s(d.average_10)+"/10",3)]))),128))]))])])])):$("",!0)],64))),128))])]),"custom-filters":O(({filters:c,selected:l})=>[e("div",Aa,[(a(!0),o(X,null,B(c,d=>(a(),o("button",{key:d.value,onClick:ne(C=>H(d.value),["stop"]),class:z(["inline-mastery-btn",d.class,{active:j.value===d.value}]),title:d.label,"aria-label":d.label},[e("span",Ha,s(d.icon),1),e("span",Oa,s(d.label),1)],10,Va))),128))])]),"items-list":O(({items:c,toggleDetails:l,isExpanded:d,navigateToItem:C})=>[(a(!0),o(X,null,B(c,m=>(a(),o("div",{key:m.id,class:z(["exercice-card",{correct:m.est_correct,incorrect:!m.est_correct}])},[e("div",{class:"exercice-card-header",onClick:G=>l(m.id)},[e("div",Qa,[e("h5",{class:"exercice-card-title clickable-title",onClick:ne(G=>C(m),["stop"]),title:"Accéder à l'exercice: "+m.exercice_titre},[I(s(m.exercice_titre)+" ",1),t[17]||(t[17]=e("svg",{class:"navigation-icon",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M7 17l9.2-9.2M17 17V7H7"})],-1))],8,Fa),e("div",Ua,s(m.matiere.titre)+" → "+s(m.notion.titre),1)]),e("div",Ja,[e("div",{class:z(["exercice-status",N(m.est_correct)])},s(m.est_correct?"✅":"❌"),3),e("button",{class:z(["expand-toggle",{expanded:d(m.id)}])},t[18]||(t[18]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"6,9 12,15 18,9"})],-1)]),2)])],8,Ba),d(m.id)?(a(),o("div",Wa,[e("div",Ga,[e("span",Ka,s(m.matiere.titre),1),t[19]||(t[19]=e("span",{class:"breadcrumb-separator"},"→",-1)),e("span",Ya,s(m.notion.titre),1),t[20]||(t[20]=e("span",{class:"breadcrumb-separator"},"→",-1)),e("span",Za,s(m.chapitre.titre),1)]),e("div",eo,[e("span",to,s(q(m.date_creation)),1),m.temps_seconde?(a(),o("span",so,s(R(m.temps_seconde)),1)):$("",!0),m.points_obtenus?(a(),o("span",ao,s(m.points_obtenus)+" points ",1)):$("",!0)])])):$("",!0)],2))),128))]),"empty-state":O(()=>t[21]||(t[21]=[e("p",null,"Aucun exercice trouvé avec ces filtres",-1),e("p",{class:"empty-hint"},"Essayez de modifier vos filtres ou commencez à faire des exercices !",-1)])),_:1},8,["filtered-items"]))}},io=J(oo,[["__scopeId","data-v-1974ba44"]]),no={class:"daily-objectives-card"},ro={key:0,class:"current-objective"},lo={class:"objective-icon"},co={class:"objective-content"},uo={class:"objective-text"},vo={class:"objective-progress"},_o={class:"progress-bar"},po={class:"progress-text"},mo={key:1,class:"no-objective"},ho={key:2,class:"completion-badge"},go={class:"objectives-list"},yo={class:"objective-info"},fo={class:"objective-icon-small"},$o={class:"objective-details"},bo={class:"objective-text-small"},ko={class:"objective-description"},xo={class:"objective-reward"},Co={class:"objective-status"},So={class:"progress-info"},wo={class:"progress-bar-modal"},jo={key:0,class:"status-completed"},Do={class:"modal-footer"},zo={class:"daily-summary"},Po={class:"summary-stat"},Mo={class:"stat-value"},No={class:"summary-stat"},Eo={class:"stat-value"},To={__name:"DailyObjectives",setup(Q){const f=y(!1),{currentObjective:h,unlockedObjectivesList:w,allObjectives:b,loadTodayStats:j,isInitialized:g,simulateQuizEasy:x,simulateQuizMedium:_,simulateQuizHard:p,simulateQuizPerfect:M,simulateExerciseCompleted:D,simulateQuizStreak:E}=ze(),P=V(()=>w.value.filter(q=>q.isCompleted).length),L=V(()=>w.value.filter(q=>q.isCompleted).reduce((q,R)=>q+R.xpReward,0)),N=()=>{f.value=!0},u=()=>{f.value=!1},v=V(()=>{if(!h.value)return 0;const q=h.value.progress,R=h.value.target;return Math.min(q/R*100,100)}),k=q=>q>=100?"completed":q>=75?"almost-done":q>=25?"half-way":q>0?"starting":"",r=()=>x(),n=()=>_(),S=()=>p(),A=()=>M(),F=()=>D(),U=()=>E(Math.floor(Math.random()*8)+1),Y=q=>{j(),setTimeout(()=>{h.value},100)},Z=q=>{},ee=q=>{};return K(()=>{window.addEventListener("dailyObjectiveProgress",Y),window.addEventListener("objectiveUnlocked",Z),window.addEventListener("dailyObjectiveCompleted",ee)}),xe(()=>{window.removeEventListener("dailyObjectiveProgress",Y),window.removeEventListener("objectiveUnlocked",Z),window.removeEventListener("dailyObjectiveCompleted",ee)}),window.testDailyObjectives={quizEasy:r,quizMedium:n,quizHard:S,quizPerfect:A,exerciseCompleted:F,quizStreak:U},(q,R)=>(a(),o(X,null,[e("div",no,[e("div",{class:"objective-header"},[R[1]||(R[1]=e("div",{class:"objective-title"},"🎯 Défi du jour",-1)),e("button",{class:"see-more-btn",onClick:N}," Voir tous les défis ")]),T(g)&&T(h)?(a(),o("div",ro,[e("div",lo,s(T(h).icon),1),e("div",co,[e("div",uo,s(T(h).text),1),e("div",vo,[e("div",_o,[e("div",{class:z(["progress-fill",k(v.value)]),style:ie({width:v.value+"%"})},null,6)]),e("div",po,s(T(h).progress)+" / "+s(T(h).target),1)])])])):(a(),o("div",mo,[T(g)?(a(),o(X,{key:0},[I(" 🎉 Tous les défis du jour sont terminés ! Revenez demain pour de nouveaux défis. ")],64)):(a(),o(X,{key:1},[I(" ⏳ Chargement des défis du jour... ")],64))])),T(h)&&T(h).isCompleted?(a(),o("div",ho," ✅ Défi complété ! +"+s(T(h).xpReward)+" XP ",1)):$("",!0)]),f.value?(a(),o("div",{key:0,class:"modal-overlay",onClick:u},[e("div",{class:"modal-content",onClick:R[0]||(R[0]=ne(()=>{},["stop"]))},[e("div",{class:"modal-header"},[R[2]||(R[2]=e("h3",null,"🎯 Vos défis journaliers",-1)),e("button",{class:"close-btn",onClick:u},"×")]),e("div",go,[(a(!0),o(X,null,B(T(b),(H,i)=>(a(),o("div",{key:i,class:z(["objective-item",{completed:H.isCompleted,locked:!H.isUnlocked}])},[e("div",yo,[e("div",fo,s(H.icon),1),e("div",$o,[e("div",bo,s(H.name),1),e("div",ko,s(H.text),1),e("div",xo,"+"+s(H.xpReward)+" XP",1)])]),e("div",Co,[e("div",So,s(H.progress)+" / "+s(H.target),1),e("div",wo,[e("div",{class:z(["progress-fill-modal",{completed:H.isCompleted}]),style:ie({width:H.percentage+"%"})},null,6)]),H.isCompleted?(a(),o("div",jo," ✅ Terminé ")):$("",!0)])],2))),128))]),e("div",Do,[e("div",zo,[e("div",Po,[R[3]||(R[3]=e("span",{class:"stat-label"},"Défis complétés :",-1)),e("span",Mo,s(P.value)+" / "+s(T(b).length),1)]),e("div",No,[R[4]||(R[4]=e("span",{class:"stat-label"},"XP gagnés aujourd'hui :",-1)),e("span",Eo,"+"+s(L.value),1)])]),R[5]||(R[5]=e("p",{class:"modal-note"}," Tous les défis se réinitialisent chaque jour à minuit. Bonne chance ! ",-1))])])])):$("",!0),W(pe)],64))}},qo=J(To,[["__scopeId","data-v-a56e4f19"]]),Xo={class:"streak-test-container"},Ro={class:"status-grid"},Io={class:"status-card"},Lo={class:"status-content"},Ao={class:"status-value"},Vo={class:"status-card"},Ho={class:"status-content"},Oo={class:"status-value"},Bo={class:"status-card"},Qo={class:"status-content"},Fo={class:"status-value"},Uo={class:"status-card"},Jo={class:"status-content"},Wo={class:"simulation-section"},Go={class:"simulation-buttons"},Ko={key:0,class:"test-results"},Yo={class:"results-list"},Zo={class:"result-time"},ei={class:"result-message"},ti={__name:"StreakTestButton",setup(Q){const f=se(),{currentStreak:h,isStreakCheckedToday:w,checkDailyStreak:b,resetStreak:j,initializeStreak:g}=de(),{updateUserXPInstantly:x}=me(),_=y([]),p=(r,n="info")=>{const S=new Date().toLocaleTimeString();_.value.unshift({timestamp:S,message:r,type:n}),_.value.length>8&&(_.value=_.value.slice(0,8))},M=r=>{try{p(`🎭 Simulation du jour ${r}...`,"info");const n=new Date,S=new Date(n);S.setDate(n.getDate()-1);const A=S.toISOString().split("T")[0],F=r-1;localStorage.setItem("lastLoginDate",A),localStorage.setItem("currentStreak",F.toString()),localStorage.removeItem("streakCheckedToday"),h.value=F,w.value=!1,p(`✅ Streak de ${r} jours simulé (dernière connexion: ${A})`,"success"),setTimeout(()=>{P()},500)}catch(n){p(`❌ Erreur simulation jour ${r}: ${n.message}`,"error")}},D=()=>{try{p("💔 Simulation rupture de streak...","warning");const r=new Date,n=new Date(r);n.setDate(r.getDate()-3);const S=n.toISOString().split("T")[0];localStorage.setItem("lastLoginDate",S),localStorage.setItem("currentStreak","0"),localStorage.removeItem("streakCheckedToday"),h.value=0,w.value=!1,p("✅ Rupture de streak simulée (3 jours d'écart)","warning"),setTimeout(()=>{P()},500)}catch(r){p(`❌ Erreur simulation rupture: ${r.message}`,"error")}},E=()=>{try{p("🔄 Reset de la simulation...","info");const r=new Date().toISOString().split("T")[0];localStorage.setItem("lastLoginDate",r),localStorage.setItem("currentStreak","0"),localStorage.removeItem("streakCheckedToday"),h.value=0,w.value=!1,p("✅ Simulation remise à aujourd'hui (streak: 0)","success")}catch(r){p(`❌ Erreur reset simulation: ${r.message}`,"error")}},P=async()=>{try{p("🔄 Vérification du streak...","info");const r=await b();r.success?r.alreadyChecked?p("✅ Streak déjà vérifié aujourd'hui","success"):p(`🎉 Streak: ${r.streakDays} jours, +${r.xpGained} XP`,"success"):p(`❌ Erreur: ${r.reason||"inconnue"}`,"error")}catch(r){p(`❌ Erreur: ${r.message}`,"error")}},L=async()=>{try{p("➕ Test +5 XP...","info");const r=f.xp||0;if((await x(5,"test_manual")).success){const S=f.xp||0;p(`✅ XP: ${r} → ${S} (+5)`,"success")}else p("❌ Échec mise à jour XP","error")}catch(r){p(`❌ Erreur: ${r.message}`,"error")}},N=async()=>{try{p("➖ Test -5 XP...","info");const r=f.xp||0;if((await x(-5,"test_manual_decrease")).success){const S=f.xp||0;p(`✅ XP: ${r} → ${S} (-5)`,"success")}else p("❌ Échec diminution XP","error")}catch(r){p(`❌ Erreur: ${r.message}`,"error")}},u=()=>{try{j(),p("🗑️ Streak remis à zéro","warning")}catch(r){p(`❌ Erreur reset: ${r.message}`,"error")}},v=async()=>{try{p("🔄 Rafraîchissement...","info"),g(),p("✅ Données rafraîchies","success")}catch(r){p(`❌ Erreur: ${r.message}`,"error")}},k=()=>{_.value=[]};return K(()=>{p("🚀 Test Badges & Streak chargé","info")}),(r,n)=>(a(),o("div",Xo,[n[18]||(n[18]=e("div",{class:"test-header"},[e("h3",null,"🧪 Test Badges & Streak"),e("p",{class:"test-subtitle"},"Interface de test pour administrateur")],-1)),e("div",Ro,[e("div",Io,[n[8]||(n[8]=e("span",{class:"status-icon"},"🔥",-1)),e("div",Lo,[n[7]||(n[7]=e("span",{class:"status-label"},"Streak",-1)),e("span",Ao,s(T(h))+" jours",1)])]),e("div",Vo,[n[10]||(n[10]=e("span",{class:"status-icon"},"⭐",-1)),e("div",Ho,[n[9]||(n[9]=e("span",{class:"status-label"},"XP",-1)),e("span",Oo,s(T(f).xp||0),1)])]),e("div",Bo,[n[12]||(n[12]=e("span",{class:"status-icon"},"🏆",-1)),e("div",Qo,[n[11]||(n[11]=e("span",{class:"status-label"},"Niveau",-1)),e("span",Fo,s(T(f).level||0),1)])]),e("div",Uo,[n[14]||(n[14]=e("span",{class:"status-icon"},"📅",-1)),e("div",Jo,[n[13]||(n[13]=e("span",{class:"status-label"},"Vérifié",-1)),e("span",{class:z(["status-value",{checked:T(w)}])},s(T(w)?"Oui":"Non"),3)])])]),e("div",Wo,[n[15]||(n[15]=e("h4",null,"🎭 Simulation de Jours",-1)),n[16]||(n[16]=e("p",{class:"simulation-info"},"Simulez différents jours pour tester le streak",-1)),e("div",Go,[e("button",{onClick:n[0]||(n[0]=S=>M(1)),class:"sim-btn day-1"}," 📅 Jour 1 "),e("button",{onClick:n[1]||(n[1]=S=>M(2)),class:"sim-btn day-2"}," 📅 Jour 2 "),e("button",{onClick:n[2]||(n[2]=S=>M(3)),class:"sim-btn day-3"}," 📅 Jour 3 "),e("button",{onClick:n[3]||(n[3]=S=>M(4)),class:"sim-btn day-4"}," 📅 Jour 4 "),e("button",{onClick:n[4]||(n[4]=S=>M(5)),class:"sim-btn day-5"}," 📅 Jour 5 "),e("button",{onClick:n[5]||(n[5]=S=>M(7)),class:"sim-btn day-7"}," 📅 Jour 7 "),e("button",{onClick:n[6]||(n[6]=S=>M(10)),class:"sim-btn day-10"}," 📅 Jour 10 ")]),e("div",{class:"simulation-controls"},[e("button",{onClick:D,class:"sim-btn break"}," 💔 Casser le Streak "),e("button",{onClick:E,class:"sim-btn reset"}," 🔄 Reset Simulation ")])]),e("div",{class:"test-actions"},[e("button",{onClick:P,class:"test-btn primary"}," 🔄 Vérifier Streak "),e("button",{onClick:L,class:"test-btn success"}," ➕ +5 XP "),e("button",{onClick:N,class:"test-btn danger"}," ➖ -5 XP "),e("button",{onClick:u,class:"test-btn warning"}," 🗑️ Reset "),e("button",{onClick:v,class:"test-btn info"}," 🔄 Refresh ")]),_.value.length>0?(a(),o("div",Ko,[e("div",{class:"results-header"},[n[17]||(n[17]=e("h4",null,"📊 Résultats des tests",-1)),e("button",{onClick:k,class:"clear-btn"},"🗑️")]),e("div",Yo,[(a(!0),o(X,null,B(_.value,(S,A)=>(a(),o("div",{key:A,class:z(["result-item",S.type])},[e("span",Zo,s(S.timestamp),1),e("span",ei,s(S.message),1)],2))),128))])])):$("",!0)]))}},si=J(ti,[["__scopeId","data-v-d8c0f382"]]),ai={class:"dashboard-content"},oi={class:"dashboard-center-top"},ii={key:0,class:"dashboard-spinner"},ni={key:1},ri={class:"section leaderboard-section"},li={class:"leaderboard-grid"},ci={class:"leaderboard-container"},di={class:"level-container"},ui={key:0},vi={key:1},_i={key:2,class:"dashboard-spinner"},pi={key:3,class:"section"},mi={__name:"DashboardStudent",setup(Q){const f=se();he(),re();const h=y({done:0,acquired:0,not_acquired:0}),w=y(!0),b=y([]),j=y([]),g=y([]),x=y({}),_=y({}),p=y([]),M=y(null);V(()=>b.value.length?[...b.value].sort((P,L)=>new Date(L.date_creation)-new Date(P.date_creation))[0]:null);function D(){x.value=Object.fromEntries(j.value.map(E=>[E.id,E])),_.value=Object.fromEntries(g.value.map(E=>[E.id,E]))}return K(async()=>{try{const[E,P,L,N,u,v]=await Promise.all([Se({}),we({}),De(),je(),ge().catch(()=>null),ye().catch(()=>null)]),k=n=>Array.isArray(n)?n:n?.results||[];j.value=k(E),g.value=k(P),b.value=k(L?.data),p.value=k(N?.data??N),M.value=v?.data?.data||null;const r=u?.data?.data;r&&(f.xp=r.xp??f.xp,f.level=r.level??f.level,f.xp_to_next=r.xp_to_next??r.next_level_xp-r.xp),D(),h.value.done=b.value.length,h.value.acquired=b.value.filter(n=>n.est_correct===!0).length,h.value.not_acquired=b.value.filter(n=>n.est_correct===!1).length}catch{}w.value=!1}),(E,P)=>(a(),o("div",ai,[W(os),e("div",oi,[T(f).isLoading?(a(),o("div",ii,P[0]||(P[0]=[e("span",{class:"spinner"},null,-1)]))):(a(),o("h1",ni," Bienvenue "+s(T(f).firstName)+" sur votre tableau de bord ",1))]),e("div",ri,[e("div",li,[e("div",ci,[W(Pt)]),e("div",di,[W(ts),W(qo)])])]),w.value?$("",!0):(a(),o("div",ui,[W(oa)])),w.value?$("",!0):(a(),o("div",vi,[W(io)])),w.value?(a(),o("div",_i,P[1]||(P[1]=[e("span",{class:"spinner"},null,-1)]))):$("",!0),T(f).isAdmin?(a(),o("div",pi,[P[2]||(P[2]=e("div",{class:"section-header"},[e("h3",{class:"section-title"},"🧪 Tests (Admin uniquement)")],-1)),W(si)])):$("",!0)]))}},hi=J(mi,[["__scopeId","data-v-62b3d7ac"]]),gi={class:"parent-dashboard"},yi={class:"add-child"},fi=["disabled"],$i={key:0,class:"hint"},bi={class:"create-child"},ki={class:"form-row"},xi={class:"form-row"},Ci=["disabled"],Si={key:0,class:"hint"},wi={key:1,class:"temp-pass"},ji={key:0,class:"loading"},Di={key:1},zi={key:0,class:"empty"},Pi={key:1,class:"children-grid"},Mi={class:"child-header"},Ni={class:"avatar"},Ei={class:"child-info"},Ti={class:"name"},qi={key:0,class:"flag"},Xi={class:"meta"},Ri={key:0},Ii={class:"xp"},Li={class:"xp-value"},Ai={class:"level"},Vi={class:"child-body"},Hi={class:"metrics-grid"},Oi={class:"metric"},Bi={class:"bar"},Qi={class:"hint"},Fi={class:"metric small"},Ui={class:"kpi"},Ji={class:"metric small ok"},Wi={class:"kpi"},Gi={class:"metric small ko"},Ki={class:"kpi"},Yi={key:0,class:"last-activity"},Zi={class:"activity-line"},en={class:"activity-title"},tn={key:0,class:"activity-meta"},sn={class:"actions"},an=["onClick"],on=["onClick","disabled"],nn={__name:"DashboardParent",setup(Q){const f=y(!0),h=y([]),w=re(),b=y(""),j=y(!1),g=y(""),x=y(null),_=y(!1),p=y(""),M=y(""),D=y({first_name:"",last_name:"",email:""});function E(k){if(!k)return"E";const r=String(k).trim().split(/\s+/);return r.length===1?r[0].substring(0,2).toUpperCase():(r[0].substring(0,1)+r[1].substring(0,1)).toUpperCase()}function P(k){w.push({name:"ChildOverview",params:{childId:String(k)}})}K(async()=>{try{const r=(await ce())?.data?.data||{};h.value=r.children||[]}catch{h.value=[]}finally{f.value=!1}});async function L(){try{const r=(await ce())?.data?.data||{};h.value=r.children||[]}catch{h.value=[]}}async function N(){g.value="";const k=String(b.value||"").trim();if(!k){g.value="Renseignez l'email de l'élève";return}j.value=!0;try{await fe({email:k}),b.value="",g.value="Élève ajouté ✅",await L()}catch{g.value="Impossible d'ajouter cet élève"}finally{j.value=!1,setTimeout(()=>{g.value=""},2500)}}async function u(k){x.value=k;try{await $e(k),await L()}catch{}x.value=null}async function v(){p.value="",M.value="";const k={first_name:String(D.value.first_name||"").trim(),last_name:String(D.value.last_name||"").trim(),email:String(D.value.email||"").trim().toLowerCase()};if(!k.first_name||!k.last_name||!k.email){p.value="Renseignez prénom, nom et email";return}_.value=!0;try{const n=(await le.post("/api/users/me/children/create/",k))?.data?.data||{};M.value=n.temp_password||"",p.value="Compte créé et lié ✅",D.value={first_name:"",last_name:"",email:""},await L()}catch{p.value="Création impossible (email déjà utilisé?)"}finally{_.value=!1,setTimeout(()=>{p.value=""},3e3)}}return(k,r)=>(a(),o("div",gi,[r[13]||(r[13]=e("div",{class:"header"},[e("h1",null,"Tableau de bord Parent"),e("p",{class:"subtitle"},"Suivez la progression de vos enfants, simplement.")],-1)),e("div",yi,[ae(e("input",{"onUpdate:modelValue":r[0]||(r[0]=n=>b.value=n),type:"email",placeholder:"Email de l'élève",class:"input"},null,512),[[oe,b.value]]),e("button",{class:"btn",disabled:j.value,onClick:N},"Ajouter",8,fi),g.value?(a(),o("span",$i,s(g.value),1)):$("",!0)]),e("div",bi,[e("details",null,[r[5]||(r[5]=e("summary",null,"Créer un compte pour un enfant",-1)),e("div",ki,[ae(e("input",{"onUpdate:modelValue":r[1]||(r[1]=n=>D.value.first_name=n),class:"input",placeholder:"Prénom"},null,512),[[oe,D.value.first_name]]),ae(e("input",{"onUpdate:modelValue":r[2]||(r[2]=n=>D.value.last_name=n),class:"input",placeholder:"Nom"},null,512),[[oe,D.value.last_name]])]),e("div",xi,[ae(e("input",{"onUpdate:modelValue":r[3]||(r[3]=n=>D.value.email=n),class:"input",placeholder:"Email"},null,512),[[oe,D.value.email]])]),e("button",{class:"btn",disabled:_.value,onClick:v},"Créer le compte",8,Ci),p.value?(a(),o("div",Si,s(p.value),1)):$("",!0),M.value?(a(),o("div",wi,[r[4]||(r[4]=I("Mot de passe temporaire: ")),e("code",null,s(M.value),1)])):$("",!0)])]),f.value?(a(),o("div",ji,r[6]||(r[6]=[e("span",{class:"spinner"},null,-1)]))):(a(),o("div",Di,[h.value.length===0?(a(),o("div",zi,r[7]||(r[7]=[e("p",null,"Aucun enfant rattaché pour le moment.",-1)]))):(a(),o("div",Pi,[(a(!0),o(X,null,B(h.value,n=>(a(),o("div",{class:"child-card",key:n.id},[e("div",Mi,[e("div",Ni,s(E(n.display_name)),1),e("div",Ei,[e("div",Ti,[n.pays_flag?(a(),o("span",qi,s(n.pays_flag),1)):$("",!0),I(" "+s(n.display_name),1)]),e("div",Xi,[n.niveau?(a(),o("span",Ri,s(n.niveau),1)):$("",!0)])]),e("div",Ii,[e("div",Li,s(n.xp)+" XP",1),e("div",Ai,"Niveau "+s(n.level),1)])]),e("div",Vi,[e("div",Hi,[e("div",Oi,[r[8]||(r[8]=e("div",{class:"label"},"Objectif hebdo",-1)),e("div",Bi,[e("div",{class:"fill",style:ie({width:(n.metrics?.weekly_progress||0)+"%"})},null,4)]),e("div",Qi,s(n.metrics?n.metrics.weekly_done+" / "+n.metrics.weekly_goal:"—"),1)]),e("div",Fi,[e("div",Ui,s(n.metrics?.done_total??"—"),1),r[9]||(r[9]=e("div",{class:"kpi-label"},"Exercices",-1))]),e("div",Ji,[e("div",Wi,s(n.metrics?.acquired_count??"—"),1),r[10]||(r[10]=e("div",{class:"kpi-label"},"Acquis",-1))]),e("div",Gi,[e("div",Ki,s(n.metrics?.not_acquired_count??"—"),1),r[11]||(r[11]=e("div",{class:"kpi-label"},"À revoir",-1))])]),n.last_activity?(a(),o("div",Yi,[r[12]||(r[12]=e("div",{class:"label"},"Dernière activité",-1)),e("div",Zi,[e("span",en,s(n.last_activity.exercice_title),1),n.last_activity.chapitre_title?(a(),o("span",tn,"• "+s(n.last_activity.chapitre_title),1)):$("",!0)])])):$("",!0),e("div",sn,[e("button",{class:"btn",onClick:S=>P(n.id)},"Voir détails",8,an),e("button",{class:"btn secondary",onClick:S=>u(n.id),disabled:x.value===n.id},"Retirer",8,on)])])]))),128))]))]))]))}},rn=J(nn,[["__scopeId","data-v-91b4522e"]]),$n={__name:"Dashboard",setup(Q){const f=se(),h=V(()=>f.role==="parent"?rn:hi);return(w,b)=>(a(),te(ve,null,{default:O(()=>[(a(),te(Ce(h.value)))]),_:1}))}};export{$n as default};
