import{D as C}from"./DashboardLayout-DmmXvv68.js";import{B as E}from"./BaseCard-DktRHXN7.js";import{_ as b,h as m,G as w,q as z,m as A,p as B,C as j,f as x,w as y,o,c,b as v,a as i,u,d as M,t as N,F as R,e as V,j as F,W as T}from"./index-C20tTf3S.js";import{a as q,g as D}from"./matieres-Ce1WeeoH.js";import{g as L}from"./themes-KZqHIzgY.js";import{u as U}from"./useSmartNavigation-CohFfUbW.js";import"./menuItems-zei-A9he.js";const $={key:0,class:"exercises-section"},G={key:0,class:"help-message"},P={class:"exercises-grid"},W={key:1,class:"no-matiere-message"},H={key:1,class:"loading-section"},J={__name:"Exercises",setup(K){const g=j(),r=m([]),_=m({}),l=m(!0),s=w(),f=z(),{checkAndRedirectIfNeeded:k}=U(),I=A(()=>!l.value);B(async()=>{try{if(l.value=!0,await k()){console.log("[Exercises] Redirection automatique effectu√©e");return}try{const p=(await q())?.data?.matieres_disponibles||[];r.value=p.map(d=>({id:d.id,nom:d.nom,description:d.description||"",svg_icon:d.svg_icon||""}))}catch{const{data:p}=await D();r.value=p||[]}let e=s.activeMatiereId;const a=f.pays?.id||null,h=f.niveau_pays?.id||null;if(!e&&r.value.length>0&&(e=r.value[0].id,s.setActiveMatiere(e)),e){const n=await L(e,h,a);_.value[e]=Array.isArray(n?.data)?n.data:n?.data||[],g.push({name:"Themes",params:{matiereId:String(e)}});return}s.selectedMatieresIds.length>0&&!s.activeMatiereId&&console.log("[Exercises] Utilisateur a des mati√®res s√©lectionn√©es, proposant une redirection intelligente")}catch(t){console.error("[Exercises] Erreur lors du chargement:",t),r.value=[]}finally{l.value=!1}});function S(t){try{s.isSelectedMatiere(t.id)||(s.addMatiereId(t.id),console.log(`[Exercises] Mati√®re ${t.nom} ajout√©e aux s√©lectionn√©es`)),s.setActiveMatiere(t.id),console.log(`[Exercises] Mati√®re ${t.nom} d√©finie comme active`),g.push({name:"Themes",params:{matiereId:t.id.toString()}})}catch(e){console.error("[Exercises] Erreur lors de la s√©lection de mati√®re:",e)}}return(t,e)=>(o(),x(C,null,{default:y(()=>[I.value?(o(),c("section",$,[e[4]||(e[4]=i("h2",{class:"exercises-title"},"Choisissez une mati√®re pour vos exercices guid√©s",-1)),u(s).selectedMatieresIds.length>0?(o(),c("div",G,[i("p",null,[e[0]||(e[0]=M("üí° ")),e[1]||(e[1]=i("strong",null,"Astuce :",-1)),M(" Vous avez "+N(u(s).selectedMatieresIds.length)+" mati√®re(s) s√©lectionn√©e(s). Cliquez sur une mati√®re ci-dessous ou utilisez vos onglets en haut pour acc√©der directement √† vos mati√®res favorites.",1)])])):v("",!0),i("div",P,[(o(!0),c(R,null,V(r.value,a=>(o(),x(E,{key:a.id,title:a.nom,icon:a.svg_icon,description:a.description||"",class:F({favorite:u(s).isFavoriteMatiere(a.id)}),onClick:h=>S(a)},T({_:2},[u(s).isFavoriteMatiere(a.id)?{name:"badge",fn:y(()=>[e[2]||(e[2]=i("span",{class:"favorite-badge"},"‚≠ê",-1))]),key:"0"}:void 0]),1032,["title","icon","description","class","onClick"]))),128))]),r.value.length===0?(o(),c("div",W,e[3]||(e[3]=[i("p",null,"Aucune mati√®re n'est actuellement disponible.",-1),i("p",null,"Veuillez r√©essayer plus tard ou contactez l'administrateur.",-1)]))):v("",!0)])):l.value?(o(),c("section",H,e[5]||(e[5]=[i("div",{class:"loading-spinner"},[i("p",null,"Chargement de vos exercices...")],-1)]))):v("",!0)]),_:1}))}},te=b(J,[["__scopeId","data-v-feaa7ea8"]]);export{te as default};
