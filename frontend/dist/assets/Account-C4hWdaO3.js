import{c as r,o,a as e,_ as $,b as x,d as D,t as g,k as J,z as W,j as w,F,e as A,m as k,n as X,s as T,p as L,D as Y,f as U,l as H,q as R,h as b,N as ee,O as ae,P as te,i as S,u as p,Q as se,R as le,w as ne,g as ie,S as B,U as oe}from"./index-C20tTf3S.js";import{D as ue}from"./DashboardLayout-DmmXvv68.js";import{g as z}from"./niveaux-BM1EBO4x.js";import"./menuItems-zei-A9he.js";import"./matieres-Ce1WeeoH.js";function re(t,v){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})])}const de={name:"FormSelect",props:{modelValue:{type:[String,Number],default:""},label:{type:String,default:""},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},error:{type:String,default:""},helpText:{type:String,default:""},options:{type:Array,required:!0}},emits:["update:modelValue","focus","blur"],setup(t,{emit:v}){const a=`select-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,s=k({get:()=>t.modelValue,set:y=>v("update:modelValue",y)}),f=k(()=>({"has-error":t.error,"is-disabled":t.disabled}));return{selectId:a,modelValueProxy:s,inputClass:f,handleFocus:y=>v("focus",y),handleBlur:y=>v("blur",y)}}},ce={class:"form-group"},ve=["for"],fe={key:0,class:"required-indicator"},me={class:"input-wrapper"},ye=["id","required","disabled"],pe=["value"],ge={key:1,class:"form-error"},he={key:2,class:"form-help"};function be(t,v,a,s,f,d){return o(),r("div",ce,[a.label?(o(),r("label",{key:0,for:s.selectId,class:"form-label"},[D(g(a.label)+" ",1),a.required?(o(),r("span",fe,"*")):x("",!0)],8,ve)):x("",!0),e("div",me,[J(e("select",{id:s.selectId,"onUpdate:modelValue":v[0]||(v[0]=c=>s.modelValueProxy=c),required:a.required,disabled:a.disabled,class:w(["form-input",s.inputClass]),onFocus:v[1]||(v[1]=(...c)=>s.handleFocus&&s.handleFocus(...c)),onBlur:v[2]||(v[2]=(...c)=>s.handleBlur&&s.handleBlur(...c))},[(o(!0),r(F,null,A(a.options,c=>(o(),r("option",{key:c.value,value:c.value},g(c.label),9,pe))),128))],42,ye),[[W,s.modelValueProxy]])]),a.error?(o(),r("p",ge,g(a.error),1)):x("",!0),a.helpText?(o(),r("p",he,g(a.helpText),1)):x("",!0)])}const Ne=$(de,[["render",be],["__scopeId","data-v-208cd485"]]),xe={class:"config-card"},Se={class:"config-header"},ke={class:"current-config"},Pe={class:"config-item"},Ce={class:"config-value"},Ve={class:"flag"},we={class:"config-item"},_e={class:"config-value"},$e={class:"niveau-badge"},Me={__name:"PaysNiveauDisplayCard",props:{userPays:{type:Object,default:null},userNiveau:{type:Object,default:null}},emits:["edit"],setup(t){return(v,a)=>(o(),r("div",xe,[e("div",Se,[a[2]||(a[2]=e("div",{class:"config-info"},[e("h3",null,"Configuration"),e("p",null,"Votre pays et niveau scolaire")],-1)),e("button",{onClick:a[0]||(a[0]=s=>v.$emit("edit")),class:"btn-configure"},a[1]||(a[1]=[e("svg",{class:"icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),D(" Modifier ")]))]),e("div",ke,[e("div",Pe,[a[3]||(a[3]=e("div",{class:"config-label"},"Pays",-1)),e("div",Ce,[e("span",Ve,g(t.userPays?.drapeau_emoji),1),e("span",null,g(t.userPays?.nom),1)])]),a[5]||(a[5]=e("div",{class:"config-divider"},null,-1)),e("div",we,[a[4]||(a[4]=e("div",{class:"config-label"},"Niveau",-1)),e("div",_e,[e("div",$e,g(t.userNiveau?.nom),1)])])])]))}},Be=$(Me,[["__scopeId","data-v-c92dc949"]]),De={key:0,class:"flag"},Ee={class:"option-info"},Ie={key:2,class:"current-badge"},Ue={key:3,class:"selected-indicator"},je={__name:"SelectionCard",props:{item:{type:Object,required:!0},type:{type:String,required:!0,validator:t=>["pays","niveau"].includes(t)},isSelected:{type:Boolean,default:!1},isCurrent:{type:Boolean,default:!1},isDisabled:{type:Boolean,default:!1}},emits:["select","hover"],setup(t,{emit:v}){const a=t,s=v,f=k(()=>a.type==="pays"?a.item.nom:a.item.nom_local||a.item.nom),d=k(()=>{if(a.type==="pays"){const n=a.item.nombre_niveaux;return n==null?"Niveaux disponibles":n===0?"Aucun niveau disponible":n===1?"1 niveau":`${n} niveaux`}return a.item.description||""}),c=k(()=>a.type!=="niveau"?{}:{background:a.item.couleur||"#667eea"}),y=()=>{a.isDisabled||s("select",a.item)},h=()=>{a.isDisabled||s("hover",a.item)};return(n,i)=>(o(),r("div",{class:w(["option-card",{selected:t.isSelected,current:t.isCurrent,disabled:t.isDisabled}]),onClick:y,onMouseenter:h},[t.type==="pays"?(o(),r("div",De,g(t.item.drapeau_emoji),1)):(o(),r("div",{key:1,class:"niveau-indicator",style:X(c.value)},null,4)),e("div",Ee,[e("h5",null,g(f.value),1),e("p",null,g(d.value),1)]),t.isCurrent?(o(),r("div",Ie," Actuel ")):x("",!0),t.isSelected?(o(),r("div",Ue,i[0]||(i[0]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none"},[e("path",{d:"M9 12L11 14L15 10",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]))):x("",!0)],34))}},O=$(je,[["__scopeId","data-v-75d409c0"]]),Fe={class:"progress"},Ae={class:"config-modal-body"},Le={key:0,class:"empty-state"},qe={key:1,class:"options-grid"},ze={key:0,class:"empty-state"},Oe={key:1,class:"empty-state"},Te={key:2,class:"options-grid"},He={class:"config-modal-footer"},Re=["disabled"],Ke={key:0},Qe={key:1},Ze={__name:"PaysNiveauSelectionModal",props:{modelValue:{type:Boolean,default:!1},paysList:{type:Array,default:()=>[]},filteredNiveaux:{type:Array,default:()=>[]},loadingNiveaux:{type:Boolean,default:!1},selectedPaysId:{type:Number,default:null},selectedNiveauId:{type:Number,default:null},userPays:{type:Object,default:null},userNiveau:{type:Object,default:null},currentStep:{type:String,default:"pays"},canSave:{type:Boolean,default:!1},saving:{type:Boolean,default:!1}},emits:["update:modelValue","select-pays","select-niveau","save","prefetch-niveaux"],setup(t,{emit:v}){const a=t,s=v,f=()=>{s("update:modelValue",!1)},d=i=>{s("select-pays",i)},c=i=>{s("select-niveau",i)},y=()=>{s("save")},h=i=>{s("prefetch-niveaux",i?.id||i)};T(()=>a.modelValue,i=>{i?document.body.style.overflow="hidden":document.body.style.overflow=""});const n=i=>{i.key==="Escape"&&a.modelValue&&f()};return L(()=>{document.addEventListener("keydown",n)}),Y(()=>{document.removeEventListener("keydown",n),document.body.style.overflow=""}),(i,l)=>t.modelValue?(o(),r("div",{key:0,class:"config-modal-overlay",onClick:f},[e("div",{class:"config-modal-content",onClick:l[0]||(l[0]=H(()=>{},["stop"]))},[e("div",{class:"config-modal-header"},[l[1]||(l[1]=e("div",{class:"title-wrap"},[e("h3",null,"Modifier votre configuration"),e("p",{class:"subtitle"},"Personnalisez votre pays et votre niveau pour adapter tout le contenu.")],-1)),e("button",{onClick:f,class:"close-btn","aria-label":"Fermer"},"×")]),e("div",Fe,[e("div",{class:w(["progress-step",{active:t.currentStep==="pays"||t.currentStep==="niveau",completed:t.currentStep==="niveau"&&!!t.selectedPaysId}])},l[2]||(l[2]=[e("span",{class:"circle"},"1",-1),e("span",{class:"label"},"Pays",-1)]),2),e("div",{class:w(["line",{completed:t.currentStep==="niveau"&&!!t.selectedPaysId}])},null,2),e("div",{class:w(["progress-step",{active:t.currentStep==="niveau"}])},l[3]||(l[3]=[e("span",{class:"circle"},"2",-1),e("span",{class:"label"},"Niveau",-1)]),2)]),e("div",Ae,[e("div",{class:w(["config-step",{active:t.currentStep==="pays"}])},[l[5]||(l[5]=e("h4",null,[e("span",{class:"step-number"},"1"),D(" Sélectionnez votre pays ")],-1)),l[6]||(l[6]=e("p",null,"Choisissez votre pays pour adapter le contenu à votre système éducatif",-1)),!t.paysList||t.paysList.length===0?(o(),r("div",Le,l[4]||(l[4]=[e("p",null,"Aucun pays disponible pour le moment.",-1)]))):(o(),r("div",qe,[(o(!0),r(F,null,A(t.paysList,m=>(o(),U(O,{key:m.id,item:m,type:"pays","is-selected":t.selectedPaysId===m.id,"is-current":t.userPays?.id===m.id,"is-disabled":m.nombre_niveaux===0,onSelect:d,onHover:h},null,8,["item","is-selected","is-current","is-disabled"]))),128))]))],2),t.selectedPaysId?(o(),r("div",{key:0,class:w(["config-step",{active:t.currentStep==="niveau"}])},[l[9]||(l[9]=e("h4",null,[e("span",{class:"step-number"},"2"),D(" Sélectionnez votre niveau ")],-1)),l[10]||(l[10]=e("p",null,"Choisissez votre niveau scolaire pour du contenu adapté",-1)),t.loadingNiveaux?(o(),r("div",ze,l[7]||(l[7]=[e("p",null,"Chargement des niveaux...",-1)]))):!t.filteredNiveaux||t.filteredNiveaux.length===0?(o(),r("div",Oe,l[8]||(l[8]=[e("p",null,"Aucun niveau disponible pour ce pays.",-1)]))):(o(),r("div",Te,[(o(!0),r(F,null,A(t.filteredNiveaux,m=>(o(),U(O,{key:m.id,item:m,type:"niveau","is-selected":t.selectedNiveauId===m.id,"is-current":t.userNiveau?.id===m.id,onSelect:c},null,8,["item","is-selected","is-current"]))),128))]))],2)):x("",!0)]),e("div",He,[e("button",{onClick:f,class:"btn-secondary"},"Annuler"),e("button",{onClick:y,class:"btn-primary",disabled:!t.canSave||t.saving},[t.saving?(o(),r("span",Ke,"Sauvegarde...")):(o(),r("span",Qe,"Sauvegarder"))],8,Re)])])])):x("",!0)}},Ge=$(Ze,[["__scopeId","data-v-c4af308b"]]);function Je(){const t=R(),{showToast:v}=ae(),a=b([]),s=b([]),f=b(null),d=b(null),c=b(!1),y=b(!1),h=b("pays"),n=b(!1),i=new Map;let l=0;const m=k(()=>t.pays),P=k(()=>t.niveau_pays),_=k(()=>f.value?s.value:[]),E=k(()=>{const u=f.value!==m.value?.id,N=d.value!==P.value?.id;return!!((u||N)&&f.value&&d.value)}),j=async()=>{try{const u=await te();a.value=u,m.value&&(f.value=m.value.id,await C(m.value.id)),P.value&&(d.value=P.value.id)}catch(u){console.error("Error loading data:",u),v("Erreur lors du chargement des données","error")}},q=async u=>{if(!(!u||i.has(u)))try{const N=await z(u);i.set(u,N);const V=a.value.findIndex(M=>M.id===u);V!==-1&&(a.value[V]={...a.value[V],nombre_niveaux:N.length})}catch{}},C=async u=>{if(!u){s.value=[];return}if(i.has(u)){s.value=i.get(u);return}try{n.value=!0,s.value=[];const N=++l,V=await z(u);if(N!==l)return;s.value=V,i.set(u,V);const M=a.value.findIndex(G=>G.id===u);M!==-1&&(a.value[M]={...a.value[M],nombre_niveaux:V.length})}catch(N){console.error("Error loading niveaux for pays:",N),v("Erreur lors du chargement des niveaux","error")}finally{n.value=!1}},I=async u=>{f.value=u.id,u.id!==m.value?.id&&(d.value=null,h.value="niveau"),C(u.id)},K=u=>{d.value=u.id},Q=async()=>{if(E.value)try{if(c.value=!0,await ee({pays_id:f.value,niveau_id:d.value}),await t.fetchUser(),v("Configuration mise à jour avec succès !","success"),y.value=!1,t.id){const u=`configurationCompleted_${t.id}`;localStorage.setItem(u,"true")}}catch(u){console.error("Error saving configuration:",u),v("Erreur lors de la sauvegarde","error")}finally{c.value=!1}},Z=()=>{y.value=!1,f.value=m.value?.id||null,d.value=P.value?.id||null,h.value="pays"};return T(f,u=>{u&&_.value.length>0&&(!d.value||!_.value.find(N=>N.id===d.value))&&(d.value=_.value[0]?.id)}),{paysList:a,niveauxList:s,selectedPaysId:f,selectedNiveauId:d,saving:c,showConfigModal:y,currentStep:h,loadingNiveaux:n,userPays:m,userNiveau:P,filteredNiveaux:_,canSave:E,loadData:j,selectPays:I,selectNiveau:K,saveConfiguration:Q,closeModal:Z,prefetchNiveauxForPays:q}}const We={class:"user-config-selector"},Xe={__name:"UserPaysNiveauConfig",setup(t){const{paysList:v,selectedPaysId:a,selectedNiveauId:s,saving:f,showConfigModal:d,currentStep:c,loadingNiveaux:y,userPays:h,userNiveau:n,filteredNiveaux:i,canSave:l,loadData:m,selectPays:P,selectNiveau:_,saveConfiguration:E,prefetchNiveauxForPays:j}=Je();return L(()=>{m()}),(q,C)=>(o(),r("div",We,[S(Be,{"user-pays":p(h),"user-niveau":p(n),onEdit:C[0]||(C[0]=I=>d.value=!0)},null,8,["user-pays","user-niveau"]),S(Ge,{modelValue:p(d),"onUpdate:modelValue":C[1]||(C[1]=I=>se(d)?d.value=I:null),"pays-list":p(v),"filtered-niveaux":p(i),"loading-niveaux":p(y),"selected-pays-id":p(a),"selected-niveau-id":p(s),"user-pays":p(h),"user-niveau":p(n),"current-step":p(c),"can-save":p(l),saving:p(f),onSelectPays:p(P),onSelectNiveau:p(_),onSave:p(E),onPrefetchNiveaux:p(j)},null,8,["modelValue","pays-list","filtered-niveaux","loading-niveaux","selected-pays-id","selected-niveau-id","user-pays","user-niveau","current-step","can-save","saving","onSelectPays","onSelectNiveau","onSave","onPrefetchNiveaux"])]))}},Ye=$(Xe,[["__scopeId","data-v-0f9fbf76"]]),ea={class:"account-page"},aa={class:"account-title"},ta={class:"account-title-icon"},sa={class:"config-section"},la={class:"account-fields-row"},na={class:"account-fields-row"},ia={class:"account-actions"},oa=["disabled"],ua={key:0,class:"account-success"},ra={key:1,class:"account-error"},da={__name:"Account",setup(t){const v=re,a=R(),s=b({civilite:"",firstName:"",lastName:"",email:"",telephone:"",date_naissance:""}),f=b(!1),d=b(""),c=b(""),y=n=>{s.value.civilite=n.civilite||"",s.value.firstName=n.firstName||n.first_name||"",s.value.lastName=n.lastName||n.last_name||"",s.value.email=n.email||"",s.value.telephone=n.telephone||"",s.value.date_naissance=n.date_naissance||""};L(async()=>{(!a.firstName||!a.lastName)&&await a.fetchUser(),y(a);try{const{data:n}=await le();y(n)}catch{}});const h=async()=>{f.value=!0,d.value="",c.value="";try{const n={civilite:s.value.civilite,first_name:s.value.firstName,last_name:s.value.lastName,telephone:s.value.telephone,date_naissance:s.value.date_naissance};Object.keys(n).forEach(l=>{(n[l]===""||n[l]===null||n[l]===void 0)&&(n[l]=null)});const i=await oe(n);d.value="Profil mis à jour avec succès !",await a.fetchUser()}catch(n){if(console.error("Erreur mise à jour profil:",n),n.response&&n.response.data&&n.response.data.errors){const i=n.response.data.errors,l=Object.values(i).join(", ");c.value=`Erreurs de validation: ${l}`}else n.response&&n.response.data&&n.response.data.error?c.value=n.response.data.error:c.value="Erreur lors de la sauvegarde. Veuillez réessayer."}finally{f.value=!1}};return(n,i)=>(o(),U(ue,null,{default:ne(()=>[e("div",ea,[e("h2",aa,[e("span",ta,[(o(),U(ie(p(v)),{class:"account-icon dark-blue-icon"}))]),i[6]||(i[6]=D(" Mes Coordonnées "))]),e("div",sa,[S(Ye)]),e("form",{class:"account-form",onSubmit:H(h,["prevent"])},[e("div",la,[S(Ne,{label:"Civilité",modelValue:s.value.civilite,"onUpdate:modelValue":i[0]||(i[0]=l=>s.value.civilite=l),options:[{value:"",label:"--"},{value:"Monsieur",label:"Monsieur"},{value:"Madame",label:"Madame"},{value:"Autre",label:"Autre"}],class:"account-input"},null,8,["modelValue"]),S(B,{label:"Prénom",modelValue:s.value.firstName,"onUpdate:modelValue":i[1]||(i[1]=l=>s.value.firstName=l),id:"firstName",required:"",class:"account-input",placeholder:"Prénom"},null,8,["modelValue"]),S(B,{label:"Nom",modelValue:s.value.lastName,"onUpdate:modelValue":i[2]||(i[2]=l=>s.value.lastName=l),id:"lastName",required:"",class:"account-input",placeholder:"Nom"},null,8,["modelValue"])]),e("div",na,[S(B,{label:"Email (ton identifiant)",modelValue:s.value.email,"onUpdate:modelValue":i[3]||(i[3]=l=>s.value.email=l),id:"email",type:"email",disabled:!0,class:"account-input",placeholder:"Email"},null,8,["modelValue"]),S(B,{label:"Numéro de téléphone",modelValue:s.value.telephone,"onUpdate:modelValue":i[4]||(i[4]=l=>s.value.telephone=l),id:"telephone",type:"tel",class:"account-input",placeholder:"Numéro de téléphone"},null,8,["modelValue"]),S(B,{label:"Date de naissance",modelValue:s.value.date_naissance,"onUpdate:modelValue":i[5]||(i[5]=l=>s.value.date_naissance=l),id:"date_naissance",type:"date",class:"account-input",placeholder:"Date de naissance"},null,8,["modelValue"])]),e("div",ia,[e("button",{class:"account-save-btn",type:"submit",disabled:f.value},g(f.value?"Sauvegarde...":"Sauvegarder"),9,oa),d.value?(o(),r("span",ua,g(d.value),1)):x("",!0),c.value?(o(),r("span",ra,g(c.value),1)):x("",!0)])],32)])]),_:1}))}},pa=$(da,[["__scopeId","data-v-77dec437"]]);export{pa as default};
