import{_ as B,h as m,m as S,p as U,c as i,a as t,b as C,k as u,z as x,F as y,e as b,v as p,t as s,l as E,o as r,i as M,u as j}from"./index-C20tTf3S.js";import{a as F,g as L,u as I,j as O,k as T}from"./curriculum-C6dJwtfd.js";import{A as q}from"./AdminActionsButtons-BF654C6o.js";const z={class:"form-group"},G=["value"],P={class:"form-group"},R={class:"form-group"},H={class:"form-group"},J={class:"btn-primary",type:"submit"},K={class:"filters"},Q={class:"filter-group"},W=["value"],X={class:"filter-group"},Y={class:"admin-table"},Z={key:0},$={__name:"AdminChapitres",setup(ee){const v=m([]),d=m([]),l=m({id:null,nom:"",notion:"",description:"",ordre:0}),a=m({notion:"",nom:""}),h=S(()=>{let o=v.value;return a.value.notion&&(o=o.filter(e=>e.notion==a.value.notion)),a.value.nom&&(o=o.filter(e=>e.nom.toLowerCase().includes(a.value.nom.toLowerCase()))),o.sort((e,n)=>(e.ordre||0)-(n.ordre||0))});async function c(){try{const[o,e]=await Promise.all([F(),L()]);v.value=o||[],d.value=e||[]}catch(o){console.error("[AdminChapitres] Erreur lors du chargement:",o),v.value=[],d.value=[]}}U(c);function g(){l.value={id:null,nom:"",notion:"",description:"",ordre:0}}async function _(){if(!(!l.value.nom||!l.value.notion))try{const o={nom:l.value.nom,notion:Number(l.value.notion),description:l.value.description,ordre:l.value.ordre,contenu:""};l.value.id?await I(l.value.id,o):await O(o),g(),await c()}catch(o){console.error("[AdminChapitres] Erreur:",o)}}function N(o){l.value={...o,notion:o.notion}}function f(o){if(!o)return"";const e=o.matiere_nom||o.contexte_detail&&o.contexte_detail.matiere_nom||"",n=o.contexte_detail&&o.contexte_detail.pays?o.contexte_detail.pays.nom:"",V=o.contexte_detail&&o.contexte_detail.niveau?o.contexte_detail.niveau.nom:"",D=o.theme_nom||"";return[o.nom,D,e,[n,V].filter(Boolean).join(" - ")].filter(Boolean).join(" — ")}function w(o){const e=d.value.find(n=>String(n.id)===String(o));return f(e)}async function k(o){try{await T(o),await c()}catch(e){console.error("Erreur:",e)}}function A(o){k(o.id)}return(o,e)=>(r(),i("div",null,[e[16]||(e[16]=t("h2",{class:"admin-title"},"Gestion des Chapitres",-1)),t("form",{class:"admin-form",onSubmit:E(_,["prevent"])},[t("div",z,[e[7]||(e[7]=t("label",null,"Notion (hérite du contexte via Thème):",-1)),u(t("select",{"onUpdate:modelValue":e[0]||(e[0]=n=>l.value.notion=n),required:""},[e[6]||(e[6]=t("option",{value:""},"Choisir une notion",-1)),(r(!0),i(y,null,b(d.value,n=>(r(),i("option",{key:n.id,value:n.id},s(f(n)),9,G))),128))],512),[[x,l.value.notion]])]),t("div",P,[e[8]||(e[8]=t("label",null,"Nom du chapitre:",-1)),u(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>l.value.nom=n),placeholder:"Nom du chapitre",required:""},null,512),[[p,l.value.nom]])]),t("div",R,[e[9]||(e[9]=t("label",null,"Description:",-1)),u(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=n=>l.value.description=n),rows:"3"},null,512),[[p,l.value.description]])]),t("div",H,[e[10]||(e[10]=t("label",null,"Ordre d'affichage:",-1)),u(t("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>l.value.ordre=n),type:"number",min:"0"},null,512),[[p,l.value.ordre,void 0,{number:!0}]])]),t("button",J,s(l.value.id?"Mettre à jour":"Créer"),1),l.value.id?(r(),i("button",{key:0,class:"btn-secondary",type:"button",onClick:g},"Annuler")):C("",!0)],32),t("div",K,[t("div",Q,[e[12]||(e[12]=t("label",null,"Filtrer par notion:",-1)),u(t("select",{"onUpdate:modelValue":e[4]||(e[4]=n=>a.value.notion=n)},[e[11]||(e[11]=t("option",{value:""},"Toutes les notions",-1)),(r(!0),i(y,null,b(d.value,n=>(r(),i("option",{key:n.id,value:n.id},s(f(n)),9,W))),128))],512),[[x,a.value.notion]])]),t("div",X,[e[13]||(e[13]=t("label",null,"Rechercher:",-1)),u(t("input",{"onUpdate:modelValue":e[5]||(e[5]=n=>a.value.nom=n),type:"text",placeholder:"Nom du chapitre..."},null,512),[[p,a.value.nom]])])]),t("table",Y,[e[15]||(e[15]=t("thead",null,[t("tr",null,[t("th",null,"ID"),t("th",null,"Nom du chapitre"),t("th",null,"Notion"),t("th",null,"Ordre"),t("th",null,"Actions")])],-1)),t("tbody",null,[(r(!0),i(y,null,b(h.value,n=>(r(),i("tr",{key:n.id},[t("td",null,s(n.id),1),t("td",null,s(n.nom),1),t("td",null,s(w(n.notion)),1),t("td",null,s(n.ordre||0),1),t("td",null,[M(j(q),{item:n,actions:["edit","delete"],"edit-label":"Éditer","confirm-message":"Êtes-vous sûr de vouloir supprimer ce chapitre ?",onEdit:N,onDelete:A},null,8,["item"])])]))),128)),h.value.length===0?(r(),i("tr",Z,e[14]||(e[14]=[t("td",{colspan:"5",style:{"text-align":"center","font-style":"italic"}},"Aucun chapitre trouvé.",-1)]))):C("",!0)])])]))}},ie=B($,[["__scopeId","data-v-54113af4"]]);export{ie as default};
