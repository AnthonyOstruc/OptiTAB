function m(e){return e?e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;(?!nbsp;)/g,"&").replace(/\\/g,"\\").replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+)\*/g,"<em>$1</em>"):""}function c(e){if(!e)return"";let t=e;t=t.replace(/^#### (.*$)/gm,'<h4 style="margin-top: 1.5em; margin-bottom: 0.8em; color: #193e8e; font-weight: 600;">$1</h4>'),t=t.replace(/^### (.*$)/gm,'<h3 style="margin-top: 2em; margin-bottom: 1em; color: #193e8e; font-weight: 600;">$1</h3>'),t=t.replace(/^## (.*$)/gm,'<h2 style="margin-top: 2.5em; margin-bottom: 1.2em; color: #193e8e; font-weight: 600; font-size: 1.5em;">$1</h2>'),t=t.replace(/^# (.*$)/gm,'<h1 style="margin-top: 3em; margin-bottom: 1.5em; color: #193e8e; font-weight: 700; font-size: 1.8em;">$1</h1>');const r=t.split(`
`);let o=[],n=!1;for(let i=0;i<r.length;i++){const s=r[i],a=s.trim();if(a.startsWith("- "))n||(o.push('<ul style="margin: 1em 0; padding-left: 0;">'),n=!0),o.push(`<li style="margin-bottom: 0.5em;">${a.substring(2)}</li>`);else if(n&&(o.push("</ul>"),n=!1),a){let p=s.replace(/^ +/g,l=>"&nbsp;".repeat(l.length)).replace(/ +$/g,l=>"&nbsp;".repeat(l.length)).replace(/  +/g,l=>"&nbsp;".repeat(l.length));o.push(`<p style="margin-bottom: 1em; line-height: 1.6;">${p}</p>`)}else s===""&&o.push('<p style="margin-bottom: 1em; line-height: 1.6;">&nbsp;</p>')}return n&&o.push("</ul>"),t=o.join(`
`),t=t.replace(/\*\*([^*]+)\*\*/g,'<strong style="color: #193e8e;">$1</strong>'),t=t.replace(/\*([^*]+)\*/g,'<em style="color: #666;">$1</em>'),t}function h(e,t=[]){if(!e)return"";let r=c(e);if(r=m(r),!t||t.length===0)return r;const o={};return t.forEach(n=>{n.position&&(o[n.position]=n)}),r=r.replace(/\[IMAGE_(\d+)\]/g,(n,i)=>{const s=o[parseInt(i)];return s?`
        <div class="content-image-container" data-image-position="${i}" style="text-align: center; margin: 2em 0;">
          <img 
            src="${g(s.image)}" 
            alt="Image ${s.image_type||"illustration"} - position ${i}"
            class="content-image"
            style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);"
          />
          ${s.legende?`<div class="image-legende" style="text-align: center; margin-top: 8px; font-style: italic; color: #666; font-size: 0.9em;">${s.legende}</div>`:""}
        </div>
      `:n}),r}function g(e,t="cours"){return e&&(e.startsWith("blob:")||e.startsWith("data:"))?e:e&&e.startsWith("/media/")?`http://localhost:8000${e}`:e&&e.includes("/")?`http://localhost:8000/media/${e}`:e&&!e.startsWith("/")?`http://localhost:8000/media/${t==="cours"?"cours_images":"exercice_images"}/${e}`:e}function u(){window.MathJax&&window.MathJax.typesetPromise?window.MathJax.typesetPromise():setTimeout(()=>{window.MathJax&&window.MathJax.typesetPromise&&window.MathJax.typesetPromise()},100);let e=0;const t=10,r=()=>{window.MathJax&&window.MathJax.typesetPromise?window.MathJax.typesetPromise():e<t&&(e++,setTimeout(r,200))};setTimeout(r,100)}export{h as a,g,u as r};
