const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Home-D7xj57pj.js","assets/MainLayout-B15Acfjn.js","assets/vendor-JoY6QM7x.js","assets/menuItems-CGsFFYXe.js","assets/matieres-CW6TrQsL.js","assets/MainLayout-BGO-Lpg3.css","assets/BaseCard-dpxqrxGh.js","assets/BaseCard-wVd7U2iM.css","assets/ui-jaH5oyHW.js","assets/pdf-B39ievqC.js","assets/mathlive-B5k0jhbN.js","assets/Home-C6UKIa5s.css","assets/Dashboard-DpHGV42E.js","assets/DashboardLayout-BQxYtzur.js","assets/DashboardLayout-DlpgjpAm.css","assets/curriculum-1vPkSFMM.js","assets/exercices-DnktByex.js","assets/quiz-DC1c3tez.js","assets/useDailyObjectives-Exur5uet.js","assets/Dashboard-AT5dR-9h.css","assets/ChildOverview-BUZPXzJQ.js","assets/ChildOverview-Ct9ZYVDo.css","assets/Account-VGRkBfY2.js","assets/niveaux-dai62ukD.js","assets/defineProperty-CByTjH6h.js","assets/Account-qspy0l7C.css","assets/Pricing-BaLQwifk.js","assets/Pricing-B0gC7E42.css","assets/Exercises-DSkRsgaV.js","assets/themes-DdvDCXG2.js","assets/useSmartNavigation-RJzT3Cxr.js","assets/Exercises-DJgsPd93.css","assets/OnlineCourses-azc8uJxL.js","assets/OnlineCourses-WPMua6PN.css","assets/Quiz-BwPcLF5b.js","assets/Quiz-BaVQ_woE.css","assets/QuizNotions-D5LLKARZ.js","assets/ThemeNotionsView-C3nrhe-a.js","assets/NotionCard-6zZlH5nh.js","assets/NotionCard-CHk7ZF0g.css","assets/ThemeNotionsView-Od9CvGnQ.css","assets/BackButton-DcJ3p42f.js","assets/BackButton-C5yUIBdm.css","assets/QuizNotions-Dl1wANwl.css","assets/QuizChapitres-B8OToHiM.js","assets/ChapitresListView-DHMprj3P.js","assets/ChapitresListView-CCAmRy31.css","assets/ChapterQuiz-DS7reDZx.js","assets/ChapterQuiz-DulUkX--.css","assets/CourseNotions-CzPCwjax.js","assets/CourseNotions-Be_90auv.css","assets/CourseChapitres--JDm1Kq_.js","assets/CourseChapitre-BUGCvROq.js","assets/PDFDownloadButton-r4l1CHHj.js","assets/PDFDownloadButton-D7sfzo-M.css","assets/scientificRenderer-Bx8oYBxt.js","assets/CourseChapitre-1As98nXp.css","assets/Cours-BdCnNox9.js","assets/Cours-BkIZ9rTK.css","assets/CoursDetail-B2Seyp_V.js","assets/CoursDetail-CZyP49zS.css","assets/Sheets-BxnowFB3.js","assets/synthesis-SFUTrOcd.js","assets/Sheets-D4Zq-ef4.css","assets/About-DnRd6Pd3.js","assets/About-BIGv8Rov.css","assets/CGV-D8ZaFSzS.js","assets/CGV-BgP3puIB.css","assets/CGU-JU3ftOVV.js","assets/CGU-DdhkNJwG.css","assets/Confidentialite-BONYaOoC.js","assets/Confidentialite-BBWG7fbl.css","assets/Conditions-DWIkQwaL.js","assets/Conditions-D7anzJ0L.css","assets/Notions-BUWsg0Fx.js","assets/notions-BR4wCIPX.js","assets/math-DsqdWQfm.js","assets/Notions-CNPax--8.css","assets/Themes-B8coCD2u.js","assets/ThemeNotions-C-gpvsHi.js","assets/ThemeNotions-tPiWNz0W.css","assets/Chapitres-CMmI2pdK.js","assets/Chapitres-DMZqd22O.css","assets/ChapterExercises-CSv8xORM.js","assets/ExerciceQCM-BRbkhadZ.js","assets/ExerciceQCM-Bi28n1Dj.css","assets/ChapterExercises-BZ4hHnsf.css","assets/Tabs-DlI6u4ZP.css","assets/ExerciceDetail-fbXYECF2.js","assets/ExerciceDetail-CYwV5da-.css","assets/Progress-DfYd-ZwF.js","assets/Progress-oXpKVhMa.css","assets/Calculator-f3uPDYse.js","assets/calculator-CbtoceRh.js","assets/Calculator-Dy0zL-nw.css","assets/TestFiltrageStrict-n-55MnTu.js","assets/TestFiltrageStrict-BeULsNWG.css","assets/AdminLayout-Cq7QHmND.js","assets/AdminLayout-zRG-CH6Y.css","assets/AdminMatieres-FKtwAoQv.js","assets/matiere-contextes-D3QO_oLs.js","assets/AdminActionsButtons-BcL45EBh.js","assets/AdminActionsButtons-Ccw6G07H.css","assets/AdminMatieres-BounX-DR.css","assets/AdminThemes-29L27Uxr.js","assets/PaysNiveauxDisplay.vue_vue_type_style_index_0_scoped_821033d6_lang-l0sNRNKZ.js","assets/AdminThemes-C42FetGD.css","assets/AdminNotions-DSxsbTs7.js","assets/PaysNiveauxSelector.vue_vue_type_style_index_0_scoped_6652d9f9_lang-l0sNRNKZ.js","assets/AdminNotions-CICP2R-z.css","assets/AdminChapitres-BpoDPSNd.js","assets/AdminChapitres-NJFWNzBT.css","assets/AdminExercices-BvX2qEzR.js","assets/AdminExercices-CJLdLS4b.css","assets/AdminExercicesPlus-ChuDQ7GN.js","assets/AdminExercicesPlus-bswOZmlE.css","assets/AdminCours-B0BwPO15.js","assets/AdminCours-CpH06XSE.css","assets/AdminCoursPlus-Bia2KkUm.js","assets/AdminCoursPlus-DJVlzxGp.css","assets/AdminSheets-DqI-4XwX.js","assets/AdminSheets-BzsaFlZ6.css","assets/AdminQuiz-BRXcmYIs.js","assets/AdminQuiz-xcDF0Z17.css","assets/AdminQuizPlus-LZKrBpAp.js","assets/AdminQuizPlus-Cbgqxmao.css","assets/AdminNiveaux-DqaVj6Ry.js","assets/AdminNiveaux-BU2lQ2eA.css","assets/AdminPays-Dt4doxSL.js","assets/AdminPays-8Ot7-Z35.css","assets/NotFound-Cs30MZpo.js","assets/NotFound-BRLCr2dc.css"])))=>i.map(i=>d[i]);
import{r as Te,a as w,c as M,b as S,o as v,d as a,e as W,f as ee,g as q,t as O,h as U,i as qe,w as Re,n as K,T as ze,j as pe,k as je,v as gt,l as _t,m as ot,F as he,p as ve,q as ge,u as j,s as yt,x as St,y as Ge,z as ae,A as be,B as It,C as Ce,D as Et,E as nt,G as at,H as bt,I as kt,J as wt}from"./vendor-JoY6QM7x.js";import{a as it}from"./ui-jaH5oyHW.js";import{_ as T}from"./pdf-B39ievqC.js";import"./mathlive-B5k0jhbN.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}})();const ne=Te({}),fe=w([]);function $e(){return{modalStates:ne,activeModals:fe,openModal:(o,l={})=>{ne[o]={isOpen:!0,...l},fe.value.includes(o)||fe.value.push(o),document.body.style.overflow="hidden"},closeModal:o=>{ne[o]&&(ne[o].isOpen=!1);const l=fe.value.indexOf(o);l>-1&&fe.value.splice(l,1),fe.value.length===0&&(document.body.style.overflow="")},closeAllModals:()=>{Object.keys(ne).forEach(o=>{ne[o].isOpen=!1}),fe.value=[],document.body.style.overflow=""},isModalOpen:o=>ne[o]?.isOpen||!1,getModalState:o=>ne[o]||{isOpen:!1},updateModalOptions:(o,l)=>{ne[o]&&Object.assign(ne[o],l)}}}const re={LOGIN:"login",REGISTER:"register",FORGOT_PASSWORD:"forgot-password",SIGNUP:"signup",CONFIRM_DELETE:"confirm-delete",SETTINGS:"settings",AUTO_NIVEAU:"auto-niveau"},X={required:e=>typeof e=="string"?e.trim().length>0||"Ce champ est requis":e!=null||"Ce champ est requis",email:e=>e?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)||"Format d'email invalide":!0,minLength:e=>t=>t?t.length>=e||`Minimum ${e} caractères requis`:!0,maxLength:e=>t=>t?t.length<=e||`Maximum ${e} caractères autorisés`:!0,password:e=>{if(!e)return!0;const t=/[A-Z]/.test(e),r=/[a-z]/.test(e),s=/\d/.test(e);return e.length>=8?t?r?s?!0:"Le mot de passe doit contenir au moins un chiffre":"Le mot de passe doit contenir au moins une minuscule":"Le mot de passe doit contenir au moins une majuscule":"Le mot de passe doit contenir au moins 8 caractères"},confirmPassword:e=>t=>t?e===t||"Les mots de passe ne correspondent pas":"Veuillez confirmer votre mot de passe"};function At(e={},t={}){const r=Te({...e}),s=Te({}),n=Te({}),i=w(!1),o=M(()=>Object.keys(s).length===0||Object.values(s).every(y=>!y)),l=M(()=>Object.values(s).some(y=>y)),u=(y,f)=>{const g=t[y];if(!g)return!0;for(const k of g){const R=k(f,void 0,r);if(R!==!0)return s[y]=R,!1}return delete s[y],!0},p=()=>{let y=!0;return Object.keys(t).forEach(f=>{u(f,r[f])||(y=!1)}),y};return{formData:r,errors:s,touched:n,isSubmitting:i,isValid:o,hasErrors:l,validateField:u,validateForm:p,setFieldValue:(y,f)=>{r[y]=f,n[y]&&u(y,f)},setFieldTouched:y=>{n[y]=!0,u(y,r[y])},resetForm:()=>{Object.keys(r).forEach(y=>{r[y]=e[y]||""}),Object.keys(s).forEach(y=>{delete s[y]}),Object.keys(n).forEach(y=>{delete n[y]}),i.value=!1},setErrors:y=>{Object.assign(s,y)},getFieldError:y=>s[y]||"",isFieldTouched:y=>n[y]||!1,handleSubmit:async y=>{if(!i.value){if(Object.keys(t).forEach(f=>{n[f]=!0}),!p())return!1;i.value=!0;try{return await y(r),!0}catch{return!1}finally{i.value=!1}}}}}const Tt={LOGIN:{fields:{email:{type:"email",label:"Email",placeholder:"votre@email.com",required:!0,name:"username",autocomplete:"username",validation:[X.required,X.email]},password:{type:"password",label:"Mot de passe",placeholder:"Votre mot de passe",required:!0,name:"current-password",autocomplete:"current-password",validation:[X.required,X.minLength(6)]},rememberMe:{type:"checkbox",label:"Se souvenir de moi",required:!1}},submitText:"Se connecter",socialText:"Continuer avec Google"},REGISTER:{fields:{firstName:{type:"text",label:"Prénom",placeholder:"Votre prénom",required:!0,autocomplete:"given-name",validation:[X.required,X.minLength(2)]},lastName:{type:"text",label:"Nom",placeholder:"Votre nom",required:!0,autocomplete:"family-name",validation:[X.required,X.minLength(2)]},email:{type:"email",label:"Email",placeholder:"votre@email.com",required:!0,autocomplete:"email",validation:[X.required,X.email]},password:{type:"password",label:"Mot de passe",placeholder:"Créez un mot de passe",required:!0,autocomplete:"new-password",validation:[X.required,X.password]},confirmPassword:{type:"password",label:"Confirmer le mot de passe",placeholder:"Confirmez votre mot de passe",required:!0,autocomplete:"new-password",validation:[X.required]},acceptTerms:{type:"checkbox",label:"J'accepte les conditions d'utilisation",required:!0,validation:[e=>e===!0||"Vous devez accepter les conditions d'utilisation"]},newsletter:{type:"checkbox",label:"Je souhaite recevoir les actualités et offres d'OptiTAB",required:!1}},submitText:"Créer mon compte",socialText:"Continuer avec Google"},FORGOT_PASSWORD:{fields:{email:{type:"email",label:"Email",placeholder:"votre@email.com",required:!0,autocomplete:"email",validation:[X.required,X.email]}},submitText:"Envoyer le lien de réinitialisation",socialText:"Continuer avec Google"}};function Xe(e){const t=Tt[e];if(!t)throw new Error(`Unknown form type: ${e}`);const r=Object.keys(t.fields).reduce((f,g)=>{const k=t.fields[g];return f[g]=k.type==="checkbox"?!1:"",f},{}),s=Object.keys(t.fields).reduce((f,g)=>{const k=t.fields[g];return k.validation&&(f[g]=k.validation),f},{});e==="REGISTER"&&s.confirmPassword.push((f,g,k)=>X.confirmPassword(k.password)(f));const{formData:n,errors:i,touched:o,isSubmitting:l,isValid:u,getFieldError:p,setFieldTouched:m,handleSubmit:h,resetForm:d}=At(r,s);return{config:t,formData:n,errors:i,touched:o,isSubmitting:l,isValid:u,getFieldError:p,setFieldTouched:m,submitForm:async(f,g)=>await h(async R=>{try{return await f(R),!0}catch(P){return g?.(P),!1}}),resetForm:d,getFieldConfig:f=>t.fields[f]||null,getFieldNames:()=>Object.keys(t.fields),isFieldRequired:f=>t.fields[f]?.required||!1,getFieldType:f=>t.fields[f]?.type||"text"}}const H=(e,t)=>{const r=e.__vccOpts||e;for(const[s,n]of t)r[s]=n;return r},Mt={name:"CloseIcon"},Ct={class:"close-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"};function Ft(e,t,r,s,n,i){return v(),S("svg",Ct,t[0]||(t[0]=[a("line",{x1:"18",y1:"6",x2:"6",y2:"18"},null,-1),a("line",{x1:"6",y1:"6",x2:"18",y2:"18"},null,-1)]))}const Lt=H(Mt,[["render",Ft],["__scopeId","data-v-8853147e"]]),Rt={name:"Modal",components:{CloseIcon:Lt},props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:""},showHeader:{type:Boolean,default:!0},showCloseButton:{type:Boolean,default:!0},closeButtonLabel:{type:String,default:"Fermer"},closeOnOverlay:{type:Boolean,default:!0},canClose:{type:Boolean,default:!0},size:{type:String,default:"medium",validator:e=>["small","medium","large","full"].includes(e)},contentClass:{type:String,default:""}},emits:["close","overlay-click"],setup(e,{emit:t}){return{titleId:M(()=>e.title?`modal-title-${Date.now()}`:""),handleClose:()=>{t("close")},handleOverlayClick:()=>{e.closeOnOverlay&&e.canClose&&(t("overlay-click"),t("close"))}}}},xt={key:0,class:"modal-wrapper"},Pt=["aria-modal","aria-labelledby"],Ot={key:0,class:"modal-header"},Nt=["id"],Dt=["aria-label"],Vt={class:"modal-body"};function qt(e,t,r,s,n,i){const o=W("CloseIcon");return v(),ee(ze,{to:"body"},[r.isOpen?(v(),S("div",xt,[a("div",{class:"modal-overlay",onClick:t[0]||(t[0]=(...l)=>s.handleOverlayClick&&s.handleOverlayClick(...l)),role:"presentation"}),a("div",{class:K(["modal-content",`modal-${r.size}`]),role:"dialog","aria-modal":r.isOpen,"aria-labelledby":s.titleId,onClick:t[2]||(t[2]=Re(()=>{},["stop"]))},[r.showHeader?(v(),S("div",Ot,[r.title?(v(),S("h2",{key:0,id:s.titleId,class:"modal-title"},O(r.title),9,Nt)):q("",!0),r.showCloseButton&&r.canClose?(v(),S("button",{key:1,class:"modal-close-btn",onClick:t[1]||(t[1]=(...l)=>s.handleClose&&s.handleClose(...l)),"aria-label":r.closeButtonLabel},[U(o)],8,Dt)):q("",!0)])):q("",!0),a("div",Vt,[qe(e.$slots,"default",{},void 0,!0)])],10,Pt)])):q("",!0)])}const ke=H(Rt,[["render",qt],["__scopeId","data-v-91224a14"]]),Ut={name:"FormInput",props:{modelValue:{type:[String,Number],default:""},type:{type:String,default:"text",validator:e=>["text","email","password","number","tel","url","date"].includes(e)},label:{type:String,default:""},placeholder:{type:String,default:""},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},name:{type:String,default:""},autocomplete:{type:String,default:""},error:{type:String,default:""},helpText:{type:String,default:""}},emits:["update:modelValue","input","focus","blur","keydown"],setup(e,{emit:t}){const r=`input-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,s=w(!1),n=M({get:()=>e.modelValue,set:d=>t("update:modelValue",d)}),i=M(()=>({"has-error":e.error,"is-disabled":e.disabled})),o=M(()=>e.type==="password"?s.value?"text":"password":e.type);return{inputId:r,inputValue:n,inputClass:i,actualType:o,isPasswordVisible:s,handleInput:d=>t("input",d),handleFocus:d=>t("focus",d),handleBlur:d=>t("blur",d),handleKeydown:d=>t("keydown",d),togglePasswordVisibility:()=>{s.value=!s.value}}}},Bt={class:"form-group"},zt=["for"],jt={key:0,class:"required-indicator"},Gt={class:"input-wrapper"},$t=["id","type","placeholder","required","disabled","name","autocomplete"],Xt=["disabled"],Ht={key:0,width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Qt={key:1,width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Kt={key:1,class:"form-error"},Wt={key:2,class:"form-help"};function Jt(e,t,r,s,n,i){return v(),S("div",Bt,[r.label?(v(),S("label",{key:0,for:s.inputId,class:"form-label"},[pe(O(r.label)+" ",1),r.required?(v(),S("span",jt,"*")):q("",!0)],8,zt)):q("",!0),a("div",Gt,[je(a("input",{id:s.inputId,"onUpdate:modelValue":t[0]||(t[0]=o=>s.inputValue=o),type:s.actualType,placeholder:r.placeholder,required:r.required,disabled:r.disabled,name:r.name,autocomplete:r.autocomplete,class:K(["form-input",s.inputClass]),onInput:t[1]||(t[1]=(...o)=>s.handleInput&&s.handleInput(...o)),onFocus:t[2]||(t[2]=(...o)=>s.handleFocus&&s.handleFocus(...o)),onBlur:t[3]||(t[3]=(...o)=>s.handleBlur&&s.handleBlur(...o)),onKeydown:t[4]||(t[4]=(...o)=>s.handleKeydown&&s.handleKeydown(...o))},null,42,$t),[[gt,s.inputValue]]),r.type==="password"?(v(),S("button",{key:0,type:"button",class:"password-toggle",onClick:t[5]||(t[5]=(...o)=>s.togglePasswordVisibility&&s.togglePasswordVisibility(...o)),disabled:r.disabled,tabindex:"-1"},[s.isPasswordVisible?(v(),S("svg",Ht,t[6]||(t[6]=[a("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"},null,-1),a("line",{x1:"1",y1:"1",x2:"23",y2:"23"},null,-1)]))):(v(),S("svg",Qt,t[7]||(t[7]=[a("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"},null,-1),a("circle",{cx:"12",cy:"12",r:"3"},null,-1)])))],8,Xt)):q("",!0)]),r.error?(v(),S("p",Kt,O(r.error),1)):q("",!0),r.helpText?(v(),S("p",Wt,O(r.helpText),1)):q("",!0)])}const Yt=H(Ut,[["render",Jt],["__scopeId","data-v-49655f01"]]),Zt={name:"FormField",components:{FormInput:Yt},props:{fieldName:{type:String,required:!0},fieldConfig:{type:Object,required:!0},modelValue:{type:[String,Number,Boolean],default:""},disabled:{type:Boolean,default:!1},getFieldError:{type:Function,required:!0}},emits:["update:modelValue","blur","input"],setup(e,{emit:t}){const r=M({get:()=>e.modelValue,set:l=>t("update:modelValue",l)}),s=M(()=>e.fieldConfig?["text","email","password","number","tel","url"].includes(e.fieldConfig.type):!1),n=M(()=>({"has-error":e.getFieldError(e.fieldName),"is-disabled":e.disabled}));return{fieldValue:r,isInputField:s,fieldClass:n,handleBlur:l=>{t("blur",{fieldName:e.fieldName,event:l})},handleInput:l=>{t("input",{fieldName:e.fieldName,event:l})}}}},er={key:1,class:"checkbox-field"},tr={class:"checkbox-label"},rr=["required","disabled"],sr=["innerHTML"],or={key:0,class:"form-error"},nr={key:2,class:"unsupported-field"},ar={class:"error-message"};function ir(e,t,r,s,n,i){const o=W("FormInput");return r.fieldConfig?(v(),S("div",{key:0,class:K(["form-field",s.fieldClass])},[s.isInputField?(v(),ee(o,{key:0,modelValue:s.fieldValue,"onUpdate:modelValue":t[0]||(t[0]=l=>s.fieldValue=l),type:r.fieldConfig.type,label:r.fieldConfig.label,placeholder:r.fieldConfig.placeholder,required:r.fieldConfig.required,disabled:r.disabled,name:r.fieldConfig.name||r.fieldName,autocomplete:r.fieldConfig.autocomplete,error:r.getFieldError(r.fieldName),"help-text":r.fieldConfig.helpText,onBlur:s.handleBlur,onInput:s.handleInput},null,8,["modelValue","type","label","placeholder","required","disabled","name","autocomplete","error","help-text","onBlur","onInput"])):r.fieldConfig.type==="checkbox"?(v(),S("div",er,[a("label",tr,[je(a("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>s.fieldValue=l),type:"checkbox",class:"checkbox-input",required:r.fieldConfig.required,disabled:r.disabled},null,8,rr),[[_t,s.fieldValue]]),a("span",{class:"checkbox-text",innerHTML:r.fieldConfig.label},null,8,sr)]),r.getFieldError(r.fieldName)?(v(),S("p",or,O(r.getFieldError(r.fieldName)),1)):q("",!0)])):(v(),S("div",nr,[a("p",ar,'Field type "'+O(r.fieldConfig.type)+'" is not supported',1)]))],2)):q("",!0)}const lt=H(Zt,[["render",ir],["__scopeId","data-v-d5ac912b"]]),lr={name:"LoadingSpinner",props:{size:{type:String,default:"medium",validator:e=>["small","medium","large"].includes(e)},color:{type:String,default:"current"}},computed:{sizeClass(){return`spinner-${this.size}`},spinnerStyle(){return this.color==="current"?{}:{"--spinner-color":this.color}}}};function cr(e,t,r,s,n,i){return v(),S("div",{class:K(["loading-spinner",i.sizeClass]),style:ot(i.spinnerStyle)},t[0]||(t[0]=[a("div",{class:"spinner-ring"},null,-1)]),6)}const ur=H(lr,[["render",cr],["__scopeId","data-v-f8c69cd1"]]),dr={name:"DynamicForm",components:{FormField:lt,LoadingSpinner:ur},props:{fieldNames:{type:Array,required:!0},getFieldConfig:{type:Function,required:!0},formData:{type:Object,required:!0},isSubmitting:{type:Boolean,default:!1},isValid:{type:Boolean,default:!0},getFieldError:{type:Function,required:!0},setFieldTouched:{type:Function,required:!0},submitText:{type:String,default:"Soumettre"}},emits:["submit","field-blur","field-input"],setup(e,{emit:t}){return{handleSubmit:()=>{t("submit")},handleFieldBlur:({fieldName:i,event:o})=>{e.setFieldTouched(i),t("field-blur",{fieldName:i,event:o})},handleFieldInput:({fieldName:i,event:o})=>{t("field-input",{fieldName:i,event:o})}}}},mr={class:"form-fields"},fr=["disabled"],pr={key:1};function hr(e,t,r,s,n,i){const o=W("FormField"),l=W("LoadingSpinner");return v(),S("form",{onSubmit:t[0]||(t[0]=Re((...u)=>s.handleSubmit&&s.handleSubmit(...u),["prevent"])),class:"dynamic-form"},[a("div",mr,[(v(!0),S(he,null,ve(r.fieldNames,u=>(v(),ee(o,{key:u,"field-name":u,"field-config":r.getFieldConfig(u),modelValue:r.formData[u],"onUpdate:modelValue":p=>r.formData[u]=p,disabled:r.isSubmitting,"get-field-error":r.getFieldError,onBlur:s.handleFieldBlur,onInput:s.handleFieldInput},null,8,["field-name","field-config","modelValue","onUpdate:modelValue","disabled","get-field-error","onBlur","onInput"]))),128))]),qe(e.$slots,"form-content",{},void 0,!0),a("button",{type:"submit",class:"form-submit-btn",disabled:r.isSubmitting||!r.isValid},[r.isSubmitting?(v(),ee(l,{key:0})):(v(),S("span",pr,O(r.submitText),1))],8,fr),qe(e.$slots,"form-actions",{},void 0,!0)],32)}const He=H(dr,[["render",hr],["__scopeId","data-v-6fbd3fc3"]]),vr="/icons/google.svg",ct=[{key:"google",label:"Continuer avec Google",icon:vr,btnClass:"google-btn",color:"#e5e7eb"}];function Ue(e){if(e<=0)return{level:0,next_level_xp:10,xp_to_next:10};let t=0;for(;;){const n=(t+1)*(t+1)*10;if(e<n)break;t+=1}const r=(t+1)*(t+1)*10,s=r-e;return{level:t,next_level_xp:r,xp_to_next:s}}localStorage.removeItem("user");const te=ge("user",{state:()=>({id:null,firstName:"",lastName:"",email:"",telephone:"",date_naissance:"",niveau_pays:null,pays:null,role:"student",xp:0,level:0,xp_to_next:0,isAdmin:!1,isAuthenticated:!1,isLoading:!1}),actions:{setUser(e){this.id=e.id||e.user_id||null,this.firstName=e.first_name||"",this.lastName=e.last_name||"",this.email=e.email||"",this.telephone=e.telephone||"",this.date_naissance=e.date_naissance||"",this.niveau_pays=e.niveau_pays||null,this.pays=e.pays||null,this.role=e.role||"student";const t=Number(e.xp??0),r=Ue(t);this.xp=t,this.level=Number(r.level),this.xp_to_next=Number(r.xp_to_next);const s=["anthonytabet.c@gmail.com","admin@optitab.com"];this.isAdmin=e.is_staff||e.isAdmin||s.includes(e.email)||!1,this.isAuthenticated=!0,this.isLoading=!1},clearUser(){Ee.stopTokenMonitoring();const e=this.id;if(this.id=null,this.firstName="",this.lastName="",this.email="",this.telephone="",this.date_naissance="",this.niveau_pays=null,this.pays=null,this.role="student",this.xp=0,this.level=0,this.xp_to_next=0,this.isAdmin=!1,this.isAuthenticated=!1,this.isLoading=!1,e){const r=`configurationCompleted_${e}`;localStorage.removeItem(r)}["selectedMatieres","favoriteMatieresIds","activeMatiereId","selectedMatieresIds","access_token","refresh_token"].forEach(r=>localStorage.removeItem(r))},async fetchUser(){this.isLoading=!0;try{const e=localStorage.getItem("access_token"),t=localStorage.getItem("refresh_token"),r=await zr(),s=r.data?.data||r.data,n=this.pays&&this.niveau_pays,i=s.pays&&s.niveau_pays;if(n&&!i&&this.id){const o=`configurationCompleted_${this.id}`;localStorage.removeItem(o),["selectedMatieres","favoriteMatieresIds","activeMatiereId","selectedMatieresIds"].forEach(u=>localStorage.removeItem(u))}this.setUser(s),setTimeout(()=>{Ee.startTokenMonitoring()},500)}catch(e){const t=e.response?.status,r=e.response?.data?.message||e.message;t===401?this.clearUser():t>=500?setTimeout(()=>{this.isAuthenticated||this.fetchUser()},5e3):this.clearUser()}finally{this.isLoading=!1}}}}),B={SELECTED_SUBJECT:"selected-subject",SELECTED_MATIERES:"selected-matieres-ids",FAVORITE_MATIERES:"favorite-matieres-ids",ACTIVE_MATIERE:"active-matiere-id"},Fe={MAX_SELECTED_MATIERES:10,MAX_FAVORITE_MATIERES:20},de={INVALID_ID:"ID de matière invalide",LIMIT_REACHED:"Limite atteinte"},ut={UNAUTHORIZED:401,NOT_FOUND:404},z=(e,t,r={})=>{const s={context:t,message:e.message,timestamp:new Date().toISOString(),...r};return e.response&&(e.response.status,ut.NOT_FOUND),s},dt=e=>{if(e==null)return!1;const t=Number(e);return!isNaN(t)&&t>0&&Number.isInteger(t)},Z=e=>dt(e)?Number(e):null,G=()=>!!localStorage.getItem("access_token"),Y=(e,t)=>{try{return localStorage.setItem(e,JSON.stringify(t)),!0}catch{return!1}},Qe=(e,t,r=!0)=>{try{const s=localStorage.getItem(e);if(!s)return t;if(!r)return s;try{return JSON.parse(s)}catch{return s}}catch{return t}},Se=e=>Array.isArray(e)?e.filter(dt).map(Z):[],Ie=(e,t)=>e.response?.status===ut.UNAUTHORIZED,mt=(e,t)=>e<t,I=(e,t={},r="info")=>{const s={operation:e,timestamp:new Date().toISOString(),...t};switch(r){case"warn":break;case"error":break;default:}},gr=ge("subjects-favorites",()=>{const e=w([]),t=w(!1),r=w(null),s=M(()=>e.value.length),n=M(()=>mt(s.value,Fe.MAX_FAVORITE_MATIERES)),i=M(()=>d=>{const c=Z(d);return c!==null&&e.value.includes(c)}),o=async d=>{const c=Z(d);if(!c)return I("addFavoriteMatiere",{id:d,error:de.INVALID_ID},"warn"),!1;if(e.value.includes(c))return I("addFavoriteMatiere",{id:c,status:"already_favorite"}),!0;if(!n.value)return I("addFavoriteMatiere",{id:c,error:de.LIMIT_REACHED,currentCount:s.value,maxCount:Fe.MAX_FAVORITE_MATIERES},"warn"),!1;if(e.value.push(c),Y(B.FAVORITE_MATIERES,e.value),I("addFavoriteMatiere",{id:c,status:"local_update",authenticated:G()}),!G())return!0;try{return t.value=!0,r.value=null,await Or(c),I("addFavoriteMatiere",{id:c,status:"backend_success"}),!0}catch(E){return Ie(E,"addFavoriteMatiere")?!0:(e.value=e.value.filter(A=>A!==c),Y(B.FAVORITE_MATIERES,e.value),r.value=z(E,"addFavoriteMatiere",{matiereId:c}),!1)}finally{t.value=!1}},l=async d=>{const c=Z(d);if(!c)return I("removeFavoriteMatiere",{id:d,error:de.INVALID_ID},"warn"),!1;const E=e.value.indexOf(c);if(E===-1)return I("removeFavoriteMatiere",{id:c,status:"not_found"}),!0;if(e.value.splice(E,1),Y(B.FAVORITE_MATIERES,e.value),I("removeFavoriteMatiere",{id:c,status:"local_update",authenticated:G()}),!G())return!0;try{return t.value=!0,r.value=null,await Nr(c),I("removeFavoriteMatiere",{id:c,status:"backend_success"}),!0}catch(A){return Ie(A,"removeFavoriteMatiere")?!0:(e.value.splice(E,0,c),Y(B.FAVORITE_MATIERES,e.value),r.value=z(A,"removeFavoriteMatiere",{matiereId:c}),!1)}finally{t.value=!1}};return{favoriteMatieresIds:e,isSyncing:t,lastSyncError:r,favoriteMatieresCount:s,canAddMoreFavorites:n,isFavoriteMatiere:i,addFavoriteMatiere:o,removeFavoriteMatiere:l,toggleFavoriteMatiere:async d=>{const c=Z(d);if(!c)return I("toggleFavoriteMatiere",{matiereId:d,error:de.INVALID_ID},"warn"),!1;try{return e.value.includes(c)?await l(c):await o(c)}catch(E){return r.value=z(E,"toggleFavoriteMatiere",{matiereId:c}),!1}},loadFavoriteMatieresIds:async()=>{try{const d=Qe(B.FAVORITE_MATIERES,[]),c=Se(d);e.value=c,I("loadFavoriteMatieresIds",{loadedCount:c.length,totalStored:d.length})}catch(d){r.value=z(d,"loadFavoriteMatieresIds"),e.value=[]}},clearFavorites:async()=>{try{const d=[...e.value];for(const c of d)await l(c);return I("clearFavorites",{clearedCount:d.length}),!0}catch(d){return r.value=z(d,"clearFavorites"),!1}},setFavoriteMatieresIds:d=>{const c=Se(d);e.value=c,Y(B.FAVORITE_MATIERES,c),I("setFavoriteMatieresIds",{setCount:c.length,originalCount:d.length})}}}),_r=ge("subjects-selected",()=>{const e=w([]),t=w(!1),r=w(null),s=M(()=>e.value.length),n=M(()=>mt(s.value,Fe.MAX_SELECTED_MATIERES)),i=M(()=>d=>{const c=Z(d);return c!==null&&e.value.includes(c)}),o=async d=>{const c=Z(d);if(!c)return I("addMatiereId",{id:d,error:de.INVALID_ID},"warn"),!1;if(e.value.includes(c))return I("addMatiereId",{id:c,status:"already_selected"}),!0;if(!n.value)return I("addMatiereId",{id:c,error:de.LIMIT_REACHED,currentCount:s.value,maxCount:Fe.MAX_SELECTED_MATIERES},"warn"),!1;if(e.value.push(c),Y(B.SELECTED_MATIERES,e.value),I("addMatiereId",{id:c,status:"local_update",authenticated:G()}),!G())return!0;try{return t.value=!0,r.value=null,await Dr(c),I("addMatiereId",{id:c,status:"backend_success"}),!0}catch(E){return Ie(E,"addMatiereId")?!0:(e.value=e.value.filter(A=>A!==c),Y(B.SELECTED_MATIERES,e.value),r.value=z(E,"addMatiereId",{matiereId:c}),!1)}finally{t.value=!1}},l=async d=>{const c=Z(d);if(!c)return I("removeMatiereId",{id:d,error:de.INVALID_ID},"warn"),!1;const E=e.value.indexOf(c);if(E===-1)return I("removeMatiereId",{id:c,status:"not_found"}),!0;try{return e.value.splice(E,1),Y(B.SELECTED_MATIERES,e.value),I("removeMatiereId",{id:c,status:"local_update",authenticated:G()}),G()&&(t.value=!0,r.value=null,await Vr(c),I("removeMatiereId",{id:c,status:"backend_success"})),!0}catch(A){return e.value.splice(E,0,c),Y(B.SELECTED_MATIERES,e.value),r.value=z(A,"removeMatiereId",{matiereId:c}),!1}finally{t.value=!1}};return{selectedMatieresIds:e,isSyncing:t,lastSyncError:r,selectedMatieresCount:s,canAddMoreSelected:n,isSelectedMatiere:i,addMatiereId:o,removeMatiereId:l,loadSelectedMatieresIds:async()=>{try{const d=Qe(B.SELECTED_MATIERES,[]),c=Se(d);e.value=c,I("loadSelectedMatieresIds",{loadedCount:c.length,totalStored:d.length})}catch(d){r.value=z(d,"loadSelectedMatieresIds"),e.value=[]}},clearSelectedMatieres:async()=>{try{const d=[...e.value];for(const c of d)await l(c);return I("clearSelectedMatieres",{clearedCount:d.length}),!0}catch(d){return r.value=z(d,"clearSelectedMatieres"),!1}},setSelectedMatieresIds:d=>{const c=Se(d);e.value=c,Y(B.SELECTED_MATIERES,c),I("setSelectedMatieresIds",{setCount:c.length,originalCount:d.length})},addMultipleMatieres:async d=>{try{const c=Se(d),A=(await Promise.all(c.map(y=>o(y)))).filter(Boolean).length,b=c.length;return I("addMultipleMatieres",{successCount:A,totalCount:b,successRate:`${(A/b*100).toFixed(1)}%`}),A===b}catch(c){return r.value=z(c,"addMultipleMatieres",{ids:d}),!1}}}}),yr=ge("subjects-active",()=>{const e=w(null),t=w(!1),r=w(null),s=M(()=>m=>{const h=Z(m);return h!==null&&e.value===h}),n=M(()=>e.value!==null),i=async m=>{const h=Z(m);if(!h)return I("setActiveMatiere",{id:m,error:de.INVALID_ID},"warn"),!1;if(e.value===h)return I("setActiveMatiere",{id:h,status:"already_active"}),!0;try{const d=e.value;return e.value=h,Y(B.ACTIVE_MATIERE,h),I("setActiveMatiere",{id:h,previousId:d,status:"local_update",authenticated:G()}),G()&&(t.value=!0,r.value=null,await qr(h),I("setActiveMatiere",{id:h,status:"backend_success"})),!0}catch(d){return e.value=previousId,previousId?Y(B.ACTIVE_MATIERE,previousId):localStorage.removeItem(B.ACTIVE_MATIERE),r.value=z(d,"setActiveMatiere",{matiereId:h}),!1}finally{t.value=!1}};return{activeMatiereId:e,isSyncing:t,lastSyncError:r,isActiveMatiere:s,hasActiveMatiere:n,setActiveMatiere:i,clearActiveMatiere:async()=>{try{const m=e.value;return e.value=null,localStorage.removeItem(B.ACTIVE_MATIERE),I("clearActiveMatiere",{previousId:m,status:"cleared"}),!0}catch(m){return r.value=z(m,"clearActiveMatiere"),!1}},loadActiveMatiereId:async()=>{try{const m=Qe(B.ACTIVE_MATIERE,null),h=m!==null?Z(m):null;e.value=h,I("loadActiveMatiereId",{loadedId:h,storedValue:m})}catch(m){r.value=z(m,"loadActiveMatiereId"),e.value=null}},getOrSetSmartActiveMatiere:async(m=[])=>{try{if(e.value)return e.value;if(m.length>0){const h=m[0];if(await i(h))return h}return I("getOrSetSmartActiveMatiere",{status:"no_matiere_available",selectedCount:m.length}),null}catch(h){return r.value=z(h,"getOrSetSmartActiveMatiere"),null}},setActiveMatiereId:m=>{const h=Z(m);e.value=h,h?Y(B.ACTIVE_MATIERE,h):localStorage.removeItem(B.ACTIVE_MATIERE),I("setActiveMatiereId",{id:h,status:"direct_set"})}}}),Sr=ge("subjects-sync",()=>{const e=w(!1),t=w(null),r=w(null),s=async p=>{if(!G())return I("loadPreferencesFromServer",{status:"user_not_authenticated",message:"Utilisateur non connecté, chargement depuis localStorage uniquement"}),!1;try{e.value=!0,t.value=null,I("loadPreferencesFromServer",{status:"starting",authenticated:!0});const m=await Br();return m?(p.selectedStore&&p.selectedStore.setSelectedMatieresIds(m.selectedIds||[]),p.favoritesStore&&p.favoritesStore.setFavoriteMatieresIds(m.favoriteIds||[]),p.activeStore&&p.activeStore.setActiveMatiereId(m.activeId||null),r.value=new Date().toISOString(),I("loadPreferencesFromServer",{status:"success",selectedCount:m.selectedIds?.length||0,favoritesCount:m.favoriteIds?.length||0,activeId:m.activeId}),!0):(I("loadPreferencesFromServer",{status:"no_data",message:"Aucune donnée reçue du backend"}),!1)}catch(m){return Ie(m,"loadPreferencesFromServer")||(t.value=z(m,"loadPreferencesFromServer")),!1}finally{e.value=!1}},n=async()=>{if(!G())return I("syncWithBackend",{status:"user_not_authenticated",message:"Synchronisation ignorée (utilisateur non connecté)"}),!0;try{e.value=!0,t.value=null,I("syncWithBackend",{status:"starting",authenticated:!0});const p=await Ur();return p&&(r.value=new Date().toISOString(),I("syncWithBackend",{status:"success",timestamp:r.value})),p}catch(p){return Ie(p,"syncWithBackend")?!0:(t.value=z(p,"syncWithBackend"),!1)}finally{e.value=!1}};return{isSyncing:e,lastSyncError:t,lastSyncTimestamp:r,loadPreferencesFromServer:s,syncWithBackend:n,initializeAfterLogin:async p=>{if(!G())return I("initializeAfterLogin",{status:"user_not_authenticated",message:"initializeAfterLogin appelé sans authentification"},"warn"),!1;try{return I("initializeAfterLogin",{status:"starting",message:"Initialisation après connexion..."}),await s(p)||(p.selectedStore?.selectedMatieresCount>0||p.favoritesStore?.favoriteMatieresCount>0)&&(I("initializeAfterLogin",{status:"syncing_local_to_backend",message:"Synchronisation des données locales vers le backend..."}),await n()),I("initializeAfterLogin",{status:"completed",message:"Initialisation après connexion terminée"}),!0}catch(m){return I("initializeAfterLogin",{status:"error",error:m.message},"error"),!1}},getSyncStatus:()=>({isSyncing:e.value,lastSyncError:t.value,lastSyncTimestamp:r.value,isAuthenticated:G(),canSync:G()&&!e.value}),clearSyncErrors:()=>{t.value=null,I("clearSyncErrors",{status:"errors_cleared"})},forceSync:async p=>{try{I("forceSync",{status:"starting",message:"Synchronisation forcée..."});const m=await s(p),h=await n(),d=m||h;return I("forceSync",{status:d?"success":"partial_failure",loadSuccess:m,syncSuccess:h}),d}catch(m){return t.value=z(m,"forceSync"),!1}}}}),xe=ge("subjects",()=>{const e=gr(),t=_r(),r=yr(),s=Sr(),n=M(()=>j(e.favoriteMatieresIds)),i=M(()=>j(t.selectedMatieresIds)),o=M(()=>j(r.activeMatiereId)),l=M(()=>j(e.favoriteMatieresCount)),u=M(()=>j(t.selectedMatieresCount)),p=M(()=>e.isFavoriteMatiere),m=M(()=>t.isSelectedMatiere),h=M(()=>r.isActiveMatiere),d=M(()=>j(r.hasActiveMatiere)),c=M(()=>j(e.canAddMoreFavorites)),E=M(()=>j(t.canAddMoreSelected)),A=M(()=>j(e.isSyncing)||j(t.isSyncing)||j(r.isSyncing)||j(s.isSyncing)),b=M(()=>j(e.lastSyncError)||j(t.lastSyncError)||j(r.lastSyncError)||j(s.lastSyncError)),y=async N=>await e.addFavoriteMatiere(N),f=async N=>await e.removeFavoriteMatiere(N),g=async N=>await e.toggleFavoriteMatiere(N),k=async N=>await t.addMatiereId(N),R=async N=>await t.removeMatiereId(N),P=async N=>await t.addMultipleMatieres(N),Q=async N=>await r.setActiveMatiere(N),ie=async()=>await r.clearActiveMatiere(),C=async(N=[])=>await r.getOrSetSmartActiveMatiere(N),_=async()=>{const N={selectedStore:t,favoritesStore:e,activeStore:r};return await s.loadPreferencesFromServer(N)};return{favoriteMatieresIds:n,selectedMatieresIds:i,activeMatiereId:o,favoriteMatieresCount:l,selectedMatieresCount:u,isFavoriteMatiere:p,isSelectedMatiere:m,isActiveMatiere:h,hasActiveMatiere:d,canAddMoreFavorites:c,canAddMoreSelected:E,isSyncing:A,lastSyncError:b,addFavoriteMatiere:y,removeFavoriteMatiere:f,toggleFavoriteMatiere:g,addMatiereId:k,removeMatiereId:R,addMultipleMatieres:P,setActiveMatiere:Q,clearActiveMatiere:ie,getOrSetSmartActiveMatiere:C,loadPreferencesFromServer:_,syncWithBackend:async()=>{const N={selectedStore:t,favoritesStore:e,activeStore:r};return await s.syncWithBackend(N)},initializeAfterLogin:async()=>{const N={selectedStore:t,favoritesStore:e,activeStore:r};return await s.initializeAfterLogin(N)},initialize:async()=>{try{I("initialize",{status:"starting"}),await Promise.all([e.loadFavoriteMatieresIds(),t.loadSelectedMatieresIds(),r.loadActiveMatiereId()]),G()&&await _(),I("initialize",{status:"success",favoritesCount:l.value,selectedCount:u.value,activeId:o.value})}catch(N){throw z(N,"initialize"),N}},clearAll:async()=>{try{await Promise.all([e.clearFavorites(),t.clearSelectedMatieres(),r.clearActiveMatiere()]),I("clearAll",{status:"success"})}catch(N){throw z(N,"clearAll"),N}},getSyncStatus:()=>s.getSyncStatus(),clearSyncErrors:()=>{e.lastSyncError=null,t.lastSyncError=null,r.lastSyncError=null,s.clearSyncErrors()},getStats:()=>({hasActiveMatiere:d.value,activeMatiereId:o.value,favoritesCount:l.value,selectedCount:u.value,canAddMoreFavorites:c.value,canAddMoreSelected:E.value,isSyncing:A.value,lastSyncError:b.value,favoriteMatieresIds:n.value,selectedMatieresIds:i.value,isAuthenticated:G(),timestamp:new Date().toISOString()}),loadFavoriteMatieresIds:async()=>await e.loadFavoriteMatieresIds(),loadSelectedMatieresIds:async()=>await t.loadSelectedMatieresIds(),loadActiveMatiereId:async()=>await r.loadActiveMatiereId(),stores:{favorites:e,selected:t,active:r,sync:s}}}),Ir=["Exercises","Quiz","Sheets","OnlineCourses"],Er={Exercises:e=>({name:"Notions",params:{matiereId:String(e)}}),Quiz:e=>({name:"QuizNotions",params:{matiereId:String(e)}}),Sheets:e=>({name:"Sheets",query:{matiereId:String(e)}}),OnlineCourses:e=>({name:"CourseNotions",params:{matiereId:String(e)}})},we=(e,t,r)=>{try{const s=xe();if(!Ir.includes(e.name)){Le(e,s),r();return}const n=e.params.matiereId||e.query.matiereId;if(n&&ft(n)){Le(e,s),r();return}const i=br(s);if(i){const o=Er[e.name];if(o){const l=o(i);r(l);return}}r()}catch{r()}},Le=(e,t)=>{try{const r=e.params.matiereId||e.query.matiereId;if(ft(r)){const s=Number(r);t.selectedMatieresIds.includes(s)||t.addMatiereId(s),t.setActiveMatiere(s)}}catch{}},br=e=>{try{if(e.activeMatiereId)return e.activeMatiereId;if(e.selectedMatieresIds.length>0){const t=e.selectedMatieresIds[0];return e.setActiveMatiere(t),t}return null}catch{return null}},ft=e=>e!=null&&!isNaN(Number(e))&&Number(e)>0,ye=(e,t,r)=>{try{const s=xe();e.name==="Notions"&&e.params.matiereId&&Le(e,s),r()}catch{r()}},Oe=(e,t,r)=>{try{const s=xe();["QuizNotions","QuizChapitres","ChapterQuiz"].includes(e.name)&&e.params.matiereId&&Le(e,s),r()}catch{r()}};function kr(e,t,r){const s=te();if(!s.isAuthenticated)return r();if(!s.niveau_pays&&e.name!=="Dashboard")return r({name:"Dashboard"});r()}const wr=["Cours","Exercises","Quiz","Sheets","Themes","Notions","Chapitres","ChapterExercises","ChapterQuiz","ThemeNotions","CourseChapitres","CourseChapitre","CourseNotions","QuizChapitres","QuizNotions","Progress","Calculator"];function Ar(e){return wr.includes(e)}const Tr=[{path:"/",name:"Home",component:()=>T(()=>import("./Home-D7xj57pj.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))},{path:"/dashboard",name:"Dashboard",component:()=>T(()=>import("./Dashboard-DpHGV42E.js"),__vite__mapDeps([12,13,2,3,4,8,14,15,9,16,17,18,10,19]))},{path:"/child/:childId",name:"ChildOverview",component:()=>T(()=>import("./ChildOverview-BUZPXzJQ.js"),__vite__mapDeps([20,2,8,9,10,21])),meta:{requiresAuth:!0}},{path:"/account",name:"Account",component:()=>T(()=>import("./Account-VGRkBfY2.js"),__vite__mapDeps([22,2,13,3,4,8,14,23,9,24,10,25])),meta:{requiresAuth:!0}},{path:"/pricing",name:"Pricing",component:()=>T(()=>import("./Pricing-BaLQwifk.js"),__vite__mapDeps([26,13,2,3,4,8,14,9,10,27])),meta:{requiresAuth:!0}},{path:"/exercises",name:"Exercises",component:()=>T(()=>import("./Exercises-DSkRsgaV.js"),__vite__mapDeps([28,13,2,3,4,8,14,6,7,29,30,9,10,31])),meta:{requiresAuth:!0},beforeEnter:we},{path:"/online-courses",name:"OnlineCourses",component:()=>T(()=>import("./OnlineCourses-azc8uJxL.js"),__vite__mapDeps([32,13,2,3,4,8,14,6,7,30,9,10,33])),meta:{requiresAuth:!0},beforeEnter:we},{path:"/quiz",name:"Quiz",component:()=>T(()=>import("./Quiz-BwPcLF5b.js"),__vite__mapDeps([34,13,2,3,4,8,14,6,7,30,9,10,35])),meta:{requiresAuth:!0},beforeEnter:we},{path:"/quiz/:matiereId",name:"QuizNotions",component:()=>T(()=>import("./QuizNotions-D5LLKARZ.js"),__vite__mapDeps([36,2,13,3,4,8,14,37,29,38,39,40,41,42,9,10,43])),meta:{requiresAuth:!0},beforeEnter:Oe},{path:"/quiz-chapitres/:notionId",name:"QuizChapitres",component:()=>T(()=>import("./QuizChapitres-B8OToHiM.js"),__vite__mapDeps([44,2,13,3,4,8,14,45,41,42,46,15,9,10])),meta:{requiresAuth:!0},beforeEnter:Oe},{path:"/quiz-exercices/:chapitreId",name:"ChapterQuiz",component:()=>T(()=>import("./ChapterQuiz-DS7reDZx.js"),__vite__mapDeps([47,2,13,3,4,8,14,17,15,9,18,10,41,42,48])),meta:{requiresAuth:!0},beforeEnter:Oe},{path:"/course-notions/:matiereId",name:"CourseNotions",component:()=>T(()=>import("./CourseNotions-CzPCwjax.js"),__vite__mapDeps([49,2,13,3,4,8,14,41,42,37,29,38,39,40,9,10,50])),meta:{requiresAuth:!0}},{path:"/course-chapitres/:notionId",name:"CourseChapitres",component:()=>T(()=>import("./CourseChapitres--JDm1Kq_.js"),__vite__mapDeps([51,2,13,3,4,8,14,45,41,42,46,15,9,10])),meta:{requiresAuth:!0}},{path:"/course/:chapitreId",name:"CourseChapitre",component:()=>T(()=>import("./CourseChapitre-BUGCvROq.js"),__vite__mapDeps([52,2,13,3,4,8,14,41,42,53,9,54,15,55,10,56])),meta:{requiresAuth:!0}},{path:"/cours/:matiereId/:notionId/:chapitreId",name:"Cours",component:()=>T(()=>import("./Cours-BdCnNox9.js"),__vite__mapDeps([57,2,13,3,4,8,14,41,42,55,9,10,58])),meta:{requiresAuth:!0}},{path:"/cours/:matiereId/:notionId/:chapitreId/:coursId",name:"CoursDetail",component:()=>T(()=>import("./CoursDetail-B2Seyp_V.js"),__vite__mapDeps([59,2,13,3,4,8,14,41,42,55,9,10,60])),meta:{requiresAuth:!0}},{path:"/sheets",name:"Sheets",component:()=>T(()=>import("./Sheets-BxnowFB3.js"),__vite__mapDeps([61,2,13,3,4,8,14,62,30,9,10,63])),meta:{requiresAuth:!0},beforeEnter:we},{path:"/about",name:"About",component:()=>T(()=>import("./About-DnRd6Pd3.js"),__vite__mapDeps([64,1,2,3,4,5,8,9,10,65]))},{path:"/cgv",name:"CGV",component:()=>T(()=>import("./CGV-D8ZaFSzS.js"),__vite__mapDeps([66,1,2,3,4,5,8,9,10,67]))},{path:"/cgu",name:"CGU",component:()=>T(()=>import("./CGU-JU3ftOVV.js"),__vite__mapDeps([68,1,2,3,4,5,8,9,10,69]))},{path:"/confidentialite",name:"Confidentialite",component:()=>T(()=>import("./Confidentialite-BONYaOoC.js"),__vite__mapDeps([70,1,2,3,4,5,8,9,10,71]))},{path:"/conditions",name:"Conditions",component:()=>T(()=>import("./Conditions-DWIkQwaL.js"),__vite__mapDeps([72,1,2,3,4,5,8,9,10,73]))},{path:"/notions/:matiereId",name:"Notions",component:()=>T(()=>import("./Notions-BUWsg0Fx.js"),__vite__mapDeps([74,2,13,3,4,8,14,75,29,76,41,42,9,10,77,39])),meta:{requiresAuth:!0},beforeEnter:ye},{path:"/themes/:matiereId",name:"Themes",component:()=>T(()=>import("./Themes-B8coCD2u.js"),__vite__mapDeps([78,2,13,3,4,8,14,37,29,38,39,40,41,42,9,10])),meta:{requiresAuth:!0},beforeEnter:ye},{path:"/theme-notions/:themeId",name:"ThemeNotions",component:()=>T(()=>import("./ThemeNotions-C-gpvsHi.js"),__vite__mapDeps([79,2,13,3,4,8,14,15,9,38,39,41,42,10,80])),meta:{requiresAuth:!0},beforeEnter:ye},{path:"/chapitres/:notionId",name:"Chapitres",component:()=>T(()=>import("./Chapitres-CMmI2pdK.js"),__vite__mapDeps([81,2,13,3,4,8,14,15,9,45,41,42,46,10,82])),meta:{requiresAuth:!0},beforeEnter:ye},{path:"/exercices/:chapitreId",name:"Exercices",component:()=>T(()=>import("./ChapterExercises-CSv8xORM.js"),__vite__mapDeps([83,9,2,13,3,4,8,14,15,16,84,85,41,42,53,54,10,86,87])),meta:{requiresAuth:!0},beforeEnter:ye},{path:"/exercice/:exerciceId",name:"ExerciceDetail",component:()=>T(()=>import("./ExerciceDetail-fbXYECF2.js"),__vite__mapDeps([88,9,2,15,16,13,3,4,8,14,84,85,41,42,53,54,10,89])),meta:{requiresAuth:!0}},{path:"/progress",name:"Progress",component:()=>T(()=>import("./Progress-DfYd-ZwF.js"),__vite__mapDeps([90,13,2,3,4,8,14,15,9,16,10,91,87])),meta:{requiresAuth:!0}},{path:"/calculator",name:"Calculator",component:()=>T(()=>import("./Calculator-f3uPDYse.js"),__vite__mapDeps([92,2,13,3,4,8,14,76,93,9,10,94]))},{path:"/test-filtrage-strict",name:"TestFiltrageStrict",component:()=>T(()=>import("./TestFiltrageStrict-n-55MnTu.js"),__vite__mapDeps([95,4,2,8,9,10,96]))},{path:"/admin",component:()=>T(()=>import("./AdminLayout-Cq7QHmND.js"),__vite__mapDeps([97,2,13,3,4,8,14,9,10,98])),meta:{requiresAdmin:!0},children:[{path:"matieres",name:"AdminMatieres",component:()=>T(()=>import("./AdminMatieres-FKtwAoQv.js"),__vite__mapDeps([99,2,4,100,101,102,8,9,10,103]))},{path:"themes",name:"AdminThemes",component:()=>T(()=>import("./AdminThemes-29L27Uxr.js"),__vite__mapDeps([104,2,29,100,105,101,102,8,9,10,106]))},{path:"notions",name:"AdminNotions",component:()=>T(()=>import("./AdminNotions-DSxsbTs7.js"),__vite__mapDeps([107,2,75,29,100,108,105,101,102,8,9,10,109]))},{path:"chapitres",name:"AdminChapitres",component:()=>T(()=>import("./AdminChapitres-BpoDPSNd.js"),__vite__mapDeps([110,2,15,9,101,102,8,10,111]))},{path:"exercices",name:"AdminExercices",component:()=>T(()=>import("./AdminExercices-BvX2qEzR.js"),__vite__mapDeps([112,2,15,9,108,105,101,102,84,16,85,8,10,113]))},{path:"exercices-plus",name:"AdminExercicesPlus",component:()=>T(()=>import("./AdminExercicesPlus-ChuDQ7GN.js"),__vite__mapDeps([114,2,15,9,16,84,85,8,10,115]))},{path:"cours",name:"AdminCours",component:()=>T(()=>import("./AdminCours-B0BwPO15.js"),__vite__mapDeps([116,2,55,15,9,101,102,8,10,117]))},{path:"cours-plus",name:"AdminCoursPlus",component:()=>T(()=>import("./AdminCoursPlus-Bia2KkUm.js"),__vite__mapDeps([118,2,15,9,55,8,10,119]))},{path:"sheets",name:"AdminSheets",component:()=>T(()=>import("./AdminSheets-DqI-4XwX.js"),__vite__mapDeps([120,2,62,15,9,4,8,10,121]))},{path:"quiz",name:"AdminQuiz",component:()=>T(()=>import("./AdminQuiz-BRXcmYIs.js"),__vite__mapDeps([122,2,17,15,9,101,102,8,10,123]))},{path:"quiz-plus",name:"AdminQuizPlus",component:()=>T(()=>import("./AdminQuizPlus-LZKrBpAp.js"),__vite__mapDeps([124,2,15,9,17,8,10,125]))},{path:"niveaux",name:"AdminNiveaux",component:()=>T(()=>import("./AdminNiveaux-DqaVj6Ry.js"),__vite__mapDeps([126,2,101,102,23,8,9,10,127]))},{path:"pays",name:"AdminPays",component:()=>T(()=>import("./AdminPays-Dt4doxSL.js"),__vite__mapDeps([128,2,8,9,10,129]))},{path:"",redirect:{name:"AdminMatieres"}}]},{path:"/:pathMatch(.*)*",name:"NotFound",component:()=>T(()=>import("./NotFound-Cs30MZpo.js"),__vite__mapDeps([130,2,8,9,10,131]))}],Ke=yt({history:St(),routes:Tr,scrollBehavior(){return{top:0}}});Ke.beforeEach(async(e,t,r)=>{const s=localStorage.getItem("access_token");localStorage.getItem("refresh_token");const n=te();let i=n.isAuthenticated,o=n.isAdmin;const l=u=>{if(!u)return!0;try{const p=JSON.parse(atob(u.split(".")[1])),m=Date.now()/1e3;return p.exp<m}catch{return!0}};if(s&&l(s)&&(localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),n.clearUser(),i=!1,o=!1),s&&!l(s)&&!i)try{await n.fetchUser(),i=n.isAuthenticated,o=n.isAdmin}catch{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),n.clearUser(),i=!1,o=!1}(e.meta.requiresAuth||e.name==="Dashboard")&&!i?r({name:"Home"}):e.meta.requiresAdmin&&(!i||!o)?r({name:"Home"}):i&&(e.name==="Home"||e.path==="/")?r({name:"Dashboard"}):i&&Ar(e.name)?kr(e,t,r):r()});function Mr(){let e="http://localhost:8000".trim();return e?(/^https:\/\/(127\.0\.0\.1|localhost)(:\d+)?/i.test(e)&&(e=e.replace(/^https:/i,"http:")),e.replace(/\/+$/,"")):"https://optitab-backend.onrender.com"}const se={BASE_URL:Mr(),REFRESH_ENDPOINT:"/api/users/token/refresh/",REQUEST_TIMEOUT:8e3,REFRESH_TIMEOUT:4e3,MAX_RETRIES:1,RETRY_DELAY:500,LOGGING:{ENABLED:!1,LEVEL:"error",SENSITIVE_FIELDS:["password","token","refresh","access"]},DEFAULT_HEADERS:{"Content-Type":"application/json",Accept:"application/json"}};class x{static isDevelopment(){return!1}static isProduction(){return!0}static log(t,r,s={}){if(!this.isDevelopment())return;const n=this.sanitizeData(s),o={timestamp:new Date().toISOString(),level:t,message:r,data:n,source:"api-client"};switch(t){case"error":break;case"warn":break;case"info":break;default:}}static sanitizeData(t){if(!t||typeof t!="object")return t;const r={...t},s=se.LOGGING.SENSITIVE_FIELDS,n=i=>{for(const o in i)if(i.hasOwnProperty(o)){const l=o.toLowerCase();s.some(u=>l.includes(u))?i[o]="[MASKED]":typeof i[o]=="object"&&i[o]!==null&&n(i[o])}};return n(r),r}static error(t,r=null){if(this.isProduction())return;const s={message:r?.message,status:r?.response?.status,statusText:r?.response?.statusText,url:r?.config?.url,method:r?.config?.method};this.isDevelopment()&&(s.stack=r?.stack),this.log("error",t,s)}static warn(t,r={}){this.log("warn",t,r)}static info(t,r={}){this.log("info",t,r)}static debug(t,r={}){this.isDevelopment()&&this.log("debug",t,r)}static isLoggingEnabled(){return se.LOGGING.ENABLED}static secureLog(t,r,s={}){if(!this.isLoggingEnabled())return;const n=["debug","info","warn","error"],i=n.indexOf(t),o=n.indexOf(se.LOGGING.LEVEL);i>=o&&this.log(t,r,s)}}class Cr{constructor(){this.isRefreshing=!1,this.refreshSubscribers=[],this.refreshPromise=null}getAccessToken(){return localStorage.getItem("access_token")}getRefreshToken(){return localStorage.getItem("refresh_token")}setTokens(t,r=null){t&&localStorage.setItem("access_token",t),r&&localStorage.setItem("refresh_token",r)}clearTokens(){localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}isTokenExpired(t){if(!t)return!0;try{const r=JSON.parse(atob(t.split(".")[1])),s=Date.now()/1e3;return r.exp<s}catch(r){return x.warn("Impossible de décoder le token JWT",{error:r.message}),!0}}async refreshAccessToken(){if(this.isRefreshing)return this.refreshPromise;this.isRefreshing=!0,this.refreshPromise=this._performRefresh();try{return await this.refreshPromise}finally{this.isRefreshing=!1,this.refreshPromise=null}}async _performRefresh(t=3){const r=this.getRefreshToken();if(!r)throw new Error("Aucun token de rafraîchissement disponible");let s;for(let n=0;n<=t;n++)try{x.secureLog("info",`Tentative de rafraîchissement du token (essai ${n+1}/${t+1})`);const i=await it.post(`${se.BASE_URL}${se.REFRESH_ENDPOINT}`,{refresh:r},{timeout:se.REFRESH_TIMEOUT,headers:{"Content-Type":"application/json"}}),{access:o,refresh:l}=i.data;return this.setTokens(o,l),x.secureLog("info","Token rafraîchi avec succès"),o}catch(i){if(s=i,x.error(`Échec du rafraîchissement du token (essai ${n+1})`,i),i.response?.status>=400&&i.response?.status<500&&i.code!=="ECONNABORTED")break;if(n<t){const o=Math.min(1e3*Math.pow(2,n),1e4);x.secureLog("info",`Nouvelle tentative dans ${o}ms`),await this._sleep(o)}}throw this.clearTokens(),s}_sleep(t){return new Promise(r=>setTimeout(r,t))}onRefreshed(t){this.refreshSubscribers.forEach(r=>r(t)),this.refreshSubscribers=[]}addRefreshSubscriber(t){this.refreshSubscribers.push(t)}shouldRefreshToken(t,r=5){if(!t)return!1;try{const s=JSON.parse(atob(t.split(".")[1])),n=Date.now()/1e3,i=r*60;return s.exp-n<=i}catch(s){return x.warn("Impossible de vérifier l'expiration du token",{error:s.message}),!1}}async proactiveRefresh(){const t=this.getAccessToken(),r=this.getRefreshToken();if(!t||!r)return!1;if(this.shouldRefreshToken(t,5)){x.secureLog("info","Rafraîchissement proactif du token");try{return await this.refreshAccessToken(),!0}catch(s){return x.error("Échec du rafraîchissement proactif",s),!1}}return!1}}class pt{static async retryRequest(t,r=se.MAX_RETRIES){let s;for(let n=0;n<=r;n++)try{return await t()}catch(i){if(s=i,this.shouldNotRetry(i))throw i;if(n<r){const o=this.calculateDelay(n);x.secureLog("warn",`Tentative ${n+1} échouée, nouvelle tentative dans ${o}ms`,{error:i.message,status:i.response?.status}),await this.sleep(o)}}throw s}static shouldNotRetry(t){const r=t.response?.status;return r>=400&&r<500&&r!==429?!0:(t.code==="ECONNABORTED",!1)}static calculateDelay(t){return Math.min(se.RETRY_DELAY*Math.pow(2,t),1e4)}static sleep(t){return new Promise(r=>setTimeout(r,t))}}class Be{static logout(t="Session expirée"){x.secureLog("info","Déconnexion utilisateur",{reason:t}),V.clearTokens();try{te().clearUser()}catch(r){x.secureLog("warn","Erreur lors du nettoyage du store utilisateur",{error:r.message})}Ke.push("/")}}const V=new Cr;let _e=null;const L=it.create({baseURL:se.BASE_URL,timeout:se.REQUEST_TIMEOUT,headers:se.DEFAULT_HEADERS,withCredentials:!0});L.interceptors.request.use(e=>{const t=V.getAccessToken();return t&&!V.isTokenExpired(t)&&(e.headers.Authorization=`Bearer ${t}`,x.secureLog("info","Token ajouté à la requête",{url:e.url,method:e.method})),e},e=>(x.error("Erreur dans l'intercepteur de requête",e),Promise.reject(e)));L.interceptors.response.use(e=>(x.secureLog("info","Requête réussie",{url:e.config.url,method:e.config.method,status:e.status}),e),async e=>{const{config:t,response:r}=e;if(t?.url?.includes("/api/users/notifications/")&&r?.status===404?x.debug("Notification introuvable (404)",{url:t.url,method:t.method,status:r.status}):x.error("Erreur de requête",e),(r?.status===401||r?.status===403)&&!t.__isRetryRequest){const n=!!V.getAccessToken(),i=!!V.getRefreshToken(),o=r?.data?.code==="token_not_valid"||r?.data?.detail?.includes("token")||r?.data?.messages?.some(u=>u?.token?.includes("expired")),l=r?.data?.detail?.includes("refresh")||r?.data?.messages?.some(u=>u?.token?.includes("refresh"));if(n&&i&&(o||r?.status===401))return x.secureLog("info","Erreur de token détectée, tentative de rafraîchissement",{status:r.status,url:t.url,isTokenExpiredError:o,isRefreshTokenError:l}),rt(t,e);if(r?.status===403){if(x.secureLog("warn","Erreur 403 - Accès refusé",{url:t.url,hasAccessToken:n,hasRefreshToken:i}),n&&i&&!t.__isRetryRequest)return rt(t,e)}else x.secureLog("warn",`Erreur ${r?.status} sans tokens valides ou erreur d'authentification`,{url:t.url,status:r?.status,hasAccessToken:n,hasRefreshToken:i})}return!r&&(e.code==="ECONNABORTED"||e.code==="NETWORK_ERROR")?Fr(t):Promise.reject(e)});async function rt(e,t){try{if(!V.getRefreshToken())return x.secureLog("warn","Aucun token de rafraîchissement disponible"),Be.logout("Aucun token de rafraîchissement disponible"),Promise.reject(t);x.secureLog("info","Tentative de rafraîchissement du token",{url:e.url});const s=await V.refreshAccessToken();if(!s)throw new Error("Aucun nouveau token reçu");return V.onRefreshed(s),e.headers.Authorization=`Bearer ${s}`,e.__isRetryRequest=!0,x.secureLog("info","Requête retry avec le nouveau token",{url:e.url}),L(e)}catch(r){x.error("Échec du rafraîchissement du token",r);const s=r.response?.status;let n="Échec du rafraîchissement du token";return s===401?n="Token de rafraîchissement invalide ou expiré":s===400?n="Requête de rafraîchissement malformée":r.response||(n="Erreur réseau lors du rafraîchissement"),Be.logout(n),Promise.reject(t)}}async function Fr(e,t){return pt.retryRequest(()=>(x.secureLog("info","Retry de la requête réseau",{url:e.url}),L(e)))}const Ee={async request(e){return pt.retryRequest(()=>L(e))},async cachedGet(e,{params:t={},ttl:r=3e5,signal:s}={}){const n=c=>c?Object.keys(c).sort().map(b=>`${encodeURIComponent(b)}=${encodeURIComponent(c[b]??"")}`).join("&"):"";let i="n",o="p";try{const c=te();i=c?.niveau_pays?.id??"n",o=c?.pays?.id??"p"}catch{}const l=typeof localStorage<"u"&&localStorage.getItem("access_token")||"",u=l?l.slice(0,12):"anon",p=`GET|${e}|${n(t)}|${i}|${o}|${u}`;window.__API_RESPONSE_CACHE__||(window.__API_RESPONSE_CACHE__=new Map),window.__API_INFLIGHT__||(window.__API_INFLIGHT__=new Map);const m=Date.now(),h=window.__API_RESPONSE_CACHE__.get(p);if(h&&m-h.t<r)return h.r;if(window.__API_INFLIGHT__.has(p))return window.__API_INFLIGHT__.get(p);const d=L.get(e,{params:t,signal:s}).then(c=>(window.__API_RESPONSE_CACHE__.set(p,{t:Date.now(),r:c}),window.__API_INFLIGHT__.delete(p),c)).catch(c=>{throw window.__API_INFLIGHT__.delete(p),c});return window.__API_INFLIGHT__.set(p,d),d},isAuthenticated(){const e=V.getAccessToken();return e&&!V.isTokenExpired(e)},async refreshToken(){return V.refreshAccessToken()},logout(e){Be.logout(e)},getStats(){return{isRefreshing:V.isRefreshing,hasValidToken:this.isAuthenticated(),refreshSubscribersCount:V.refreshSubscribers.length}},cleanExpiredTokens(){const e=V.getAccessToken(),t=V.getRefreshToken();let r=!1;return e&&V.isTokenExpired(e)&&(x.secureLog("info","Nettoyage du token d'accès expiré"),localStorage.removeItem("access_token"),r=!0),t&&V.isTokenExpired(t)&&(x.secureLog("info","Nettoyage du token de rafraîchissement expiré"),localStorage.removeItem("refresh_token"),r=!0),r&&x.secureLog("info","Tokens expirés nettoyés automatiquement"),r},hasValidTokens(){const e=V.getAccessToken(),t=V.getRefreshToken(),r=e&&!V.isTokenExpired(e),s=t&&!V.isTokenExpired(t);return{hasAccess:r,hasRefresh:s,hasAnyValid:r||s}},startTokenMonitoring(){_e&&clearInterval(_e),_e=setInterval(async()=>{try{this.cleanExpiredTokens(),await V.proactiveRefresh()}catch(e){x.error("Erreur lors de la surveillance des tokens",e)}},3e4),x.secureLog("info","Surveillance automatique des tokens démarrée")},stopTokenMonitoring(){_e&&(clearInterval(_e),_e=null,x.secureLog("info","Surveillance automatique des tokens arrêtée"))},async proactiveTokenRefresh(){return V.proactiveRefresh()}},gn=Object.freeze(Object.defineProperty({__proto__:null,apiUtils:Ee,default:L},Symbol.toStringTag,{value:"Module"}));class st{constructor(t){this.endpoint=t}async getAll(t={}){try{return(await L.get(this.endpoint,{params:t})).data}catch(r){throw this.handleError("récupération",r),r}}async getById(t){try{return(await L.get(`${this.endpoint}${t}/`)).data}catch(r){throw this.handleError(`récupération de l'élément ${t}`,r),r}}async create(t){try{return(await L.post(this.endpoint,t)).data}catch(r){throw this.handleError("création",r),r}}async update(t,r){try{return(await L.patch(`${this.endpoint}${t}/`,r)).data}catch(s){throw this.handleError(`mise à jour de l'élément ${t}`,s),s}}async delete(t){try{await L.delete(`${this.endpoint}${t}/`)}catch(r){throw this.handleError(`suppression de l'élément ${t}`,r),r}}async getByFilter(t={}){return this.getAll(t)}async getByRelation(t,r,s={}){return this.getAll({...s,[t]:r})}async getHierarchical(t,r){try{return(await L.get(`${this.endpoint}${t}/${r}/`)).data}catch(s){throw this.handleError(`récupération hiérarchique ${r}`,s),s}}handleError(t,r){}async getHierarchy(t,r){try{const[s,n]=await Promise.all([this.getById(t),this.getHierarchical(t,r)]);return{parent:s,children:n}}catch(s){throw this.handleError(`récupération de la hiérarchie ${t}`,s),s}}}const ht={createEndpoint(e){return new st(e)},createCRUDFunctions(e){const t=new st(e);return{getAll:r=>t.getAll(r),getById:r=>t.getById(r),create:r=>t.create(r),update:(r,s)=>t.update(r,s),delete:r=>t.delete(r),getByFilter:r=>t.getByFilter(r),getByRelation:(r,s,n)=>t.getByRelation(r,s,n),getHierarchical:(r,s)=>t.getHierarchical(r,s),getHierarchy:(r,s)=>t.getHierarchy(r,s)}}},ce=()=>(ce._instance||(ce._instance=ht.createCRUDFunctions("/api/pays/")),ce._instance),_n=e=>ce().getAll(e),yn=e=>ce().create(e),Sn=(e,t)=>ce().update(e,t),In=e=>ce().delete(e),Lr=(e={})=>ce().getByFilter({...e,est_actif:!0}),Me=()=>(Me._instance||(Me._instance=ht.createCRUDFunctions("/api/niveaux/")),Me._instance),En=e=>Me().getAll(e),Rr=e=>ce().getHierarchical(e,"niveaux"),xr=()=>L.get("/api/users/preferences/"),Pr=e=>L.post("/api/users/preferences/bulk-update/",e),Or=e=>L.post(`/api/users/favorites/add/${e}/`),Nr=e=>L.delete(`/api/users/favorites/remove/${e}/`),Dr=e=>L.post(`/api/users/selected/add/${e}/`),Vr=e=>L.delete(`/api/users/selected/remove/${e}/`),qr=e=>L.post(`/api/users/selected/set-active/${e}/`),Ur=async()=>{try{const e=JSON.parse(localStorage.getItem("selected-matieres-ids")||"[]"),t=JSON.parse(localStorage.getItem("favorite-matieres-ids")||"[]"),r=localStorage.getItem("active-matiere-id"),s={};return t.length>0&&(s.favorite_matiere_ids=t),e.length>0&&(s.selected_matieres=e.map((n,i)=>({matiere_id:parseInt(n),order:i,is_active:parseInt(n)===parseInt(r)}))),r&&(s.active_matiere_id=parseInt(r)),Object.keys(s).length>0&&await Pr(s),!0}catch{return!1}},Br=async()=>{try{const{data:e}=await xr(),t=e.favorite_matieres?.map(n=>n.matiere.id)||[],r=e.selected_matieres||[],s=e.active_matiere_id;return localStorage.setItem("favorite-matieres-ids",JSON.stringify(t)),localStorage.setItem("selected-matieres-ids",JSON.stringify(r.map(n=>n.matiere.id))),s?localStorage.setItem("active-matiere-id",s.toString()):localStorage.removeItem("active-matiere-id"),{favoriteIds:t,selectedIds:r.map(n=>n.matiere.id),activeId:s,selectedMatieres:r}}catch{return null}},zr=()=>L.get("/api/users/me/"),bn=e=>L.patch("/api/users/me/update/",e),jr=(e,t)=>{let r,s;return typeof e=="object"&&e!==null?(r=e.pays_id??e.pays,s=e.niveau_id??e.niveau_pays_id??e.niveau):(r=e,s=t),L.patch("/api/users/me/pays-niveau/",{pays_id:r,niveau_pays_id:s})},Gr=()=>L.get("/api/users/me/gamification/"),kn=(e={})=>{const t=e.scope||"global",r=e.limit||20;return L.get("/api/users/leaderboard/",{params:{scope:t,limit:r}})},wn=()=>L.get("/api/users/me/overview/"),An=()=>L.get("/api/users/me/children/"),Tn=e=>L.post("/api/users/me/children/add/",e),Mn=e=>L.delete(`/api/users/me/children/${e}/remove/`),$r=e=>L.post("/api/users/me/update-xp/",e),We=(e={})=>L.get("/api/users/notifications/",{params:e}),vt=async e=>{try{return await L.patch(`/api/users/notifications/${e}/`,{read:!0})}catch(t){return{success:!1,error:t.response?.status||"unknown"}}},Xr=async()=>{const t=(await We({unread:1}))?.data||[];return{count:(await Promise.allSettled(t.map(n=>vt(n.id)))).filter(n=>n.status==="fulfilled"&&n.value.success!==!1).length}},Hr=async e=>{try{return await L.delete(`/api/users/notifications/${e}/`)}catch(t){return{success:!1,error:t.response?.status||"unknown"}}},Cn=async()=>{const t=(await We())?.data||[];return{count:(await Promise.allSettled(t.map(n=>Hr(n.id)))).filter(n=>n.status==="fulfilled"&&n.value.success!==!1).length}},Qr=e=>L.post("/api/users/register/",e,{timeout:2e4}),Kr=e=>({first_name:e.firstName?.trim(),last_name:e.lastName?.trim(),email:e.email?.trim().toLowerCase(),password:e.password,password2:e.confirmPassword}),Wr=e=>L.post("/api/users/login/",{email:(e?.email||"").trim().toLowerCase(),password:e?.password},{timeout:2e4}),Jr=e=>({email:e.email?.trim().toLowerCase(),password:e.password}),Yr=e=>L.post("/api/users/verify-code/",e,{timeout:15e3}),Fn=e=>L.post("/api/users/logout/",e,{timeout:1e4}),Zr=e=>L.post("/api/users/auth/google/",e,{timeout:2e4}),Ae=w([]);let es=1;function Je(){const e=(o,l="info",u=5e3)=>{const p=es++,m={id:p,message:o,type:l,visible:!0};return Ae.value.push(m),setTimeout(()=>{t(p)},u),p},t=o=>{const l=Ae.value.findIndex(u=>u.id===o);l>-1&&Ae.value.splice(l,1)};return{toasts:Ae,showToast:e,removeToast:t,success:(o,l)=>e(o,"success",l),error:(o,l)=>e(o,"error",l),warning:(o,l)=>e(o,"warning",l),info:(o,l)=>e(o,"info",l)}}function ts(){const e=Ge(),t=te(),{closeModal:r}=$e(),{showToast:s}=Je(),n=w(!1),i="151259305565-a03g822b5qhoaia71gju8hl9cbnu9lp4.apps.googleusercontent.com",o=()=>{typeof google<"u"&&google.accounts.id.initialize({client_id:i,callback:l,context:"signin",ux_mode:"popup",auto_select:!1,cancel_on_tap_outside:!0,use_fedcm_for_prompt:!0})},l=async h=>{try{n.value=!0;const d=await Zr({access_token:h.credential}),{user:c,access:E,refresh:A}=d.data.data;localStorage.setItem("access_token",E),localStorage.setItem("refresh_token",A),t.setUser(c),await t.fetchUser(),r(re.LOGIN),e.push("/dashboard"),s("Connexion réussie !","success")}catch(d){const c=d.response?.data?.message||"Erreur de connexion";s(c,"error")}finally{n.value=!1}},u=()=>{typeof google<"u"?google.accounts.id.prompt():s("Google Sign-In non disponible","error")},p=()=>new Promise((h,d)=>{if(typeof google<"u"){h();return}const c=document.createElement("script");c.src="https://accounts.google.com/gsi/client",c.async=!0,c.defer=!0,c.onload=()=>{h()},c.onerror=()=>{d(new Error("Failed to load Google script"))},document.head.appendChild(c)});return{isGoogleLoading:n,signInWithGoogle:u,setupGoogleSignIn:async()=>{try{await p(),o()}catch{}},loadGoogleScript:p,initializeGoogleSignIn:o}}const rs={name:"LoginModal",components:{Modal:ke,DynamicForm:He},props:{isOpen:{type:Boolean,default:!1}},emits:["close","login","signup","forgot-password"],setup(e,{emit:t}){const r=Ge(),s=te(),{closeModal:n}=$e(),{setupGoogleSignIn:i,signInWithGoogle:o,isGoogleLoading:l}=ts(),{config:u,formData:p,isSubmitting:m,isValid:h,getFieldError:d,setFieldTouched:c,submitForm:E,getFieldConfig:A,getFieldNames:b}=Xe("LOGIN"),y=b(),f=w("");be(async()=>{await i();try{const _=localStorage.getItem("remember_me");if(_){const F=JSON.parse(_),$=Date.now();F?.expiresAt&&$<F.expiresAt&&F?.email&&F?.password?(p.email=F.email,p.password=F.password,p.rememberMe=!0):F?.expiresAt&&$>=F.expiresAt&&localStorage.removeItem("remember_me")}}catch{}});const g=()=>{f.value="",t("close")},k=()=>{f.value=""},R=async()=>{await E(P)},P=async _=>{const F=Jr(_);try{const $=await Wr(F),oe=$.data.data||$.data,le=oe.access,me=oe.refresh;if(!le||!me)throw new Error("Tokens d'authentification manquants");localStorage.setItem("access_token",le),localStorage.setItem("refresh_token",me);const D=oe||$.data;(D.user_id||D.id)&&s.setUser(D);try{if(_.rememberMe){const J={email:_.email,password:_.password,expiresAt:Date.now()+2592e6};localStorage.setItem("remember_me",JSON.stringify(J))}else localStorage.removeItem("remember_me")}catch{}t("login",{email:_.email}),g(),n(re.LOGIN),r.push("/dashboard"),s.fetchUser().catch(J=>{})}catch($){const oe=$.response?.data?.detail||$.response?.data?.error;f.value=oe||"Erreur lors de la connexion"}};return{config:u,fieldNames:y,socialProviders:ct,formData:p,isSubmitting:m,isValid:h,isGoogleLoading:l,getFieldError:d,setFieldTouched:c,getFieldConfig:A,handleClose:g,handleFormSubmit:R,handleSocialLogin:_=>{_==="google"?o():t("login",{provider:_})},handleSignUp:()=>{t("signup")},handleForgotPassword:()=>{t("forgot-password")},loginError:f,handleInput:k}}},ss={class:"signup-link signup-link-top"},os={class:"form-options"},ns={key:0,class:"login-error"},as={class:"social-login"},is={class:"social-btn-group"},ls=["onClick","disabled"],cs=["src","alt"];function us(e,t,r,s,n,i){const o=W("DynamicForm"),l=W("Modal");return v(),ee(l,{"is-open":r.isOpen,title:"Connexion",size:"small",onClose:s.handleClose},{default:ae(()=>[a("div",ss,[a("p",null,[t[2]||(t[2]=pe(" Pas encore de compte ? ")),a("button",{type:"button",class:"signup-btn",onClick:t[0]||(t[0]=(...u)=>s.handleSignUp&&s.handleSignUp(...u))}," Créer un compte ")])]),U(o,{"field-names":s.fieldNames,"get-field-config":s.getFieldConfig,"form-data":s.formData,"is-submitting":s.isSubmitting,"is-valid":s.isValid,"get-field-error":s.getFieldError,"set-field-touched":s.setFieldTouched,"submit-text":s.config.submitText,onSubmit:s.handleFormSubmit,onInput:s.handleInput},{"form-content":ae(()=>[a("div",os,[a("button",{type:"button",class:"forgot-password-btn",onClick:t[1]||(t[1]=(...u)=>s.handleForgotPassword&&s.handleForgotPassword(...u))}," Mot de passe oublié ? ")])]),_:1},8,["field-names","get-field-config","form-data","is-submitting","is-valid","get-field-error","set-field-touched","submit-text","onSubmit","onInput"]),s.loginError?(v(),S("div",ns,O(s.loginError),1)):q("",!0),t[3]||(t[3]=a("div",{class:"divider"},[a("span",{class:"divider-line"}),a("span",{class:"divider-text"},"ou"),a("span",{class:"divider-line"})],-1)),a("div",as,[a("div",is,[(v(!0),S(he,null,ve(s.socialProviders,u=>(v(),S("button",{key:u.key,class:K(["social-btn",u.btnClass]),onClick:()=>s.handleSocialLogin(u.key),disabled:s.isSubmitting||u.key==="google"&&s.isGoogleLoading},[a("img",{src:u.icon,alt:u.key,class:"social-icon"},null,8,cs),pe(" "+O(u.label),1)],10,ls))),128))])])]),_:1,__:[3]},8,["is-open","onClose"])}const ds=H(rs,[["render",us],["__scopeId","data-v-5a3a77fd"]]),ms={name:"PasswordStrength",props:{password:{type:String,required:!0}},computed:{rules(){const e=this.password||"";return[{key:"length",label:"8+ caractères",passed:e.length>=8},{key:"uppercase",label:"Majuscule",passed:/[A-Z]/.test(e)},{key:"lowercase",label:"Minuscule",passed:/[a-z]/.test(e)},{key:"digit",label:"Chiffre",passed:/\d/.test(e)},{key:"special",label:"Caractère spécial",passed:/[^A-Za-z0-9]/.test(e)}]}}},fs={class:"password-strength"},ps={class:"icon"},hs={key:0,width:"16",height:"16",fill:"none",viewBox:"0 0 16 16"},vs={key:1,width:"16",height:"16",fill:"none",viewBox:"0 0 16 16"},gs={class:"label"};function _s(e,t,r,s,n,i){return v(),S("div",fs,[(v(!0),S(he,null,ve(i.rules,o=>(v(),S("div",{key:o.key,class:K(["strength-box",{passed:o.passed}])},[a("span",ps,[o.passed?(v(),S("svg",hs,t[0]||(t[0]=[a("path",{d:"M4 8.5l3 3 5-5",stroke:"#10b981","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))):(v(),S("svg",vs,t[1]||(t[1]=[a("circle",{cx:"8",cy:"8",r:"7",stroke:"#d1d5db","stroke-width":"2"},null,-1)])))]),a("span",gs,O(o.label),1)],2))),128))])}const ys=H(ms,[["render",_s],["__scopeId","data-v-5e920371"]]),Ss={name:"RegisterModal",components:{Modal:ke,DynamicForm:He,FormField:lt,PasswordStrength:ys},props:{isOpen:{type:Boolean,default:!1}},emits:["close","register","login","terms","privacy"],setup(e,{emit:t}){const{config:r,formData:s,isSubmitting:n,isValid:i,getFieldError:o,setFieldTouched:l,submitForm:u,getFieldConfig:p,getFieldNames:m}=Xe("REGISTER"),h=te(),d=["firstName","lastName"],c=m().filter(C=>!["firstName","lastName","acceptTerms","newsletter"].includes(C)),E=w(""),A=w("");function b(C,_="error"){E.value=C,A.value=_,setTimeout(()=>{E.value="",A.value=""},4e3)}const y=()=>{t("close")},f=async()=>{const C=await u(g)},g=async C=>{const _=Kr(C);try{const F=await Qr(_);F&&F.data&&h.setUser(F.data),b("Compte créé avec succès!","success"),t("register",{..._}),setTimeout(y,1200)}catch(F){const $=F.response?.data?Object.entries(F.response.data).map(([oe,le])=>`${oe}: ${Array.isArray(le)?le.join(", "):le}`).join(" | "):F.message;b($||"Erreur lors de la création du compte","error")}};return{config:r,formData:s,isSubmitting:n,isValid:i,getFieldError:o,setFieldTouched:l,submitForm:u,getFieldConfig:p,getFieldNames:m,nameFields:d,mainFieldNames:c,socialProviders:ct,handleClose:y,handleFormSubmit:f,handleFieldBlur:({fieldName:C,event:_})=>{l(C)},handleSocialRegister:C=>{t("register",{provider:C})},handleLogin:()=>{t("login")},handleTermsClick:()=>{t("terms")},handlePrivacyClick:()=>{t("privacy")},feedbackMessage:E,feedbackType:A,showFeedback:b}}},Is={class:"login-link login-link-top"},Es={class:"top-fields"},bs={class:"name-fields"},ks={key:0,class:"password-strength-row"},ws={class:"terms-section"},As={class:"newsletter-section"},Ts={class:"social-register"},Ms={class:"social-btn-group"},Cs=["onClick","disabled"],Fs=["src","alt"];function Ls(e,t,r,s,n,i){const o=W("FormField"),l=W("PasswordStrength"),u=W("DynamicForm"),p=W("Modal");return v(),ee(p,{"is-open":r.isOpen,title:"Créer un compte",size:"medium",onClose:s.handleClose},{default:ae(()=>[a("div",Is,[a("p",null,[t[5]||(t[5]=pe(" Déjà un compte ? ")),a("button",{type:"button",class:"login-btn",onClick:t[0]||(t[0]=(...m)=>s.handleLogin&&s.handleLogin(...m))}," Se connecter ")])]),a("div",Es,[a("div",bs,[U(o,{"field-name":"firstName","field-config":s.getFieldConfig("firstName"),modelValue:s.formData.firstName,"onUpdate:modelValue":t[1]||(t[1]=m=>s.formData.firstName=m),disabled:s.isSubmitting,"get-field-error":s.getFieldError,onBlur:s.handleFieldBlur},null,8,["field-config","modelValue","disabled","get-field-error","onBlur"]),U(o,{"field-name":"lastName","field-config":s.getFieldConfig("lastName"),modelValue:s.formData.lastName,"onUpdate:modelValue":t[2]||(t[2]=m=>s.formData.lastName=m),disabled:s.isSubmitting,"get-field-error":s.getFieldError,onBlur:s.handleFieldBlur},null,8,["field-config","modelValue","disabled","get-field-error","onBlur"])])]),U(u,{class:"register-dynamic-form","field-names":s.mainFieldNames,"get-field-config":s.getFieldConfig,"form-data":s.formData,"is-submitting":s.isSubmitting,"is-valid":s.isValid,"get-field-error":s.getFieldError,"set-field-touched":s.setFieldTouched,"submit-text":s.config.submitText,onSubmit:s.handleFormSubmit},{"form-content":ae(()=>[s.mainFieldNames.includes("password")?(v(),S("div",ks,[U(l,{password:s.formData.password},null,8,["password"])])):q("",!0),a("div",ws,[U(o,{"field-name":"acceptTerms","field-config":s.getFieldConfig("acceptTerms"),modelValue:s.formData.acceptTerms,"onUpdate:modelValue":t[3]||(t[3]=m=>s.formData.acceptTerms=m),disabled:s.isSubmitting,"get-field-error":s.getFieldError,onBlur:s.handleFieldBlur},null,8,["field-config","modelValue","disabled","get-field-error","onBlur"])]),a("div",As,[U(o,{"field-name":"newsletter","field-config":s.getFieldConfig("newsletter"),modelValue:s.formData.newsletter,"onUpdate:modelValue":t[4]||(t[4]=m=>s.formData.newsletter=m),disabled:s.isSubmitting,"get-field-error":s.getFieldError,onBlur:s.handleFieldBlur},null,8,["field-config","modelValue","disabled","get-field-error","onBlur"])])]),_:1},8,["field-names","get-field-config","form-data","is-submitting","is-valid","get-field-error","set-field-touched","submit-text","onSubmit"]),s.feedbackMessage?(v(),S("div",{key:0,class:K(["register-feedback",s.feedbackType])},O(s.feedbackMessage),3)):q("",!0),t[6]||(t[6]=a("div",{class:"divider"},[a("span",{class:"divider-line"}),a("span",{class:"divider-text"},"ou"),a("span",{class:"divider-line"})],-1)),a("div",Ts,[a("div",Ms,[(v(!0),S(he,null,ve(s.socialProviders,m=>(v(),S("button",{key:m.key,class:K(["social-btn",m.btnClass]),onClick:()=>s.handleSocialRegister(m.key),disabled:s.isSubmitting},[a("img",{src:m.icon,alt:m.key,class:"social-icon"},null,8,Fs),pe(" "+O(m.label),1)],10,Cs))),128))])])]),_:1,__:[6]},8,["is-open","onClose"])}const Rs=H(Ss,[["render",Ls],["__scopeId","data-v-b20b530e"]]),xs={name:"ForgotPasswordModal",components:{Modal:ke,DynamicForm:He},props:{isOpen:{type:Boolean,default:!1}},emits:["close","forgot-password","login"],setup(e,{emit:t}){const r=w(!1),{config:s,formData:n,isSubmitting:i,isValid:o,getFieldError:l,setFieldTouched:u,submitForm:p,getFieldConfig:m,getFieldNames:h,resetForm:d}=Xe("FORGOT_PASSWORD"),c=h(),E=()=>{t("close"),d(),r.value=!1},A=async()=>{const f=await p(async g=>{await new Promise(k=>setTimeout(k,1500)),t("forgot-password",{...g}),r.value=!0},g=>{})};return{isSuccess:r,config:s,fieldNames:c,formData:n,isSubmitting:i,isValid:o,getFieldError:l,setFieldTouched:u,getFieldConfig:m,handleClose:E,handleFormSubmit:A,handleBackToLogin:()=>{t("login")},handleResend:async()=>{r.value=!1,await A()}}}},Ps={key:0,class:"success-state"},Os={class:"success-message"},Ns={class:"success-actions"},Ds={key:1},Vs={class:"back-to-login"};function qs(e,t,r,s,n,i){const o=W("DynamicForm"),l=W("Modal");return v(),ee(l,{"is-open":r.isOpen,title:"Mot de passe oublié",size:"small",onClose:s.handleClose},{default:ae(()=>[s.isSuccess?(v(),S("div",Ps,[t[4]||(t[4]=a("div",{class:"success-icon"},[a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),a("polyline",{points:"22,4 12,14.01 9,11.01"})])],-1)),t[5]||(t[5]=a("h3",{class:"success-title"},"Email envoyé !",-1)),a("p",Os,[t[3]||(t[3]=pe(" Nous avons envoyé un lien de réinitialisation à ")),a("strong",null,O(s.formData.email),1)]),a("div",Ns,[a("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=(...u)=>s.handleClose&&s.handleClose(...u))}," Fermer "),a("button",{type:"button",class:"btn btn-secondary",onClick:t[1]||(t[1]=(...u)=>s.handleResend&&s.handleResend(...u))}," Renvoyer l'email ")])])):(v(),S("div",Ds,[t[6]||(t[6]=a("div",{class:"instructions"},[a("p",{class:"instruction-text"}," Entrez votre adresse email et nous vous enverrons un lien pour réinitialiser votre mot de passe. ")],-1)),U(o,{"field-names":s.fieldNames,"get-field-config":s.getFieldConfig,"form-data":s.formData,"is-submitting":s.isSubmitting,"is-valid":s.isValid,"get-field-error":s.getFieldError,"set-field-touched":s.setFieldTouched,"submit-text":s.config.submitText,onSubmit:s.handleFormSubmit},null,8,["field-names","get-field-config","form-data","is-submitting","is-valid","get-field-error","set-field-touched","submit-text","onSubmit"]),a("div",Vs,[a("p",null,[a("button",{type:"button",class:"back-btn",onClick:t[2]||(t[2]=(...u)=>s.handleBackToLogin&&s.handleBackToLogin(...u))}," ← Retour à la connexion ")])])]))]),_:1},8,["is-open","onClose"])}const Us=H(xs,[["render",qs],["__scopeId","data-v-57942d67"]]),Bs={name:"VerifyCodeModal",components:{Modal:ke},props:{isOpen:{type:Boolean,default:!1},email:{type:String,required:!0}},emits:["close","verified"],data(){return{code:"",error:"",isSubmitting:!1}},methods:{async handleVerify(){this.error="",this.isSubmitting=!0;try{await Yr({email:this.email,code:this.code}),this.$emit("verified"),this.code=""}catch{this.error="Code invalide ou expiré."}finally{this.isSubmitting=!1}},handleClose(){this.$emit("close"),this.code="",this.error=""}}},zs=["disabled"],js={key:0,class:"verify-error"};function Gs(e,t,r,s,n,i){const o=W("Modal");return v(),ee(o,{"is-open":r.isOpen,title:"Vérification du compte",size:"small",onClose:i.handleClose},{default:ae(()=>[a("form",{onSubmit:t[1]||(t[1]=Re((...l)=>i.handleVerify&&i.handleVerify(...l),["prevent"])),class:"verify-form"},[t[2]||(t[2]=a("label",{for:"code-input",class:"verify-label"},"Code reçu par email",-1)),je(a("input",{id:"code-input","onUpdate:modelValue":t[0]||(t[0]=l=>n.code=l),class:"verify-input",placeholder:"Entrez le code",required:"",autocomplete:"one-time-code"},null,512),[[It,n.code]]),a("button",{type:"submit",class:"verify-btn",disabled:n.isSubmitting},O(n.isSubmitting?"Vérification...":"Valider"),9,zs),n.error?(v(),S("div",js,O(n.error),1)):q("",!0)],32)]),_:1},8,["is-open","onClose"])}const $s=H(Bs,[["render",Gs],["__scopeId","data-v-c5b00a14"]]),Xs={class:"pays-niveau-selector"},Hs={class:"modal-header"},Qs={class:"progress-bar"},Ks={class:"modal-subtitle"},Ws={key:0,class:"step-content"},Js={key:0,class:"loading-state"},Ys={key:1,class:"error-state"},Zs={key:2,class:"pays-grid"},eo=["onClick"],to={class:"pays-flag"},ro={class:"pays-info"},so={key:0,class:"selected-indicator"},oo={class:"step-actions"},no=["disabled"],ao={key:0},io={key:1},lo={key:1,class:"step-content"},co={class:"section-header"},uo={key:0,class:"loading-state"},mo={key:1,class:"empty-state"},fo={key:2,class:"niveaux-grid"},po=["onClick"],ho={class:"niveau-info"},vo={key:0,class:"selected-indicator"},go={class:"step-actions"},_o=["disabled"],yo={key:0},So={key:1},Io={key:2,class:"step-content"},Eo={class:"confirmation-content"},bo={class:"configuration-summary"},ko={class:"summary-item"},wo={class:"value"},Ao={class:"summary-item"},To={class:"value"},Mo={__name:"PaysNiveauSelector",props:{isOpen:{type:Boolean,default:!1}},emits:["configuration-complete","close"],setup(e,{emit:t}){const r=e,s=t,n=te(),{showToast:i}=Je(),o=w(1),l=w([]),u=w([]),p=w(null),m=w(null),h=w(!1),d=w(!1),c=w(!1),E=w(!1),A=M(()=>l.value.find(C=>C.id===p.value)),b=M(()=>u.value.find(C=>C.id===m.value)),y=()=>{switch(o.value){case 1:return"Étape 1 sur 2 - Choisissez votre pays";case 2:return"Étape 2 sur 2 - Choisissez votre niveau";case 3:return"Configuration terminée";default:return""}},f=async()=>{try{h.value=!0,c.value=!1;const C=await Lr();l.value=C.data||C}catch{c.value=!0,i("Erreur lors du chargement des pays","error")}finally{h.value=!1}},g=async C=>{if(!C){u.value=[];return}try{d.value=!0;const _=await Rr(C);u.value=_.data||_}catch{u.value=[],i("Erreur lors du chargement des niveaux","error")}finally{d.value=!1}},k=C=>{p.value=C.id,m.value=null},R=C=>{m.value=C.id},P=()=>{o.value===1&&p.value&&(o.value=2,g(p.value))},Q=()=>{o.value===2&&(o.value=1,u.value=[],m.value=null)},ie=async()=>{if(!(!p.value||!m.value))try{E.value=!0,await jr(p.value,m.value),await n.fetchUser(),o.value=3,i("Configuration enregistrée avec succès !","success"),setTimeout(()=>{s("configuration-complete")},2e3)}catch{i("Erreur lors de l'enregistrement de la configuration","error")}finally{E.value=!1}};return Ce(()=>r.isOpen,C=>{C&&l.value.length===0&&f()}),Ce(p,C=>{C&&o.value===2&&g(C)}),be(()=>{r.isOpen&&f()}),(C,_)=>(v(),ee(ke,{"is-open":e.isOpen,"can-close":!1,"show-header":!1},{default:ae(()=>[a("div",Xs,[a("div",Hs,[a("div",Qs,[a("div",{class:K(["progress-step",{active:o.value>=1,completed:o.value>1}])},_[0]||(_[0]=[a("span",{class:"step-number"},"1",-1),a("span",{class:"step-label"},"Pays",-1)]),2),a("div",{class:K(["progress-line",{completed:o.value>1}])},null,2),a("div",{class:K(["progress-step",{active:o.value>=2,completed:o.value>2}])},_[1]||(_[1]=[a("span",{class:"step-number"},"2",-1),a("span",{class:"step-label"},"Niveau",-1)]),2)]),_[2]||(_[2]=a("h2",null,"🎓 Configuration de votre profil d'apprentissage",-1)),a("p",Ks,O(y()),1)]),o.value===1?(v(),S("div",Ws,[_[7]||(_[7]=a("div",{class:"section-header"},[a("h3",null,"📍 Sélectionnez votre pays"),a("p",null,"Choisissez votre pays pour personnaliser le contenu selon votre système éducatif")],-1)),h.value?(v(),S("div",Js,_[3]||(_[3]=[a("div",{class:"spinner"},null,-1),a("p",null,"Chargement des pays disponibles...",-1)]))):c.value?(v(),S("div",Ys,[_[4]||(_[4]=a("p",null,"❌ Erreur lors du chargement des pays",-1)),a("button",{onClick:f,class:"btn-retry"},"Réessayer")])):(v(),S("div",Zs,[(v(!0),S(he,null,ve(l.value,F=>(v(),S("div",{key:F.id,class:K(["pays-card",{selected:p.value===F.id}]),onClick:$=>k(F)},[a("div",to,O(F.drapeau_emoji),1),a("div",ro,[a("h4",null,O(F.nom),1),a("p",null,O(F.nombre_niveaux||0)+" niveaux disponibles",1)]),p.value===F.id?(v(),S("div",so,_[5]||(_[5]=[a("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none"},[a("path",{d:"M9 12L11 14L15 10",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]))):q("",!0)],10,eo))),128))])),a("div",oo,[a("button",{onClick:P,disabled:!p.value||d.value,class:"btn-primary"},[d.value?(v(),S("span",ao,"Chargement...")):(v(),S("span",io,"Continuer")),_[6]||(_[6]=a("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none"},[a("path",{d:"M9 18L15 12L9 6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1))],8,no)])])):q("",!0),o.value===2?(v(),S("div",lo,[a("div",co,[_[8]||(_[8]=a("h3",null,"📚 Sélectionnez votre niveau scolaire",-1)),a("p",null,"Choisissez votre niveau pour "+O(A.value?.nom),1)]),d.value?(v(),S("div",uo,_[9]||(_[9]=[a("div",{class:"spinner"},null,-1),a("p",null,"Chargement des niveaux...",-1)]))):u.value.length===0?(v(),S("div",mo,_[10]||(_[10]=[a("p",null,"Aucun niveau disponible pour ce pays",-1)]))):(v(),S("div",fo,[(v(!0),S(he,null,ve(u.value,F=>(v(),S("div",{key:F.id,class:K(["niveau-card",{selected:m.value===F.id}]),onClick:$=>R(F)},[a("div",{class:"niveau-color",style:ot({backgroundColor:F.couleur||"#667eea"})},null,4),a("div",ho,[a("h4",null,O(F.nom_local||F.nom),1),_[11]||(_[11]=a("p",null,"Niveau scolaire",-1))]),m.value===F.id?(v(),S("div",vo,_[12]||(_[12]=[a("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none"},[a("path",{d:"M9 12L11 14L15 10",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]))):q("",!0)],10,po))),128))])),a("div",go,[a("button",{onClick:Q,class:"btn-secondary"},_[13]||(_[13]=[a("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none"},[a("path",{d:"M15 18L9 12L15 6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),pe(" Retour ")])),a("button",{onClick:ie,disabled:!m.value||E.value,class:"btn-primary"},[E.value?(v(),S("span",yo,"Enregistrement...")):(v(),S("span",So,"Terminer la configuration"))],8,_o)])])):q("",!0),o.value===3?(v(),S("div",Io,[a("div",Eo,[_[16]||(_[16]=a("div",{class:"success-icon"},"✅",-1)),_[17]||(_[17]=a("h3",null,"Configuration terminée !",-1)),_[18]||(_[18]=a("p",null,"Votre profil a été configuré avec succès.",-1)),a("div",bo,[a("div",ko,[_[14]||(_[14]=a("span",{class:"label"},"Pays:",-1)),a("span",wo,O(A.value?.nom),1)]),a("div",Ao,[_[15]||(_[15]=a("span",{class:"label"},"Niveau:",-1)),a("span",To,O(b.value?.nom_local||b.value?.nom),1)])]),_[19]||(_[19]=a("p",{class:"redirect-message"},"Vous allez être redirigé vers votre tableau de bord...",-1))])])):q("",!0)])]),_:1},8,["is-open"]))}},Co=H(Mo,[["__scopeId","data-v-d3ef1302"]]),Fo={name:"Toast",setup(){const{toasts:e,removeToast:t}=Je();return{toasts:e,removeToast:t}}},Lo={class:"toast-container"},Ro=["onClick"],xo={class:"toast-content"},Po={class:"toast-message"},Oo=["onClick"];function No(e,t,r,s,n,i){return v(),S("div",Lo,[U(Et,{name:"toast",tag:"div",class:"toasts"},{default:ae(()=>[(v(!0),S(he,null,ve(s.toasts,o=>(v(),S("div",{key:o.id,class:K(["toast",o.type]),onClick:l=>s.removeToast(o.id)},[a("div",xo,[a("span",Po,O(o.message),1),a("button",{class:"toast-close",onClick:Re(l=>s.removeToast(o.id),["stop"])}," × ",8,Oo)])],10,Ro))),128))]),_:1})])}const Do=H(Fo,[["render",No],["__scopeId","data-v-90fbbd54"]]),Vo={key:0,class:"xp-notification-overlay"},qo={class:"xp-notification-card"},Uo={class:"xp-notification-content"},Bo={class:"xp-message"},zo={class:"xp-reward"},jo={class:"xp-amount"},Go={__name:"XPRewardNotification",setup(e){const t=w(!1),r=w(""),s=w(0),n=l=>{r.value=`Objectif "${i(l.objectiveType)}" terminé !`,s.value=l.xpAmount,t.value=!0,setTimeout(()=>{t.value=!1},4e3)},i=l=>({quiz_easy:"Quiz simples",quiz_medium:"Quiz moyens",quiz_hard:"Quiz difficiles",quiz_perfect:"Quiz parfaits",quiz_streak:"Série de quiz"})[l]||"Objectif",o=l=>{n(l.detail)};return be(()=>{window.addEventListener("dailyObjectiveCompleted",o)}),nt(()=>{window.removeEventListener("dailyObjectiveCompleted",o)}),(l,u)=>(v(),ee(ze,{to:"body"},[U(at,{name:"notification"},{default:ae(()=>[t.value?(v(),S("div",Vo,[a("div",qo,[a("div",Uo,[u[1]||(u[1]=a("div",{class:"xp-icon"},"🎉",-1)),a("div",Bo,[u[0]||(u[0]=a("h3",null,"Défi complété !",-1)),a("p",null,O(r.value),1)]),a("div",zo,[a("span",jo,"+"+O(s.value)+" XP",1)])]),u[2]||(u[2]=a("div",{class:"xp-progress-bar"},[a("div",{class:"xp-progress-fill",style:{width:"100%"}})],-1))])])):q("",!0)]),_:1})]))}},$o=H(Go,[["__scopeId","data-v-0e93c61c"]]),Xo={key:0,class:"unlock-notification-overlay"},Ho={class:"unlock-notification-card"},Qo={class:"unlock-notification-content"},Ko={class:"unlock-message"},Wo={class:"unlock-objective-icon"},Jo={__name:"ObjectiveUnlockedNotification",setup(e){const t=w(!1),r=w(""),s=w(""),n=o=>{r.value=`"${o.objective.name}" est maintenant disponible !`,s.value=o.objective.icon||"🎯",t.value=!0,setTimeout(()=>{t.value=!1},3e3)},i=o=>{n(o.detail)};return be(()=>{window.addEventListener("objectiveUnlocked",i)}),nt(()=>{window.removeEventListener("objectiveUnlocked",i)}),(o,l)=>(v(),ee(ze,{to:"body"},[U(at,{name:"unlock-notification"},{default:ae(()=>[t.value?(v(),S("div",Xo,[a("div",Ho,[a("div",Qo,[l[1]||(l[1]=a("div",{class:"unlock-icon"},"🔓",-1)),a("div",Ko,[l[0]||(l[0]=a("h3",null,"Nouvel objectif débloqué !",-1)),a("p",null,O(r.value),1)]),a("div",Wo,O(s.value),1)]),l[2]||(l[2]=a("div",{class:"unlock-progress-bar"},[a("div",{class:"unlock-progress-fill",style:{width:"100%"}})],-1))])])):q("",!0)]),_:1})]))}},Yo=H(Jo,[["__scopeId","data-v-25a66a03"]]),Zo={},en={class:"fullpage-spinner"};function tn(e,t){return v(),S("div",en,t[0]||(t[0]=[a("span",{class:"spinner"},null,-1)]))}const rn=H(Zo,[["render",tn],["__scopeId","data-v-b5fd4076"]]),Ye=ge("notifications",()=>{const e=w([]),t=w(1),r=M(()=>e.value.filter(f=>!f.read).length),s=M(()=>r.value>0),n={XP_GAINED:"xp_gained",LEVEL_UP:"level_up",EXERCISE_UNLOCKED:"exercise_unlocked",CHAPTER_COMPLETED:"chapter_completed",ACHIEVEMENT:"achievement",DAILY_STREAK:"daily_streak"},i={XP_GAINED:4e3,LEVEL_UP:6e3,EXERCISE_UNLOCKED:5e3,CHAPTER_COMPLETED:5e3,ACHIEVEMENT:7e3,DAILY_STREAK:5e3};function o({type:f,title:g,message:k,data:R={},autoRemove:P=!1}){const Q={id:t.value++,type:f,title:g,message:k,data:R,read:!1,timestamp:new Date,autoRemove:P};if(e.value.unshift(Q),P){const ie=i[f]||5e3;setTimeout(()=>{A(Q.id)},ie)}return Q}function l(f,g,k=1){const R=k===1,P=R?"🎉 XP Gagnés !":"🔄 Tentative Supplémentaire";let Q;return R&&f>0?Q=`+${f} XP pour "${g}"`:Q=`Quiz "${g}" terminé (cooldown 1h30)`,o({type:n.XP_GAINED,title:P,message:Q,data:{xpAmount:f,quizTitle:g,attempt:k,isFirstAttempt:R}})}function u(f,g,k){return o({type:n.LEVEL_UP,title:"🏆 Niveau Supérieur !",message:`Félicitations ! Vous êtes maintenant niveau ${f}`,data:{newLevel:f,totalXP:g,xpToNext:k}})}function p(f,g){return o({type:n.EXERCISE_UNLOCKED,title:"🔓 Nouvel Exercice !",message:`"${f}" disponible dans ${g}`,data:{exerciseTitle:f,chapterTitle:g}})}function m(f,g){return o({type:n.CHAPTER_COMPLETED,title:"✅ Chapitre Terminé !",message:`"${f}" complété à ${g}%`,data:{chapterTitle:f,completionRate:g}})}function h(f,g,k="🏅"){return o({type:n.ACHIEVEMENT,title:`${k} Réussite Débloquée !`,message:`${f}: ${g}`,data:{achievementTitle:f,description:g,icon:k}})}function d(f,g){const k=P=>P===1?"Première connexion aujourd'hui !":P<=5?`${P} jours consécutifs ! Bravo !`:`${P} jours de suite ! Incroyable série !`,R=P=>P===1?"🌟":P===2?"⭐":P===3?"🔥":P===4?"💫":P>=5?"🏆":"🌟";return o({type:n.DAILY_STREAK,title:`${R(f)} Série Quotidienne !`,message:`${k(f)} +${g} XP`,data:{streakDays:f,xpGained:g}})}async function c(f){const g=e.value.find(k=>k.id===f);if(g){g.read=!0;try{await vt(f)}catch{}}}async function E(){e.value.forEach(f=>f.read=!0);try{const f=await Xr()}catch{}}function A(f){const g=e.value.findIndex(k=>k.id===f);g>-1&&e.value.splice(g,1)}function b(){e.value=[]}function y(){e.value.length>20&&(e.value=e.value.sort((f,g)=>new Date(g.timestamp)-new Date(f.timestamp)).slice(0,20))}return{notifications:M(()=>e.value),unreadCount:r,hasUnread:s,NOTIFICATION_TYPES:n,loadFromServer:async()=>{try{const f=await We(),g=Array.isArray(f?.data)?f.data:f?.data?.results||[];e.value=g.map(R=>({id:R.id,type:R.type,title:R.title,message:R.message,data:R.data||{},read:!!R.read,timestamp:R.created_at?new Date(R.created_at):new Date}));const k=g.reduce((R,P)=>Math.max(R,Number(P.id||0)),0);t.value=Math.max(t.value,k+1)}catch{}},addNotification:o,markAsRead:c,markAllAsRead:E,removeNotification:A,clearAll:b,cleanupOld:y,notifyXPGained:l,notifyLevelUp:u,notifyExerciseUnlocked:p,notifyChapterCompleted:m,notifyAchievement:h,notifyDailyStreak:d}}),Ne=w(!1),De=w(0),Ve=w("");function sn(){const e=te(),t=Ye();function r(l=0,u="XP gagné !"){De.value=l,Ve.value=u,Ne.value=!0}function s(){Ne.value=!1,De.value=0,Ve.value=""}async function n(l=!1){try{const u=await Gr(),p=u?.data?.data||u?.data||null;if(p){const m=Number(e.xp||0),h=Number(p.xp??e.xp??0),d=p.level,c=p.xp_to_next??p.next_level_xp??null,E=Ue(h),A=Number(d??E.level),b=Number(c??E.xp_to_next);return l||(e.xp=h,e.level=A,e.xp_to_next=b),{success:!0,gainedXp:h-m,newXp:h,newLevel:A,newXpToNext:b}}}catch(u){return{success:!1,error:u}}}async function i(l,u="streak_daily"){if(l==null)return{success:!1};const p=Number(e.xp||0),m=Number(e.level||0),h=p+Number(l),{level:d,xp_to_next:c}=Ue(h);e.xp=h,e.level=d,e.xp_to_next=c,await bt();try{await $r({xp_delta:l,reason:u})}catch{}const E=d>m;return E&&t.notifyLevelUp(d,h,c),{success:!0,oldXp:p,newXp:h,oldLevel:m,newLevel:d,levelUp:E}}async function o(l,u,p=1,m="Quiz"){if(t.notifyXPGained(u,m,p),u>0){let h="Quiz réussi !";p===1&&(h="Premier essai réussi !"),r(u,h);const d=await i(u,"quiz_completion");return await n(!0)}else p>1&&r(0,"Tentative supplémentaire (cooldown 1h30)");return{success:!0,gainedXp:0}}return{showXpNotification:Ne,xpGained:De,xpMessage:Ve,showXpGain:r,hideXpNotification:s,refreshUserXP:n,updateUserXPInstantly:i,handleQuizCompletion:o}}function on(){const e=te(),t=Ye(),{updateUserXPInstantly:r}=sn(),s=w(0),n=w(null),i=w(!1);function o(b){return b<=0?0:b<=5?b:5}function l(b){if(!b)return!0;const y=new Date,f=new Date(b),g=y.toDateString(),k=f.toDateString();return g!==k}function u(b){if(!b)return!1;const y=new Date,f=new Date(b),g=y-f;return Math.floor(g/(1e3*60*60*24))<=1}async function p(){try{if(i.value)return{success:!0,alreadyChecked:!0};const b=new Date().toISOString().split("T")[0],y=localStorage.getItem("lastLoginDate"),f=parseInt(localStorage.getItem("currentStreak")||"0");if(!l(y))return i.value=!0,s.value=f,{success:!0,alreadyChecked:!0};let g=1;u(y)&&(g=f+1);const k=o(g);return s.value=g,n.value=b,i.value=!0,localStorage.setItem("currentStreak",g.toString()),localStorage.setItem("lastLoginDate",b),localStorage.setItem("streakCheckedToday","true"),k>0&&await r(k,"streak_daily"),t.notifyDailyStreak(g,k),{success:!0,streakDays:g,xpGained:k,isNewStreak:g===1&&!u(y)}}catch(b){return{success:!1,error:b}}}function m(){try{const b=parseInt(localStorage.getItem("currentStreak")||"0"),y=localStorage.getItem("lastLoginDate"),f=localStorage.getItem("streakCheckedToday")==="true";s.value=b,n.value=y,l(y)?(i.value=!1,localStorage.removeItem("streakCheckedToday")):i.value=f}catch{s.value=0,n.value=null,i.value=!1}}function h(){s.value=0,n.value=null,i.value=!1,localStorage.removeItem("currentStreak"),localStorage.removeItem("lastLoginDate"),localStorage.removeItem("streakCheckedToday")}async function d(){return e.isAuthenticated?(m(),await p()):{success:!1,reason:"not_authenticated"}}const c=M(()=>o(s.value+1)),E=M(()=>o(s.value)),A=M(()=>s.value===0?"Connectez-vous quotidiennement pour gagner des XP !":s.value<=5?`${s.value} jour${s.value>1?"s":""} de suite ! Prochain: +${c.value} XP`:`${s.value} jours consécutifs ! +5 XP quotidiens`);return{currentStreak:M(()=>s.value),lastLoginDate:M(()=>n.value),isStreakCheckedToday:M(()=>i.value),nextStreakXP:c,todayStreakXP:E,streakMessage:A,checkDailyStreak:d,updateStreak:p,initializeStreak:m,resetStreak:h,calculateStreakXP:o,isNewDay:l,isStreakValid:u}}const nn={key:1,id:"app"},an={__name:"App",setup(e){const t=te(),r=xe(),s=Ge(),{isModalOpen:n,closeModal:i,openModal:o}=$e(),{checkDailyStreak:l}=on(),u=Ye(),p=w(!1),m=w(""),h=w(!1),d=M(()=>n(re.LOGIN)),c=M(()=>n(re.REGISTER)),E=M(()=>n(re.FORGOT_PASSWORD)),A=()=>i(re.LOGIN),b=()=>i(re.REGISTER),y=()=>i(re.FORGOT_PASSWORD),f=()=>{h.value=!1},g=async()=>{if(t.isAuthenticated&&t.pays&&t.niveau_pays)try{await r.initialize()}catch{}},k=()=>{if(t.id){const D=`configurationCompleted_${t.id}`;localStorage.setItem(D,"true")}f(),t.fetchUser().then(()=>{g()})},R=D=>{m.value=D,p.value=!0},P=()=>{p.value=!1,m.value=""},Q=D=>{D.provider==="google"||A()},ie=()=>{A(),o(re.REGISTER)},C=()=>{A(),o(re.FORGOT_PASSWORD)},_=async D=>{D.provider==="google"||(b(),R(D.email))},F=()=>{b(),y(),o(re.LOGIN)},$=()=>{},oe=()=>{},le=()=>{P(),s.push("/dashboard")},me=()=>{if(t.isLoading||!t.isAuthenticated||!t.id)return;const D=t.pays!==null&&t.pays!==void 0,J=t.niveau_pays!==null&&t.niveau_pays!==void 0;if(!D||!J){const ue=`configurationCompleted_${t.id}`;localStorage.getItem(ue)==="true"&&(!D||!J)&&localStorage.removeItem(ue),!localStorage.getItem(ue)&&!h.value&&(h.value=!0)}};return Ce(()=>t.isAuthenticated,D=>{D&&setTimeout(async()=>{try{await l()}catch{}me();try{await u.loadFromServer()}catch{}},200)},{immediate:!0}),Ce([()=>t.pays,()=>t.niveau_pays,()=>t.isLoading],([D,J,ue])=>{if(!ue&&t.isAuthenticated&&t.id){const Pe=D!=null,et=J!=null;if(Pe&&et){h.value=!1;const tt=`configurationCompleted_${t.id}`;localStorage.setItem(tt,"true"),g()}else me()}}),be(async()=>{try{await l()}catch{}if(t.isAuthenticated){me(),t.pays&&t.niveau_pays&&g();try{await u.loadFromServer()}catch{}}}),(D,J)=>{const ue=W("router-view");return j(t).isLoading?(v(),ee(rn,{key:0})):(v(),S("div",nn,[U(ue),U(ds,{"is-open":d.value,onClose:A,onLogin:Q,onSignup:ie,onForgotPassword:C},null,8,["is-open"]),U(Rs,{"is-open":c.value,onClose:b,onRegister:_,onLogin:F,onTerms:$,onPrivacy:oe},null,8,["is-open"]),U(Us,{"is-open":E.value,onClose:y,onForgotPassword:C,onLogin:F},null,8,["is-open"]),U($s,{"is-open":p.value,email:m.value,onClose:P,onVerified:le},null,8,["is-open","email"]),U(Co,{"is-open":h.value,onConfigurationComplete:k,onClose:f},null,8,["is-open"]),U(Do),U($o),U(Yo)]))}}},ln={};if(typeof document<"u"){const e=document.createElement("style");e.textContent=`
    /* Cache le bouton menu (≡) et le toggle clavier virtuel */
    math-field::part(menu-toggle),
    math-field::part(virtual-keyboard-toggle) {
      display: none !important;
    }
  `,document.head.appendChild(e)}const cn=kt(),Ze=wt(an);Ze.use(cn);Ze.use(Ke);const un=te(),dn=Ee.cleanExpiredTokens(),mn=localStorage.getItem("access_token");if(import.meta&&ln){const e=()=>{};console.log=e,console.debug=e,console.info=e,console.warn=e}mn&&(un.fetchUser(),setTimeout(()=>{Ee.startTokenMonitoring()},1e3));Ze.mount("#app");export{Sn as A,st as B,Lt as C,yn as D,gn as E,Yt as F,ur as L,re as M,$o as X,H as _,on as a,L as b,sn as c,xe as d,Gr as e,kn as f,wn as g,An as h,Tn as i,jr as j,bn as k,Je as l,_n as m,zr as n,$e as o,Ye as p,Fn as q,Mn as r,Ee as s,Cn as t,te as u,Hr as v,ht as w,$r as x,En as y,In as z};
