import{a as _,A as ne,c as oe,C as R,b as u,P as re,d as i,g as f,k as j,L as le,F as z,p as E,t as d,j as $,B as ue,H as T,o as c,n as V}from"./vendor-CPU10QdV.js";import{_ as ce}from"./index-BhTphZWV.js";import{a as me,g as de}from"./curriculum-DPSaZDuo.js";import{e as ge,h as pe,u as ve}from"./quiz-CRbLhkZQ.js";import"./ui-es3YBeq-.js";import"./pdf-OEFxGcL4.js";import"./mathlive-B5k0jhbN.js";const he={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_URL:"https://optitab-backend.onrender.com",VITE_GOOGLE_CLIENT_ID:"demo-client-id.apps.googleusercontent.com"},fe={class:"bulk-form"},_e={class:"form-row"},xe=["value"],ye={class:"stats"},Ie={key:0,class:"stat-item"},be={key:0,class:"context-panel"},qe={class:"context-row"},$e={class:"context-row"},Ne={class:"context-row"},we={class:"context-row"},ze={class:"images-upload-section"},Ee={key:0,class:"selected-images"},ke=["src","alt"],Ce={class:"image-name"},Qe=["onClick"],Me={class:"btn-group"},Ae=["disabled"],Te=["disabled"],Le={key:0,class:"success-msg"},Se={key:1,class:"error-msg"},We={key:2,class:"preview-section"},Ue={class:"preview-header"},Be={class:"preview-title"},Pe={class:"quiz-grid"},Re={class:"quiz-header"},je={class:"quiz-title"},Ve={class:"quiz-instructions"},Fe={class:"questions-summary"},Oe={class:"questions-count"},De={key:0,class:"explanations-count"},Ge={key:1,class:"images-count"},Je={class:"questions-preview"},He={class:"question-header"},Xe=["innerHTML"],Ye={class:"options-mini"},Ze=["innerHTML"],Ke={key:0,class:"explanation-section"},et={key:0,class:"explanation-mini"},tt=["innerHTML"],st={key:1,class:"no-explanation"},it={key:0,class:"more-questions"},at={key:0},nt=10*1024*1024,ot={__name:"AdminQuizPlus",setup(rt){const C=_([]),L=_([]),I=_(""),x=_(""),b=_(""),h=_(""),v=_([]),q=_(!0),N=_([]),Q=_(null),F=["image/jpeg","image/jpg","image/png","image/gif","image/webp"];class O{constructor(){this.images=new Map,this.imageTypes=new Map}addImage(e){if(!this.validateImage(e))throw new Error(`Image invalide: ${e.name}`);this.images.set(e.name,e)}removeImage(e){this.images.delete(e),this.imageTypes.delete(e)}validateImage(e){return!(!F.includes(e.type)||e.size>nt)}getImage(e){let t=this.images.get(e);if(t)return t;for(const[a,n]of this.images)if(a.toLowerCase()===e.toLowerCase())return n;return null}parseImageString(e){return e?e.split(",").map(t=>t.trim()).filter(Boolean):[]}validateImageReferences(e){const t=this.parseImageString(e),a=[];for(const n of t)this.getImage(n)||a.push(n);return{valid:a.length===0,missing:a}}determineImageType(e,t){return"question"}}class D{constructor(e){this.imageManager=e}async createQuizWithImages(e){try{const t=await ge({chapitre:Number(e.chapitre),titre:e.titre,contenu:e.instruction||e.titre||"Quiz",difficulty:e.difficulty||"medium",questions_data:Array.isArray(e.questions)?e.questions:[]}),a=t&&t.data&&t.data.id?t.data.id:t&&t.id?t.id:null;return e.image&&await this.addImagesToQuiz(a,e),{success:!0,quizId:a}}catch(t){return{success:!1,error:t.response?.data?JSON.stringify(t.response.data):t.message||"Erreur inconnue"}}}async addImagesToQuiz(e,t){const a=this.imageManager.parseImageString(t.image),n=[],o=new Map;for(let r=0;r<a.length;r++){const p=a[r],m=this.imageManager.getImage(p);if(m)try{const k=this.imageManager.determineImageType(t,r+1),l=await pe({quiz:e,image:m,image_type:k,position:r+1});if(l?.data?.image){let g=l.data.image;if(!/^https?:\/\//i.test(g)){const P=he?.VITE_API_BASE_URL||"http://127.0.0.1:8000";g.startsWith("/")?g=P+g:g=P+"/media/"+g}o.set(r+1,g)}}catch{n.push(`Image ${p} non ajout√©e`)}else n.push(`Image ${p} non trouv√©e`)}if(o.size>0)try{await this.updateQuizQuestionsWithImageUrls(e,t,o)}catch{n.push("Erreur lors de la mise √† jour des URLs d'images dans les questions")}return n}async updateQuizQuestionsWithImageUrls(e,t,a){const n=t.questions.map(o=>{const r={...o};return r.question&&(r.question=this.replaceImageMarkersWithUrls(r.question,a)),r.options&&(r.options=r.options.map(p=>this.replaceImageMarkersWithUrls(p,a))),r.explanation&&(r.explanation=this.replaceImageMarkersWithUrls(r.explanation,a)),r});await ve(e,{questions_data:n})}replaceImageMarkersWithUrls(e,t){return e&&e.replace(/\[IMAGE_(\d+)\]/g,(a,n)=>{const o=parseInt(n),r=t.get(o);return r?`<img src="${r}" alt="Image ${o}" style="max-width: 300px; height: auto; border-radius: 6px; margin: 8px 0; border: 1px solid #e5e7eb;" />`:a})}}const y=new O,G=new D(y);async function J(){try{const[s,e]=await Promise.all([me(),de()]);C.value=Array.isArray(s)?s:s?.data||[],L.value=Array.isArray(e)?e:e?.data||[]}catch{}}ne(J);function S(s){return L.value.find(e=>String(e.id)===String(s))}function W(s){if(!s)return null;const e=S(s.notion);if(!e)return{themeNom:"",matiereNom:"",paysNom:"",niveauNom:""};const t=e.matiere_nom||e.contexte_detail&&e.contexte_detail.matiere_nom||"",a=e.theme_nom||"",n=e.contexte_detail&&e.contexte_detail.pays?e.contexte_detail.pays.nom:"",o=e.contexte_detail&&e.contexte_detail.niveau?e.contexte_detail.niveau.nom:"";return{matiereNom:t,themeNom:a,paysNom:n,niveauNom:o}}const w=oe(()=>{const s=C.value.find(e=>String(e.id)===String(I.value));return s?W(s):null});function H(s){const e=S(s.notion),t=W(s);return[s.nom,e?`‚Äî ${e.nom}`:"",t&&t.matiereNom?`‚Äî ${t.matiereNom}`:"",t&&(t.paysNom||t.niveauNom)?`‚Äî ${[t.paysNom,t.niveauNom].filter(Boolean).join(" ¬∑ ")}`:""].filter(Boolean).join(" ")}function X(s){return{easy:"‚≠ê Facile",medium:"‚≠ê‚≠ê Moyen",hard:"‚≠ê‚≠ê‚≠ê Difficile"}[s]||s}function U(){return v.value.reduce((s,e)=>s+e.questions.length,0)}const M=()=>{T(()=>{window.MathJax&&window.MathJax.typesetPromise()})};R(v,()=>{v.value.length>0&&M()},{deep:!0}),R(q,()=>{v.value.length>0&&T(()=>{setTimeout(()=>M(),100)})});function B(){const s=x.value.trim();return s?s.includes("===")?Y(s):Z(s):[]}function Y(s){return s.split(/^={3,}\s*$/m).map(t=>t.trim()).filter(Boolean).map(t=>{let a="",n="",o="medium",r="";const p=[];let m=null;const k=t.split(`
`).map(l=>l.trim());for(const l of k)if(l.startsWith("Titre:"))a=l.slice(6).trim();else if(l.startsWith("Instructions:"))n=l.slice(12).trim();else if(l.startsWith("Difficult√©:")||l.startsWith("Difficulty:"))o=l.split(":")[1].trim().toLowerCase();else if(l.startsWith("Images:"))r=l.slice(7).trim();else if(l.startsWith("Question:"))m&&m.question&&p.push({...m}),m={question:l.slice(9).trim(),options:[],correct_answer:0,explanation:""};else if(l.match(/^[A-F]:/))m&&m.options.push(l.slice(2).trim());else if(l.startsWith("Correct:")){if(m){const g=l.slice(8).trim().toUpperCase();m.correct_answer=g.charCodeAt(0)-65}}else if(l.startsWith("Explication:")){if(m){let g=l.slice(12).trim();g=g.replace(/\\/g,"\\"),m.explanation=g}}else if(m&&m.explanation&&l.trim()){let g=l.trim();g=g.replace(/\\/g,"\\"),m.explanation+=" "+g}else if(m&&l.trim()){const g=l.trim();m.question=m.question?m.question+`
`+g:g}return m&&m.question&&p.push({...m}),{titre:a||"Quiz sans titre",instruction:n||"Quiz",difficulty:o,image:r,questions:p,chapitre:Number(I.value)}})}function Z(s){return s.split(`
`).map(t=>t.trim()).filter(Boolean).map(t=>{const a=t.split(";;").map(o=>o.trim());let n=[];try{n=a[3]?JSON.parse(a[3]):[]}catch{}return{titre:a[0]||"Quiz sans titre",instruction:a[1]||"Quiz",difficulty:(a[2]||"medium").toLowerCase(),questions:n,chapitre:Number(I.value)}})}async function K(){h.value="",b.value="";try{const s=B().filter(o=>o.titre&&o.questions.length>0);if(s.length===0){h.value="Aucun quiz valide trouv√©. V√©rifiez le format.";return}let e=0,t=0,a=[];for(const o of s){if(o.image){const p=y.validateImageReferences(o.image);if(!p.valid){a.push(`Images manquantes pour "${o.titre}": ${p.missing.join(", ")}`);continue}}const r=await G.createQuizWithImages(o);r.success?(e++,t+=Array.isArray(o.questions)?o.questions.length:0):a.push(`Erreur pour "${o.titre}": ${r.error}`)}let n=`${e} quiz cr√©√©s avec ${t} questions au total !`;a.length>0&&(n+=`

Erreurs : ${a.join(" | ")}`,h.value=`Certains quiz n'ont pas pu √™tre cr√©√©s : ${a.join(" | ")}`),b.value=n,x.value="",v.value=[]}catch(s){const e=s?.response?.data;if(e)try{h.value=typeof e=="string"?e:JSON.stringify(e)}catch{h.value="Erreur lors de la cr√©ation des quiz."}else h.value="Erreur lors de la cr√©ation des quiz."}}function ee(){h.value="",b.value="";try{const s=B().filter(e=>e.titre&&e.questions.length>0);v.value=s,s.forEach(e=>{e.questions.forEach((t,a)=>{t.explanation})}),s.length===0?h.value="Aucun quiz valide trouv√©. V√©rifiez le format.":T(()=>M())}catch{h.value="Erreur lors du parsing. V√©rifiez le format."}}function te(){x.value="",v.value=[],b.value="",h.value=""}function se(s){Array.from(s.target.files).forEach(t=>{try{y.addImage(t)}catch(a){h.value=a.message}}),N.value=Array.from(y.images.values())}function ie(s){const e=N.value[s];y.removeImage(e.name),N.value.splice(s,1),Q.value&&(Q.value.value="")}function ae(s){return URL.createObjectURL(s)}function A(s,e){if(!s||!e)return s;const t=y.parseImageString(e);return s.replace(/\[IMAGE_(\d+)\]/g,(a,n)=>{const o=parseInt(n)-1;if(o>=0&&o<t.length){const r=t[o],p=y.getImage(r);if(p)return`<img src="${URL.createObjectURL(p)}" alt="${r}" class="quiz-preview-image" style="max-width: 300px; height: auto; border-radius: 6px; margin: 8px 0; border: 1px solid #e5e7eb; display: block;" />`}return`<span class="image-placeholder" style="background: #fee2e2; color: #dc2626; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; border: 1px dashed #dc2626;">üñºÔ∏è Image ${n} manquante</span>`})}return(s,e)=>(c(),u("div",null,[e[17]||(e[17]=re(`<h2 class="admin-title" data-v-ec27929b>üöÄ Bulk ‚Äì Cr√©ation de Quiz QCM</h2><div class="help-section" data-v-ec27929b><p data-v-ec27929b><strong data-v-ec27929b>1.</strong> S√©lectionnez le chapitre ‚Ä¢ <strong data-v-ec27929b>2.</strong> Collez vos quiz au format structur√©</p><details class="format-help" data-v-ec27929b><summary data-v-ec27929b>üìñ Guide du format (cliquez pour voir)</summary><div class="format-examples" data-v-ec27929b><h4 data-v-ec27929b>Format recommand√© avec blocs ===</h4><pre data-v-ec27929b><code data-v-ec27929b>Titre: Quiz D√©riv√©es - Niveau 1
Instructions: Testez vos connaissances sur les d√©riv√©es
Difficult√©: medium
Images: image1.png, image2.jpg

Question: Quelle est la d√©riv√©e de $f(x) = x^2$ ?
A: $2x$
B: $x$
C: $2$
D: $x^2$
Correct: A
Explication: La d√©riv√©e de $x^2$ est $2x$ d&#39;apr√®s la r√®gle...

Question: Quelle est la d√©riv√©e de $f(x) = \\\\sin(x)$ ?
A: $-\\\\cos(x)$
B: $\\\\cos(x)$
C: $\\\\sin(x)$
D: $-\\\\sin(x)$
Correct: B
Explication: La d√©riv√©e de $\\\\sin(x)$ est $\\\\cos(x)$...
===
Titre: Quiz Int√©grales - Niveau 1
Instructions: Quiz sur les int√©grales simples
...
===</code></pre><h4 data-v-ec27929b>Support des images</h4><ul data-v-ec27929b><li data-v-ec27929b>Uploadez vos images via la section &quot;üìÅ Images pour les quiz&quot;</li><li data-v-ec27929b>R√©f√©rencez les images avec : <code data-v-ec27929b>Images: nom_image1.png, nom_image2.jpg</code></li><li data-v-ec27929b>Types support√©s : JPG, PNG, GIF, WebP (max 10MB)</li><li data-v-ec27929b>Les images seront associ√©es aux questions du quiz</li></ul><h4 data-v-ec27929b>Format alternatif (une ligne par quiz)</h4><p data-v-ec27929b><code data-v-ec27929b>Titre ;; Instructions ;; Difficult√© ;; JSON_Questions</code></p></div></details></div>`,2)),i("div",fe,[i("div",_e,[j(i("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>I.value=t),required:"",class:"chapter-select"},[e[3]||(e[3]=i("option",{disabled:"",value:""},"üìö Choisir le chapitre",-1)),(c(!0),u(z,null,E(C.value,t=>(c(),u("option",{key:t.id,value:t.id},d(H(t)),9,xe))),128))],512),[[le,I.value]]),i("div",ye,[v.value.length?(c(),u("span",Ie," üìä "+d(v.value.length)+" quiz ‚Ä¢ "+d(U())+" questions ",1)):f("",!0)])]),w.value?(c(),u("div",be,[i("div",qe,[e[4]||(e[4]=i("strong",null,"Mati√®re:",-1)),e[5]||(e[5]=$()),i("span",null,d(w.value.matiereNom||"‚Äî"),1)]),i("div",$e,[e[6]||(e[6]=i("strong",null,"Th√®me:",-1)),e[7]||(e[7]=$()),i("span",null,d(w.value.themeNom||"‚Äî"),1)]),i("div",Ne,[e[8]||(e[8]=i("strong",null,"Pays:",-1)),e[9]||(e[9]=$()),i("span",null,d(w.value.paysNom||"‚Äî"),1)]),i("div",we,[e[10]||(e[10]=i("strong",null,"Niveau:",-1)),e[11]||(e[11]=$()),i("span",null,d(w.value.niveauNom||"‚Äî"),1)])])):f("",!0),i("div",ze,[e[13]||(e[13]=i("h4",null,"üìÅ Images pour les quiz",-1)),e[14]||(e[14]=i("p",{class:"upload-help"},"Uploadez les images qui seront r√©f√©renc√©es dans vos quiz :",-1)),i("input",{type:"file",ref_key:"imagesInput",ref:Q,onChange:se,accept:"image/*",multiple:"",class:"images-file-input"},null,544),N.value.length>0?(c(),u("div",Ee,[e[12]||(e[12]=i("h5",null,"Images s√©lectionn√©es :",-1)),(c(!0),u(z,null,E(N.value,(t,a)=>(c(),u("div",{key:a,class:"selected-image-item"},[i("img",{src:ae(t),alt:t.name,class:"image-preview"},null,8,ke),i("span",Ce,d(t.name),1),i("button",{type:"button",class:"btn-remove",onClick:n=>ie(a)},"√ó",8,Qe)]))),128))])):f("",!0)]),j(i("textarea",{"onUpdate:modelValue":e[1]||(e[1]=t=>x.value=t),placeholder:`üìù Collez vos quiz ici au format structur√©...

Exemple rapide :
Titre: Quiz Exemple
Instructions: Quiz d'exemple
Difficult√©: easy

Question: Combien font 2+2 ?
A: 3
B: 4
C: 5
D: 6
Correct: B
Explication: 2+2=4, c'est math√©matique !
===`,class:"quiz-textarea"},null,512),[[ue,x.value]]),i("div",Me,[i("button",{class:"btn-preview",onClick:ee,disabled:!x.value.trim()}," üëÅÔ∏è Pr√©visualiser ",8,Ae),i("button",{class:"btn-create",onClick:K,disabled:!I.value||!v.value.length}," ‚ú® Cr√©er "+d(v.value.length||"")+" quiz ",9,Te),x.value||v.value.length?(c(),u("button",{key:0,class:"btn-clear",onClick:te}," üóëÔ∏è Vider ")):f("",!0)])]),b.value?(c(),u("div",Le,"‚úÖ "+d(b.value),1)):f("",!0),h.value?(c(),u("div",Se,"‚ùå "+d(h.value),1)):f("",!0),v.value.length?(c(),u("div",We,[i("div",Ue,[i("h3",Be," üéØ Aper√ßu ("+d(v.value.length)+" quiz ‚Ä¢ "+d(U())+" questions total) ",1),i("button",{class:"btn-toggle-explanations",onClick:e[2]||(e[2]=t=>q.value=!q.value)},d(q.value?"üôà Masquer":"üëÅÔ∏è Voir")+" explications ",1)]),i("div",Pe,[(c(!0),u(z,null,E(v.value,(t,a)=>(c(),u("div",{key:a,class:"quiz-preview-card"},[i("div",Re,[i("h4",je,d(t.titre),1),i("span",{class:V(["difficulty-badge",t.difficulty])},d(X(t.difficulty)),3)]),i("p",Ve,d(t.instruction),1),i("div",Fe,[i("span",Oe,"üìù "+d(t.questions.length)+" questions",1),t.questions.some(n=>n.explanation)?(c(),u("span",De,"üí° "+d(t.questions.filter(n=>n.explanation).length)+" explications",1)):f("",!0),t.image?(c(),u("span",Ge,"üñºÔ∏è "+d(t.image.split(",").length)+" images",1)):f("",!0)]),i("div",Je,[(c(!0),u(z,null,E(t.questions.slice(0,2),(n,o)=>(c(),u("div",{key:o,class:"question-mini"},[i("div",He,[i("strong",null,"Q"+d(o+1)+":",1),i("div",{innerHTML:A(n.question,t.image)},null,8,Xe)]),i("div",Ye,[(c(!0),u(z,null,E(n.options,(r,p)=>(c(),u("span",{key:p,class:V(["option-mini",{correct:p===n.correct_answer}])},[$(d(String.fromCharCode(65+p))+": ",1),i("span",{innerHTML:A(r,t.image)},null,8,Ze)],2))),128))]),q.value?(c(),u("div",Ke,[n.explanation?(c(),u("div",et,[e[15]||(e[15]=i("strong",null,"üí° Explication:",-1)),i("div",{innerHTML:A(n.explanation,t.image)},null,8,tt)])):(c(),u("div",st,e[16]||(e[16]=[i("em",null,"‚ö†Ô∏è Aucune explication fournie pour cette question",-1)])))])):f("",!0)]))),128)),t.questions.length>2?(c(),u("div",it,[$(" ... et "+d(t.questions.length-2)+" autres questions ",1),q.value?(c(),u("span",at," ("+d(t.questions.slice(2).filter(n=>n.explanation).length)+" explications dans les autres questions) ",1)):f("",!0)])):f("",!0)])]))),128))])])):f("",!0)]))}},vt=ce(ot,[["__scopeId","data-v-ec27929b"]]);export{vt as default};
