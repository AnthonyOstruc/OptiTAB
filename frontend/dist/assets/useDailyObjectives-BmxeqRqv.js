import{u as A,A as N}from"./index-DdsjLnq7.js";import{c as b,a as O,D as H}from"./vendor-1gmgAmFu.js";import"./ui-jaH5oyHW.js";import"./pdf-B39ievqC.js";import"./mathlive-B5k0jhbN.js";const V=O({quizEasy:0,quizMedium:0,quizHard:0,quizPerfect:0,quizStreak:0,exercicesCompleted:0}),z=O(!1),J=O([]);let I=!1;function L(){const u=A(),o=V,v={quiz_easy:{icon:"ðŸŸ¢",getText:e=>`RÃ©ussir ${e} quiz simples`,xpReward:3,getProgress:()=>o.value.quizEasy},quiz_medium:{icon:"ðŸŸ¡",getText:e=>`RÃ©ussir ${e} quiz moyens`,xpReward:5,getProgress:()=>o.value.quizMedium},quiz_hard:{icon:"ðŸ”´",getText:e=>`RÃ©ussir ${e} quiz difficiles`,xpReward:8,getProgress:()=>o.value.quizHard},quiz_perfect:{icon:"ðŸŽ¯",getText:e=>`Obtenir 100% sur ${e} quiz`,xpReward:9,getProgress:()=>o.value.quizPerfect},quiz_streak:{icon:"âš¡",getText:e=>`RÃ©ussir ${e} quiz d'affilÃ©e`,xpReward:9,getProgress:()=>o.value.quizStreak},exercices_completed:{icon:"ðŸ“š",getText:e=>`RÃ©ussir ${e} exercices`,xpReward:5,getProgress:()=>o.value.exercicesCompleted}},y=e=>({quiz_easy:"quizEasy",quiz_medium:"quizMedium",quiz_hard:"quizHard",quiz_perfect:"quizPerfect",quiz_streak:"quizStreak",exercices_completed:"exercicesCompleted"})[e]||null,c=[{name:"Quiz simples",type:"quiz_easy",target:3},{name:"Quiz moyens",type:"quiz_medium",target:5},{name:"Quiz difficiles",type:"quiz_hard",target:6},{name:"Quiz parfaits",type:"quiz_perfect",target:2},{name:"SÃ©rie de quiz",type:"quiz_streak",target:7},{name:"Exercices rÃ©ussis",type:"exercices_completed",target:2}],l=J,x=()=>{const e=new Date().toDateString(),t=localStorage.getItem(`unlocked_objectives_${e}`);if(t){let s=JSON.parse(t);if(s=s.filter(i=>i>=0&&i<c.length),s.length>0)l.value=s;else{const i=Math.floor(Math.random()*c.length);l.value=[i]}m()}else{const s=Math.floor(Math.random()*c.length);l.value=[s],m()}},m=()=>{const e=new Date().toDateString();localStorage.setItem(`unlocked_objectives_${e}`,JSON.stringify(l.value))},a=()=>{const t=Array.from({length:c.length},(s,i)=>i).filter(s=>!l.value.includes(s));if(t.length>0){const s=t[0];l.value.push(s),m(),window.dispatchEvent(new CustomEvent("objectiveUnlocked",{detail:{objective:c[s],index:s}}))}},r=b(()=>l.value.filter(e=>e<c.length).map(e=>{const t=c[e],s=v[t.type];if(!t||!s)return null;const i=s.getProgress();return{index:e,name:t.name,type:t.type,target:t.target,xpReward:s.xpReward,icon:s.icon,text:s.getText(t.target),progress:i,isCompleted:i>=t.target,percentage:Math.min(i/t.target*100,100)}}).filter(e=>e!==null)),d=b(()=>{if(!z.value)return null;const e=r.value;if(e.length===0)return null;const t=e.find(i=>!i.isCompleted);if(t)return t;const s=Array.from({length:c.length},(i,n)=>n).filter(i=>!l.value.includes(i));if(s.length>0){const i=s[0];l.value.push(i),m();const n=c[i],S=v[n.type],w=y(n.type),k=w?o.value[w]:0;return{...n,...S,progress:k,isCompleted:k>=n.target,isUnlocked:!0}}return null}),$=b(()=>c.map((e,t)=>{const s=l.value.includes(t),i=v[e.type];if(!e||!i)return null;const n=s?i.getProgress():0;return{index:t,name:e.name,type:e.type,target:e.target,xpReward:i.xpReward,icon:i.icon,text:i.getText(e.target),progress:n,isCompleted:s&&n>=e.target,isUnlocked:s,percentage:s?Math.min(n/e.target*100,100):0}}).filter(e=>e!==null)),q=e=>{const t=new Date().toDateString();return`daily_objective_${e}_${t}`},h=()=>{Object.keys(v).forEach(e=>{const t=q(e),s=localStorage.getItem(t),i=y(e);s&&i&&Object.prototype.hasOwnProperty.call(o.value,i)&&(o.value[i]=parseInt(s,10)||0)})},p=()=>{Object.keys(v).forEach(e=>{const t=q(e),s=y(e),i=s?o.value[s]:0;localStorage.setItem(t,String(i??0))})},g=(e,t=1)=>{const s=y(e);if(s&&Object.prototype.hasOwnProperty.call(o.value,s)){const i=o.value[s];o.value[s]+=t;const n=o.value[s];p();try{window.dispatchEvent(new CustomEvent("dailyObjectiveProgress",{detail:{type:e,value:n}}))}catch{}setTimeout(()=>{j()},100)}},C=()=>{Object.keys(o.value).forEach(e=>{o.value[e]=0}),p()},P=b(()=>d.value?d.value.progress>=d.value.target:!1),_=e=>{const t=new Date().toDateString();return`daily_objective_reward_${e}_${t}`},f=e=>{const t=_(e);return localStorage.getItem(t)==="true"},E=e=>{const t=_(e);localStorage.setItem(t,"true")},D=async(e,t)=>{if(f(e))return!1;try{await N({xp_delta:t,reason:`daily_objective:${e}`});const s=u.xp||0;u.xp=s+t,E(e),setTimeout(()=>{window.dispatchEvent(new CustomEvent("dailyObjectiveCompleted",{detail:{objectiveType:e,xpAmount:t}}))},500)}catch{const i=u.xp||0;u.xp=i+t,window.dispatchEvent(new CustomEvent("dailyObjectiveCompleted",{detail:{objectiveType:e,xpAmount:t}}))}return!0},j=()=>{let e=!1;r.value.forEach(t=>{t.isCompleted&&!f(t.type)&&(e=!0,D(t.type,t.xpReward))}),e&&setTimeout(()=>{Array.from({length:c.length},(s,i)=>i).filter(s=>!l.value.includes(s)).length>0&&a()},1500)},Q=e=>Math.min(100,e.progress/e.target*100),R=()=>g("quiz_easy"),T=()=>g("quiz_medium"),M=()=>g("quiz_hard"),K=()=>g("quiz_perfect"),U=()=>g("exercices_completed"),X=e=>{o.value.quizStreak=Math.max(o.value.quizStreak,e),p();try{window.dispatchEvent(new CustomEvent("dailyObjectiveProgress",{detail:{type:"quiz_streak",value:o.value.quizStreak}}))}catch{}setTimeout(()=>{j()},100)};return I||(h(),x(),H(o,p,{deep:!0}),I=!0,z.value=!0),{userStats:o,isInitialized:z,currentObjective:d,unlockedObjectives:l,unlockedObjectivesList:r,allObjectives:$,isDailyObjectiveCompleted:P,getProgressPercentage:Q,incrementStat:g,resetDailyStats:C,loadTodayStats:h,checkAndAwardObjectives:j,awardObjectiveXP:D,hasObjectiveBeenRewarded:f,simulateQuizEasy:R,simulateQuizMedium:T,simulateQuizHard:M,simulateQuizPerfect:K,simulateExerciseCompleted:U,simulateQuizStreak:X}}function Z(){const{incrementStat:u,simulateQuizStreak:o}=L(),v=a=>`${a}_${new Date().toDateString()}`,y=()=>{const a=localStorage.getItem(v("daily_quiz_success_streak"));return a&&parseInt(a,10)||0},c=a=>{localStorage.setItem(v("daily_quiz_success_streak"),String(a))};return{onQuizCompleted:a=>{if(a.isSuccess){const r=a.difficulty?.toLowerCase?.()||"easy";r==="facile"||r==="easy"?u("quiz_easy"):r==="moyen"||r==="moyenne"||r==="medium"?u("quiz_medium"):(r==="difficile"||r==="hard")&&u("quiz_hard");let d=y();d=d+1,c(d),o(d)}else c(0),o(0);a.percentage===100&&u("quiz_perfect")},onQuizStreak:a=>{o(a)},onExerciseCompleted:a=>{a.isSuccess&&u("exercices_completed")}}}export{L as useDailyObjectives,Z as useDailyObjectivesIntegration};
