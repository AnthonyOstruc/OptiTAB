import{q as X,h as k,m as f,s as N,aD as H}from"./index-C20tTf3S.js";const A=k({quizEasy:0,quizMedium:0,quizHard:0,quizPerfect:0,quizStreak:0,exercicesCompleted:0});let x=!1;function J(){const u=X(),o=A,g={quiz_easy:{icon:"üü¢",getText:e=>`R√©ussir ${e} quiz simples`,xpReward:3,getProgress:()=>o.value.quizEasy},quiz_medium:{icon:"üü°",getText:e=>`R√©ussir ${e} quiz moyens`,xpReward:5,getProgress:()=>o.value.quizMedium},quiz_hard:{icon:"üî¥",getText:e=>`R√©ussir ${e} quiz difficiles`,xpReward:8,getProgress:()=>o.value.quizHard},quiz_perfect:{icon:"üéØ",getText:e=>`Obtenir 100% sur ${e} quiz`,xpReward:9,getProgress:()=>o.value.quizPerfect},quiz_streak:{icon:"‚ö°",getText:e=>`R√©ussir ${e} quiz d'affil√©e`,xpReward:9,getProgress:()=>o.value.quizStreak},exercices_completed:{icon:"üìö",getText:e=>`R√©ussir ${e} exercices`,xpReward:5,getProgress:()=>o.value.exercicesCompleted}},v=e=>({quiz_easy:"quizEasy",quiz_medium:"quizMedium",quiz_hard:"quizHard",quiz_perfect:"quizPerfect",quiz_streak:"quizStreak",exercices_completed:"exercicesCompleted"})[e]||null,c=[{name:"Quiz simples",type:"quiz_easy",target:3},{name:"Quiz moyens",type:"quiz_medium",target:5},{name:"Quiz difficiles",type:"quiz_hard",target:6},{name:"Quiz parfaits",type:"quiz_perfect",target:2},{name:"S√©rie de quiz",type:"quiz_streak",target:7},{name:"Exercices r√©ussis",type:"exercices_completed",target:2}],l=k([]),O=()=>{const e=new Date().toDateString(),s=localStorage.getItem(`unlocked_objectives_${e}`);if(s){let t=JSON.parse(s);if(t=t.filter(i=>i>=0&&i<c.length),t.length>0)l.value=t,console.log("üéØ [DailyObjectives] Objectifs charg√©s (nettoy√©s):",l.value);else{const i=Math.floor(Math.random()*c.length);l.value=[i],console.log("üéØ [DailyObjectives] Objectifs invalides supprim√©s, nouveau d√©part:",i)}y()}else{const t=Math.floor(Math.random()*c.length);l.value=[t],y(),console.log("üéØ [DailyObjectives] Premier objectif d√©bloqu√©:",t,c[t].name)}},y=()=>{const e=new Date().toDateString();localStorage.setItem(`unlocked_objectives_${e}`,JSON.stringify(l.value)),console.log("üéØ [DailyObjectives] Objectifs sauvegard√©s:",l.value)},a=()=>{const s=Array.from({length:c.length},(t,i)=>i).filter(t=>!l.value.includes(t));if(s.length>0){const t=s[0];l.value.push(t),y(),console.log("üéØ [DailyObjectives] Nouvel objectif d√©bloqu√© (s√©quentiel):",t,c[t].name),window.dispatchEvent(new CustomEvent("objectiveUnlocked",{detail:{objective:c[t],index:t}}))}else console.log("üéØ [DailyObjectives] Tous les objectifs sont d√©j√† d√©bloqu√©s !")},n=f(()=>l.value.filter(e=>e<c.length).map(e=>{const s=c[e],t=g[s.type];if(!s||!t)return console.warn(`üéØ [DailyObjectives] Configuration invalide pour l'index ${e}`),null;const i=t.getProgress();return{index:e,name:s.name,type:s.type,target:s.target,xpReward:t.xpReward,icon:t.icon,text:t.getText(s.target),progress:i,isCompleted:i>=s.target,percentage:Math.min(i/s.target*100,100)}}).filter(e=>e!==null)),d=f(()=>{const e=n.value;if(e.length===0)return null;const s=e.find(i=>!i.isCompleted);if(s)return s;const t=Array.from({length:c.length},(i,r)=>r).filter(i=>!l.value.includes(i));if(t.length>0){const i=t[0];console.log(`üéØ [DailyObjectives] Auto-d√©blocage objectif ${i}`),l.value.push(i),y();const r=c[i],z=g[r.type],S=v(r.type),w=S?o.value[S]:0;return{...r,...z,progress:w,isCompleted:w>=r.target,isUnlocked:!0}}return null}),$=f(()=>c.map((e,s)=>{const t=l.value.includes(s),i=g[e.type];if(!e||!i)return console.warn(`üéØ [DailyObjectives] Configuration invalide pour l'index ${s}`),null;const r=t?i.getProgress():0;return{index:s,name:e.name,type:e.type,target:e.target,xpReward:i.xpReward,icon:i.icon,text:i.getText(e.target),progress:r,isCompleted:t&&r>=e.target,isUnlocked:t,percentage:t?Math.min(r/e.target*100,100):0}}).filter(e=>e!==null)),_=e=>{const s=new Date().toDateString();return`daily_objective_${e}_${s}`},h=()=>{Object.keys(g).forEach(e=>{const s=_(e),t=localStorage.getItem(s),i=v(e);t&&i&&Object.prototype.hasOwnProperty.call(o.value,i)&&(o.value[i]=parseInt(t,10)||0)})},p=()=>{Object.keys(g).forEach(e=>{const s=_(e),t=v(e),i=t?o.value[t]:0;localStorage.setItem(s,String(i??0))})},m=(e,s=1)=>{const t=v(e);if(console.log(`üéØ [DailyObjectives] incrementStat appel√©: ${e} ‚Üí ${t}`),t&&Object.prototype.hasOwnProperty.call(o.value,t)){const i=o.value[t];o.value[t]+=s;const r=o.value[t];console.log(`üéØ [DailyObjectives] ${t} mis √† jour: ${i} ‚Üí ${r}`),p();try{window.dispatchEvent(new CustomEvent("dailyObjectiveProgress",{detail:{type:e,value:r}})),console.log(`üéØ [DailyObjectives] √âv√©nement √©mis pour ${e}`)}catch(z){console.error("üéØ [DailyObjectives] Erreur √©v√©nement:",z)}setTimeout(()=>{j()},100)}else console.error(`üéØ [DailyObjectives] Stat invalide: ${e} ‚Üí ${t}`),console.error("üéØ [DailyObjectives] userStats disponibles:",Object.keys(o.value))},P=()=>{Object.keys(o.value).forEach(e=>{o.value[e]=0}),p()},C=f(()=>d.value.progress>=d.value.target),q=e=>{const s=new Date().toDateString();return`daily_objective_reward_${e}_${s}`},b=e=>{const s=q(e);return localStorage.getItem(s)==="true"},E=e=>{const s=q(e);localStorage.setItem(s,"true")},D=async(e,s)=>{if(b(e))return!1;console.log(`üéØ [DailyObjectives] Attribution XP: ${s} pour ${e}`);try{await H({xp_delta:s,reason:`daily_objective:${e}`});const t=u.xp||0;u.xp=t+s,console.log(`üéØ [DailyObjectives] XP sauvegard√©s backend et store: ${t} ‚Üí ${u.xp}`),E(e),setTimeout(()=>{console.log(`üéØ [DailyObjectives] √âmission notification pour ${e}`),window.dispatchEvent(new CustomEvent("dailyObjectiveCompleted",{detail:{objectiveType:e,xpAmount:s}}))},500)}catch(t){console.error("üéØ [DailyObjectives] Erreur sauvegarde XP:",t);const i=u.xp||0;u.xp=i+s,window.dispatchEvent(new CustomEvent("dailyObjectiveCompleted",{detail:{objectiveType:e,xpAmount:s}}))}return!0},j=()=>{let e=!1;n.value.forEach(s=>{s.isCompleted&&!b(s.type)&&(console.log(`üéØ [DailyObjectives] Objectif compl√©t√©: ${s.name}`),e=!0,D(s.type,s.xpReward))}),e&&setTimeout(()=>{Array.from({length:c.length},(t,i)=>i).filter(t=>!l.value.includes(t)).length>0?(console.log("üéØ [DailyObjectives] D√©blocage d'un nouvel objectif..."),a()):console.log("üéØ [DailyObjectives] Tous les objectifs sont d√©j√† d√©bloqu√©s !")},1500)},I=e=>Math.min(100,e.progress/e.target*100),Q=()=>m("quiz_easy"),R=()=>m("quiz_medium"),M=()=>m("quiz_hard"),K=()=>m("quiz_perfect"),T=()=>m("exercices_completed"),U=e=>{o.value.quizStreak=Math.max(o.value.quizStreak,e),p();try{window.dispatchEvent(new CustomEvent("dailyObjectiveProgress",{detail:{type:"quiz_streak",value:o.value.quizStreak}}))}catch{}setTimeout(()=>{j()},100)};return x||(h(),O(),N(o,p,{deep:!0}),x=!0),{userStats:o,currentObjective:d,unlockedObjectives:l,unlockedObjectivesList:n,allObjectives:$,isDailyObjectiveCompleted:C,getProgressPercentage:I,incrementStat:m,resetDailyStats:P,loadTodayStats:h,checkAndAwardObjectives:j,awardObjectiveXP:D,hasObjectiveBeenRewarded:b,simulateQuizEasy:Q,simulateQuizMedium:R,simulateQuizHard:M,simulateQuizPerfect:K,simulateExerciseCompleted:T,simulateQuizStreak:U}}function V(){const{incrementStat:u,simulateQuizStreak:o}=J(),g=a=>`${a}_${new Date().toDateString()}`,v=()=>{const a=localStorage.getItem(g("daily_quiz_success_streak"));return a&&parseInt(a,10)||0},c=a=>{localStorage.setItem(g("daily_quiz_success_streak"),String(a))};return{onQuizCompleted:a=>{if(console.log("[DailyObjectives] Quiz completed:",a),console.log("[DailyObjectives] Quiz difficulty:",a.difficulty),console.log("[DailyObjectives] Quiz success:",a.isSuccess),a.isSuccess){const n=a.difficulty?.toLowerCase?.()||"easy";console.log("[DailyObjectives] Difficult√© d√©tect√©e:",n),n==="facile"||n==="easy"?(console.log("[DailyObjectives] Quiz facile r√©ussi - Incr√©mentation quiz_easy"),u("quiz_easy")):n==="moyen"||n==="moyenne"||n==="medium"?(console.log("[DailyObjectives] Quiz moyen r√©ussi - Incr√©mentation quiz_medium"),u("quiz_medium")):(n==="difficile"||n==="hard")&&(console.log("[DailyObjectives] Quiz difficile r√©ussi - Incr√©mentation quiz_hard"),u("quiz_hard"));let d=v();d=d+1,c(d),console.log("[DailyObjectives] Streak success mis √† jour:",d),o(d)}else console.log("[DailyObjectives] Quiz √©chou√© - Pas d'incr√©mentation"),c(0),o(0);a.percentage===100&&(console.log("[DailyObjectives] Quiz parfait d√©tect√© (100%)"),u("quiz_perfect"))},onQuizStreak:a=>{console.log("[DailyObjectives] Quiz streak:",a),o(a)},onExerciseCompleted:a=>{console.log("[DailyObjectives] Exercise completed:",a),a.isSuccess?(console.log("[DailyObjectives] Exercise r√©ussi - Incr√©mentation exercices_completed"),u("exercices_completed")):console.log("[DailyObjectives] Exercise √©chou√© - Pas d'incr√©mentation")}}}export{J as useDailyObjectives,V as useDailyObjectivesIntegration};
