import{c as E,L as T,a as c,e as L,h as S,C as V,A as F,o as v,d as a,b,t as H}from"./vendor-1gmgAmFu.js";import{D as R}from"./DashboardLayout-DOJbCPaM.js";import{_ as j,d as P,u as J}from"./index-DdsjLnq7.js";import{h as I,d as N,b as x}from"./curriculum-6-VMzQHc.js";import{C as O}from"./ChapitresListView-BuPgXy-T.js";import"./menuItems-C0wivC9l.js";import"./matieres-DVwPPJpo.js";import"./ui-jaH5oyHW.js";import"./pdf-B39ievqC.js";import"./mathlive-B5k0jhbN.js";import"./BackButton-79xazihh.js";const z={class:"chapitres-section"},K={key:0,class:"chapitres-loader"},U={key:1,class:"chapitres-error"},Z=12e4,$={__name:"Chapitres",setup(q){const C=T(),y=F(),f=P();J(),E(()=>f.activeMatiereId||C.params.matiereId);const l=c(null);function B(){const t=l.value||f.activeMatiereId||C.params.matiereId;t?y.push({name:"Themes",params:{matiereId:String(t)}}):y.push({name:"Exercises"})}const o=c([]),u=c(""),p=c(!0),h=c("");function g(t){return`chapitres_meta:${t}`}function M(t){try{const e=localStorage.getItem(g(t));if(!e)return null;const r=JSON.parse(e);return!r?.t||!r?.v||Date.now()-r.t>Z?null:r.v}catch{return null}}function m(t,e){try{localStorage.setItem(g(t),JSON.stringify({t:Date.now(),v:e}))}catch{}}async function _(){const t=C.params.notionId;if(t){p.value=!0,h.value="";try{const e=M(t);if(e){u.value=e.notion?.nom||e.notion?.titre||"Notion",l.value=e.notion?.matiere||null,o.value=Array.isArray(e.chapitres)?e.chapitres:[],p.value=!1,I(t).then(i=>{const n=i?.data||i,w=n?.notion||{},A=n?.chapitres||[];w&&Array.isArray(A)&&m(t,{notion:w,chapitres:A})}).catch(async()=>{try{const[i,n]=await Promise.all([N(t),x(t)]);m(t,{notion:i,chapitres:Array.isArray(n)?n:[]})}catch{}});return}const r=await I(t),s=r?.data||r,d=s?.notion||{},k=s?.chapitres||[];u.value=d?.nom||d?.titre||"Notion",l.value=d?.matiere||null,o.value=Array.isArray(k)?k:[],m(t,{notion:d,chapitres:o.value})}catch{try{const[r,s]=await Promise.all([N(t),x(t)]);u.value=r?.nom||r?.titre||"Notion",l.value=r?.matiere||null,o.value=Array.isArray(s)?s:[],m(t,{notion:r,chapitres:o.value})}catch{h.value="Impossible de charger les chapitres. Veuillez réessayer."}}finally{p.value=!1}}}L(()=>{_()});function D(t){y.push({name:"Exercices",params:{chapitreId:t}})}return(t,e)=>(v(),S(R,null,{default:V(()=>[a("section",z,[p.value?(v(),b("div",K,e[0]||(e[0]=[a("div",{class:"loader-spinner"},null,-1),a("p",null,"Chargement des chapitres...",-1)]))):h.value?(v(),b("div",U,[e[1]||(e[1]=a("div",{class:"error-icon"},[a("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[a("path",{d:"M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),e[2]||(e[2]=a("h3",null,"Erreur de chargement",-1)),a("p",null,H(h.value),1),a("button",{class:"retry-button",onClick:_}," Réessayer ")])):(v(),S(O,{key:2,title:u.value,chapitres:o.value,"back-button-text":"Retour aux thèmes","back-action":B,"on-chapitre-click":D},null,8,["title","chapitres"]))])]),_:1}))}},it=j($,[["__scopeId","data-v-90094530"]]);export{it as default};
