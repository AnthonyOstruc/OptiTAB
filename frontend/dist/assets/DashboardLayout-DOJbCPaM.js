import{b as c,o as l,d as e,A as te,L as ie,c as T,e as W,f as se,i as k,n as q,j as I,x,F as U,s as Q,h as ee,J as me,t as $,a as L,D as O,q as ne,C as he,G as Ee,m as fe,a0 as Te,w as H,T as xe,B as pe,V as He,E as Oe,l as le,a1 as Be,K as Ve,Y as Ce,g as ze,k as Re}from"./vendor-1gmgAmFu.js";import{m as Ue,a as Qe,b as B,c as V,d as Ke,e as R}from"./menuItems-C0wivC9l.js";import{_ as D,u as ge,d as Le,q as Ne,t as ce,w as We,x as Ge,y as Je}from"./index-DdsjLnq7.js";import{a as Ie}from"./matieres-DVwPPJpo.js";import{a as Se}from"./ui-jaH5oyHW.js";function Xe(i,s){return l(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9"})])}function Ze(i,s){return l(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0"})])}function Ye(i,s){return l(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})])}function et(i,s){return l(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Z"})])}function tt(i,s){return l(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"})])}function st(i,s){return l(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})])}function at(i,s){return l(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}const ot=Ue.filter(i=>["dashboard","cours","calculator","exercices","quiz","fiches"].includes(i.key));function ve(i,s){const d=i?i[0].toUpperCase():"",m=s?s[0].toUpperCase():"";return(d+(m?"."+m:"")).trim()}const nt={class:"sidebar-menu"},it={class:"sidebar-menu-container"},rt=["title"],lt={class:"sidebar-icon"},ct={key:0,class:"sidebar-label"},dt=["onClick","title"],ut={class:"sidebar-icon"},ht={key:0,class:"sidebar-label"},pt={key:0,class:"sidebar-section-header"},vt=["title"],mt={class:"sidebar-icon"},ft={key:0,class:"sidebar-label"},gt=["title"],bt={class:"sidebar-icon"},_t={key:0,class:"sidebar-label"},yt=["title"],kt={class:"sidebar-icon"},wt={key:0,class:"sidebar-label"},$t=["title"],Mt={class:"sidebar-icon"},xt={key:0,class:"sidebar-label"},Ct=["title"],It={class:"sidebar-icon"},St={key:0,class:"sidebar-label"},At=["title"],Et={class:"sidebar-icon"},Tt={key:0,class:"sidebar-label"},zt=["title"],Lt={class:"sidebar-icon"},Nt={key:0,class:"sidebar-label"},qt={__name:"Sidebar",props:{collapsed:Boolean},emits:["navigation","toggle-collapsed"],setup(i,{expose:s,emit:d}){const m=i,r=d,u=ge(),n=te(),p=ie(),h=Le(),f=T(()=>ot.filter(M=>M.key!=="dashboard")),y=M=>{const b=p.path,C={dashboard:"/dashboard",cours:["/online-courses","/course-notions","/course-chapitres","/course","/cours"],exercices:["/exercises","/notions","/themes","/theme-notions","/chapitres","/exercices","/chapter-exercises"],fiches:["/sheets"],quiz:["/quiz","/quiz-notions","/quiz-chapitres","/quiz-exercices","/chapter-quiz"],progress:"/progress",calculator:"/calculator"}[M];return C?Array.isArray(C)?C.some(_=>b.startsWith(_)):b===C:!1};async function g(M){if(M.key==="calculator")n.push("/calculator");else if(M.key==="dashboard")n.push("/dashboard");else if(["exercices","fiches","quiz","cours"].includes(M.key)){const b=h.activeMatiereId||h.selectedMatieresIds?.[0]||null;if(M.key==="exercices")if(b){n.push({name:"Themes",params:{matiereId:String(b)}});try{ce.cachedGet("/api/themes/notions-pour-utilisateur/",{params:{matiere:b},ttl:12e4})}catch{}}else n.push({name:"Exercises"});else if(M.key==="fiches")b?n.push({name:"Sheets",query:{matiereId:String(b)}}):n.push({name:"Sheets"});else if(M.key==="quiz")if(b){n.push({name:"QuizNotions",params:{matiereId:String(b)}});try{ce.cachedGet("/api/themes/notions-pour-utilisateur/",{params:{matiere:b},ttl:12e4})}catch{}}else n.push({name:"Quiz"});else if(M.key==="cours")if(b){n.push({name:"CourseNotions",params:{matiereId:String(b)}});try{ce.cachedGet("/api/themes/notions-pour-utilisateur/",{params:{matiere:b},ttl:12e4})}catch{}}else n.push({name:"OnlineCourses"})}}T(()=>(u.firstName+" "+u.lastName).trim()),T(()=>ve(u.firstName,u.lastName)),u.firstName+""+u.lastName,ve(u.firstName,u.lastName);let A=null,N=null;const E=()=>window.innerWidth<900,j=()=>{A&&clearTimeout(A),A=setTimeout(()=>{(E()&&!m.collapsed||!E()&&m.collapsed)&&r("toggle-collapsed")},30)};return W(()=>{E()&&!m.collapsed&&setTimeout(()=>{r("toggle-collapsed")},10),window.addEventListener("resize",j),window.ResizeObserver&&(N=new ResizeObserver(()=>{j()}),N.observe(document.body))}),se(()=>{window.removeEventListener("resize",j),A&&clearTimeout(A),N&&N.disconnect()}),s({isActiveRoute:y,handleSidebarClick:g,handleLogout:async()=>{const M=localStorage.getItem("refresh_token");if(M&&M!=="null"&&M!=="undefined"&&M.trim()!=="")try{await Ne({refresh:M})}catch{}localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),u.clearUser(),n.push("/")}}),(M,b)=>(l(),c("aside",{class:q(["sidebar",{collapsed:i.collapsed}])},[e("nav",nt,[e("div",it,[e("ul",null,[e("li",{class:q(["sidebar-item",{active:y("dashboard")}]),onClick:b[0]||(b[0]=v=>g({key:"dashboard"})),title:i.collapsed?"Tableau de bord":""},[e("span",lt,[I(x(Qe))]),i.collapsed?k("",!0):(l(),c("span",ct,"Tableau de bord"))],10,rt),(l(!0),c(U,null,Q(f.value,v=>(l(),c("li",{class:q(["sidebar-item",{active:y(v.key)}]),key:v.key,onClick:C=>g(v),title:i.collapsed?v.text:""},[e("span",ut,[(l(),ee(me(v.icon)))]),i.collapsed?k("",!0):(l(),c("span",ht,$(v.text),1))],10,dt))),128)),x(u).isAdmin?(l(),c(U,{key:0},[i.collapsed?k("",!0):(l(),c("li",pt,b[8]||(b[8]=[e("span",{class:"section-title"},"⚙️ Administration",-1)]))),e("li",{class:"sidebar-item",onClick:b[1]||(b[1]=v=>x(n).push("/admin/matieres")),title:i.collapsed?"Matières":""},[e("span",mt,[I(x(B),{class:"h-6 w-6"})]),i.collapsed?k("",!0):(l(),c("span",ft,"Matières"))],8,vt),e("li",{class:"sidebar-item",onClick:b[2]||(b[2]=v=>x(n).push("/admin/notions")),title:i.collapsed?"Notions":""},[e("span",bt,[I(x(tt),{class:"h-6 w-6"})]),i.collapsed?k("",!0):(l(),c("span",_t,"Notions"))],8,gt),e("li",{class:"sidebar-item",onClick:b[3]||(b[3]=v=>x(n).push("/admin/chapitres")),title:i.collapsed?"Chapitres":""},[e("span",kt,[I(x(V),{class:"h-6 w-6"})]),i.collapsed?k("",!0):(l(),c("span",wt,"Chapitres"))],8,yt),e("li",{class:"sidebar-item",onClick:b[4]||(b[4]=v=>x(n).push("/admin/exercices")),title:i.collapsed?"Exercices":""},[e("span",Mt,[I(x(st),{class:"h-6 w-6"})]),i.collapsed?k("",!0):(l(),c("span",xt,"Exercices"))],8,$t),e("li",{class:"sidebar-item",onClick:b[5]||(b[5]=v=>x(n).push("/admin/exercices-plus")),title:i.collapsed?"Exercices+":""},[e("span",It,[I(x(at))]),i.collapsed?k("",!0):(l(),c("span",St,"Exercices+"))],8,Ct),e("li",{class:"sidebar-item",onClick:b[6]||(b[6]=v=>x(n).push("/admin/fiches")),title:i.collapsed?"Fiches":""},[e("span",Et,[I(x(Ke),{class:"h-6 w-6"})]),i.collapsed?k("",!0):(l(),c("span",Tt,"Fiches"))],8,At),e("li",{class:"sidebar-item",onClick:b[7]||(b[7]=v=>x(n).push("/admin/quiz")),title:i.collapsed?"Quiz":""},[e("span",Lt,[I(x(R),{class:"h-6 w-6"})]),i.collapsed?k("",!0):(l(),c("span",Nt,"Quiz"))],8,zt)],64)):k("",!0)])])])],2))}},jt=D(qt,[["__scopeId","data-v-7ee398ee"]]),Dt=["aria-expanded"],Pt={class:"user-info"},Ft=["aria-label"],Ht={class:"user-avatar"},Ot={class:"user-details"},Bt={class:"user-name"},Vt={class:"user-title"},Rt={key:0,class:"user-xp-bar"},Ut={key:0,class:"user-menu-dropdown"},Qt={class:"menu-avatar"},Kt={class:"menu-user-info"},Wt={class:"menu-full-name"},Gt={class:"menu-email"},Jt={class:"menu-options"},Xt={class:"option-icon"},Zt={class:"option-icon"},Yt={class:"option-icon"},es={__name:"UserMenu",emits:["logout"],setup(i,{emit:s}){const d=s,m=ge(),r=te(),u=L(!1),n=L(null),p=T(()=>`${m.firstName} ${m.lastName}`.trim()||"Utilisateur"),h=T(()=>ve(m.firstName,m.lastName)),f=T(()=>{if(!m.isAuthenticated)return"";const _=m.level??0,z=m.xp??0;return`Niveau ${_} · ${z} XP`}),y=T(()=>m.isAuthenticated),g=T(()=>{const _=Number(m.level||0),z=Number(m.xp||0),F=_*_*10,K=(_+1)*(_+1)*10,G=Math.max(z,F)-F,ae=Math.max(1,K-F);return Math.min(100,Math.round(G/ae*100))}),A=T(()=>m.email||"email@exemple.com"),N=()=>{u.value=!u.value},E=()=>{u.value=!1},j=()=>{E(),r.push("/account")},P=()=>{E(),r.push("/pricing")},M=()=>{E(),r.push("/account")},b=async()=>{E();try{const _=localStorage.getItem("refresh_token");if(_&&_!=="null"&&_!=="undefined"&&_.trim()!=="")try{await Ne({refresh:_})}catch{}localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),m.clearUser(),d("logout"),r.push("/")}catch{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),m.clearUser(),r.push("/")}},v=_=>{n.value&&!n.value.contains(_.target)&&E()},C=_=>{_.key==="Escape"&&u.value&&E()};return O(()=>[m.xp,m.level,m.xp_to_next],(_,z)=>{},{deep:!0}),W(()=>{document.addEventListener("click",v),document.addEventListener("keydown",C)}),se(()=>{document.removeEventListener("click",v),document.removeEventListener("keydown",C)}),(_,z)=>(l(),c("div",{class:"user-menu-container",ref_key:"menuContainer",ref:n},[e("button",{class:"user-menu-trigger",onClick:N,"aria-expanded":u.value,"aria-label":"Menu utilisateur"},[e("div",Pt,[e("div",{class:"avatar-progress",style:ne({"--progress":g.value+"%"}),role:"img","aria-label":`Progression de niveau: ${g.value}%`,title:"Progression vers le prochain niveau"},[e("span",Ht,$(h.value),1)],12,Ft),e("div",Ot,[e("span",Bt,$(p.value),1),e("span",Vt,$(f.value),1),y.value?(l(),c("div",Rt,[e("div",{class:"user-xp-fill",style:ne({width:g.value+"%"})},null,4)])):k("",!0)])])],8,Dt),I(Ee,{name:"menu-dropdown"},{default:he(()=>[u.value?(l(),c("div",Ut,[e("button",{class:"menu-header",onClick:M},[e("span",Qt,$(h.value),1),e("div",Kt,[e("div",Wt,$(p.value),1),e("div",Gt,$(A.value),1)])]),e("div",Jt,[e("button",{class:"menu-option",onClick:j},[e("span",Xt,[I(x(Ye),{class:"user-menu-heroicon"})]),z[0]||(z[0]=e("span",{class:"option-label"},"Mon compte",-1))]),e("button",{class:"menu-option",onClick:P},[e("span",Zt,[I(x(et),{class:"user-menu-heroicon"})]),z[1]||(z[1]=e("span",{class:"option-label"},"Abonnement",-1))]),e("button",{class:"menu-option logout-option",onClick:b},[e("span",Yt,[I(x(Xe),{class:"user-menu-heroicon"})]),z[2]||(z[2]=e("span",{class:"option-label"},"Déconnexion",-1))])])])):k("",!0)]),_:1})],512))}},ts=D(es,[["__scopeId","data-v-c94e9bdf"]]),ss={class:"subject-filters"},as=["onClick"],os={__name:"SubjectFilters",props:{subjects:{type:Array,default:()=>[{id:"maths",name:"Mathématiques"},{id:"physics",name:"Physique"},{id:"chemistry",name:"Chimie"}]},initialSubject:{type:String,default:"maths"}},emits:["subject-changed"],setup(i,{expose:s,emit:d}){const m=i,r=d,u=L(m.initialSubject),n=p=>{u.value=p,r("subject-changed",p)};return O(()=>m.initialSubject,p=>{u.value=p}),s({selectedSubject:u}),(p,h)=>(l(),c("div",ss,[(l(!0),c(U,null,Q(i.subjects,f=>(l(),c("button",{key:f.id,class:q(["subject-btn",{active:u.value===f.id}]),onClick:y=>n(f.id)},$(f.name),11,as))),128))]))}},ns=D(os,[["__scopeId","data-v-3ad3f663"]]),is={class:"chapter-navigation","aria-label":"Navigation des chapitres"},rs=["aria-pressed","aria-label","onClick"],ls={class:"chapter-nav-label"},cs={__name:"ChapterNavigation",props:{chapitreId:{type:[String,Number],required:!1,default:null}},setup(i){const s=i,d=ie(),m=te(),r=T(()=>{const h=d.path,f=d.params.notionId,y=s.chapitreId||d.params.chapitreId,g=d.params.matiereId;return y&&y!==null?[{key:"cours",label:"Cours",icon:V,route:`/course/${y}`},{key:"exercices",label:"Exercices",icon:B,route:`/exercices/${y}`},{key:"quiz",label:"Quiz",icon:R,route:`/quiz-exercices/${y}`}]:f&&h.includes("/chapitres/")&&!h.includes("/quiz-chapitres/")&&!h.includes("/course-chapitres/")?[{key:"cours",label:"Cours",icon:V,route:`/course-chapitres/${f}`},{key:"exercices",label:"Exercices",icon:B,route:`/chapitres/${f}`},{key:"quiz",label:"Quiz",icon:R,route:`/quiz-chapitres/${f}`}]:g&&h.includes("/notions/")?[{key:"cours",label:"Cours",icon:V,route:`/course-notions/${g}`},{key:"exercices",label:"Exercices",icon:B,route:`/notions/${g}`},{key:"quiz",label:"Quiz",icon:R,route:`/quiz/${g}`}]:f&&h.includes("/course-chapitres/")?[{key:"cours",label:"Cours",icon:V,route:`/course-chapitres/${f}`},{key:"exercices",label:"Exercices",icon:B,route:`/chapitres/${f}`},{key:"quiz",label:"Quiz",icon:R,route:`/quiz-chapitres/${f}`}]:f&&h.includes("/quiz-chapitres/")?[{key:"cours",label:"Cours",icon:V,route:`/course-chapitres/${f}`},{key:"exercices",label:"Exercices ",icon:B,route:`/chapitres/${f}`},{key:"quiz",label:"Quiz",icon:R,route:`/quiz-chapitres/${f}`}]:g&&h.includes("/course-notions/")?[{key:"cours",label:"Cours",icon:V,route:`/course-notions/${g}`},{key:"exercices",label:"Exercices",icon:B,route:`/notions/${g}`},{key:"quiz",label:"Quiz",icon:R,route:`/quiz/${g}`}]:g&&h.includes("/quiz/")?[{key:"cours",label:"Cours",icon:V,route:`/course-notions/${g}`},{key:"exercices",label:"Exercices ",icon:B,route:`/notions/${g}`},{key:"quiz",label:"Quiz",icon:R,route:`/quiz/${g}`}]:[{key:"cours",label:"Cours",icon:V,route:"/online-courses"},{key:"exercices",label:"Exercices",icon:B,route:"/exercises"},{key:"quiz",label:"Quiz",icon:R,route:"/quiz"}]}),u=L("exercices");function n(){const h=d.path,f=s.chapitreId||d.params.chapitreId;f&&f!==null?h.includes(`/course/${f}`)?u.value="cours":h.includes(`/exercices/${f}`)?u.value="exercices":h.includes(`/quiz-exercices/${f}`)?u.value="quiz":u.value="exercices":h.includes("/course/")||h.includes("/course-chapitres/")||h.includes("/course-notions/")?u.value="cours":h.includes("/exercices/")||h.includes("/chapitres/")&&!h.includes("/quiz-chapitres/")&&!h.includes("/course-chapitres/")||h.includes("/notions/")?u.value="exercices":h.includes("/quiz-exercices/")||h.includes("/quiz-chapitres/")||h.includes("/quiz/")&&d.params.matiereId?u.value="quiz":u.value="exercices"}W(()=>{n()}),O(()=>d.path,()=>{n()});function p(h){const f=r.value.find(y=>y.key===h);f&&(u.value=h,m.push({path:f.route,replace:!1}).catch(y=>{n()}))}return(h,f)=>(l(),c("nav",is,[(l(!0),c(U,null,Q(r.value,y=>(l(),c("button",{key:y.key,class:q(["chapter-nav-btn",{active:y.key===u.value}]),"aria-pressed":y.key===u.value,"aria-label":y.label,onClick:g=>p(y.key)},[(l(),ee(me(y.icon),{class:"chapter-nav-icon"})),e("span",ls,$(y.label),1)],10,rs))),128))]))}},ds=D(cs,[["__scopeId","data-v-e67b6d2c"]]),us={class:"context-menu-icon"},hs={class:"context-menu-text"},ps={__name:"ContextMenu",props:{visible:{type:Boolean,default:!1},x:{type:Number,default:0},y:{type:Number,default:0},isFavorite:{type:Boolean,default:!1},matiereId:{type:[Number,String,null],default:null}},emits:["favorite-toggle","close"],setup(i,{emit:s}){const d=i,m=s,r=T(()=>({position:"fixed",left:`${d.x}px`,top:`${d.y}px`,zIndex:12006}));function u(){d.matiereId!==null&&m("favorite-toggle",d.matiereId),m("close")}function n(h){d.visible&&m("close")}function p(h){h.key==="Escape"&&d.visible&&m("close")}return W(()=>{document.addEventListener("click",n),document.addEventListener("keydown",p)}),se(()=>{document.removeEventListener("click",n),document.removeEventListener("keydown",p)}),(h,f)=>fe((l(),c("div",{class:"context-menu",style:ne(r.value),onClick:f[0]||(f[0]=H(()=>{},["stop"]))},[e("div",{class:"context-menu-item",onClick:u},[e("span",us,$(i.isFavorite?"⭐":"☆"),1),e("span",hs,$(i.isFavorite?"Retirer des favoris":"Ajouter aux favoris"),1)])],4)),[[Te,i.visible]])}},vs=D(ps,[["__scopeId","data-v-9bd47334"]]),ms={class:"selected-matiere-header"},fs={key:0,class:"loading-state"},gs={key:1,class:"matieres-tabs"},bs={class:"tabs-container"},_s=["disabled"],ys=["onClick","onMousedown","onContextmenu","title","aria-label","aria-selected"],ks=["innerHTML"],ws={class:"tab-name"},$s={class:"tab-initials"},Ms=["onClick","title","aria-label","disabled"],xs=["disabled"],Cs=["onClick","onContextmenu","title"],Is={class:"dropdown-content-left"},Ss=["innerHTML"],As={class:"dropdown-name"},Es=["onClick","title","aria-label","disabled"],Ts={class:"star-icon"},zs={key:0,class:"dropdown-empty"},Ls={key:0,class:"favorites-bar"},Ns={class:"favorites-container"},qs={class:"favorites-list"},js=["onClick","onContextmenu","title","aria-label","disabled"],Ds=["innerHTML"],Ps={class:"favorite-name"},Fs={class:"favorite-initials"},Hs=["title","aria-label"],de=5,Ae=6,ue="matieres_disponibles_cache",Os=600*1e3,Bs={__name:"SelectedMatiereHeader",props:{matiereId:{type:[Number,String],default:null,validator:i=>i===null||!isNaN(Number(i))&&Number(i)>0}},emits:["matiere-changed"],setup(i,{emit:s}){const d=i;O(()=>d.matiereId,t=>{n.value.matiereId=t||null});const m=s;te();const r=Le(),u=ge(),n=L({visible:!1,x:0,y:0,matiereId:d.matiereId||null,isFavorite:!1}),p=L([]),h=L(!1),f=L(null),y=L(null),g=L(null),A=L(!1),N=L(!1),E=L(null),j=L({}),P=T(()=>p.value.filter(t=>t&&t.id&&r.selectedMatieresIds.includes(t.id))),M=T(()=>p.value.filter(t=>t&&t.id&&!r.selectedMatieresIds.includes(t.id))),b=T(()=>{const t=p.value.filter(a=>a&&a.id&&r.isFavoriteMatiere(a.id));return!N.value&&t.length>de?t.slice(0,de):t});T(()=>p.value.find(t=>t&&t.id===g.value));const v=(t,a)=>{},C=t=>{try{if(!t||typeof t!="string")return"";const a=t.replace(/\([^)]*\)/g,"").replace(/[^\p{L}\s-]/gu,"").trim();if(!a)return"";const o=a.split(/[\s-]+/).filter(Boolean);return o.length===0?"":o.slice(0,2).map(w=>w.charAt(0).toUpperCase()).join("")}catch{return""}},_=t=>t!=null&&!isNaN(Number(t))&&Number(t)>0,z=()=>{try{const t=localStorage.getItem(ue);if(!t)return null;const a=JSON.parse(t);return!a||!Array.isArray(a.data)?null:a}catch{return null}},F=t=>{try{const a={niveauId:u.niveau_pays?.id||null,ts:Date.now(),data:t};localStorage.setItem(ue,JSON.stringify(a))}catch{}},K=()=>{try{localStorage.removeItem(ue)}catch{}},Z=async()=>{try{if(!u.niveau_pays?.id)return;const t=await Ie();if(t&&t.data&&t.data.matieres_disponibles){const a=t.data.matieres_disponibles.filter(S=>S&&S.id&&S.nom),o=(p.value||[]).map(S=>S.id).join(","),w=a.map(S=>S.id).join(",");o!==w&&(p.value=a),F(a)}}catch{}},G=async({useCache:t=!0}={})=>{if(!h.value){if(t){const a=z(),o=a?.niveauId===(u.niveau_pays?.id||null),w=a&&Date.now()-a.ts<Os;if(a&&o&&w){p.value=a.data.filter(S=>S&&S.id&&S.nom),Z();return}}h.value=!0;try{if(!u.niveau_pays?.id){p.value=[];return}const a=await Ie();if(a&&a.data&&a.data.matieres_disponibles){const o=a.data.matieres_disponibles.filter(w=>w&&w.id&&w.nom);p.value=o,F(o)}else throw new Error("Format de réponse API invalide")}catch(a){v(a,"loadMatieres"),p.value=[]}finally{h.value=!1}}},ae=async t=>{if(!(!_(t)||h.value))try{if(A.value&&J(),r.removeMatiereId(t),g.value===t){const a=P.value.filter(o=>o.id!==t);a.length>0?(await pe(),Y(a[0].id)):(g.value=null,m("matiere-changed",null))}}catch(a){v(a,"removeMatiere")}},qe=(t,a)=>{if(t.button===1){t.preventDefault(),t.stopPropagation(),ae(a);return}},Y=t=>{if(!(!_(t)||h.value||f.value===t))try{g.value=t,r.setActiveMatiere(t),m("matiere-changed",t)}catch(a){v(a,"setActiveMatiere")}},be=(t=null)=>{const a=t||E.value;if(!a||typeof a.getBoundingClientRect!="function")return{};try{const o=a.getBoundingClientRect(),w=window.innerHeight,S=window.innerWidth;let X={position:"fixed",top:`${o.bottom+Ae}px`,left:`${o.left}px`,minWidth:`${Math.max(o.width,280)}px`,maxWidth:`${Math.min(400,S-20)}px`,zIndex:12005};return o.bottom+300>w&&(X.top=`${o.top-300-Ae}px`,X.bottom="auto"),o.left+280>S&&(X.left=`${S-300}px`),X}catch(o){return v(o,"calculateDropdownPosition"),{}}},_e=async t=>{if(!h.value)try{if(A.value=!A.value,A.value){await pe();const a=t&&t.currentTarget||E.value||null;j.value=be(a)}else j.value={}}catch(a){v(a,"toggleMatiereDropdown")}},J=()=>{A.value=!1,j.value={}},ye=async t=>{if(!(!t?.id||h.value||f.value===t.id)){f.value=t.id;try{r.selectedMatieresIds.includes(t.id)||r.addMatiereId(t.id),g.value=t.id,r.setActiveMatiere(t.id),m("matiere-changed",t.id),A.value&&J()}catch(a){v(a,"selectMatiere")}finally{f.value=null}}},re=(t,a)=>{t.preventDefault(),n.value={visible:!0,x:t.clientX,y:t.clientY,matiereId:a.id,isFavorite:r.isFavoriteMatiere(a.id)}},je=()=>{n.value.visible=!1},De=async t=>{await ke(t)},ke=async t=>{if(!(!_(t)||y.value===t)){y.value=t;try{r.toggleFavoriteMatiere(t);const a=p.value.find(w=>w.id===t),o=r.isFavoriteMatiere(t)}catch(a){v(a,"toggleFavorite")}finally{y.value=null}}},Pe=()=>{N.value=!N.value},we=t=>{if(A.value)try{const a=document.querySelector(".matiere-dropdown"),o=E.value,w=a&&a.contains(t.target),S=o&&o.contains(t.target),X=t.target.classList&&t.target.classList.contains("tab-close");(!w&&!S||X)&&J()}catch(a){v(a,"handleClickOutside")}},$e=t=>{try{t.key==="Escape"&&A.value&&(t.preventDefault(),J())}catch(a){v(a,"handleKeydown")}},Fe=t=>{try{const a=document.querySelectorAll(".dropdown-item:not(:disabled)"),o=Array.from(a).findIndex(w=>w===document.activeElement);switch(t.key){case"ArrowDown":t.preventDefault();const w=o<a.length-1?o+1:0;a[w]?.focus();break;case"ArrowUp":t.preventDefault();const S=o>0?o-1:a.length-1;a[S]?.focus();break;case"Enter":case" ":t.preventDefault(),document.activeElement.classList.contains("dropdown-item")&&document.activeElement.click();break;case"Escape":t.preventDefault(),J(),E.value?.focus();break}}catch(a){v(a,"handleDropdownKeydown")}};W(async()=>{try{await Promise.all([G({useCache:!0}),r.loadSelectedMatieresIds(),r.loadFavoriteMatieresIds(),r.loadActiveMatiereId()]),p.value.length>0&&r.selectedMatieresIds.length===0&&(r.addMatiereId(p.value[0].id),Y(p.value[0].id)),r.activeMatiereId&&(g.value=r.activeMatiereId),document.addEventListener("click",we,{passive:!0}),document.addEventListener("keydown",$e,{passive:!0}),oe=()=>{A.value&&(j.value=be(E.value||null))},window.addEventListener("resize",oe,{passive:!0});const t=()=>{K(),G({useCache:!1})};window.addEventListener("matieres-cache:invalidate",t),Me.push(t)}catch(t){v(t,"onMounted")}});const Me=[];let oe=null;return se(()=>{try{document.removeEventListener("click",we),document.removeEventListener("keydown",$e),oe&&window.removeEventListener("resize",oe);for(const t of Me)window.removeEventListener("matieres-cache:invalidate",t)}catch(t){v(t,"onUnmounted")}}),O(()=>d.matiereId,async t=>{if(_(t))try{p.value.length===0&&await G(),r.selectedMatieresIds.includes(Number(t))||r.addMatiereId(t),g.value||Y(Number(t))}catch(a){v(a,"watch matiereId")}},{immediate:!0}),O(()=>P.value,(t,a)=>{try{if(!g.value&&t.length>0){const o=r.activeMatiereId;o&&t.find(w=>w.id===o)&&(g.value=o)}}catch(o){v(o,"watch selectedMatieres")}}),O(()=>u.niveau_pays,async t=>{if(t)try{await G();const a=p.value.map(o=>o.id);r.selectedMatieresIds=r.selectedMatieresIds.filter(o=>a.includes(o)),r.selectedMatieresIds.length===0&&p.value.length>0&&(r.addMatiereId(p.value[0].id),Y(p.value[0].id))}catch(a){v(a,"watch userStore.niveau_pays")}},{immediate:!1}),O(()=>r.activeMatiereId,t=>{try{t!==g.value&&(t&&P.value.find(a=>a.id===t)?(g.value=t,m("matiere-changed",t)):t&&!r.selectedMatieresIds.includes(t)&&r.addMatiereId(t))}catch(a){v(a,"watch store activeMatiereId")}},{immediate:!1}),(t,a)=>(l(),c("div",ms,[(l(),ee(xe,{to:"body"},[I(vs,{visible:n.value.visible,x:n.value.x,y:n.value.y,"is-favorite":n.value.isFavorite,"matiere-id":n.value.matiereId,onFavoriteToggle:De,onClose:je},null,8,["visible","x","y","is-favorite","matiere-id"])])),h.value&&p.value.length===0?(l(),c("div",fs,a[2]||(a[2]=[e("div",{class:"loading-spinner"},null,-1),e("span",null,"Chargement des matières...",-1)]))):(l(),c("div",gs,[e("div",bs,[P.value.length===0?(l(),c("button",{key:0,class:"matiere-tab new-tab",onClick:a[0]||(a[0]=o=>_e(o)),disabled:h.value,title:"Ajouter une nouvelle matière",ref_key:"newMatiereButton",ref:E,"aria-label":"Ajouter une nouvelle matière"},a[3]||(a[3]=[e("span",{class:"tab-icon","aria-hidden":"true"},"+",-1),e("span",{class:"tab-name"},"New Matière",-1)]),8,_s)):k("",!0),(l(!0),c(U,null,Q(P.value,o=>(l(),c("div",{key:`tab-${o.id}`,class:q(["matiere-tab",{active:g.value===o.id,loading:f.value===o.id}]),onClick:w=>Y(o.id),onMousedown:w=>qe(w,o.id),onContextmenu:H(w=>re(w,o),["prevent"]),title:`Voir ${o.nom}`,"aria-label":`Matière ${o.nom}`,"aria-selected":g.value===o.id,role:"tab"},[e("span",{class:"tab-icon",innerHTML:o.svg_icon||"📚","aria-hidden":"true"},null,8,ks),e("span",ws,$(o.nom),1),e("span",$s,$(C(o.nom)),1),e("button",{class:"tab-close",onClick:H(w=>ae(o.id),["stop"]),title:`Fermer ${o.nom}`,"aria-label":`Fermer l'onglet ${o.nom}`,disabled:h.value}," × ",8,Ms)],42,ys))),128)),P.value.length>0?(l(),c("button",{key:1,class:"matiere-tab new-tab-small",onClick:a[1]||(a[1]=o=>_e(o)),disabled:h.value||M.value.length===0,title:"Ajouter une nouvelle matière",ref_key:"newMatiereButton",ref:E,"aria-label":"Ajouter une nouvelle matière"},a[4]||(a[4]=[e("span",{class:"tab-icon","aria-hidden":"true"},"+",-1)]),8,xs)):k("",!0)]),(l(),ee(xe,{to:"body"},[A.value?(l(),c("div",{key:0,class:"matiere-dropdown",style:ne(j.value),role:"listbox","aria-label":"Liste des matières disponibles",onKeydown:Fe},[e("div",{class:"dropdown-header"},[a[5]||(a[5]=e("span",{class:"dropdown-title"},"Matières disponibles",-1)),e("button",{class:"dropdown-close",onClick:J,"aria-label":"Fermer la liste"}," × ")]),(l(!0),c(U,null,Q(M.value,(o,w)=>(l(),c("div",{key:`dropdown-${o.id}`,class:q(["dropdown-item",{"last-item":w===M.value.length-1,loading:f.value===o.id}]),onClick:S=>ye(o),onContextmenu:H(S=>re(S,o),["prevent"]),role:"option","aria-selected":!1,title:`Ouvrir ${o.nom}`},[e("div",Is,[e("span",{class:"dropdown-icon",innerHTML:o.svg_icon||"📚","aria-hidden":"true"},null,8,Ss),e("span",As,$(o.nom),1)]),e("button",{class:q(["dropdown-star",{favorite:x(r).isFavoriteMatiere(o.id),loading:y.value===o.id}]),onClick:H(S=>ke(o.id),["stop"]),title:x(r).isFavoriteMatiere(o.id)?"Retirer des favoris":"Ajouter aux favoris","aria-label":x(r).isFavoriteMatiere(o.id)?`Retirer ${o.nom} des favoris`:`Ajouter ${o.nom} aux favoris`,disabled:y.value===o.id},[e("span",Ts,$(x(r).isFavoriteMatiere(o.id)?"⭐":"☆"),1)],10,Es)],42,Cs))),128)),M.value.length===0?(l(),c("div",zs,a[6]||(a[6]=[e("span",{class:"empty-icon"},"📚",-1),e("span",{class:"empty-text"},"Toutes les matières sont déjà ouvertes",-1)]))):k("",!0)],36)):k("",!0)])),b.value.length>0?(l(),c("div",Ls,[e("div",Ns,[a[7]||(a[7]=e("div",{class:"favorites-label"},[e("span",{class:"favorites-icon","aria-hidden":"true"},"⭐"),e("span",{class:"favorites-text"},"Favoris:")],-1)),e("div",qs,[(l(!0),c(U,null,Q(b.value,o=>(l(),c("button",{key:`favorite-${o.id}`,class:q(["favorite-item",{active:g.value===o.id,loading:f.value===o.id}]),onClick:w=>ye(o),onContextmenu:H(w=>re(w,o),["prevent"]),title:`Ouvrir ${o.nom}`,"aria-label":`Ouvrir la matière favorite ${o.nom}`,disabled:f.value===o.id},[e("span",{class:"favorite-icon",innerHTML:o.svg_icon||"📚","aria-hidden":"true"},null,8,Ds),e("span",Ps,$(o.nom),1),e("span",Fs,$(C(o.nom)),1)],42,js))),128))]),b.value.length>de?(l(),c("button",{key:0,class:"favorites-toggle",onClick:Pe,title:N.value?"Réduire les favoris":"Voir tous les favoris","aria-label":N.value?"Réduire la liste des favoris":"Voir tous les favoris"},$(N.value?"‹":"›"),9,Hs)):k("",!0)])])):k("",!0)]))]))}},Vs=D(Bs,[["__scopeId","data-v-d17a96e1"]]),Rs={class:"header-center"},Us={__name:"ConditionalHeader",props:{subjectPages:{type:Array,default:()=>["Calculator","Exercises","Sheets"]},searchPages:{type:Array,default:()=>["Dashboard","Chapitres","Notions"]},chapterPages:{type:Array,default:()=>["Exercices","ChapterQuiz","CourseChapitre","QuizChapitres","CourseChapitres","Chapitres"]},matierePages:{type:Array,default:()=>["Dashboard","Themes","Notions","Exercises","OnlineCourses","CourseNotions","Quiz","QuizNotions","Sheets"]},subjectProps:{type:Object,default:()=>({})},searchProps:{type:Object,default:()=>({})},chapterProps:{type:Object,default:()=>({})},matiereProps:{type:Object,default:()=>({})}},emits:["subject-changed","search"],setup(i,{emit:s}){const d=i,m=s,r=ie(),u=T(()=>{const h=r.name;return h==="Quiz"||h==="QuizNotions"||h==="Dashboard"||d.matierePages.includes(h)?Vs:d.chapterPages.includes(h)?ds:d.subjectPages.includes(h)?ns:null}),n=T(()=>{const h=r.name;return h==="Quiz"||h==="QuizNotions"||h==="Dashboard"||d.matierePages.includes(h)?{matiereId:d.matiereProps.matiereId,...d.matiereProps}:d.chapterPages.includes(h)?{chapitreId:r.params.chapitreId,...d.chapterProps}:d.subjectPages.includes(h)?{...d.subjectProps}:{...d.searchProps}}),p=h=>{m("subject-changed",h)};return(h,f)=>(l(),c("div",Rs,[(l(),ee(me(u.value),He(n.value,{onSubjectChanged:p}),null,16))]))}},Qs=D(Us,[["__scopeId","data-v-ad5d71d5"]]),Ks={class:"notification-center"},Ws={key:0,class:"notification-badge"},Gs={class:"notification-header"},Js={class:"notification-actions"},Xs={class:"notification-list"},Zs=["onClick"],Ys={class:"notification-item-icon"},ea={class:"icon"},ta={class:"notification-item-content"},sa={class:"notification-item-title"},aa={class:"notification-item-message"},oa={class:"notification-item-time"},na={key:0,class:"unread-indicator"},ia=["onClick"],ra={key:0,class:"notification-empty"},la={__name:"NotificationCenter",setup(i){const s=We(),d=L(!1),m=T(()=>s.notifications),r=T(()=>s.unreadCount),u=T(()=>s.hasUnread);function n(){d.value=!d.value}function p(){d.value=!1}const{markAsRead:h,markAllAsRead:f,removeNotification:y,clearAll:g,loadFromServer:A}=s;async function N(v){if(!v.read)try{await h(v.id)}catch{}v.type}async function E(v){y(v);try{await Je(v)}catch{}}async function j(){g();try{await Ge()}catch{}}function P(v){return{xp_gained:"⭐",level_up:"🏆",exercise_unlocked:"🔓",chapter_completed:"✅",achievement:"🏅",daily_streak:"🔥"}[v]||"🔔"}function M(v){const C=new Date,_=new Date(v),z=C-_,F=Math.floor(z/(1e3*60)),K=Math.floor(F/60),Z=Math.floor(K/24);return F<1?"À l'instant":F<60?`Il y a ${F}min`:K<24?`Il y a ${K}h`:Z<7?`Il y a ${Z}j`:_.toLocaleDateString("fr-FR",{day:"numeric",month:"short"})}function b(v){v.key==="Escape"&&d.value&&p()}return W(()=>{document.addEventListener("keydown",b);try{A()}catch{}}),se(()=>{document.removeEventListener("keydown",b)}),(v,C)=>(l(),c("div",Ks,[e("button",{class:q(["notification-trigger",{"has-notifications":u.value}]),onClick:n,"aria-label":"Notifications",title:"Notifications"},[I(x(Ze),{class:"notification-icon"}),r.value>0?(l(),c("span",Ws,$(r.value>99?"99+":r.value),1)):k("",!0)],2),I(Ee,{name:"notification-panel"},{default:he(()=>[d.value?(l(),c("div",{key:0,class:"notification-panel",onClick:C[1]||(C[1]=H(()=>{},["stop"]))},[e("div",Gs,[C[2]||(C[2]=e("h3",{class:"notification-title"},"Notifications",-1)),e("div",Js,[u.value?(l(),c("button",{key:0,onClick:C[0]||(C[0]=(..._)=>x(f)&&x(f)(..._)),class:"btn-mark-all-read",title:"Tout marquer comme lu"}," ✓ Tout lire ")):k("",!0),e("button",{onClick:j,class:"btn-clear-all",title:"Effacer tout"}," 🗑️ "),e("button",{onClick:p,class:"btn-close",title:"Fermer"}," ✕ ")])]),e("div",Xs,[I(Oe,{name:"notification-item",tag:"div"},{default:he(()=>[(l(!0),c(U,null,Q(m.value,_=>(l(),c("div",{key:_.id,class:q(["notification-item",[`type-${_.type}`,{unread:!_.read}]]),onClick:z=>N(_)},[e("div",Ys,[e("span",ea,$(P(_.type)),1)]),e("div",ta,[e("h4",sa,$(_.title),1),e("p",aa,$(_.message),1),e("time",oa,$(M(_.timestamp)),1)]),_.read?k("",!0):(l(),c("div",na)),e("button",{onClick:H(z=>E(_.id),["stop"]),class:"btn-remove-notification",title:"Supprimer"}," ✕ ",8,ia)],10,Zs))),128))]),_:1}),m.value.length===0?(l(),c("div",ra,C[3]||(C[3]=[e("div",{class:"empty-icon"},"🔔",-1),e("p",{class:"empty-message"},"Aucune notification",-1),e("p",{class:"empty-subtitle"},"Vous recevrez des notifications pour vos progrès !",-1)]))):k("",!0)])])):k("",!0)]),_:1}),d.value?(l(),c("div",{key:0,class:"notification-overlay",onClick:p})):k("",!0)]))}},ca=D(la,[["__scopeId","data-v-3fc20629"]]),da={class:"dashboard-header"},ua={class:"header-right"},ha={__name:"DashboardHeader",emits:["toggle-sidebar","subject-changed","search"],setup(i,{emit:s}){const d=s;te();const m=n=>{d("subject-changed",n)},r=n=>{d("search",n)},u=()=>{};return(n,p)=>(l(),c("header",da,[e("button",{class:"burger-btn-fixed",onClick:p[0]||(p[0]=h=>n.$emit("toggle-sidebar")),"aria-label":"Ouvrir ou fermer le menu"},p[1]||(p[1]=[e("span",{class:"burger-icon-fixed"},"☰",-1)])),I(Qs,{"matiere-props":{matiereId:null},onSubjectChanged:m,onSearch:r}),e("div",ua,[I(ca),I(ts,{onLogout:u})])]))}},pa=D(ha,[["__scopeId","data-v-619dde50"]]),va={name:"AIAssistant",props:{autoFocus:{type:Boolean,default:!1}},data(){return{currentMessage:"",selectedModel:"gpt-3.5-turbo",messages:[],isLoading:!1,error:null,conversationId:null}},watch:{currentMessage:{handler(){this.$nextTick(()=>{this.autoResizeTextarea()})}}},async mounted(){await this.loadConversationHistory(),this.autoFocus&&this.$refs.messageInput&&this.$nextTick(()=>{this.$refs.messageInput.focus()})},methods:{async sendMessage(i){if(!this.currentMessage.trim()||this.isLoading)return;const s={role:"user",content:this.currentMessage.trim(),timestamp:new Date};this.messages.push(s);const d=this.currentMessage.trim();this.currentMessage="",this.$nextTick(()=>{this.scrollToBottom()}),await this.sendToAI(d)},async sendSuggestion(i){this.currentMessage=i,await this.sendMessage()},async sendToAI(i){this.isLoading=!0,this.error=null;try{const s=await Se.post("/api/ai/ask/",{message:i,model:this.selectedModel},{headers:{Authorization:`Bearer ${this.getAuthToken()}`}}),d={role:"assistant",content:s.data.ai_response,timestamp:new Date,tokens:s.data.tokens_used};this.messages.push(d),this.$nextTick(()=>{this.scrollToBottom()})}catch(s){this.error=s.response?.data?.error||s.response?.data?.message||"Erreur lors de la requête IA";const d={role:"assistant",content:"Désolé, une erreur s'est produite. Veuillez réessayer.",timestamp:new Date,isError:!0};this.messages.push(d)}finally{this.isLoading=!1}},async loadConversationHistory(){try{const i=this.getAuthToken();if(!i)return;const s=await Se.get("/api/ai/history/",{headers:{Authorization:`Bearer ${i}`}});this.messages=[],Array.isArray(s.data)?s.data.forEach((d,m)=>{this.messages.push({role:"user",content:d.message,timestamp:new Date(d.created_at)}),this.messages.push({role:"assistant",content:d.ai_response,timestamp:new Date(d.created_at),tokens:d.tokens_used})}):s.data&&typeof s.data=="object"&&s.data.results&&Array.isArray(s.data.results)&&s.data.results.forEach(d=>{this.messages.push({role:"user",content:d.message,timestamp:new Date(d.created_at)}),this.messages.push({role:"assistant",content:d.ai_response,timestamp:new Date(d.created_at),tokens:d.tokens_used})}),this.$nextTick(()=>{this.scrollToBottom()})}catch(i){i.response?i.response.status===401||i.response.status:i.request,this.messages=[]}},clearChat(){this.messages=[],this.conversationId=null},addNewLine(){this.currentMessage+=`
`},scrollToBottom(){this.$refs.messagesContainer&&(this.$refs.messagesContainer.scrollTop=this.$refs.messagesContainer.scrollHeight)},autoResizeTextarea(){const i=this.$refs.messageInput;i&&(i.style.height="auto",i.style.height=Math.min(i.scrollHeight,120)+"px")},formatMessage(i){return i.replace(/\n/g,"<br>")},formatTime(i){return i.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})},getAuthToken(){return localStorage.getItem("access_token")||""}}},ma={class:"chatgpt-container"},fa={class:"chat-header"},ga={class:"header-info"},ba={class:"header-text"},_a={class:"status"},ya={class:"header-actions"},ka={class:"messages-container",ref:"messagesContainer"},wa={key:0,class:"welcome-message"},$a={class:"welcome-content"},Ma={key:0,class:"auth-warning"},xa={class:"suggestions"},Ca={class:"suggestion-tags"},Ia={class:"message-avatar"},Sa={key:0,class:"avatar-icon user"},Aa={key:1,class:"avatar-icon ai"},Ea={class:"message-content"},Ta={class:"message-bubble"},za={key:0,class:"message-text"},La=["innerHTML"],Na={key:2,class:"message-meta"},qa={class:"tokens-info"},ja={key:0,class:"message-time"},Da={key:1,class:"message-wrapper ai-message"},Pa={class:"input-container"},Fa={class:"input-wrapper"},Ha=["disabled"],Oa=["disabled"],Ba={key:0,class:"loading-spinner"},Va={key:1},Ra={key:0,class:"error-toast"};function Ua(i,s,d,m,r,u){return l(),c("div",ma,[e("div",fa,[e("div",ga,[s[10]||(s[10]=e("div",{class:"ai-avatar"},[e("span",{class:"avatar-icon"},"🤖")],-1)),e("div",ba,[s[9]||(s[9]=e("h3",null,"Assistant IA OptiTAB",-1)),e("span",_a,[e("span",{class:q(["status-dot",{online:!r.isLoading}])},null,2),le(" "+$(r.isLoading?"En train d'écrire...":"En ligne"),1)])])]),e("div",ya,[e("button",{onClick:s[0]||(s[0]=(...n)=>u.clearChat&&u.clearChat(...n)),class:"clear-btn",title:"Nouvelle conversation"}," 🗑️ ")])]),e("div",ka,[r.messages.length===0?(l(),c("div",wa,[e("div",$a,[s[13]||(s[13]=e("h4",null,"👋 Bonjour ! Je suis votre assistant pédagogique IA",-1)),s[14]||(s[14]=e("p",null,"Je peux vous aider avec vos questions de mathématiques en me basant sur les exercices et cours disponibles dans OptiTAB.",-1)),u.getAuthToken()?k("",!0):(l(),c("div",Ma,s[11]||(s[11]=[e("p",null,[le("⚠️ "),e("strong",null,"Connexion requise :"),le(" Connectez-vous pour utiliser l'assistant IA")],-1)]))),e("div",xa,[s[12]||(s[12]=e("p",null,"Essayez de me demander :",-1)),e("div",Ca,[e("span",{onClick:s[1]||(s[1]=n=>u.sendSuggestion("Explique-moi les dérivées")),class:"tag"},"Explique-moi les dérivées"),e("span",{onClick:s[2]||(s[2]=n=>u.sendSuggestion("Donne-moi un exercice sur les intégrales")),class:"tag"},"Exercice sur les intégrales"),e("span",{onClick:s[3]||(s[3]=n=>u.sendSuggestion("Comment résoudre une équation du second degré")),class:"tag"},"Équation du second degré")])])])])):k("",!0),(l(!0),c(U,null,Q(r.messages,(n,p)=>(l(),c("div",{key:p,class:q(["message-wrapper",{"user-message":n.role==="user","ai-message":n.role==="assistant"}])},[e("div",Ia,[n.role==="user"?(l(),c("span",Sa,"👤")):(l(),c("span",Aa,"🤖"))]),e("div",Ea,[e("div",Ta,[n.role==="user"?(l(),c("div",za,$(n.content),1)):(l(),c("div",{key:1,class:"message-text",innerHTML:u.formatMessage(n.content)},null,8,La)),n.role==="assistant"&&n.tokens?(l(),c("div",Na,[e("span",qa,$(n.tokens)+" tokens utilisés",1)])):k("",!0)]),n.role==="assistant"?(l(),c("div",ja,$(u.formatTime(n.timestamp)),1)):k("",!0)])],2))),128)),r.isLoading?(l(),c("div",Da,s[15]||(s[15]=[Be('<div class="message-avatar" data-v-6a4cf4d4><span class="avatar-icon ai" data-v-6a4cf4d4>🤖</span></div><div class="message-content" data-v-6a4cf4d4><div class="message-bubble typing" data-v-6a4cf4d4><div class="typing-dots" data-v-6a4cf4d4><span data-v-6a4cf4d4></span><span data-v-6a4cf4d4></span><span data-v-6a4cf4d4></span></div></div></div>',2)]))):k("",!0)],512),e("div",Pa,[e("div",Fa,[fe(e("textarea",{"onUpdate:modelValue":s[4]||(s[4]=n=>r.currentMessage=n),onKeydown:[s[5]||(s[5]=Ce(H((...n)=>i.simpleSend&&i.simpleSend(...n),["exact","prevent"]),["enter"])),s[6]||(s[6]=Ce(H((...n)=>u.addNewLine&&u.addNewLine(...n),["shift","exact"]),["enter"]))],placeholder:"Posez votre question sur les mathématiques... (Enter pour envoyer)",class:"message-input",disabled:r.isLoading,rows:"1",ref:"messageInput"},null,40,Ha),[[Ve,r.currentMessage]]),e("button",{onClick:s[7]||(s[7]=(...n)=>i.simpleSend&&i.simpleSend(...n)),class:q(["send-btn",{active:r.currentMessage.trim()}]),disabled:!r.currentMessage.trim()||r.isLoading,title:"Envoyer le message"},[r.isLoading?(l(),c("span",Ba,"⏳")):(l(),c("span",Va,"📤"))],10,Oa)])]),r.error?(l(),c("div",Ra,[s[16]||(s[16]=e("span",{class:"error-icon"},"⚠️",-1)),e("span",null,$(r.error),1),e("button",{onClick:s[8]||(s[8]=n=>r.error=null),class:"error-close"},"✕")])):k("",!0)])}const Qa=D(va,[["render",Ua],["__scopeId","data-v-6a4cf4d4"]]),Ka={name:"AIModal",components:{AIAssistant:Qa},props:{showModal:{type:Boolean,default:!1}},methods:{closeModal(){this.$emit("close")}}},Wa={class:"ai-modal-header"};function Ga(i,s,d,m,r,u){const n=ze("AIAssistant");return d.showModal?(l(),c("div",{key:0,class:"ai-modal-overlay",onClick:s[2]||(s[2]=(...p)=>u.closeModal&&u.closeModal(...p))},[e("div",{class:"ai-modal-content",onClick:s[1]||(s[1]=H(()=>{},["stop"]))},[e("div",Wa,[s[3]||(s[3]=e("h3",null,"🤖 Assistant IA OptiTAB",-1)),e("button",{onClick:s[0]||(s[0]=(...p)=>u.closeModal&&u.closeModal(...p)),class:"close-btn"},"✕")]),I(n,{"auto-focus":!0})])])):k("",!0)}const Ja=D(Ka,[["render",Ga],["__scopeId","data-v-a6e60a7a"]]),Xa={name:"AIFloatingButton",components:{AIModal:Ja},props:{},data(){return{showModal:!1}},methods:{toggleModal(){this.showModal=!this.showModal},closeModal(){this.showModal=!1}}},Za={class:"ai-floating-container"};function Ya(i,s,d,m,r,u){const n=ze("AIModal");return l(),c("div",Za,[e("button",{onClick:s[0]||(s[0]=(...p)=>u.toggleModal&&u.toggleModal(...p)),class:q(["ai-floating-btn",{active:r.showModal}]),title:"Assistant IA OptiTAB"},s[1]||(s[1]=[e("span",{class:"ai-icon"},"🤖",-1),e("span",{class:"ai-text"},"IA",-1)]),2),I(n,{"show-modal":r.showModal,onClose:u.closeModal},null,8,["show-modal","onClose"])])}const eo=D(Xa,[["render",Ya],["__scopeId","data-v-7f0a5cf2"]]),to={class:"dashboard-layout"},so={class:"dashboard-main-container"},ao={class:"dashboard-content"},oo={class:"dashboard-main"},no={__name:"DashboardLayout",emits:["sidebar-toggle","navigation","subject-changed"],setup(i,{emit:s}){const d=s,m=L(null),r=ie(),u=L(!0),n=L(!1),p=()=>{n.value=!n.value,localStorage.setItem("sidebar-collapsed",n.value.toString())},h=y=>{d("navigation",y)},f=y=>{d("subject-changed",y)};return W(async()=>{const y=localStorage.getItem("sidebar-open");y!==null&&(u.value=y==="true");const g=localStorage.getItem("sidebar-collapsed");g!==null&&(n.value=g==="true"),await pe(),m.value}),O(()=>r.path,(y,g)=>{},{immediate:!1}),O(()=>n.value,(y,g)=>{},{immediate:!1}),(y,g)=>(l(),c("div",to,[I(pa,{sidebarOpen:u.value,onToggleSidebar:p,onSubjectChanged:f},null,8,["sidebarOpen"]),e("div",so,[fe(I(jt,{collapsed:n.value,onNavigation:h,onToggleCollapsed:p,ref_key:"sidebarRef",ref:m},null,8,["collapsed"]),[[Te,u.value]]),k("",!0),e("div",ao,[e("main",oo,[Re(y.$slots,"default",{},void 0,!0)])])]),I(eo)]))}},ho=D(no,[["__scopeId","data-v-e7b473a2"]]);export{ho as D,Ye as r};
