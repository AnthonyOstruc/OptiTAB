import{_ as E,G as T,q as V,m as F,M as H,h as c,p as L,f as b,w as R,C as j,o as v,a as r,c as A,t as P}from"./index-C20tTf3S.js";import{D as J}from"./DashboardLayout-DmmXvv68.js";import{h as I,e as N,b as x}from"./curriculum-C6dJwtfd.js";import{C as O}from"./ChapitresListView-OP62dzKt.js";import"./menuItems-zei-A9he.js";import"./matieres-Ce1WeeoH.js";import"./BackButton-B9UoO6zr.js";const q={class:"chapitres-section"},z={key:0,class:"chapitres-loader"},G={key:1,class:"chapitres-error"},K=12e4,U={__name:"Chapitres",setup(Z){const C=H(),f=j(),y=T();V(),F(()=>y.activeMatiereId||C.params.matiereId);const l=c(null);function M(){const t=l.value||y.activeMatiereId||C.params.matiereId;t?f.push({name:"Themes",params:{matiereId:String(t)}}):f.push({name:"Exercises"})}const o=c([]),u=c(""),p=c(!0),h=c("");function g(t){return`chapitres_meta:${t}`}function B(t){try{const e=localStorage.getItem(g(t));if(!e)return null;const a=JSON.parse(e);return!a?.t||!a?.v||Date.now()-a.t>K?null:a.v}catch{return null}}function m(t,e){try{localStorage.setItem(g(t),JSON.stringify({t:Date.now(),v:e}))}catch{}}async function _(){const t=C.params.notionId;if(t){p.value=!0,h.value="";try{const e=B(t);if(e){u.value=e.notion?.nom||e.notion?.titre||"Notion",l.value=e.notion?.matiere||null,o.value=Array.isArray(e.chapitres)?e.chapitres:[],p.value=!1,I(t).then(n=>{const i=n?.data||n,w=i?.notion||{},S=i?.chapitres||[];w&&Array.isArray(S)&&m(t,{notion:w,chapitres:S})}).catch(async()=>{try{const[n,i]=await Promise.all([N(t),x(t)]);m(t,{notion:n,chapitres:Array.isArray(i)?i:[]})}catch{}});return}const a=await I(t),s=a?.data||a,d=s?.notion||{},k=s?.chapitres||[];u.value=d?.nom||d?.titre||"Notion",l.value=d?.matiere||null,o.value=Array.isArray(k)?k:[],m(t,{notion:d,chapitres:o.value}),console.log("[Chapitres] Chapitres chargés:",o.value.length)}catch(e){console.error("[Chapitres] Erreur endpoint chapitres-avec-meta:",e);try{const[a,s]=await Promise.all([N(t),x(t)]);u.value=a?.nom||a?.titre||"Notion",l.value=a?.matiere||null,o.value=Array.isArray(s)?s:[],m(t,{notion:a,chapitres:o.value}),console.log("[Chapitres] Fallback utilisé, chapitres:",o.value.length)}catch(a){console.error("[Chapitres] Fallback échoué:",a),h.value="Impossible de charger les chapitres. Veuillez réessayer."}}finally{p.value=!1}}}L(()=>{_()});function D(t){f.push({name:"Exercices",params:{chapitreId:t}})}return(t,e)=>(v(),b(J,null,{default:R(()=>[r("section",q,[p.value?(v(),A("div",z,e[0]||(e[0]=[r("div",{class:"loader-spinner"},null,-1),r("p",null,"Chargement des chapitres...",-1)]))):h.value?(v(),A("div",G,[e[1]||(e[1]=r("div",{class:"error-icon"},[r("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[r("path",{d:"M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),e[2]||(e[2]=r("h3",null,"Erreur de chargement",-1)),r("p",null,P(h.value),1),r("button",{class:"retry-button",onClick:_}," Réessayer ")])):(v(),b(O,{key:2,title:u.value,chapitres:o.value,"back-button-text":"Retour aux thèmes","back-action":M,"on-chapitre-click":D},null,8,["title","chapitres"]))])]),_:1}))}},at=E(U,[["__scopeId","data-v-ce9b4c1f"]]);export{at as default};
