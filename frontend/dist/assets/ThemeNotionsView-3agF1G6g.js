import{A as J,a as h,e as K,D as O,ap as P,b as i,o as s,d as a,a1 as F,t as f,F as b,s as S,i as W,h as M}from"./vendor-1gmgAmFu.js";import{_ as G,u as Q}from"./index-DdsjLnq7.js";import{a as X}from"./themes-CG51KgNx.js";import{N as R}from"./NotionCard-B2D5LvaP.js";const Y={class:"tnv-wrapper"},Z={key:0,class:"tnv-state tnv-loading"},tt={key:1,class:"tnv-state tnv-error"},et={key:2,class:"tnv-content"},ot={key:0,class:"tnv-themes"},nt={class:"tnv-theme-header"},rt={class:"tnv-theme-title"},st={class:"tnv-theme-count"},at={class:"tnv-notions-grid"},it={key:0,class:"tnv-no-notions"},lt={key:1,class:"tnv-fallback"},ct={class:"tnv-notions-grid"},L=12e4,dt={__name:"ThemeNotionsView",props:{matiereId:{type:[Number,String],required:!0},notionRouteName:{type:String,required:!0}},setup(T){const w=T,U=J(),A=Q(),m=h(!1),y=h(""),u=h([]),l=h({}),k=h([]);function B(o){U.push({name:w.notionRouteName,params:{notionId:o}})}const $=new Map;function D(o){return`tnv_cache:${E(o)}`}function q(o){try{const e=localStorage.getItem(D(o));if(!e)return null;const t=JSON.parse(e);return!t||!t.t||!t.v||Date.now()-t.t>L?null:t}catch{return null}}function z(o,e){try{const t=JSON.stringify({t:Date.now(),v:e});localStorage.setItem(D(o),t)}catch{}}function E(o){const e=A.niveau_pays?.id||"n",t=A.pays?.id||"p";return`${o}|${e}|${t}`}let d=null;async function _(o){if(!o)return;y.value="";const e=E(o),t=$.get(e)||q(o);t&&Date.now()-t.t<L?(u.value=t.v.themes,l.value=t.v.themeToNotions,k.value=t.v.directNotions,m.value=!1):m.value=!0;try{if(d)try{d.abort()}catch{}d=new AbortController;const{data:r}=await X({matiere:o,signal:d.signal}),N=Array.isArray(r?.themes)?r.themes:[],H=[...N].sort((n,c)=>{const v=Number(n?.ordre??0),p=Number(c?.ordre??0);if(v!==p)return v-p;const C=(n?.nom??n?.titre??"").toString(),x=(c?.nom??c?.titre??"").toString();return C.localeCompare(x)}),V=Array.isArray(r?.notions)?r.notions:[],j=(n,c)=>{const v=Number(n?.ordre??0),p=Number(c?.ordre??0);if(v!==p)return v-p;const C=(n?.nom??n?.titre??"").toString(),x=(c?.nom??c?.titre??"").toString();return C.localeCompare(x)},g={};for(const n of[...V].sort(j))g[n.theme]||(g[n.theme]=[]),g[n.theme].push(n);u.value=H,l.value=g,k.value=N.length===0?[...V.filter(n=>!n.theme)].sort(j):[];const I={themes:u.value,themeToNotions:l.value,directNotions:k.value};$.set(e,{t:Date.now(),v:I}),z(o,I)}catch(r){if(r?.name==="CanceledError"||r?.name==="AbortError")return;y.value="Erreur lors du chargement des concepts"}finally{m.value=!1}}return K(()=>_(w.matiereId)),O(()=>w.matiereId,o=>_(o)),P(()=>{if(d)try{d.abort()}catch{}}),(o,e)=>(s(),i("div",Y,[m.value?(s(),i("div",Z,e[1]||(e[1]=[a("div",{class:"tnv-spinner"},null,-1),a("p",null,"Chargement des concepts...",-1)]))):y.value?(s(),i("div",tt,[e[2]||(e[2]=F('<div class="tnv-error-icon" data-v-7640a1c3><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-7640a1c3><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" data-v-7640a1c3></circle><line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2" data-v-7640a1c3></line><line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2" data-v-7640a1c3></line></svg></div>',1)),a("p",null,f(y.value),1),a("button",{class:"tnv-retry",onClick:e[0]||(e[0]=t=>_(T.matiereId))},"Réessayer")])):(s(),i("div",et,[u.value.length>0?(s(),i("div",ot,[(s(!0),i(b,null,S(u.value,t=>(s(),i("div",{key:t.id,class:"tnv-theme-block"},[a("div",nt,[a("h2",rt,f(t.nom),1),a("div",st,f((l.value[t.id]||[]).length)+" concept"+f((l.value[t.id]||[]).length>1?"s":""),1)]),a("div",at,[(s(!0),i(b,null,S(l.value[t.id]||[],r=>(s(),M(R,{key:r.id,title:r.nom,description:r.description||"",onClick:N=>B(r.id)},null,8,["title","description","onClick"]))),128)),l.value[t.id]&&l.value[t.id].length?W("",!0):(s(),i("div",it,e[3]||(e[3]=[F('<div class="tnv-empty-icon" data-v-7640a1c3><svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-7640a1c3><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-7640a1c3></path><polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-7640a1c3></polyline><line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-7640a1c3></line><line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-7640a1c3></line><polyline points="10,9 9,9 8,9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-7640a1c3></polyline></svg></div><p data-v-7640a1c3>Aucun concept disponible</p>',2)])))])]))),128))])):(s(),i("div",lt,[e[4]||(e[4]=a("div",{class:"tnv-fallback-header"},[a("h3",null,"Concepts disponibles"),a("p",null,"Explorez les concepts fondamentaux de cette matière")],-1)),a("div",ct,[(s(!0),i(b,null,S(k.value,t=>(s(),M(R,{key:t.id,title:t.nom,description:t.description||"",onClick:r=>B(t.id)},null,8,["title","description","onClick"]))),128))])]))]))]))}},mt=G(dt,[["__scopeId","data-v-7640a1c3"]]);export{mt as T};
