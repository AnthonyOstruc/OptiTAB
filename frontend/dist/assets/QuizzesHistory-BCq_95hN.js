import{a as m,c as H,h as E,C as N,A as T,o as l,d as s,j as I,b as u,l as f,n as p,t as a,F as z,s as x,i as j}from"./vendor-1gmgAmFu.js";import{D as K}from"./DashboardLayout-DOJbCPaM.js";import{B as G}from"./BaseHistory-ZQpMzJp2.js";import{_ as J,b as O}from"./index-DdsjLnq7.js";import"./menuItems-C0wivC9l.js";import"./matieres-DVwPPJpo.js";import"./ui-jaH5oyHW.js";import"./curriculum-6-VMzQHc.js";import"./pdf-B39ievqC.js";import"./mathlive-B5k0jhbN.js";const P={class:"history-page"},U={class:"summary-table"},W={class:"summary-header"},X={class:"summary-row"},Y={class:"cell matiere"},Z={class:"cell notion"},w=["onClick"],tt={class:"notion-label"},et={class:"cell count"},st={class:"cell correct"},ot={class:"cell incorrect"},rt={key:0,class:"summary-details-row"},it={class:"details-cell"},at={class:"chapter-table"},nt={key:0,class:"chapter-loading"},ct={key:1,class:"chapter-error"},lt={key:2},ut={class:"cell chapitre"},dt={class:"cell count"},vt={class:"cell correct"},pt={class:"cell incorrect"},_t={class:"cell ratio"},mt={__name:"QuizzesHistory",setup(gt){const S=T(),D=r=>{const t=r?.chapitre?.id,o=r?.quiz_id;t&&S.push({path:`/quiz-exercices/${t}`,query:{quizId:o,autoStart:"true"}})},M=m([]),b=m([]),c=m("count"),d=m("desc"),h=m(new Set),_=m({}),A=r=>{const t=Array.isArray(r.quiz_list)?r.quiz_list:[];M.value=t,b.value=R(t)},B=H(()=>[...b.value||[]].sort((t,o)=>{const e=t[c.value]||0,i=o[c.value]||0;return d.value==="asc"?e-i:i-e})),y=r=>{c.value===r?d.value=d.value==="asc"?"desc":"asc":(c.value=r,d.value="desc")},F=r=>r===0?"0%":`${Math.round(r)}%`,$=r=>r>=90?"excellent":r>=75?"good":r>=50?"average":"poor",C=r=>`${r.matiere.id}-${r.notion.id}`,q=r=>h.value.has(C(r)),g=r=>{const t=C(r);return _.value[t]||(_.value[t]={loading:!1,error:"",chapters:[]}),_.value[t]},L=async r=>{const t=C(r);if(h.value.has(t)){h.value.delete(t);return}h.value.add(t);const o=g(r);o.chapters&&o.chapters.length>0||await Q(r.matiere.id,r.notion.id)},Q=async(r,t)=>{const o=`${r}-${t}`;_.value[o]={loading:!0,error:"",chapters:[]};try{const e=await O.get("/api/suivis/quiz/stats/",{params:{matiere:r,notion:t}}),i=Array.isArray(e?.data?.quiz_list)?e.data.quiz_list:[],n=V(i);_.value[o]={loading:!1,error:"",chapters:n}}catch(e){const i=e?.response?.data?.error||"Erreur lors du chargement des détails";_.value[o]={loading:!1,error:i,chapters:[]}}},R=r=>{const t=new Map;for(const e of r){const i=e?.matiere||{},n=e?.notion||{},v=`${i.id}-${n.id}`;t.has(v)||t.set(v,{matiere:{id:i.id,titre:i.titre||""},notion:{id:n.id,titre:n.titre||""},count:0,correct_count:0,incorrect_count:0});const k=t.get(v);k.count+=1,(e.score_on_10||0)>=7?k.correct_count+=1:k.incorrect_count+=1}const o=Array.from(t.values()).map(e=>({...e,average_percent:e.count>0?e.correct_count/e.count*100:0}));return o.sort((e,i)=>String(e.matiere.titre).localeCompare(String(i.matiere.titre),"fr",{sensitivity:"base"})||String(e.notion.titre).localeCompare(String(i.notion.titre),"fr",{sensitivity:"base"})),o},V=r=>{const t=new Map;for(const e of r){const i=e?.chapitre||{},n=i?.id;if(!n)continue;t.has(n)||t.set(n,{chapitre:{id:n,titre:i?.titre||"Chapitre"},count:0,correct_count:0,incorrect_count:0,sum_score_10:0});const v=t.get(n);v.count+=1,v.sum_score_10+=Number(e.score_on_10||0),(e.score_on_10||0)>=7?v.correct_count+=1:v.incorrect_count+=1}const o=Array.from(t.values()).map(e=>{const i=e.count>0?e.correct_count/e.count:0,n=e.count>0?e.sum_score_10/e.count:0;return{...e,ratio_percent:i*100,average_10:Math.round(n*10)/10,average_percent:i*100}});return o.sort((e,i)=>String(e.chapitre.titre).localeCompare(String(i.chapitre.titre),"fr",{sensitivity:"base"})),o};return(r,t)=>(l(),E(K,null,{default:N(()=>[s("div",P,[t[12]||(t[12]=s("h2",{class:"page-title"},"Historique complet des quiz",-1)),I(G,{title:"🧠 Historique des Quiz","list-title":"📝 Tous mes quiz","loading-text":"Chargement de l'historique...","api-endpoint":"/api/suivis/quiz/stats/","items-per-page":12,"navigation-handler":D,onDataLoaded:A},{"matiere-notion-stats":N(()=>[s("div",U,[s("div",W,[t[8]||(t[8]=s("div",null,"Matière",-1)),t[9]||(t[9]=s("div",null,"Notion",-1)),s("div",{class:"sortable-header",onClick:t[0]||(t[0]=o=>y("count"))},[t[4]||(t[4]=f(" Faits ")),s("span",{class:p(["sort-icon",{active:c.value==="count"}])},a(c.value==="count"&&d.value==="asc"?"↑":"↓"),3)]),s("div",{class:"sortable-header",onClick:t[1]||(t[1]=o=>y("correct_count"))},[t[5]||(t[5]=f(" Réussis ")),s("span",{class:p(["sort-icon",{active:c.value==="correct_count"}])},a(c.value==="correct_count"&&d.value==="asc"?"↑":"↓"),3)]),s("div",{class:"sortable-header",onClick:t[2]||(t[2]=o=>y("incorrect_count"))},[t[6]||(t[6]=f(" Ratés ")),s("span",{class:p(["sort-icon",{active:c.value==="incorrect_count"}])},a(c.value==="incorrect_count"&&d.value==="asc"?"↑":"↓"),3)]),s("div",{class:"sortable-header",onClick:t[3]||(t[3]=o=>y("average_percent"))},[t[7]||(t[7]=f(" Moyenne ")),s("span",{class:p(["sort-icon",{active:c.value==="average_percent"}])},a(c.value==="average_percent"&&d.value==="asc"?"↑":"↓"),3)])]),(l(!0),u(z,null,x(B.value,o=>(l(),u(z,{key:`${o.matiere.id}-${o.notion.id}`},[s("div",X,[s("div",Y,a(o.matiere.titre),1),s("div",Z,[s("button",{class:"notion-toggle",onClick:e=>L(o)},[s("span",tt,a(o.notion.titre),1),(l(),u("svg",{class:p(["chevron",{expanded:q(o)}]),width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},t[10]||(t[10]=[s("polyline",{points:"6,9 12,15 18,9"},null,-1)]),2))],8,w)]),s("div",et,a(o.count),1),s("div",st,a(o.correct_count),1),s("div",ot,a(o.incorrect_count),1),s("div",{class:p(["cell average",$(o.average_percent)])},a(F(o.average_percent)),3)]),q(o)?(l(),u("div",rt,[s("div",it,[s("div",at,[t[11]||(t[11]=s("div",{class:"chapter-header"},[s("div",null,"Chapitre"),s("div",null,"Faits"),s("div",null,"Réussis"),s("div",null,"Ratés"),s("div",null,"Réussite"),s("div",null,"Moyenne")],-1)),g(o).loading?(l(),u("div",nt,"Chargement des détails...")):g(o).error?(l(),u("div",ct,a(g(o).error),1)):(l(),u("div",lt,[(l(!0),u(z,null,x(g(o).chapters,e=>(l(),u("div",{key:e.chapitre.id,class:"chapter-row"},[s("div",ut,a(e.chapitre.titre),1),s("div",dt,a(e.count),1),s("div",vt,a(e.correct_count),1),s("div",pt,a(e.incorrect_count),1),s("div",_t,a(Math.round(e.ratio_percent))+"%",1),s("div",{class:p(["cell average",$(e.average_percent)])},a(Math.round(e.average_10*10)/10)+"/10",3)]))),128))]))])])])):j("",!0)],64))),128))])]),_:1})])]),_:1}))}},xt=J(mt,[["__scopeId","data-v-a7de866d"]]);export{xt as default};
