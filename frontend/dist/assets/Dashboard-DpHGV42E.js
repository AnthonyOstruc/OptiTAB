import{D as Xe}from"./DashboardLayout-BQxYtzur.js";import{_ as se,u as ve,f as Qe,a as Le,b as F,X as Ue,c as Ve,d as He,e as Be,g as Fe,h as qe,i as Je,r as We}from"./index-CaRFDJpf.js";import{a as _,c as T,C as Ee,A as te,b as a,o as t,d as e,n as Q,g as $,j as K,u as O,t as i,F as X,p as U,m as Pe,f as je,z as de,G as Ge,E as Te,k as ee,L as he,w as we,H as ze,y as Ce,i as ke,h as ne,B as Se,K as Ke}from"./vendor-JoY6QM7x.js";import{g as De,a as ue,b as Oe,c as Ye}from"./curriculum-1vPkSFMM.js";import{g as Me}from"./matieres-CW6TrQsL.js";import{g as Ze}from"./exercices-DnktByex.js";import{c as et}from"./quiz-DC1c3tez.js";import{useDailyObjectives as tt}from"./useDailyObjectives-Exur5uet.js";import"./menuItems-CGsFFYXe.js";import"./ui-jaH5oyHW.js";import"./pdf-B39ievqC.js";import"./mathlive-B5k0jhbN.js";const st={class:"leaderboard-card"},at={class:"leaderboard-header"},it={class:"leaderboard-tabs"},ot=["disabled"],nt={key:0,class:"flag"},lt=["disabled"],rt={key:0,class:"leaderboard-body"},ct={class:"leaderboard-content"},dt={key:0,class:"leaderboard-item me-item"},ut={class:"rank"},vt={class:"me-rank"},pt={class:"me-sub"},mt={class:"user"},_t={class:"info"},ht={class:"meta"},ft={key:0,class:"flag"},gt={key:1,class:"niveau"},yt={class:"xp"},bt={class:"me-xp"},$t={class:"me-percent"},kt={class:"leaderboard-list"},wt={class:"rank"},Ct={key:0,class:"trophy gold"},xt={key:1,class:"trophy silver"},St={key:2,class:"trophy bronze"},Pt={key:3},jt={class:"user"},zt={class:"avatar"},Dt={class:"info"},It={class:"name"},At={key:0,class:"flag name-flag"},Et={class:"first-name"},Tt={class:"last-name"},Mt={key:0,class:"meta"},Rt={class:"xp"},Nt={key:1,class:"expanded-section"},qt={class:"expanded-header"},Lt={class:"expanded-count"},Ot={class:"leaderboard-list"},Xt={class:"rank"},Qt={class:"user"},Ut={class:"avatar"},Vt={class:"info"},Ht={class:"name"},Bt={key:0,class:"flag name-flag"},Ft={class:"first-name"},Jt={class:"last-name"},Wt={key:0,class:"meta"},Gt={class:"xp"},Kt={key:0,class:"leaderboard-actions"},Yt=["disabled"],Zt={key:1,class:"empty-state"},es={key:1,class:"leaderboard-loading"},ts={__name:"LeaderboardWidget",setup(V){const w=ve(),k=_("global"),C=_(!0);_([]);const x=_(null),P=_(!1),j=_([]),R=T(()=>!!w?.pays?.id),g=T(()=>!!w?.niveau_pays?.id);function f(u){u==="pays"&&!R.value||u==="niveau"&&!g.value||(k.value=u)}function E(u){if(!u)return"U";const c=String(u).trim().split(/\s+/);return c.length===1?c[0].substring(0,2).toUpperCase():(c[0].substring(0,1)+c[1].substring(0,1)).toUpperCase()}function S(u){const c=String(u||"").trim();if(!c)return{firstName:"",lastName:""};const v=c.split(/\s+/),y=v[0]||"",n=v.slice(1).join(" ")||"";return{firstName:y,lastName:n}}async function z(){C.value=!0;try{const c=(await Qe({scope:k.value,limit:50}))?.data?.data||{},v=c.leaderboard||[];j.value=v.slice(0,50),x.value=c.me||null,P.value=!1}catch{j.value=[],x.value=null}finally{C.value=!1}}async function D(){P.value=!0}function A(){P.value=!1}return Ee(k,()=>z()),te(()=>z()),(u,c)=>(t(),a("div",st,[e("div",at,[c[4]||(c[4]=e("h3",{class:"leaderboard-title"},"Classement",-1)),e("div",it,[e("button",{class:Q(["tab",{active:k.value==="global"}]),onClick:c[0]||(c[0]=v=>f("global"))},"Global",2),e("button",{class:Q(["tab",{active:k.value==="pays"}]),onClick:c[1]||(c[1]=v=>f("pays")),disabled:!R.value},[O(w).pays?.drapeau_emoji?(t(),a("span",nt,i(O(w).pays?.drapeau_emoji),1)):$("",!0),c[3]||(c[3]=K(" Pays "))],10,ot),e("button",{class:Q(["tab",{active:k.value==="niveau"}]),onClick:c[2]||(c[2]=v=>f("niveau")),disabled:!g.value}," Niveau ",10,lt)])]),C.value?(t(),a("div",es,[c[10]||(c[10]=e("div",{class:"skeleton me"},null,-1)),(t(),a(X,null,U(6,v=>e("div",{class:"skeleton row",key:v})),64))])):(t(),a("div",rt,[e("div",ct,[x.value?(t(),a("div",dt,[e("div",ut,[e("div",vt,"#"+i(x.value.rank),1),e("div",pt,"sur "+i(x.value.total),1)]),e("div",mt,[e("div",_t,[c[5]||(c[5]=e("div",{class:"name"},"Vous",-1)),e("div",ht,[x.value.pays_flag?(t(),a("span",ft,i(x.value.pays_flag),1)):$("",!0),x.value.niveau?(t(),a("span",gt,i(x.value.niveau),1)):$("",!0)])])]),e("div",yt,[e("div",bt,i(x.value.xp)+" XP",1),e("div",$t,"Top "+i(x.value.percentile)+"%",1)])])):$("",!0),e("ul",kt,[(t(!0),a(X,null,U(j.value.slice(0,5),v=>(t(),a("li",{key:v.id,class:"leaderboard-item"},[e("div",wt,[v.rank===1?(t(),a("span",Ct,"ðŸ¥‡")):v.rank===2?(t(),a("span",xt,"ðŸ¥ˆ")):v.rank===3?(t(),a("span",St,"ðŸ¥‰")):(t(),a("span",Pt,"#"+i(v.rank),1))]),e("div",jt,[e("div",zt,i(E(v.display_name)),1),e("div",Dt,[e("div",It,[v.pays_flag?(t(),a("span",At,i(v.pays_flag),1)):$("",!0),e("span",Et,i(S(v.display_name).firstName),1),e("span",Tt,i(S(v.display_name).lastName),1)]),v.niveau?(t(),a("div",Mt,i(v.niveau),1)):$("",!0)])]),e("div",Rt,i(v.xp)+" XP",1)]))),128))]),P.value&&j.value.length>5?(t(),a("div",Nt,[e("div",qt,[c[6]||(c[6]=e("span",{class:"expanded-title"},"Autres classÃ©s",-1)),e("span",Lt,i(Math.min(j.value.length-5,45))+" utilisateurs",1)]),e("ul",Ot,[(t(!0),a(X,null,U(j.value.slice(5,50),v=>(t(),a("li",{key:v.id,class:"leaderboard-item expanded-item"},[e("div",Xt," #"+i(v.rank),1),e("div",Qt,[e("div",Ut,i(E(v.display_name)),1),e("div",Vt,[e("div",Ht,[v.pays_flag?(t(),a("span",Bt,i(v.pays_flag),1)):$("",!0),e("span",Ft,i(S(v.display_name).firstName),1),e("span",Jt,i(S(v.display_name).lastName),1)]),v.niveau?(t(),a("div",Wt,i(v.niveau),1)):$("",!0)])]),e("div",Gt,i(v.xp)+" XP",1)]))),128))])])):$("",!0)]),j.value.length>0?(t(),a("div",Kt,[P.value?(t(),a("button",{key:1,onClick:A,class:"btn-see-less"},c[8]||(c[8]=[e("span",{class:"btn-text"},"Voir moins",-1)]))):(t(),a("button",{key:0,onClick:D,class:"btn-see-more",disabled:C.value||j.value.length<=5},c[7]||(c[7]=[e("span",{class:"btn-text"},"Voir plus",-1)]),8,Yt))])):$("",!0),j.value.length?$("",!0):(t(),a("div",Zt,c[9]||(c[9]=[e("div",null,"Pas encore de classement pour ce filtre.",-1)])))]))]))}},ss=se(ts,[["__scopeId","data-v-32a3f080"]]),as={class:"xp-card"},is={class:"xp-header"},os={class:"xp-level"},ns={class:"xp-ring"},ls={viewBox:"0 0 36 36",class:"circular-chart"},rs=["stroke-dasharray"],cs={x:"18",y:"20.35",class:"percentage"},ds={class:"xp-next"},us={class:"streak-section"},vs={class:"streak-header"},ps={class:"streak-icon-container"},ms={key:0,class:"streak-badge"},_s={class:"streak-info"},hs={class:"streak-subtitle"},fs={key:0,class:"streak-next-xp"},gs={class:"streak-xp-display"},ys={class:"xp-icon"},bs={class:"xp-value"},$s={class:"streak-progress-container"},ks={class:"streak-progress-bar"},ws={class:"streak-progress-text"},Cs={key:0,class:"streak-motivation"},xs={class:"motivation-text"},Ss={__name:"XPBadges",setup(V){const w=ve(),{initializeStreak:k,currentStreak:C,nextStreakXP:x}=Le(),P=T(()=>w.level||0),j=T(()=>w.xp||0),R=T(()=>w.xp_to_next||0),g=T(()=>C.value),f=T(()=>g.value===0?0:g.value<=7?g.value/7*100:((g.value-1)%7+1)/7*100),E=T(()=>{if(g.value===0)return"Commencez votre streak !";if(g.value<=7)return`${g.value}/7 jours`;const c=(g.value-1)%7+1,v=Math.floor((g.value-1)/7)+1;return`${c}/7 jours (semaine ${v})`}),S=()=>g.value===0?"Connectez-vous chaque jour pour gagner des XP":g.value===1?"Excellent dÃ©but ! Continuez demain":g.value<7?`${g.value} jours consÃ©cutifs`:g.value<30?`${g.value} jours - Vous Ãªtes rÃ©gulier !`:`${g.value} jours - Vous Ãªtes un champion !`,z=()=>{const c=["Continuez comme Ã§a ! Chaque jour compte.","Vous construisez une habitude d'apprentissage solide !","Impressionnant ! Votre persÃ©vÃ©rance paie.","Vous Ãªtes sur la bonne voie vers la maÃ®trise !","Chaque jour d'apprentissage vous rapproche de vos objectifs."],v=Math.min(Math.floor(g.value/5),c.length-1);return c[v]},D=()=>g.value===0?1:g.value<=5?g.value:5,A=()=>{const c=D();return c>=5?"ðŸ‘‘":c>=3?"ðŸ†":c>=2?"â­":"ðŸ’Ž"},u=T(()=>{const c=Number(P.value||0),v=Number(j.value||0),y=c*c*10,n=(c+1)*(c+1)*10,b=Math.max(v,y)-y,B=Math.max(1,n-y);return`${Math.min(100,Math.round(b/B*100))}, 100`});return te(()=>{k()}),(c,v)=>(t(),a("div",as,[e("div",is,[v[0]||(v[0]=e("div",{class:"xp-title"},"Progression XP",-1)),e("div",os,"Niveau "+i(P.value),1)]),e("div",ns,[(t(),a("svg",ls,[v[1]||(v[1]=e("path",{class:"circle-bg",d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"},null,-1)),e("path",{class:"circle","stroke-dasharray":u.value,d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"},null,8,rs),e("text",cs,i(j.value)+" XP",1)]))]),e("div",ds,i(R.value)+" XP pour le prochain niveau",1),e("div",us,[e("div",vs,[e("div",ps,[e("span",{class:Q(["streak-icon",{"streak-active":g.value>0}])},"ðŸ”¥",2),g.value>0?(t(),a("div",ms,i(g.value),1)):$("",!0)]),e("div",_s,[v[2]||(v[2]=e("h4",{class:"streak-title"},"Streak Quotidien",-1)),e("p",hs,i(S()),1),g.value>0?(t(),a("p",fs,"Prochain: +"+i(O(x))+" XP",1)):$("",!0)]),e("div",gs,[e("span",ys,i(A()),1),e("span",bs,"+"+i(D())+" XP",1)])]),e("div",$s,[e("div",ks,[e("div",{class:"streak-progress-fill",style:Pe({width:f.value+"%"})},null,4)]),e("div",ws,i(E.value),1)]),g.value>0?(t(),a("div",Cs,[e("p",xs,i(z()),1)])):$("",!0)])]))}},Ps=se(Ss,[["__scopeId","data-v-b0d85bb8"]]),js={key:0,class:"game-reset-notification"},zs={__name:"GameResetNotification",props:{autoHide:{type:Number,default:8e3}},setup(V){const w=V,k=_(!1);function C(){k.value=!1,localStorage.setItem("game-reset-notification-seen","true")}return te(()=>{localStorage.getItem("game-reset-notification-seen")||(k.value=!0,w.autoHide>0&&setTimeout(()=>{k.value&&C()},w.autoHide))}),(x,P)=>(t(),je(Ge,{name:"notification",appear:""},{default:de(()=>[k.value?(t(),a("div",js,[P[0]||(P[0]=e("div",{class:"notification-icon"},[e("span",null,"ðŸŽ®")],-1)),P[1]||(P[1]=e("div",{class:"notification-content"},[e("div",{class:"notification-title"}," SystÃ¨me de gamification mis Ã  jour ! "),e("div",{class:"notification-message"},[e("p",null,[K("ðŸŽ¯ "),e("strong",null,"Nouveau :"),K(" Seuls les "),e("strong",null,"quiz"),K(" donnent maintenant des XP")]),e("p",null,"ðŸ“š Les exercices guidÃ©s restent Ã©ducatifs (0 XP)"),e("p",null,"ðŸ† Tous les compteurs ont Ã©tÃ© remis Ã  zÃ©ro pour un restart Ã©quitable")])],-1)),e("button",{onClick:C,class:"notification-close"}," âœ• ")])):$("",!0)]),_:1}))}},Ds=se(zs,[["__scopeId","data-v-64a66099"]]),Is={class:"quiz-history"},As={class:"quiz-header"},Es={class:"quiz-filters"},Ts=["value"],Ms=["disabled"],Rs=["value"],Ns=["disabled"],qs=["value"],Ls={key:0,class:"stats-section"},Os={class:"stats-grid"},Xs={class:"stat-card quiz-completed"},Qs={class:"stat-value"},Us={class:"stat-card quiz-average"},Vs={class:"stat-value"},Hs={class:"stat-card quiz-notions"},Bs={class:"stat-value"},Fs={key:1,class:"matiere-stats"},Js={class:"matiere-grid"},Ws={class:"matiere-name"},Gs={class:"matiere-info"},Ks={class:"matiere-average"},Ys={class:"matiere-count"},Zs={key:2,class:"quiz-list-section"},ea={class:"section-subtitle"},ta={class:"inline-mastery-filters"},sa=["onClick","title","aria-label"],aa={key:0,class:"inline-mastery-icon"},ia={class:"inline-mastery-label"},oa={key:0,class:"quiz-list-content"},na={key:0,class:"empty-state"},la={key:1,class:"quiz-grid"},ra=["onClick"],ca={class:"quiz-card-title-section"},da=["onClick","title"],ua={key:0,class:"cooldown-lock",title:"Quiz en cooldown"},va={key:1,class:"navigation-icon",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},pa={class:"quiz-breadcrumb-compact"},ma={class:"quiz-card-actions"},_a={key:0,class:"retry-indicator"},ha={key:0,class:"quiz-card-details"},fa={class:"quiz-breadcrumb"},ga={class:"breadcrumb-item"},ya={class:"breadcrumb-item"},ba={class:"breadcrumb-item"},$a={class:"quiz-meta"},ka={class:"quiz-attempt"},wa={key:0,class:"total-attempts"},Ca={class:"quiz-date"},xa={key:0,class:"quiz-time"},Sa={key:0,class:"quiz-cooldown-info"},Pa={class:"cooldown-warning"},ja={class:"cooldown-text"},za={key:2,class:"pagination-container"},Da=["disabled"],Ia={class:"pagination-pages"},Aa=["onClick"],Ea=["disabled"],Ta={key:3,class:"loading-state"},Ae=6,Ma={__name:"QuizHistory",setup(V){const w=ve(),k=Ce(),C=_(!0),x=_({completed:0,average:0,masteredNotions:0}),P=_([]),j=_([]),R=_([]),g=_([]),f=_([]),E=_({}),S=_(""),z=_(""),D=_(""),A=_("all"),u=_(1),c=_(new Set),v=_(!0),y=_(new Map),n=_(!1),l=_(!1),b=()=>{typeof window<"u"&&(l.value=window.innerWidth<=768)},B=T(()=>{if(!S.value)return[];const r=parseInt(S.value);return g.value.filter(s=>{const h=typeof s.theme=="object"?s.theme?.id:s.theme;let M=null;return typeof s.theme=="object"&&(M=s.theme?.matiere_id||s.theme?.matiere?.id||null),!M&&h&&E.value[h]&&(M=E.value[h].matiere_id||E.value[h].matiere),parseInt(M)===r})}),W=T(()=>{if(!z.value)return[];const r=parseInt(z.value);return f.value.filter(o=>{const s=o.notion_id??o.notion?.id??(typeof o.notion=="number"?o.notion:null);return parseInt(s)===r})}),Y=T(()=>{let r=P.value;return A.value!=="all"&&(r=r.filter(o=>{const s=o.score_on_10;switch(A.value){case"mastered":return s>=7;case"average":return s>=5&&s<7;case"poor":return s<5;default:return!0}})),r}),ie=T(()=>Math.ceil(Y.value.length/Ae)),fe=T(()=>{const r=(u.value-1)*Ae,o=r+Ae;return Y.value.slice(r,o)}),le=T(()=>R.value||[]),re=T(()=>{const r=[],o=ie.value,s=u.value;if(l.value)return o<=1?[1]:[1,"...",o];if(o<=7)for(let h=1;h<=o;h++)r.push(h);else if(s<=4){for(let h=1;h<=5;h++)r.push(h);o>5&&r.push("..."),r.push(o)}else if(s>=o-3){r.push(1),o>6&&r.push("...");for(let h=o-4;h<=o;h++)h>1&&r.push(h)}else{r.push(1),r.push("...");for(let h=s-1;h<=s+1;h++)r.push(h);r.push("..."),r.push(o)}return r}),ce=[{value:"all",label:"Tous",icon:"",class:"all"},{value:"mastered",label:"MaÃ®trisÃ©s",icon:"âœ…",class:"mastered"},{value:"average",label:"Moyens",icon:"âš ï¸",class:"average"},{value:"poor",label:"Non maÃ®trisÃ©s",icon:"âŒ",class:"poor"}],pe=async()=>{if(P.value.length){n.value=!0;try{for(const r of P.value)try{const o=await et(r.quiz_id);y.value.set(r.quiz_id,o)}catch{y.value.set(r.quiz_id,{can_attempt:!0})}}catch{}finally{n.value=!1}}},Z=r=>y.value.get(r)||{can_attempt:!0},J=r=>!Z(r).can_attempt,ge=async()=>{try{const[r,o,s,h]=await Promise.all([F.get("/api/matieres/user_matieres/"),F.get("/api/themes/notions-pour-utilisateur/"),De({}).catch(()=>F.get("/api/notions/pour-utilisateur/")),ue({})]);let M=[];r?.data?.matieres_disponibles?M=r.data.matieres_disponibles:r?.data?.data?M=r.data.data:Array.isArray(r?.data)&&(M=r.data);let G=[];s?.data?.notions_disponibles?G=s.data.notions_disponibles:s?.data?.data?G=s.data.data:Array.isArray(s?.data)?G=s.data:s?.data?.results&&(G=s.data.results);const ae=o?.data?.themes||[],N=o?.data?.notions||[],be={};ae.forEach($e=>{const Ne=$e.matiere_id||$e.matiere&&($e.matiere.id||$e.matiere);be[$e.id]={matiere_id:Ne,matiere:Ne}}),E.value=be,Array.isArray(N)&&N.length>0&&(G=N);const Re=Array.isArray(h?.data)?h.data:h?.results||[];R.value=Array.isArray(M)?M:[],g.value=Array.isArray(G)?G:[],f.value=Array.isArray(Re)?Re:[],await ze()}catch{try{const[o,s,h]=await Promise.all([Me({}),De({}),ue({})]);R.value=Array.isArray(o?.data)?o.data:o?.results||[],g.value=Array.isArray(s?.data)?s.data:s?.results||[],f.value=Array.isArray(h?.data)?h.data:h?.results||[],await ze()}catch{}}},oe=async()=>{C.value=!0;try{const r={};S.value&&(r.matiere=S.value),z.value&&(r.notion=z.value),D.value&&(r.chapitre=D.value);const s=(await F.get("/api/suivis/quiz/stats/",{params:r})).data;x.value=s.global_stats||{completed:0,average:0,masteredNotions:0},P.value=s.quiz_list||[],j.value=s.matiere_stats||[],P.value.length>0&&await pe()}catch{}finally{C.value=!1}},q=async()=>{if(z.value="",D.value="",I(),S.value&&B.value.length===0)try{const r=await F.get("/api/themes/notions-pour-utilisateur/",{params:{matiere:S.value}}),o=r?.data?.themes||[],s=r?.data?.notions||[],h={};o.forEach(N=>{const be=N.matiere_id||N.matiere&&(N.matiere.id||N.matiere);h[N.id]={matiere_id:be,matiere:be}}),E.value={...E.value,...h};let M=s;if(!Array.isArray(M)||M.length===0){const N=await F.get("/api/notions/pour-utilisateur/",{params:{matiere:S.value}});N?.data?.notions_disponibles?M=N.data.notions_disponibles:N?.data?.data?M=N.data.data:Array.isArray(N?.data)?M=N.data:N?.data?.results&&(M=N.data.results)}const G=g.value.map(N=>N.id),ae=M.filter(N=>!G.includes(N.id));g.value=[...g.value,...ae]}catch{}oe()},L=async()=>{if(D.value="",I(),z.value)try{let r=await Oe(z.value),o=[];if(Array.isArray(r?.data)?o=r.data:r?.data?.results&&(o=r.data.results),o.length===0){const s=await ue({notion:z.value});Array.isArray(s?.data)?o=s.data:s?.data?.results&&(o=s.data.results)}if(o.length===0){const s=await F.get(`/api/notions/${z.value}/chapitres/`);Array.isArray(s?.data)?o=s.data:s?.data?.results&&(o=s.data.results)}if(o.length>0){const s=f.value.map(M=>M.id),h=o.filter(M=>!s.includes(M.id));f.value=[...f.value,...h]}}catch{}oe()},H=()=>{I(),oe()},me=r=>r>=7?"score-good":r>=5?"score-average":"score-poor",ye=r=>new Date(r).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),_e=r=>{const o=Math.floor(r/60),s=r%60;return`${o}:${s.toString().padStart(2,"0")}`},Ie=r=>{c.value.has(r)?c.value.delete(r):c.value.add(r)},xe=r=>c.value.has(r),m=()=>{v.value=!v.value},p=async r=>{try{if(J(r.quiz_id)){const h=Z(r.quiz_id);alert(`â° Ce quiz est en cooldown. ${h.message}`);return}const o=r.chapitre.id,s=r.quiz_id;await k.push({path:`/quiz-exercices/${o}`,query:{quizId:s,autoStart:"true"}})}catch{}},d=r=>{typeof r=="number"&&r>=1&&r<=ie.value&&(u.value=r)},I=()=>{u.value=1};return te(async()=>{if(b(),typeof window<"u"&&window.addEventListener("resize",b),w.isLoading||!w.isAuthenticated&&!w.id){let r=0;for(;(w.isLoading||!w.isAuthenticated)&&r<30;)await new Promise(o=>setTimeout(o,100)),r++}await ge(),await oe()}),Te(()=>{typeof window<"u"&&window.removeEventListener("resize",b)}),(r,o)=>(t(),a("div",Is,[e("div",As,[o[8]||(o[8]=e("h3",{class:"quiz-title"},"ðŸ§  Historique des Quiz",-1)),e("div",Es,[ee((t(),a("select",{"onUpdate:modelValue":o[0]||(o[0]=s=>S.value=s),onChange:q,class:"filter-select",key:"matieres-"+le.value.length},[o[5]||(o[5]=e("option",{value:""},"Toutes les matiÃ¨res",-1)),(t(!0),a(X,null,U(le.value,s=>(t(),a("option",{key:`matiere-${s.id}`,value:s.id},i(s.titre||s.nom),9,Ts))),128))],32)),[[he,S.value]]),ee(e("select",{"onUpdate:modelValue":o[1]||(o[1]=s=>z.value=s),onChange:L,class:"filter-select",disabled:!S.value},[o[6]||(o[6]=e("option",{value:""},"Toutes les notions",-1)),(t(!0),a(X,null,U(B.value,s=>(t(),a("option",{key:s.id,value:s.id},i(s.titre),9,Rs))),128))],40,Ms),[[he,z.value]]),ee(e("select",{"onUpdate:modelValue":o[2]||(o[2]=s=>D.value=s),onChange:H,class:"filter-select",disabled:!z.value},[o[7]||(o[7]=e("option",{value:""},"Tous les chapitres",-1)),(t(!0),a(X,null,U(W.value,s=>(t(),a("option",{key:s.id,value:s.id},i(s.titre),9,qs))),128))],40,Ns),[[he,D.value]])])]),C.value?$("",!0):(t(),a("div",Ls,[e("div",Os,[e("div",Xs,[o[9]||(o[9]=e("span",{class:"stat-label"},"Quiz effectuÃ©s",-1)),e("span",Qs,i(x.value.completed),1)]),e("div",Us,[o[10]||(o[10]=e("span",{class:"stat-label"},"Note moyenne",-1)),e("span",Vs,i(x.value.average)+"/10",1)]),e("div",Hs,[o[11]||(o[11]=e("span",{class:"stat-label"},"Notions maÃ®trisÃ©es",-1)),e("span",Bs,i(x.value.masteredNotions),1)])])])),!C.value&&j.value.length>0?(t(),a("div",Fs,[o[12]||(o[12]=e("h4",{class:"section-subtitle"},"ðŸ“Š Moyennes par matiÃ¨re",-1)),e("div",Js,[(t(!0),a(X,null,U(j.value,s=>(t(),a("div",{key:s.id,class:"matiere-card"},[e("div",Ws,i(s.titre),1),e("div",Gs,[e("span",Ks,i(s.average)+"/10",1),e("span",Ys,i(s.quiz_count)+" quiz",1)])]))),128))])])):$("",!0),C.value?$("",!0):(t(),a("div",Zs,[e("div",{class:"quiz-list-header",onClick:m},[e("h4",ea,"ðŸ“ Quiz effectuÃ©s ("+i(Y.value.length)+")",1),e("div",ta,[(t(),a(X,null,U(ce,s=>e("button",{key:s.value,onClick:we(h=>A.value=s.value,["stop"]),class:Q(["inline-mastery-btn",{active:A.value===s.value},s.class]),title:s.label,"aria-label":s.label},[s.icon?(t(),a("span",aa,i(s.icon),1)):$("",!0),e("span",ia,i(s.label),1)],10,sa)),64))]),e("button",{class:Q(["section-toggle",{expanded:v.value}])},o[13]||(o[13]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"6,9 12,15 18,9"})],-1)]),2)]),v.value?(t(),a("div",oa,[Y.value.length===0?(t(),a("div",na,o[14]||(o[14]=[e("p",null,"Aucun quiz trouvÃ© avec ces filtres",-1)]))):(t(),a("div",la,[(t(!0),a(X,null,U(fe.value,s=>(t(),a("div",{key:s.id,class:Q(["quiz-card",{"multiple-attempts":s.total_attempts>1,cooldown:J(s.quiz_id)}])},[e("div",{class:"quiz-card-header",onClick:h=>Ie(s.id)},[e("div",ca,[e("h5",{class:Q(["quiz-card-title clickable-title",{"cooldown-title":J(s.quiz_id)}]),onClick:we(h=>p(s),["stop"]),title:J(s.quiz_id)?"Quiz en cooldown - AccÃ¨s temporairement bloquÃ©":"AccÃ©der au quiz: "+s.quiz_titre},[J(s.quiz_id)?(t(),a("span",ua,"ðŸ”’")):$("",!0),K(" "+i(s.quiz_titre)+" ",1),J(s.quiz_id)?$("",!0):(t(),a("svg",va,o[15]||(o[15]=[e("path",{d:"M7 17l9.2-9.2M17 17V7H7"},null,-1)])))],10,da),e("div",pa,i(s.matiere.titre)+" â†’ "+i(s.notion.titre),1)]),e("div",ma,[e("div",{class:Q(["quiz-score",me(s.score_on_10)])},[K(i(s.score_on_10)+"/10 ",1),s.total_attempts>1?(t(),a("span",_a,"â†»")):$("",!0)],2),e("button",{class:Q(["expand-toggle",{expanded:xe(s.id)}])},o[16]||(o[16]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"6,9 12,15 18,9"})],-1)]),2)])],8,ra),xe(s.id)?(t(),a("div",ha,[e("div",fa,[e("span",ga,i(s.matiere.titre),1),o[17]||(o[17]=e("span",{class:"breadcrumb-separator"},"â†’",-1)),e("span",ya,i(s.notion.titre),1),o[18]||(o[18]=e("span",{class:"breadcrumb-separator"},"â†’",-1)),e("span",ba,i(s.chapitre.titre),1)]),e("div",$a,[e("span",ka,[K(" Tentative #"+i(s.tentative_numero)+" ",1),s.total_attempts>1?(t(),a("span",wa," ("+i(s.total_attempts)+" au total) ",1)):$("",!0)]),e("span",Ca,i(ye(s.date_creation)),1),s.temps_total_seconde?(t(),a("span",xa,i(_e(s.temps_total_seconde)),1)):$("",!0)]),J(s.quiz_id)?(t(),a("div",Sa,[e("div",Pa,[o[19]||(o[19]=e("span",{class:"cooldown-icon"},"â°",-1)),e("span",ja," Prochaine tentative possible dans "+i(Z(s.quiz_id).time_remaining_formatted),1)])])):$("",!0)])):$("",!0)],2))),128))])),ie.value>1?(t(),a("div",za,[e("button",{onClick:o[3]||(o[3]=s=>d(u.value-1)),disabled:u.value<=1,class:"pagination-btn prev",title:"PrÃ©cÃ©dent","aria-label":"PrÃ©cÃ©dent"},o[20]||(o[20]=[e("span",{class:"pagination-icon"},"â€¹",-1),e("span",{class:"pagination-label"},"PrÃ©cÃ©dent",-1)]),8,Da),e("div",Ia,[(t(!0),a(X,null,U(re.value,s=>(t(),a("button",{key:s,onClick:h=>d(s),class:Q(["pagination-page",{active:s===u.value}])},i(s),11,Aa))),128))]),e("button",{onClick:o[4]||(o[4]=s=>d(u.value+1)),disabled:u.value>=ie.value,class:"pagination-btn next",title:"Suivant","aria-label":"Suivant"},o[21]||(o[21]=[e("span",{class:"pagination-label"},"Suivant",-1),e("span",{class:"pagination-icon"},"â€º",-1)]),8,Ea)])):$("",!0)])):$("",!0)])),C.value?(t(),a("div",Ta,o[22]||(o[22]=[e("div",{class:"spinner"},null,-1),e("p",null,"Chargement des quiz...",-1)]))):$("",!0)]))}},Ra=se(Ma,[["__scopeId","data-v-1fd07f6e"]]),Na={class:"base-history"},qa={class:"history-header"},La={class:"history-title"},Oa={class:"history-filters"},Xa=["value"],Qa=["disabled"],Ua=["value"],Va=["disabled"],Ha=["value"],Ba={key:0,class:"stats-section"},Fa={key:1,class:"matiere-stats"},Ja={key:2,class:"items-list-section"},Wa={class:"section-subtitle"},Ga={key:0,class:"inline-filters"},Ka={key:0,class:"items-list-content"},Ya={key:0,class:"empty-state"},Za={key:1,class:"items-grid"},ei={key:2,class:"pagination-container"},ti=["disabled"],si={class:"pagination-pages"},ai=["onClick"],ii=["disabled"],oi={key:3,class:"loading-state"},ni={__name:"BaseHistory",props:{title:{type:String,required:!0},listTitle:{type:String,required:!0},loadingText:{type:String,default:"Chargement..."},apiEndpoint:{type:String,required:!0},customFilters:{type:Array,default:()=>[]},navigationHandler:{type:Function,default:null},itemsPerPage:{type:Number,default:12},filteredItems:{type:Array,default:null}},emits:["data-loaded","filter-changed"],setup(V,{expose:w,emit:k}){const C=V,x=k,P=ve();Ce();const j=_(!0),R=_({}),g=_([]),f=_([]),E=_([]),S=_([]),z=_([]),D=_({}),A=_(""),u=_(""),c=_(""),v=_("all"),y=_(1),n=_(new Set),l=_(!0),b=T(()=>{if(!A.value)return[];const m=parseInt(A.value);return S.value.filter(d=>{const I=typeof d.theme=="object"?d.theme?.id:d.theme;let r=null;return typeof d.theme=="object"&&(r=d.theme?.matiere_id||d.theme?.matiere?.id||null),!r&&I&&D.value[I]&&(r=D.value[I].matiere_id||D.value[I].matiere),parseInt(r)===m})}),B=T(()=>{if(!u.value)return[];const m=parseInt(u.value);return z.value.filter(p=>{const d=p.notion_id??p.notion?.id??(typeof p.notion=="number"?p.notion:null);return parseInt(d)===m})}),W=T(()=>C.filteredItems?C.filteredItems:g.value),Y=T(()=>Math.ceil(W.value.length/C.itemsPerPage)),ie=T(()=>{const m=(y.value-1)*C.itemsPerPage,p=m+C.itemsPerPage;return W.value.slice(m,p)}),fe=T(()=>{const m=[],p=Y.value,d=y.value;if(le.value)return p<=1?[1]:[1,"...",p];if(p<=7)for(let I=1;I<=p;I++)m.push(I);else if(d<=4){for(let I=1;I<=5;I++)m.push(I);p>5&&m.push("..."),m.push(p)}else if(d>=p-3){m.push(1),p>6&&m.push("...");for(let I=p-4;I<=p;I++)I>1&&m.push(I)}else{m.push(1),m.push("...");for(let I=d-1;I<=d+1;I++)m.push(I);m.push("..."),m.push(p)}return m}),le=_(!1),re=()=>{typeof window<"u"&&(le.value=window.innerWidth<=768)};te(()=>{re(),typeof window<"u"&&window.addEventListener("resize",re)}),Te(()=>{typeof window<"u"&&window.removeEventListener("resize",re)});const ce=T(()=>E.value||[]),pe=async()=>{try{const[m,p,d,I]=await Promise.all([F.get("/api/matieres/user_matieres/"),F.get("/api/themes/notions-pour-utilisateur/"),De({}).catch(()=>F.get("/api/notions/pour-utilisateur/")),ue({})]);let r=[];m?.data?.matieres_disponibles?r=m.data.matieres_disponibles:m?.data?.data?r=m.data.data:Array.isArray(m?.data)&&(r=m.data);let o=[];d?.data?.notions_disponibles?o=d.data.notions_disponibles:d?.data?.data?o=d.data.data:Array.isArray(d?.data)?o=d.data:d?.data?.results&&(o=d.data.results);const s=p?.data?.themes||[],h=p?.data?.notions||[],M={};s.forEach(ae=>{const N=ae.matiere_id||ae.matiere&&(ae.matiere.id||ae.matiere);M[ae.id]={matiere_id:N,matiere:N}}),D.value=M,Array.isArray(h)&&h.length>0&&(o=h);const G=Array.isArray(I?.data)?I.data:I?.results||[];E.value=Array.isArray(r)?r:[],S.value=Array.isArray(o)?o:[],z.value=Array.isArray(G)?G:[],await ze()}catch{try{const[p,d,I]=await Promise.all([Me({}),De({}),ue({})]);E.value=Array.isArray(p?.data)?p.data:p?.results||[],S.value=Array.isArray(d?.data)?d.data:d?.results||[],z.value=Array.isArray(I?.data)?I.data:I?.results||[],await ze()}catch{}}},Z=async()=>{j.value=!0;try{const m={};A.value&&(m.matiere=A.value),u.value&&(m.notion=u.value),c.value&&(m.chapitre=c.value);const d=(await F.get(C.apiEndpoint,{params:m})).data;R.value=d.global_stats||{},g.value=d.quiz_list||d.exercice_list||[],f.value=d.matiere_stats||[],x("data-loaded",d)}catch{}finally{j.value=!1}},J=async()=>{if(u.value="",c.value="",_e(),A.value&&b.value.length===0)try{const m=await F.get("/api/themes/notions-pour-utilisateur/",{params:{matiere:A.value}}),p=m?.data?.themes||[],d=m?.data?.notions||[],I={};p.forEach(h=>{const M=h.matiere_id||h.matiere&&(h.matiere.id||h.matiere);I[h.id]={matiere_id:M,matiere:M}}),D.value={...D.value,...I};let r=d;if(!Array.isArray(r)||r.length===0){const h=await F.get("/api/notions/pour-utilisateur/",{params:{matiere:A.value}});h?.data?.notions_disponibles?r=h.data.notions_disponibles:h?.data?.data?r=h.data.data:Array.isArray(h?.data)?r=h.data:h?.data?.results&&(r=h.data.results)}const o=S.value.map(h=>h.id),s=r.filter(h=>!o.includes(h.id));S.value=[...S.value,...s]}catch{}Z(),x("filter-changed",{matiere:A.value,notion:u.value,chapitre:c.value})},ge=async()=>{if(c.value="",_e(),u.value)try{let m=await Oe(u.value),p=[];if(Array.isArray(m?.data)?p=m.data:m?.data?.results&&(p=m.data.results),p.length===0){const d=await ue({notion:u.value});Array.isArray(d?.data)?p=d.data:d?.data?.results&&(p=d.data.results)}if(p.length===0){const d=await F.get(`/api/notions/${u.value}/chapitres/`);Array.isArray(d?.data)?p=d.data:d?.data?.results&&(p=d.data.results)}if(p.length>0){const d=z.value.map(r=>r.id),I=p.filter(r=>!d.includes(r.id));z.value=[...z.value,...I]}}catch{}Z(),x("filter-changed",{matiere:A.value,notion:u.value,chapitre:c.value})},oe=()=>{_e(),Z(),x("filter-changed",{matiere:A.value,notion:u.value,chapitre:c.value})},q=m=>{n.value.has(m)?n.value.delete(m):n.value.add(m)},L=m=>n.value.has(m),H=()=>{l.value=!l.value},me=m=>{C.navigationHandler&&C.navigationHandler(m)},ye=m=>{typeof m=="number"&&m>=1&&m<=Y.value&&(y.value=m)},_e=()=>{y.value=1},Ie=m=>new Date(m).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),xe=m=>{const p=Math.floor(m/60),d=m%60;return`${p}:${d.toString().padStart(2,"0")}`};return te(async()=>{if(P.isLoading||!P.isAuthenticated&&!P.id){let m=0;for(;(P.isLoading||!P.isAuthenticated)&&m<30;)await new Promise(p=>setTimeout(p,100)),m++}await pe(),await Z()}),w({formatDate:Ie,formatTime:xe,toggleItemDetails:q,isItemExpanded:L,navigateToItem:me,selectedCustomFilter:v,resetPagination:_e}),(m,p)=>(t(),a("div",Na,[e("div",qa,[e("h3",La,i(V.title),1),e("div",Oa,[ee((t(),a("select",{"onUpdate:modelValue":p[0]||(p[0]=d=>A.value=d),onChange:J,class:"filter-select",key:"matieres-"+ce.value.length},[p[5]||(p[5]=e("option",{value:""},"Toutes les matiÃ¨res",-1)),(t(!0),a(X,null,U(ce.value,d=>(t(),a("option",{key:`matiere-${d.id}`,value:d.id},i(d.titre||d.nom),9,Xa))),128))],32)),[[he,A.value]]),ee(e("select",{"onUpdate:modelValue":p[1]||(p[1]=d=>u.value=d),onChange:ge,class:"filter-select",disabled:!A.value},[p[6]||(p[6]=e("option",{value:""},"Toutes les notions",-1)),(t(!0),a(X,null,U(b.value,d=>(t(),a("option",{key:d.id,value:d.id},i(d.titre),9,Ua))),128))],40,Qa),[[he,u.value]]),ee(e("select",{"onUpdate:modelValue":p[2]||(p[2]=d=>c.value=d),onChange:oe,class:"filter-select",disabled:!u.value},[p[7]||(p[7]=e("option",{value:""},"Tous les chapitres",-1)),(t(!0),a(X,null,U(B.value,d=>(t(),a("option",{key:d.id,value:d.id},i(d.titre),9,Ha))),128))],40,Va),[[he,c.value]])])]),j.value?$("",!0):(t(),a("div",Ba,[ke(m.$slots,"global-stats",{stats:R.value,loading:j.value},void 0,!0)])),!j.value&&f.value.length>0?(t(),a("div",Fa,[ke(m.$slots,"matiere-stats",{stats:f.value},void 0,!0)])):$("",!0),j.value?$("",!0):(t(),a("div",Ja,[e("div",{class:"items-list-header",onClick:H},[e("h4",Wa,i(V.listTitle)+" ("+i(W.value.length)+")",1),V.customFilters&&V.customFilters.length>0?(t(),a("div",Ga,[ke(m.$slots,"custom-filters",{filters:V.customFilters,selected:v.value},void 0,!0)])):$("",!0),e("button",{class:Q(["section-toggle",{expanded:l.value}])},p[8]||(p[8]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"6,9 12,15 18,9"})],-1)]),2)]),l.value?(t(),a("div",Ka,[W.value.length===0?(t(),a("div",Ya,[ke(m.$slots,"empty-state",{},()=>[p[9]||(p[9]=e("p",null,"Aucun Ã©lÃ©ment trouvÃ© avec ces filtres",-1))],!0)])):(t(),a("div",Za,[ke(m.$slots,"items-list",{items:ie.value,toggleDetails:q,isExpanded:L,navigateToItem:me},void 0,!0)])),Y.value>1?(t(),a("div",ei,[e("button",{onClick:p[3]||(p[3]=d=>ye(y.value-1)),disabled:y.value<=1,class:"pagination-btn prev",title:"PrÃ©cÃ©dent","aria-label":"PrÃ©cÃ©dent"},p[10]||(p[10]=[e("span",{class:"pagination-icon"},"â€¹",-1),e("span",{class:"pagination-label"},"PrÃ©cÃ©dent",-1)]),8,ti),e("div",si,[(t(!0),a(X,null,U(fe.value,d=>(t(),a("button",{key:d,onClick:I=>ye(d),class:Q(["pagination-page",{active:d===y.value}])},i(d),11,ai))),128))]),e("button",{onClick:p[4]||(p[4]=d=>ye(y.value+1)),disabled:y.value>=Y.value,class:"pagination-btn next",title:"Suivant","aria-label":"Suivant"},p[11]||(p[11]=[e("span",{class:"pagination-label"},"Suivant",-1),e("span",{class:"pagination-icon"},"â€º",-1)]),8,ii)])):$("",!0)])):$("",!0)])),j.value?(t(),a("div",oi,[p[12]||(p[12]=e("div",{class:"spinner"},null,-1)),e("p",null,i(V.loadingText),1)])):$("",!0)]))}},li=se(ni,[["__scopeId","data-v-248ca2c4"]]),ri={class:"stats-grid"},ci={class:"stat-card exercice-completed"},di={class:"stat-value"},ui={class:"stat-card exercice-correct"},vi={class:"stat-value"},pi={class:"stat-card exercice-percentage"},mi={class:"stat-value"},_i={class:"stat-card exercice-notions"},hi={class:"stat-value"},fi={class:"matiere-grid"},gi={class:"matiere-name"},yi={class:"matiere-info"},bi={class:"matiere-average"},$i={class:"matiere-count"},ki={class:"inline-mastery-filters"},wi=["onClick","title","aria-label"],Ci={class:"inline-mastery-icon"},xi={class:"inline-mastery-label"},Si=["onClick"],Pi={class:"exercice-card-title-section"},ji=["onClick","title"],zi={class:"exercice-breadcrumb-compact"},Di={class:"exercice-card-actions"},Ii={key:0,class:"exercice-card-details"},Ai={class:"exercice-breadcrumb"},Ei={class:"breadcrumb-item"},Ti={class:"breadcrumb-item"},Mi={class:"breadcrumb-item"},Ri={class:"exercice-meta"},Ni={class:"exercice-date"},qi={key:0,class:"exercice-time"},Li={key:1,class:"exercice-points"},Oi={__name:"ExercicesHistory",setup(V,{expose:w}){const k=Ce(),C=_(null),x=[{value:"all",label:"Tous",icon:"",class:"all"},{value:"correct",label:"RÃ©ussis",icon:"âœ…",class:"correct"},{value:"incorrect",label:"RatÃ©s",icon:"âŒ",class:"incorrect"}],P=_("all"),j=_([]),R=T(()=>{let u=j.value;return P.value!=="all"&&(u=u.filter(c=>{switch(P.value){case"correct":return c.est_correct===!0;case"incorrect":return c.est_correct===!1;default:return!0}})),u}),g=u=>{j.value=u.exercice_list||[]},f=u=>{},E=u=>u?"status-correct":"status-incorrect",S=async u=>{try{const c=u.exercice_id;await k.push({name:"ExerciceDetail",params:{exerciceId:String(c)}})}catch{}},z=u=>new Date(u).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),D=u=>{const c=Math.floor(u/60),v=u%60;return`${c}:${v.toString().padStart(2,"0")}`},A=u=>{P.value=u};return w({updateSelectedMastery:A}),(u,c)=>(t(),je(li,{ref_key:"baseHistoryRef",ref:C,title:"ðŸ§­ Historique des Exercices","list-title":"ðŸ“ Exercices effectuÃ©s","loading-text":"Chargement des exercices...","api-endpoint":"/api/suivis/exercices/stats/","custom-filters":x,"navigation-handler":S,"items-per-page":6,"filtered-items":R.value,onDataLoaded:g,onFilterChanged:f},{"global-stats":de(({stats:v})=>[e("div",ri,[e("div",ci,[c[0]||(c[0]=e("span",{class:"stat-label"},"Exercices effectuÃ©s",-1)),e("span",di,i(v.completed||0),1)]),e("div",ui,[c[1]||(c[1]=e("span",{class:"stat-label"},"Exercices rÃ©ussis",-1)),e("span",vi,i(v.correct||0),1)]),e("div",pi,[c[2]||(c[2]=e("span",{class:"stat-label"},"Taux de rÃ©ussite",-1)),e("span",mi,i(v.percentage||0)+"%",1)]),e("div",_i,[c[3]||(c[3]=e("span",{class:"stat-label"},"Notions maÃ®trisÃ©es",-1)),e("span",hi,i(v.masteredNotions||0),1)])])]),"matiere-stats":de(({stats:v})=>[c[4]||(c[4]=e("h4",{class:"section-subtitle"},"ðŸ“Š Moyennes par matiÃ¨re",-1)),e("div",fi,[(t(!0),a(X,null,U(v,y=>(t(),a("div",{key:y.id,class:"matiere-card"},[e("div",gi,i(y.titre),1),e("div",yi,[e("span",bi,i(y.average)+"/10",1),e("span",$i,i(y.exercice_count)+" exercices",1)])]))),128))])]),"custom-filters":de(({filters:v,selected:y})=>[e("div",ki,[(t(!0),a(X,null,U(v,n=>(t(),a("button",{key:n.value,onClick:we(l=>A(n.value),["stop"]),class:Q(["inline-mastery-btn",n.class,{active:P.value===n.value}]),title:n.label,"aria-label":n.label},[e("span",Ci,i(n.icon),1),e("span",xi,i(n.label),1)],10,wi))),128))])]),"items-list":de(({items:v,toggleDetails:y,isExpanded:n,navigateToItem:l})=>[(t(!0),a(X,null,U(v,b=>(t(),a("div",{key:b.id,class:Q(["exercice-card",{correct:b.est_correct,incorrect:!b.est_correct}])},[e("div",{class:"exercice-card-header",onClick:B=>y(b.id)},[e("div",Pi,[e("h5",{class:"exercice-card-title clickable-title",onClick:we(B=>l(b),["stop"]),title:"AccÃ©der Ã  l'exercice: "+b.exercice_titre},[K(i(b.exercice_titre)+" ",1),c[5]||(c[5]=e("svg",{class:"navigation-icon",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M7 17l9.2-9.2M17 17V7H7"})],-1))],8,ji),e("div",zi,i(b.matiere.titre)+" â†’ "+i(b.notion.titre),1)]),e("div",Di,[e("div",{class:Q(["exercice-status",E(b.est_correct)])},i(b.est_correct?"âœ…":"âŒ"),3),e("button",{class:Q(["expand-toggle",{expanded:n(b.id)}])},c[6]||(c[6]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"6,9 12,15 18,9"})],-1)]),2)])],8,Si),n(b.id)?(t(),a("div",Ii,[e("div",Ai,[e("span",Ei,i(b.matiere.titre),1),c[7]||(c[7]=e("span",{class:"breadcrumb-separator"},"â†’",-1)),e("span",Ti,i(b.notion.titre),1),c[8]||(c[8]=e("span",{class:"breadcrumb-separator"},"â†’",-1)),e("span",Mi,i(b.chapitre.titre),1)]),e("div",Ri,[e("span",Ni,i(z(b.date_creation)),1),b.temps_seconde?(t(),a("span",qi,i(D(b.temps_seconde)),1)):$("",!0),b.points_obtenus?(t(),a("span",Li,i(b.points_obtenus)+" points ",1)):$("",!0)])])):$("",!0)],2))),128))]),"empty-state":de(()=>c[9]||(c[9]=[e("p",null,"Aucun exercice trouvÃ© avec ces filtres",-1),e("p",{class:"empty-hint"},"Essayez de modifier vos filtres ou commencez Ã  faire des exercices !",-1)])),_:1},8,["filtered-items"]))}},Xi=se(Oi,[["__scopeId","data-v-6df03229"]]),Qi={class:"daily-objectives-card"},Ui={class:"objective-icon"},Vi={class:"objective-content"},Hi={class:"objective-text"},Bi={class:"objective-progress"},Fi={class:"progress-bar"},Ji={class:"progress-text"},Wi={key:1,class:"no-objective"},Gi={key:2,class:"completion-badge"},Ki={class:"objectives-list"},Yi={class:"objective-info"},Zi={class:"objective-icon-small"},eo={class:"objective-details"},to={class:"objective-text-small"},so={class:"objective-description"},ao={class:"objective-reward"},io={class:"objective-status"},oo={class:"progress-info"},no={class:"progress-bar-modal"},lo={key:0,class:"status-completed"},ro={class:"modal-footer"},co={class:"daily-summary"},uo={class:"summary-stat"},vo={class:"stat-value"},po={class:"summary-stat"},mo={class:"stat-value"},_o={__name:"DailyObjectives",setup(V){const w=_(!1),{currentObjective:k,unlockedObjectivesList:C,unlockedObjectives:x,allObjectives:P,userStats:j,loadTodayStats:R,isInitialized:g,simulateQuizEasy:f,simulateQuizMedium:E,simulateQuizHard:S,simulateQuizPerfect:z,simulateExerciseCompleted:D,simulateQuizStreak:A}=tt(),u=_(0),c=T(()=>(u.value,C.value.filter(q=>q.isCompleted).length)),v=T(()=>(u.value,C.value.filter(q=>q.isCompleted).reduce((q,L)=>q+L.xpReward,0))),y=()=>{w.value=!0},n=()=>{w.value=!1},l=T(()=>{if(u.value,!k.value)return 0;const q=k.value.progress,L=k.value.target;return Math.min(q/L*100,100)}),b=()=>l.value,B=q=>q>=100?"completed":q>=75?"almost-done":q>=25?"half-way":q>0?"starting":"",W=()=>f(),Y=()=>E(),ie=()=>S(),fe=()=>z(),le=()=>D(),re=()=>A(Math.floor(Math.random()*8)+1),ce=q=>{u.value++,R(),setTimeout(()=>{k.value},100)},pe=q=>{u.value++},Z=q=>{u.value++};Ee(j,(q,L)=>{u.value++},{deep:!0}),Ee(x,(q,L)=>{u.value++},{deep:!0});let J=null;const ge=()=>{J=setInterval(()=>{R(),u.value++},2e3)},oe=()=>{J&&(clearInterval(J),J=null)};return te(()=>{window.addEventListener("dailyObjectiveProgress",ce),window.addEventListener("objectiveUnlocked",pe),window.addEventListener("dailyObjectiveCompleted",Z),ge()}),Te(()=>{window.removeEventListener("dailyObjectiveProgress",ce),window.removeEventListener("objectiveUnlocked",pe),window.removeEventListener("dailyObjectiveCompleted",Z),oe()}),window.testDailyObjectives={quizEasy:W,quizMedium:Y,quizHard:ie,quizPerfect:fe,exerciseCompleted:le,quizStreak:re},(q,L)=>(t(),a(X,null,[e("div",Qi,[e("div",{class:"objective-header"},[L[1]||(L[1]=e("div",{class:"objective-title"},"ðŸŽ¯ DÃ©fi du jour",-1)),e("button",{class:"see-more-btn",onClick:y}," Voir tous les dÃ©fis ")]),O(g)&&O(k)?(t(),a("div",{class:"current-objective",key:u.value},[e("div",Ui,i(O(k).icon),1),e("div",Vi,[e("div",Hi,i(O(k).text),1),e("div",Bi,[e("div",Fi,[e("div",{class:Q(["progress-fill",B(l.value)]),style:Pe({width:l.value+"%"})},null,6)]),e("div",Ji,i(O(k).progress)+" / "+i(O(k).target),1)])])])):(t(),a("div",Wi,[O(g)?(t(),a(X,{key:0},[K(" ðŸŽ‰ Tous les dÃ©fis du jour sont terminÃ©s ! Revenez demain pour de nouveaux dÃ©fis. ")],64)):(t(),a(X,{key:1},[K(" â³ Chargement des dÃ©fis du jour... ")],64))])),O(k)&&O(k).isCompleted?(t(),a("div",Gi," âœ… DÃ©fi complÃ©tÃ© ! +"+i(O(k).xpReward)+" XP ",1)):$("",!0)]),w.value?(t(),a("div",{key:0,class:"modal-overlay",onClick:n},[e("div",{class:"modal-content",onClick:L[0]||(L[0]=we(()=>{},["stop"]))},[e("div",{class:"modal-header"},[L[2]||(L[2]=e("h3",null,"ðŸŽ¯ Vos dÃ©fis journaliers",-1)),e("button",{class:"close-btn",onClick:n},"Ã—")]),e("div",Ki,[(t(!0),a(X,null,U(O(P),(H,me)=>(t(),a("div",{key:me,class:Q(["objective-item",{completed:H.isCompleted,locked:!H.isUnlocked}])},[e("div",Yi,[e("div",Zi,i(H.icon),1),e("div",eo,[e("div",to,i(H.name),1),e("div",so,i(H.text),1),e("div",ao,"+"+i(H.xpReward)+" XP",1)])]),e("div",io,[e("div",oo,i(H.progress)+" / "+i(H.target),1),e("div",no,[e("div",{class:Q(["progress-fill-modal",{completed:H.isCompleted}]),style:Pe({width:H.percentage+"%"})},null,6)]),H.isCompleted?(t(),a("div",lo," âœ… TerminÃ© ")):$("",!0)])],2))),128))]),e("div",ro,[e("div",co,[e("div",uo,[L[3]||(L[3]=e("span",{class:"stat-label"},"DÃ©fis complÃ©tÃ©s :",-1)),e("span",vo,i(c.value)+" / "+i(O(P).length),1)]),e("div",po,[L[4]||(L[4]=e("span",{class:"stat-label"},"XP gagnÃ©s aujourd'hui :",-1)),e("span",mo,"+"+i(v.value),1)])]),L[5]||(L[5]=e("p",{class:"modal-note"}," Tous les dÃ©fis se rÃ©initialisent chaque jour Ã  minuit. Bonne chance ! ",-1))])])])):$("",!0),ne(Ue)],64))}},ho=se(_o,[["__scopeId","data-v-559e2664"]]),fo={class:"streak-test-container"},go={class:"status-grid"},yo={class:"status-card"},bo={class:"status-content"},$o={class:"status-value"},ko={class:"status-card"},wo={class:"status-content"},Co={class:"status-value"},xo={class:"status-card"},So={class:"status-content"},Po={class:"status-value"},jo={class:"status-card"},zo={class:"status-content"},Do={class:"simulation-section"},Io={class:"simulation-buttons"},Ao={key:0,class:"test-results"},Eo={class:"results-list"},To={class:"result-time"},Mo={class:"result-message"},Ro={__name:"StreakTestButton",setup(V){const w=ve(),{currentStreak:k,isStreakCheckedToday:C,checkDailyStreak:x,resetStreak:P,initializeStreak:j}=Le(),{updateUserXPInstantly:R}=Ve(),g=_([]),f=(n,l="info")=>{const b=new Date().toLocaleTimeString();g.value.unshift({timestamp:b,message:n,type:l}),g.value.length>8&&(g.value=g.value.slice(0,8))},E=n=>{try{f(`ðŸŽ­ Simulation du jour ${n}...`,"info");const l=new Date,b=new Date(l);b.setDate(l.getDate()-1);const B=b.toISOString().split("T")[0],W=n-1;localStorage.setItem("lastLoginDate",B),localStorage.setItem("currentStreak",W.toString()),localStorage.removeItem("streakCheckedToday"),k.value=W,C.value=!1,f(`âœ… Streak de ${n} jours simulÃ© (derniÃ¨re connexion: ${B})`,"success"),setTimeout(()=>{D()},500)}catch(l){f(`âŒ Erreur simulation jour ${n}: ${l.message}`,"error")}},S=()=>{try{f("ðŸ’” Simulation rupture de streak...","warning");const n=new Date,l=new Date(n);l.setDate(n.getDate()-3);const b=l.toISOString().split("T")[0];localStorage.setItem("lastLoginDate",b),localStorage.setItem("currentStreak","0"),localStorage.removeItem("streakCheckedToday"),k.value=0,C.value=!1,f("âœ… Rupture de streak simulÃ©e (3 jours d'Ã©cart)","warning"),setTimeout(()=>{D()},500)}catch(n){f(`âŒ Erreur simulation rupture: ${n.message}`,"error")}},z=()=>{try{f("ðŸ”„ Reset de la simulation...","info");const n=new Date().toISOString().split("T")[0];localStorage.setItem("lastLoginDate",n),localStorage.setItem("currentStreak","0"),localStorage.removeItem("streakCheckedToday"),k.value=0,C.value=!1,f("âœ… Simulation remise Ã  aujourd'hui (streak: 0)","success")}catch(n){f(`âŒ Erreur reset simulation: ${n.message}`,"error")}},D=async()=>{try{f("ðŸ”„ VÃ©rification du streak...","info");const n=await x();n.success?n.alreadyChecked?f("âœ… Streak dÃ©jÃ  vÃ©rifiÃ© aujourd'hui","success"):f(`ðŸŽ‰ Streak: ${n.streakDays} jours, +${n.xpGained} XP`,"success"):f(`âŒ Erreur: ${n.reason||"inconnue"}`,"error")}catch(n){f(`âŒ Erreur: ${n.message}`,"error")}},A=async()=>{try{f("âž• Test +5 XP...","info");const n=w.xp||0;if((await R(5,"test_manual")).success){const b=w.xp||0;f(`âœ… XP: ${n} â†’ ${b} (+5)`,"success")}else f("âŒ Ã‰chec mise Ã  jour XP","error")}catch(n){f(`âŒ Erreur: ${n.message}`,"error")}},u=async()=>{try{f("âž– Test -5 XP...","info");const n=w.xp||0;if((await R(-5,"test_manual_decrease")).success){const b=w.xp||0;f(`âœ… XP: ${n} â†’ ${b} (-5)`,"success")}else f("âŒ Ã‰chec diminution XP","error")}catch(n){f(`âŒ Erreur: ${n.message}`,"error")}},c=()=>{try{P(),f("ðŸ—‘ï¸ Streak remis Ã  zÃ©ro","warning")}catch(n){f(`âŒ Erreur reset: ${n.message}`,"error")}},v=async()=>{try{f("ðŸ”„ RafraÃ®chissement...","info"),j(),f("âœ… DonnÃ©es rafraÃ®chies","success")}catch(n){f(`âŒ Erreur: ${n.message}`,"error")}},y=()=>{g.value=[]};return te(()=>{f("ðŸš€ Test Badges & Streak chargÃ©","info")}),(n,l)=>(t(),a("div",fo,[l[18]||(l[18]=e("div",{class:"test-header"},[e("h3",null,"ðŸ§ª Test Badges & Streak"),e("p",{class:"test-subtitle"},"Interface de test pour administrateur")],-1)),e("div",go,[e("div",yo,[l[8]||(l[8]=e("span",{class:"status-icon"},"ðŸ”¥",-1)),e("div",bo,[l[7]||(l[7]=e("span",{class:"status-label"},"Streak",-1)),e("span",$o,i(O(k))+" jours",1)])]),e("div",ko,[l[10]||(l[10]=e("span",{class:"status-icon"},"â­",-1)),e("div",wo,[l[9]||(l[9]=e("span",{class:"status-label"},"XP",-1)),e("span",Co,i(O(w).xp||0),1)])]),e("div",xo,[l[12]||(l[12]=e("span",{class:"status-icon"},"ðŸ†",-1)),e("div",So,[l[11]||(l[11]=e("span",{class:"status-label"},"Niveau",-1)),e("span",Po,i(O(w).level||0),1)])]),e("div",jo,[l[14]||(l[14]=e("span",{class:"status-icon"},"ðŸ“…",-1)),e("div",zo,[l[13]||(l[13]=e("span",{class:"status-label"},"VÃ©rifiÃ©",-1)),e("span",{class:Q(["status-value",{checked:O(C)}])},i(O(C)?"Oui":"Non"),3)])])]),e("div",Do,[l[15]||(l[15]=e("h4",null,"ðŸŽ­ Simulation de Jours",-1)),l[16]||(l[16]=e("p",{class:"simulation-info"},"Simulez diffÃ©rents jours pour tester le streak",-1)),e("div",Io,[e("button",{onClick:l[0]||(l[0]=b=>E(1)),class:"sim-btn day-1"}," ðŸ“… Jour 1 "),e("button",{onClick:l[1]||(l[1]=b=>E(2)),class:"sim-btn day-2"}," ðŸ“… Jour 2 "),e("button",{onClick:l[2]||(l[2]=b=>E(3)),class:"sim-btn day-3"}," ðŸ“… Jour 3 "),e("button",{onClick:l[3]||(l[3]=b=>E(4)),class:"sim-btn day-4"}," ðŸ“… Jour 4 "),e("button",{onClick:l[4]||(l[4]=b=>E(5)),class:"sim-btn day-5"}," ðŸ“… Jour 5 "),e("button",{onClick:l[5]||(l[5]=b=>E(7)),class:"sim-btn day-7"}," ðŸ“… Jour 7 "),e("button",{onClick:l[6]||(l[6]=b=>E(10)),class:"sim-btn day-10"}," ðŸ“… Jour 10 ")]),e("div",{class:"simulation-controls"},[e("button",{onClick:S,class:"sim-btn break"}," ðŸ’” Casser le Streak "),e("button",{onClick:z,class:"sim-btn reset"}," ðŸ”„ Reset Simulation ")])]),e("div",{class:"test-actions"},[e("button",{onClick:D,class:"test-btn primary"}," ðŸ”„ VÃ©rifier Streak "),e("button",{onClick:A,class:"test-btn success"}," âž• +5 XP "),e("button",{onClick:u,class:"test-btn danger"}," âž– -5 XP "),e("button",{onClick:c,class:"test-btn warning"}," ðŸ—‘ï¸ Reset "),e("button",{onClick:v,class:"test-btn info"}," ðŸ”„ Refresh ")]),g.value.length>0?(t(),a("div",Ao,[e("div",{class:"results-header"},[l[17]||(l[17]=e("h4",null,"ðŸ“Š RÃ©sultats des tests",-1)),e("button",{onClick:y,class:"clear-btn"},"ðŸ—‘ï¸")]),e("div",Eo,[(t(!0),a(X,null,U(g.value,(b,B)=>(t(),a("div",{key:B,class:Q(["result-item",b.type])},[e("span",To,i(b.timestamp),1),e("span",Mo,i(b.message),1)],2))),128))])])):$("",!0)]))}},No=se(Ro,[["__scopeId","data-v-d8c0f382"]]),qo={class:"dashboard-content"},Lo={class:"dashboard-center-top"},Oo={key:0,class:"dashboard-spinner"},Xo={key:1},Qo={class:"section leaderboard-section"},Uo={class:"leaderboard-grid"},Vo={class:"leaderboard-container"},Ho={class:"level-container"},Bo={key:0},Fo={key:1},Jo={key:2,class:"dashboard-spinner"},Wo={key:3,class:"section"},Go={__name:"DashboardStudent",setup(V){const w=ve();He(),Ce();const k=_({done:0,acquired:0,not_acquired:0}),C=_(!0),x=_([]),P=_([]),j=_([]),R=_({}),g=_({}),f=_([]),E=_(null);T(()=>x.value.length?[...x.value].sort((D,A)=>new Date(A.date_creation)-new Date(D.date_creation))[0]:null);function S(){R.value=Object.fromEntries(P.value.map(z=>[z.id,z])),g.value=Object.fromEntries(j.value.map(z=>[z.id,z]))}return te(async()=>{try{const[z,D,A,u,c,v]=await Promise.all([Ye({}),ue({}),Ze(),Me(),Be().catch(()=>null),Fe().catch(()=>null)]),y=l=>Array.isArray(l)?l:l?.results||[];P.value=y(z),j.value=y(D),x.value=y(A?.data),f.value=y(u?.data??u),E.value=v?.data?.data||null;const n=c?.data?.data;n&&(w.xp=n.xp??w.xp,w.level=n.level??w.level,w.xp_to_next=n.xp_to_next??n.next_level_xp-n.xp),S(),k.value.done=x.value.length,k.value.acquired=x.value.filter(l=>l.est_correct===!0).length,k.value.not_acquired=x.value.filter(l=>l.est_correct===!1).length}catch{}C.value=!1}),(z,D)=>(t(),a("div",qo,[ne(Ds),e("div",Lo,[O(w).isLoading?(t(),a("div",Oo,D[0]||(D[0]=[e("span",{class:"spinner"},null,-1)]))):(t(),a("h1",Xo," Bienvenue "+i(O(w).firstName)+" sur votre tableau de bord ",1))]),e("div",Qo,[e("div",Uo,[e("div",Vo,[ne(ss)]),e("div",Ho,[ne(Ps),ne(ho)])])]),C.value?$("",!0):(t(),a("div",Bo,[ne(Ra)])),C.value?$("",!0):(t(),a("div",Fo,[ne(Xi)])),C.value?(t(),a("div",Jo,D[1]||(D[1]=[e("span",{class:"spinner"},null,-1)]))):$("",!0),O(w).isAdmin?(t(),a("div",Wo,[D[2]||(D[2]=e("div",{class:"section-header"},[e("h3",{class:"section-title"},"ðŸ§ª Tests (Admin uniquement)")],-1)),ne(No)])):$("",!0)]))}},Ko=se(Go,[["__scopeId","data-v-f4cf7925"]]),Yo={class:"parent-dashboard"},Zo={class:"add-child"},en=["disabled"],tn={key:0,class:"hint"},sn={class:"create-child"},an={class:"form-row"},on={class:"form-row"},nn=["disabled"],ln={key:0,class:"hint"},rn={key:1,class:"temp-pass"},cn={key:0,class:"loading"},dn={key:1},un={key:0,class:"empty"},vn={key:1,class:"children-grid"},pn={class:"child-header"},mn={class:"avatar"},_n={class:"child-info"},hn={class:"name"},fn={key:0,class:"flag"},gn={class:"meta"},yn={key:0},bn={class:"xp"},$n={class:"xp-value"},kn={class:"level"},wn={class:"child-body"},Cn={class:"metrics-grid"},xn={class:"metric"},Sn={class:"bar"},Pn={class:"hint"},jn={class:"metric small"},zn={class:"kpi"},Dn={class:"metric small ok"},In={class:"kpi"},An={class:"metric small ko"},En={class:"kpi"},Tn={key:0,class:"last-activity"},Mn={class:"activity-line"},Rn={class:"activity-title"},Nn={key:0,class:"activity-meta"},qn={class:"actions"},Ln=["onClick"],On=["onClick","disabled"],Xn={__name:"DashboardParent",setup(V){const w=_(!0),k=_([]),C=Ce(),x=_(""),P=_(!1),j=_(""),R=_(null),g=_(!1),f=_(""),E=_(""),S=_({first_name:"",last_name:"",email:""});function z(y){if(!y)return"E";const n=String(y).trim().split(/\s+/);return n.length===1?n[0].substring(0,2).toUpperCase():(n[0].substring(0,1)+n[1].substring(0,1)).toUpperCase()}function D(y){C.push({name:"ChildOverview",params:{childId:String(y)}})}te(async()=>{try{const n=(await qe())?.data?.data||{};k.value=n.children||[]}catch{k.value=[]}finally{w.value=!1}});async function A(){try{const n=(await qe())?.data?.data||{};k.value=n.children||[]}catch{k.value=[]}}async function u(){j.value="";const y=String(x.value||"").trim();if(!y){j.value="Renseignez l'email de l'Ã©lÃ¨ve";return}P.value=!0;try{await Je({email:y}),x.value="",j.value="Ã‰lÃ¨ve ajoutÃ© âœ…",await A()}catch{j.value="Impossible d'ajouter cet Ã©lÃ¨ve"}finally{P.value=!1,setTimeout(()=>{j.value=""},2500)}}async function c(y){R.value=y;try{await We(y),await A()}catch{}R.value=null}async function v(){f.value="",E.value="";const y={first_name:String(S.value.first_name||"").trim(),last_name:String(S.value.last_name||"").trim(),email:String(S.value.email||"").trim().toLowerCase()};if(!y.first_name||!y.last_name||!y.email){f.value="Renseignez prÃ©nom, nom et email";return}g.value=!0;try{const l=(await F.post("/api/users/me/children/create/",y))?.data?.data||{};E.value=l.temp_password||"",f.value="Compte crÃ©Ã© et liÃ© âœ…",S.value={first_name:"",last_name:"",email:""},await A()}catch{f.value="CrÃ©ation impossible (email dÃ©jÃ  utilisÃ©?)"}finally{g.value=!1,setTimeout(()=>{f.value=""},3e3)}}return(y,n)=>(t(),a("div",Yo,[n[13]||(n[13]=e("div",{class:"header"},[e("h1",null,"Tableau de bord Parent"),e("p",{class:"subtitle"},"Suivez la progression de vos enfants, simplement.")],-1)),e("div",Zo,[ee(e("input",{"onUpdate:modelValue":n[0]||(n[0]=l=>x.value=l),type:"email",placeholder:"Email de l'Ã©lÃ¨ve",class:"input"},null,512),[[Se,x.value]]),e("button",{class:"btn",disabled:P.value,onClick:u},"Ajouter",8,en),j.value?(t(),a("span",tn,i(j.value),1)):$("",!0)]),e("div",sn,[e("details",null,[n[5]||(n[5]=e("summary",null,"CrÃ©er un compte pour un enfant",-1)),e("div",an,[ee(e("input",{"onUpdate:modelValue":n[1]||(n[1]=l=>S.value.first_name=l),class:"input",placeholder:"PrÃ©nom"},null,512),[[Se,S.value.first_name]]),ee(e("input",{"onUpdate:modelValue":n[2]||(n[2]=l=>S.value.last_name=l),class:"input",placeholder:"Nom"},null,512),[[Se,S.value.last_name]])]),e("div",on,[ee(e("input",{"onUpdate:modelValue":n[3]||(n[3]=l=>S.value.email=l),class:"input",placeholder:"Email"},null,512),[[Se,S.value.email]])]),e("button",{class:"btn",disabled:g.value,onClick:v},"CrÃ©er le compte",8,nn),f.value?(t(),a("div",ln,i(f.value),1)):$("",!0),E.value?(t(),a("div",rn,[n[4]||(n[4]=K("Mot de passe temporaire: ")),e("code",null,i(E.value),1)])):$("",!0)])]),w.value?(t(),a("div",cn,n[6]||(n[6]=[e("span",{class:"spinner"},null,-1)]))):(t(),a("div",dn,[k.value.length===0?(t(),a("div",un,n[7]||(n[7]=[e("p",null,"Aucun enfant rattachÃ© pour le moment.",-1)]))):(t(),a("div",vn,[(t(!0),a(X,null,U(k.value,l=>(t(),a("div",{class:"child-card",key:l.id},[e("div",pn,[e("div",mn,i(z(l.display_name)),1),e("div",_n,[e("div",hn,[l.pays_flag?(t(),a("span",fn,i(l.pays_flag),1)):$("",!0),K(" "+i(l.display_name),1)]),e("div",gn,[l.niveau?(t(),a("span",yn,i(l.niveau),1)):$("",!0)])]),e("div",bn,[e("div",$n,i(l.xp)+" XP",1),e("div",kn,"Niveau "+i(l.level),1)])]),e("div",wn,[e("div",Cn,[e("div",xn,[n[8]||(n[8]=e("div",{class:"label"},"Objectif hebdo",-1)),e("div",Sn,[e("div",{class:"fill",style:Pe({width:(l.metrics?.weekly_progress||0)+"%"})},null,4)]),e("div",Pn,i(l.metrics?l.metrics.weekly_done+" / "+l.metrics.weekly_goal:"â€”"),1)]),e("div",jn,[e("div",zn,i(l.metrics?.done_total??"â€”"),1),n[9]||(n[9]=e("div",{class:"kpi-label"},"Exercices",-1))]),e("div",Dn,[e("div",In,i(l.metrics?.acquired_count??"â€”"),1),n[10]||(n[10]=e("div",{class:"kpi-label"},"Acquis",-1))]),e("div",An,[e("div",En,i(l.metrics?.not_acquired_count??"â€”"),1),n[11]||(n[11]=e("div",{class:"kpi-label"},"Ã€ revoir",-1))])]),l.last_activity?(t(),a("div",Tn,[n[12]||(n[12]=e("div",{class:"label"},"DerniÃ¨re activitÃ©",-1)),e("div",Mn,[e("span",Rn,i(l.last_activity.exercice_title),1),l.last_activity.chapitre_title?(t(),a("span",Nn,"â€¢ "+i(l.last_activity.chapitre_title),1)):$("",!0)])])):$("",!0),e("div",qn,[e("button",{class:"btn",onClick:b=>D(l.id)},"Voir dÃ©tails",8,Ln),e("button",{class:"btn secondary",onClick:b=>c(l.id),disabled:R.value===l.id},"Retirer",8,On)])])]))),128))]))]))]))}},Qn=se(Xn,[["__scopeId","data-v-e116edd0"]]),tl={__name:"Dashboard",setup(V){const w=ve(),k=T(()=>w.role==="parent"?Qn:Ko);return(C,x)=>(t(),je(Xe,null,{default:de(()=>[(t(),je(Ke(k.value)))]),_:1}))}};export{tl as default};
