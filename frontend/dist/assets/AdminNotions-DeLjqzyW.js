import{_ as w,h as d,m as C,p as D,c as i,a as t,b as N,k as m,z as _,F as c,e as f,v as b,t as a,l as S,o as s,n as V,i as M,u as E}from"./index-C20tTf3S.js";import{g as T,u as B,c as F,d as U}from"./notions-D3XWmWyJ.js";import{g as L}from"./themes-KZqHIzgY.js";import"./PaysNiveauxSelector.vue_vue_type_style_index_0_scoped_6652d9f9_lang-l0sNRNKZ.js";import"./PaysNiveauxDisplay.vue_vue_type_style_index_0_scoped_821033d6_lang-l0sNRNKZ.js";import{A as q}from"./AdminActionsButtons-BF654C6o.js";const z={class:"form-group"},I=["value"],j={class:"form-group"},G={class:"btn-primary",type:"submit"},P={class:"filters"},R={class:"filter-group"},H=["value"],J={class:"filter-group"},K={class:"admin-table"},O={key:1,class:"no-theme"},Q={key:0},W={__name:"AdminNotions",setup(X){const v=d([]),u=d([]),l=d({id:null,nom:"",theme:"",niveaux:[]}),r=d({theme:"",nom:""}),y=C(()=>{let n=v.value;return r.value.theme&&(n=n.filter(e=>String(e.theme)===String(r.value.theme))),r.value.nom&&(n=n.filter(e=>e.nom.toLowerCase().includes(r.value.nom.toLowerCase()))),n});async function p(){try{const[{data:n},{data:e}]=await Promise.all([T(),L()]);v.value=n||[],u.value=e||[]}catch(n){console.error("[AdminNotions] Erreur lors du chargement:",n),v.value=[],u.value=[]}}D(p);function h(){l.value={id:null,nom:"",theme:"",niveaux:[]}}async function x(){if(!(!l.value.nom||!l.value.theme))try{const n={nom:l.value.nom,theme:Number(l.value.theme),niveaux:[]};l.value.id?await B(l.value.id,n):await F(n),h(),await p()}catch(n){console.error("[AdminNotions] Erreur:",n)}}function g(n){n.niveaux&&n.niveaux.map(e=>e.id),l.value={id:n.id,nom:n.nom,theme:n.theme||"",niveaux:[]}}async function k(n){try{await U(n),await p()}catch(e){console.error("Erreur:",e)}}function A(n){k(n.id)}return(n,e)=>(s(),i("div",null,[e[12]||(e[12]=t("h2",{class:"admin-title"},"Gestion des Notions",-1)),t("form",{class:"admin-form",onSubmit:S(x,["prevent"])},[t("div",z,[e[5]||(e[5]=t("label",null,"Thème (lié à un contexte Matière + Niveau):",-1)),m(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>l.value.theme=o),required:""},[e[4]||(e[4]=t("option",{value:""},"Choisir un thème",-1)),(s(!0),i(c,null,f(u.value,o=>(s(),i("option",{key:o.id,value:o.id},a(o.nom)+" — "+a(o.contexte_detail?.matiere_nom)+" — "+a(o.contexte_detail?.pays?.nom)+" - "+a(o.contexte_detail?.niveau?.nom),9,I))),128))],512),[[_,l.value.theme]])]),t("div",j,[e[6]||(e[6]=t("label",null,"Nom de la notion:",-1)),m(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>l.value.nom=o),placeholder:"Nom de la notion",required:""},null,512),[[b,l.value.nom]])]),t("button",G,a(l.value.id?"Mettre à jour":"Créer"),1),l.value.id?(s(),i("button",{key:0,class:"btn-secondary",type:"button",onClick:h},"Annuler")):N("",!0)],32),t("div",P,[t("div",R,[e[8]||(e[8]=t("label",null,"Filtrer par thème:",-1)),m(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>r.value.theme=o)},[e[7]||(e[7]=t("option",{value:""},"Tous les thèmes",-1)),(s(!0),i(c,null,f(u.value,o=>(s(),i("option",{key:o.id,value:o.id},a(o.nom)+" — "+a(o.contexte_detail?.matiere_nom)+" — "+a(o.contexte_detail?.pays?.nom)+" - "+a(o.contexte_detail?.niveau?.nom),9,H))),128))],512),[[_,r.value.theme]])]),t("div",J,[e[9]||(e[9]=t("label",null,"Rechercher:",-1)),m(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>r.value.nom=o),type:"text",placeholder:"Nom de la notion..."},null,512),[[b,r.value.nom]])])]),t("table",K,[e[11]||(e[11]=t("thead",null,[t("tr",null,[t("th",null,"ID"),t("th",null,"Nom de la notion"),t("th",null,"Thème"),t("th",null,"Actions")])],-1)),t("tbody",null,[(s(!0),i(c,null,f(y.value,o=>(s(),i("tr",{key:o.id},[t("td",null,a(o.id),1),t("td",null,a(o.nom),1),t("td",null,[o.theme_nom?(s(),i("span",{key:0,class:"theme-badge",style:V({backgroundColor:o.theme_couleur,color:"#fff"})},a(o.theme_nom),5)):(s(),i("span",O,"Aucun thème"))]),t("td",null,[M(E(q),{item:o,actions:["edit","delete"],"edit-label":"Éditer","confirm-message":"Êtes-vous sûr de vouloir supprimer cette notion ?",onEdit:g,onDelete:A},null,8,["item"])])]))),128)),y.value.length===0?(s(),i("tr",Q,e[10]||(e[10]=[t("td",{colspan:"4",style:{"text-align":"center","font-style":"italic"}},"Aucune notion trouvée.",-1)]))):N("",!0)])])]))}},ne=w(W,[["__scopeId","data-v-a2971f5a"]]);export{ne as default};
