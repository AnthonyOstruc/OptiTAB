import{u as X,w as A}from"./index-BhTphZWV.js";import{a as k,c as b,C as N}from"./vendor-CPU10QdV.js";import"./ui-es3YBeq-.js";import"./pdf-OEFxGcL4.js";import"./mathlive-B5k0jhbN.js";const H=k({quizEasy:0,quizMedium:0,quizHard:0,quizPerfect:0,quizStreak:0,exercicesCompleted:0});let w=!1;function V(){const u=X(),o=H,d={quiz_easy:{icon:"ðŸŸ¢",getText:e=>`RÃ©ussir ${e} quiz simples`,xpReward:3,getProgress:()=>o.value.quizEasy},quiz_medium:{icon:"ðŸŸ¡",getText:e=>`RÃ©ussir ${e} quiz moyens`,xpReward:5,getProgress:()=>o.value.quizMedium},quiz_hard:{icon:"ðŸ”´",getText:e=>`RÃ©ussir ${e} quiz difficiles`,xpReward:8,getProgress:()=>o.value.quizHard},quiz_perfect:{icon:"ðŸŽ¯",getText:e=>`Obtenir 100% sur ${e} quiz`,xpReward:9,getProgress:()=>o.value.quizPerfect},quiz_streak:{icon:"âš¡",getText:e=>`RÃ©ussir ${e} quiz d'affilÃ©e`,xpReward:9,getProgress:()=>o.value.quizStreak},exercices_completed:{icon:"ðŸ“š",getText:e=>`RÃ©ussir ${e} exercices`,xpReward:5,getProgress:()=>o.value.exercicesCompleted}},y=e=>({quiz_easy:"quizEasy",quiz_medium:"quizMedium",quiz_hard:"quizHard",quiz_perfect:"quizPerfect",quiz_streak:"quizStreak",exercices_completed:"exercicesCompleted"})[e]||null,c=[{name:"Quiz simples",type:"quiz_easy",target:3},{name:"Quiz moyens",type:"quiz_medium",target:5},{name:"Quiz difficiles",type:"quiz_hard",target:6},{name:"Quiz parfaits",type:"quiz_perfect",target:2},{name:"SÃ©rie de quiz",type:"quiz_streak",target:7},{name:"Exercices rÃ©ussis",type:"exercices_completed",target:2}],l=k([]),z=()=>{const e=new Date().toDateString(),t=localStorage.getItem(`unlocked_objectives_${e}`);if(t){let s=JSON.parse(t);if(s=s.filter(i=>i>=0&&i<c.length),s.length>0)l.value=s;else{const i=Math.floor(Math.random()*c.length);l.value=[i]}m()}else{const s=Math.floor(Math.random()*c.length);l.value=[s],m()}},m=()=>{const e=new Date().toDateString();localStorage.setItem(`unlocked_objectives_${e}`,JSON.stringify(l.value))},a=()=>{const t=Array.from({length:c.length},(s,i)=>i).filter(s=>!l.value.includes(s));if(t.length>0){const s=t[0];l.value.push(s),m(),window.dispatchEvent(new CustomEvent("objectiveUnlocked",{detail:{objective:c[s],index:s}}))}},r=b(()=>l.value.filter(e=>e<c.length).map(e=>{const t=c[e],s=d[t.type];if(!t||!s)return null;const i=s.getProgress();return{index:e,name:t.name,type:t.type,target:t.target,xpReward:s.xpReward,icon:s.icon,text:s.getText(t.target),progress:i,isCompleted:i>=t.target,percentage:Math.min(i/t.target*100,100)}}).filter(e=>e!==null)),v=b(()=>{const e=r.value;if(e.length===0)return null;const t=e.find(i=>!i.isCompleted);if(t)return t;const s=Array.from({length:c.length},(i,n)=>n).filter(i=>!l.value.includes(i));if(s.length>0){const i=s[0];l.value.push(i),m();const n=c[i],h=d[n.type],D=y(n.type),S=D?o.value[D]:0;return{...n,...h,progress:S,isCompleted:S>=n.target,isUnlocked:!0}}return null}),C=b(()=>c.map((e,t)=>{const s=l.value.includes(t),i=d[e.type];if(!e||!i)return null;const n=s?i.getProgress():0;return{index:t,name:e.name,type:e.type,target:e.target,xpReward:i.xpReward,icon:i.icon,text:i.getText(e.target),progress:n,isCompleted:s&&n>=e.target,isUnlocked:s,percentage:s?Math.min(n/e.target*100,100):0}}).filter(e=>e!==null)),O=e=>{const t=new Date().toDateString();return`daily_objective_${e}_${t}`},x=()=>{Object.keys(d).forEach(e=>{const t=O(e),s=localStorage.getItem(t),i=y(e);s&&i&&Object.prototype.hasOwnProperty.call(o.value,i)&&(o.value[i]=parseInt(s,10)||0)})},p=()=>{Object.keys(d).forEach(e=>{const t=O(e),s=y(e),i=s?o.value[s]:0;localStorage.setItem(t,String(i??0))})},g=(e,t=1)=>{const s=y(e);if(s&&Object.prototype.hasOwnProperty.call(o.value,s)){const i=o.value[s];o.value[s]+=t;const n=o.value[s];p();try{window.dispatchEvent(new CustomEvent("dailyObjectiveProgress",{detail:{type:e,value:n}}))}catch{}setTimeout(()=>{j()},100)}},I=()=>{Object.keys(o.value).forEach(e=>{o.value[e]=0}),p()},$=b(()=>v.value.progress>=v.value.target),q=e=>{const t=new Date().toDateString();return`daily_objective_reward_${e}_${t}`},f=e=>{const t=q(e);return localStorage.getItem(t)==="true"},P=e=>{const t=q(e);localStorage.setItem(t,"true")},_=async(e,t)=>{if(f(e))return!1;try{await A({xp_delta:t,reason:`daily_objective:${e}`});const s=u.xp||0;u.xp=s+t,P(e),setTimeout(()=>{window.dispatchEvent(new CustomEvent("dailyObjectiveCompleted",{detail:{objectiveType:e,xpAmount:t}}))},500)}catch{const i=u.xp||0;u.xp=i+t,window.dispatchEvent(new CustomEvent("dailyObjectiveCompleted",{detail:{objectiveType:e,xpAmount:t}}))}return!0},j=()=>{let e=!1;r.value.forEach(t=>{t.isCompleted&&!f(t.type)&&(e=!0,_(t.type,t.xpReward))}),e&&setTimeout(()=>{Array.from({length:c.length},(s,i)=>i).filter(s=>!l.value.includes(s)).length>0&&a()},1500)},E=e=>Math.min(100,e.progress/e.target*100),Q=()=>g("quiz_easy"),R=()=>g("quiz_medium"),T=()=>g("quiz_hard"),M=()=>g("quiz_perfect"),K=()=>g("exercices_completed"),U=e=>{o.value.quizStreak=Math.max(o.value.quizStreak,e),p();try{window.dispatchEvent(new CustomEvent("dailyObjectiveProgress",{detail:{type:"quiz_streak",value:o.value.quizStreak}}))}catch{}setTimeout(()=>{j()},100)};return w||(x(),z(),N(o,p,{deep:!0}),w=!0),{userStats:o,currentObjective:v,unlockedObjectives:l,unlockedObjectivesList:r,allObjectives:C,isDailyObjectiveCompleted:$,getProgressPercentage:E,incrementStat:g,resetDailyStats:I,loadTodayStats:x,checkAndAwardObjectives:j,awardObjectiveXP:_,hasObjectiveBeenRewarded:f,simulateQuizEasy:Q,simulateQuizMedium:R,simulateQuizHard:T,simulateQuizPerfect:M,simulateExerciseCompleted:K,simulateQuizStreak:U}}function W(){const{incrementStat:u,simulateQuizStreak:o}=V(),d=a=>`${a}_${new Date().toDateString()}`,y=()=>{const a=localStorage.getItem(d("daily_quiz_success_streak"));return a&&parseInt(a,10)||0},c=a=>{localStorage.setItem(d("daily_quiz_success_streak"),String(a))};return{onQuizCompleted:a=>{if(a.isSuccess){const r=a.difficulty?.toLowerCase?.()||"easy";r==="facile"||r==="easy"?u("quiz_easy"):r==="moyen"||r==="moyenne"||r==="medium"?u("quiz_medium"):(r==="difficile"||r==="hard")&&u("quiz_hard");let v=y();v=v+1,c(v),o(v)}else c(0),o(0);a.percentage===100&&u("quiz_perfect")},onQuizStreak:a=>{o(a)},onExerciseCompleted:a=>{a.isSuccess&&u("exercices_completed")}}}export{V as useDailyObjectives,W as useDailyObjectivesIntegration};
