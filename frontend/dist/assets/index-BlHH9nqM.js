const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Home-IBvLRbaF.js","assets/MainLayout-DW-0VRjb.js","assets/vendor-C_Y2k9EH.js","assets/menuItems-2RBwQC8O.js","assets/matieres-BMK_pEFL.js","assets/MainLayout-DjXpePSx.css","assets/BaseCard-CcmHQGfW.js","assets/BaseCard-wVd7U2iM.css","assets/ui-jaH5oyHW.js","assets/pdf-B39ievqC.js","assets/mathlive-B5k0jhbN.js","assets/Home-C6UKIa5s.css","assets/Dashboard-CcYyKPeO.js","assets/DashboardLayout-BeVgDFuc.js","assets/DashboardLayout-DlpgjpAm.css","assets/curriculum-MPrAE0b_.js","assets/exercices-CCUS4_6m.js","assets/quiz-Cmw20o8e.js","assets/useDailyObjectives-D-hi0e6x.js","assets/Dashboard-D8sEj_10.css","assets/ChildOverview-CSx3mnHM.js","assets/ChildOverview-Ct9ZYVDo.css","assets/Account-DjkJinIJ.js","assets/niveaux-CjwZPXlt.js","assets/defineProperty-CByTjH6h.js","assets/Account-BvdlpVBp.css","assets/Pricing-DybkC3-x.js","assets/Pricing-B0gC7E42.css","assets/Exercises-CA2haRve.js","assets/themes-BPguWxGX.js","assets/useSmartNavigation-C5QzkowB.js","assets/Exercises-DJgsPd93.css","assets/OnlineCourses-DLDp89Pz.js","assets/OnlineCourses-SnnzWnAW.css","assets/Quiz-DMGKt0qY.js","assets/Quiz-BaVQ_woE.css","assets/QuizNotions-DX8iy3tf.js","assets/ThemeNotionsView-3gqpOpQv.js","assets/NotionCard-YVybVM7X.js","assets/NotionCard-CHk7ZF0g.css","assets/ThemeNotionsView-Od9CvGnQ.css","assets/BackButton-DQBQyud6.js","assets/BackButton-C5yUIBdm.css","assets/QuizNotions-D2--llqa.css","assets/QuizChapitres-C78YAuof.js","assets/ChapitresListView-UTxLvXZP.js","assets/ChapitresListView-CCAmRy31.css","assets/ChapterQuiz-Cn5nOZD6.js","assets/ChapterQuiz-hEmS9nlz.css","assets/CourseNotions-CG4uTmKU.js","assets/CourseNotions-C3FzQNzR.css","assets/CourseChapitres-DcAq0jDO.js","assets/CourseChapitre-DjUhaZ8i.js","assets/PDFDownloadButton-CWMpgUhe.js","assets/PDFDownloadButton-D7sfzo-M.css","assets/cours-B70EkRt8.js","assets/scientificRenderer-SJJ6pUZd.js","assets/CourseChapitre-1As98nXp.css","assets/Cours-zhtU8-Fs.js","assets/Cours-BkIZ9rTK.css","assets/CoursDetail-BcWA9CGE.js","assets/CoursDetail-CZyP49zS.css","assets/Sheets-DcKUS00h.js","assets/synthesis-ZtX-MJY5.js","assets/Sheets-D4Zq-ef4.css","assets/About-D5fE_jdt.js","assets/About-BIGv8Rov.css","assets/PasswordReset-7w7CQseY.js","assets/PasswordReset-BGr53cxo.css","assets/CGV-KgwIpEZZ.js","assets/CGV-BgP3puIB.css","assets/CGU-Cku2vGO7.js","assets/CGU-DdhkNJwG.css","assets/Confidentialite-DNNXTQLc.js","assets/Confidentialite-BBWG7fbl.css","assets/Conditions-B03_1pbI.js","assets/Conditions-D7anzJ0L.css","assets/Notions-Cl3flJTM.js","assets/notions-sKUDQmQg.js","assets/math-DsqdWQfm.js","assets/Notions-CNPax--8.css","assets/Themes-D85bukUo.js","assets/Themes-BmNvf7tJ.css","assets/ThemeNotions-DXihD8bD.js","assets/ThemeNotions-tPiWNz0W.css","assets/Chapitres-DgUWZgaH.js","assets/Chapitres-DMZqd22O.css","assets/ChapterExercises-CQ-a2hhw.js","assets/ExerciceQCM-CLLiJVBR.js","assets/ExerciceQCM-Bi28n1Dj.css","assets/ChapterExercises-BZ4hHnsf.css","assets/Tabs-DlI6u4ZP.css","assets/ExerciceDetail-B96P97d9.js","assets/ExerciceDetail-CYwV5da-.css","assets/Progress-BXdRRTPx.js","assets/Progress-oXpKVhMa.css","assets/Calculator-DjWBUfOL.js","assets/calculator-B1ZA-8Qo.js","assets/calculator-CbtoceRh.js","assets/Calculator-Dy0zL-nw.css","assets/TestFiltrageStrict-Bu0zZkHu.js","assets/TestFiltrageStrict-BeULsNWG.css","assets/AdminLayout-DTVKoa79.js","assets/AdminLayout-zRG-CH6Y.css","assets/AdminMatieres-BulrE3G4.js","assets/matiere-contextes-CKKyGNsA.js","assets/AdminActionsButtons-BS03Dcpn.js","assets/AdminActionsButtons-Ccw6G07H.css","assets/AdminMatieres-BounX-DR.css","assets/AdminThemes-BaH3Yjc2.js","assets/PaysNiveauxDisplay.vue_vue_type_style_index_0_scoped_821033d6_lang-l0sNRNKZ.js","assets/AdminThemes-C42FetGD.css","assets/AdminNotions-7vrgC6jo.js","assets/PaysNiveauxSelector.vue_vue_type_style_index_0_scoped_6652d9f9_lang-l0sNRNKZ.js","assets/AdminNotions-CICP2R-z.css","assets/AdminChapitres-aw8lr7eG.js","assets/AdminChapitres-NJFWNzBT.css","assets/AdminExercices-DTnMcpVc.js","assets/AdminExercices-CJLdLS4b.css","assets/AdminExercicesPlus-Bcesb0sT.js","assets/AdminExercicesPlus-bswOZmlE.css","assets/AdminCours-BrlL0vs7.js","assets/AdminCours-CpH06XSE.css","assets/AdminCoursPlus-B8rJ3cvD.js","assets/AdminCoursPlus-DJVlzxGp.css","assets/AdminSheets-DzVJIScs.js","assets/AdminSheets-BzsaFlZ6.css","assets/AdminQuiz-FYiw0Q4w.js","assets/AdminQuiz-xcDF0Z17.css","assets/AdminQuizPlus-BUF304FX.js","assets/AdminQuizPlus-Cbgqxmao.css","assets/AdminNiveaux-gco-LQyU.js","assets/AdminNiveaux-BU2lQ2eA.css","assets/AdminPays-CFr4h_7Z.js","assets/AdminPays-8Ot7-Z35.css","assets/NotFound-B3dI-a4V.js","assets/NotFound-BRLCr2dc.css"])))=>i.map(i=>d[i]);
import{r as Ae,a as M,c as F,b as S,o as h,d as n,e as Y,f as ae,g as U,t as O,h as B,i as De,w as qe,n as K,T as Ue,j as fe,k as et,v as gt,l as ht,m as tt,F as pe,p as ge,q as he,u as G,s as vt,x as _t,y as Be,z as ue,A as be,B as Te,C as yt,D as st,E as rt,G as St,H as It,I as Et}from"./vendor-C_Y2k9EH.js";import{a as ot}from"./ui-jaH5oyHW.js";import{_ as w}from"./pdf-B39ievqC.js";import"./mathlive-B5k0jhbN.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function s(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=s(a);fetch(a.href,i)}})();const ie=Ae({}),me=M([]);function ze(){return{modalStates:ie,activeModals:me,openModal:(o,c={})=>{ie[o]={isOpen:!0,...c},me.value.includes(o)||me.value.push(o),document.body.style.overflow="hidden"},closeModal:o=>{ie[o]&&(ie[o].isOpen=!1);const c=me.value.indexOf(o);c>-1&&me.value.splice(c,1),me.value.length===0&&(document.body.style.overflow="")},closeAllModals:()=>{Object.keys(ie).forEach(o=>{ie[o].isOpen=!1}),me.value=[],document.body.style.overflow=""},isModalOpen:o=>ie[o]?.isOpen||!1,getModalState:o=>ie[o]||{isOpen:!1},updateModalOptions:(o,c)=>{ie[o]&&Object.assign(ie[o],c)}}}const re={LOGIN:"login",REGISTER:"register",FORGOT_PASSWORD:"forgot-password",SIGNUP:"signup",CONFIRM_DELETE:"confirm-delete",SETTINGS:"settings",AUTO_NIVEAU:"auto-niveau"},H={required:e=>typeof e=="string"?e.trim().length>0||"Ce champ est requis":e!=null||"Ce champ est requis",email:e=>e?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)||"Format d'email invalide":!0,minLength:e=>t=>t?t.length>=e||`Minimum ${e} caractères requis`:!0,maxLength:e=>t=>t?t.length<=e||`Maximum ${e} caractères autorisés`:!0,password:e=>{if(!e)return!0;const t=/[A-Z]/.test(e),s=/[a-z]/.test(e),r=/\d/.test(e);return e.length>=8?t?s?r?!0:"Le mot de passe doit contenir au moins un chiffre":"Le mot de passe doit contenir au moins une minuscule":"Le mot de passe doit contenir au moins une majuscule":"Le mot de passe doit contenir au moins 8 caractères"},confirmPassword:e=>t=>t?e===t||"Les mots de passe ne correspondent pas":"Veuillez confirmer votre mot de passe"};function bt(e={},t={}){const s=Ae({...e}),r=Ae({}),a=Ae({}),i=M(!1),o=F(()=>Object.keys(r).length===0||Object.values(r).every(y=>!y)),c=F(()=>Object.values(r).some(y=>y)),u=(y,f)=>{const _=t[y];if(!_)return!0;for(const T of _){const R=T(f,void 0,s);if(R!==!0)return r[y]=R,!1}return delete r[y],!0},p=()=>{let y=!0;return Object.keys(t).forEach(f=>{u(f,s[f])||(y=!1)}),y};return{formData:s,errors:r,touched:a,isSubmitting:i,isValid:o,hasErrors:c,validateField:u,validateForm:p,setFieldValue:(y,f)=>{s[y]=f,a[y]&&u(y,f)},setFieldTouched:y=>{a[y]=!0,u(y,s[y])},resetForm:()=>{Object.keys(s).forEach(y=>{s[y]=e[y]||""}),Object.keys(r).forEach(y=>{delete r[y]}),Object.keys(a).forEach(y=>{delete a[y]}),i.value=!1},setErrors:y=>{Object.assign(r,y)},getFieldError:y=>r[y]||"",isFieldTouched:y=>a[y]||!1,handleSubmit:async y=>{if(!i.value){if(Object.keys(t).forEach(f=>{a[f]=!0}),!p())return!1;i.value=!0;try{return await y(s),!0}catch{return!1}finally{i.value=!1}}}}}const kt={LOGIN:{fields:{email:{type:"email",label:"Email",placeholder:"votre@email.com",required:!0,name:"username",autocomplete:"username",validation:[H.required,H.email]},password:{type:"password",label:"Mot de passe",placeholder:"Votre mot de passe",required:!0,name:"current-password",autocomplete:"current-password",validation:[H.required,H.minLength(6)]},rememberMe:{type:"checkbox",label:"Se souvenir de moi",required:!1}},submitText:"Se connecter",socialText:"Continuer avec Google"},REGISTER:{fields:{firstName:{type:"text",label:"Prénom",placeholder:"Votre prénom",required:!0,autocomplete:"given-name",validation:[H.required,H.minLength(2)]},lastName:{type:"text",label:"Nom",placeholder:"Votre nom",required:!0,autocomplete:"family-name",validation:[H.required,H.minLength(2)]},email:{type:"email",label:"Email",placeholder:"votre@email.com",required:!0,autocomplete:"email",validation:[H.required,H.email]},password:{type:"password",label:"Mot de passe",placeholder:"Créez un mot de passe",required:!0,autocomplete:"new-password",validation:[H.required,H.password]},confirmPassword:{type:"password",label:"Confirmer le mot de passe",placeholder:"Confirmez votre mot de passe",required:!0,autocomplete:"new-password",validation:[H.required]},acceptTerms:{type:"checkbox",label:"J'accepte les conditions d'utilisation",required:!0,validation:[e=>e===!0||"Vous devez accepter les conditions d'utilisation"]},newsletter:{type:"checkbox",label:"Je souhaite recevoir les actualités et offres d'OptiTAB",required:!1}},submitText:"Créer mon compte",socialText:"Continuer avec Google"},FORGOT_PASSWORD:{fields:{email:{type:"email",label:"Email",placeholder:"votre@email.com",required:!0,autocomplete:"email",validation:[H.required,H.email]}},submitText:"Envoyer le lien de réinitialisation",socialText:"Continuer avec Google"}};function je(e){const t=kt[e];if(!t)throw new Error(`Unknown form type: ${e}`);const s=Object.keys(t.fields).reduce((f,_)=>{const T=t.fields[_];return f[_]=T.type==="checkbox"?!1:"",f},{}),r=Object.keys(t.fields).reduce((f,_)=>{const T=t.fields[_];return T.validation&&(f[_]=T.validation),f},{});e==="REGISTER"&&r.confirmPassword.push((f,_,T)=>H.confirmPassword(T.password)(f));const{formData:a,errors:i,touched:o,isSubmitting:c,isValid:u,getFieldError:p,setFieldTouched:m,handleSubmit:g,resetForm:d}=bt(s,r);return{config:t,formData:a,errors:i,touched:o,isSubmitting:c,isValid:u,getFieldError:p,setFieldTouched:m,submitForm:async(f,_)=>await g(async R=>{try{return await f(R),!0}catch(N){return _?.(N),!1}}),resetForm:d,getFieldConfig:f=>t.fields[f]||null,getFieldNames:()=>Object.keys(t.fields),isFieldRequired:f=>t.fields[f]?.required||!1,getFieldType:f=>t.fields[f]?.type||"text"}}const Q=(e,t)=>{const s=e.__vccOpts||e;for(const[r,a]of t)s[r]=a;return s},wt={name:"CloseIcon"},At={class:"close-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"};function Tt(e,t,s,r,a,i){return h(),S("svg",At,t[0]||(t[0]=[n("line",{x1:"18",y1:"6",x2:"6",y2:"18"},null,-1),n("line",{x1:"6",y1:"6",x2:"18",y2:"18"},null,-1)]))}const Mt=Q(wt,[["render",Tt],["__scopeId","data-v-8853147e"]]),Ct={name:"Modal",components:{CloseIcon:Mt},props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:""},showHeader:{type:Boolean,default:!0},showCloseButton:{type:Boolean,default:!0},closeButtonLabel:{type:String,default:"Fermer"},closeOnOverlay:{type:Boolean,default:!0},canClose:{type:Boolean,default:!0},size:{type:String,default:"medium",validator:e=>["small","medium","large","full"].includes(e)},contentClass:{type:String,default:""}},emits:["close","overlay-click"],setup(e,{emit:t}){return{titleId:F(()=>e.title?`modal-title-${Date.now()}`:""),handleClose:()=>{t("close")},handleOverlayClick:()=>{e.closeOnOverlay&&e.canClose&&(t("overlay-click"),t("close"))}}}},Ft={key:0,class:"modal-wrapper"},Lt=["aria-modal","aria-labelledby"],Rt={key:0,class:"modal-header"},xt=["id"],Pt=["aria-label"],Nt={class:"modal-body"};function Dt(e,t,s,r,a,i){const o=Y("CloseIcon");return h(),ae(Ue,{to:"body"},[s.isOpen?(h(),S("div",Ft,[n("div",{class:"modal-overlay",onClick:t[0]||(t[0]=(...c)=>r.handleOverlayClick&&r.handleOverlayClick(...c)),role:"presentation"}),n("div",{class:K(["modal-content",`modal-${s.size}`]),role:"dialog","aria-modal":s.isOpen,"aria-labelledby":r.titleId,onClick:t[2]||(t[2]=qe(()=>{},["stop"]))},[s.showHeader?(h(),S("div",Rt,[s.title?(h(),S("h2",{key:0,id:r.titleId,class:"modal-title"},O(s.title),9,xt)):U("",!0),s.showCloseButton&&s.canClose?(h(),S("button",{key:1,class:"modal-close-btn",onClick:t[1]||(t[1]=(...c)=>r.handleClose&&r.handleClose(...c)),"aria-label":s.closeButtonLabel},[B(o)],8,Pt)):U("",!0)])):U("",!0),n("div",Nt,[De(e.$slots,"default",{},void 0,!0)])],10,Lt)])):U("",!0)])}const Fe=Q(Ct,[["render",Dt],["__scopeId","data-v-91224a14"]]),Ot={name:"FormInput",props:{modelValue:{type:[String,Number],default:""},type:{type:String,default:"text",validator:e=>["text","email","password","number","tel","url","date"].includes(e)},label:{type:String,default:""},placeholder:{type:String,default:""},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},name:{type:String,default:""},autocomplete:{type:String,default:""},error:{type:String,default:""},helpText:{type:String,default:""}},emits:["update:modelValue","input","focus","blur","keydown"],setup(e,{emit:t}){const s=`input-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,r=M(!1),a=F({get:()=>e.modelValue,set:d=>t("update:modelValue",d)}),i=F(()=>({"has-error":e.error,"is-disabled":e.disabled})),o=F(()=>e.type==="password"?r.value?"text":"password":e.type);return{inputId:s,inputValue:a,inputClass:i,actualType:o,isPasswordVisible:r,handleInput:d=>t("input",d),handleFocus:d=>t("focus",d),handleBlur:d=>t("blur",d),handleKeydown:d=>t("keydown",d),togglePasswordVisibility:()=>{r.value=!r.value}}}},Vt={class:"form-group"},qt=["for"],Ut={key:0,class:"required-indicator"},Bt={class:"input-wrapper"},zt=["id","type","placeholder","required","disabled","name","autocomplete"],jt=["disabled"],Gt={key:0,width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},$t={key:1,width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Xt={key:1,class:"form-error"},Ht={key:2,class:"form-help"};function Qt(e,t,s,r,a,i){return h(),S("div",Vt,[s.label?(h(),S("label",{key:0,for:r.inputId,class:"form-label"},[fe(O(s.label)+" ",1),s.required?(h(),S("span",Ut,"*")):U("",!0)],8,qt)):U("",!0),n("div",Bt,[et(n("input",{id:r.inputId,"onUpdate:modelValue":t[0]||(t[0]=o=>r.inputValue=o),type:r.actualType,placeholder:s.placeholder,required:s.required,disabled:s.disabled,name:s.name,autocomplete:s.autocomplete,class:K(["form-input",r.inputClass]),onInput:t[1]||(t[1]=(...o)=>r.handleInput&&r.handleInput(...o)),onFocus:t[2]||(t[2]=(...o)=>r.handleFocus&&r.handleFocus(...o)),onBlur:t[3]||(t[3]=(...o)=>r.handleBlur&&r.handleBlur(...o)),onKeydown:t[4]||(t[4]=(...o)=>r.handleKeydown&&r.handleKeydown(...o))},null,42,zt),[[gt,r.inputValue]]),s.type==="password"?(h(),S("button",{key:0,type:"button",class:"password-toggle",onClick:t[5]||(t[5]=(...o)=>r.togglePasswordVisibility&&r.togglePasswordVisibility(...o)),disabled:s.disabled,tabindex:"-1"},[r.isPasswordVisible?(h(),S("svg",Gt,t[6]||(t[6]=[n("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"},null,-1),n("line",{x1:"1",y1:"1",x2:"23",y2:"23"},null,-1)]))):(h(),S("svg",$t,t[7]||(t[7]=[n("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"},null,-1),n("circle",{cx:"12",cy:"12",r:"3"},null,-1)])))],8,jt)):U("",!0)]),s.error?(h(),S("p",Xt,O(s.error),1)):U("",!0),s.helpText?(h(),S("p",Ht,O(s.helpText),1)):U("",!0)])}const Kt=Q(Ot,[["render",Qt],["__scopeId","data-v-49655f01"]]),Wt={name:"FormField",components:{FormInput:Kt},props:{fieldName:{type:String,required:!0},fieldConfig:{type:Object,required:!0},modelValue:{type:[String,Number,Boolean],default:""},disabled:{type:Boolean,default:!1},getFieldError:{type:Function,required:!0}},emits:["update:modelValue","blur","input"],setup(e,{emit:t}){const s=F({get:()=>e.modelValue,set:c=>t("update:modelValue",c)}),r=F(()=>e.fieldConfig?["text","email","password","number","tel","url"].includes(e.fieldConfig.type):!1),a=F(()=>({"has-error":e.getFieldError(e.fieldName),"is-disabled":e.disabled}));return{fieldValue:s,isInputField:r,fieldClass:a,handleBlur:c=>{t("blur",{fieldName:e.fieldName,event:c})},handleInput:c=>{t("input",{fieldName:e.fieldName,event:c})}}}},Jt={key:1,class:"checkbox-field"},Yt={class:"checkbox-label"},Zt=["required","disabled"],es=["innerHTML"],ts={key:0,class:"form-error"},ss={key:2,class:"unsupported-field"},rs={class:"error-message"};function os(e,t,s,r,a,i){const o=Y("FormInput");return s.fieldConfig?(h(),S("div",{key:0,class:K(["form-field",r.fieldClass])},[r.isInputField?(h(),ae(o,{key:0,modelValue:r.fieldValue,"onUpdate:modelValue":t[0]||(t[0]=c=>r.fieldValue=c),type:s.fieldConfig.type,label:s.fieldConfig.label,placeholder:s.fieldConfig.placeholder,required:s.fieldConfig.required,disabled:s.disabled,name:s.fieldConfig.name||s.fieldName,autocomplete:s.fieldConfig.autocomplete,error:s.getFieldError(s.fieldName),"help-text":s.fieldConfig.helpText,onBlur:r.handleBlur,onInput:r.handleInput},null,8,["modelValue","type","label","placeholder","required","disabled","name","autocomplete","error","help-text","onBlur","onInput"])):s.fieldConfig.type==="checkbox"?(h(),S("div",Jt,[n("label",Yt,[et(n("input",{"onUpdate:modelValue":t[1]||(t[1]=c=>r.fieldValue=c),type:"checkbox",class:"checkbox-input",required:s.fieldConfig.required,disabled:s.disabled},null,8,Zt),[[ht,r.fieldValue]]),n("span",{class:"checkbox-text",innerHTML:s.fieldConfig.label},null,8,es)]),s.getFieldError(s.fieldName)?(h(),S("p",ts,O(s.getFieldError(s.fieldName)),1)):U("",!0)])):(h(),S("div",ss,[n("p",rs,'Field type "'+O(s.fieldConfig.type)+'" is not supported',1)]))],2)):U("",!0)}const at=Q(Wt,[["render",os],["__scopeId","data-v-d5ac912b"]]),as={name:"LoadingSpinner",props:{size:{type:String,default:"medium",validator:e=>["small","medium","large"].includes(e)},color:{type:String,default:"current"}},computed:{sizeClass(){return`spinner-${this.size}`},spinnerStyle(){return this.color==="current"?{}:{"--spinner-color":this.color}}}};function ns(e,t,s,r,a,i){return h(),S("div",{class:K(["loading-spinner",i.sizeClass]),style:tt(i.spinnerStyle)},t[0]||(t[0]=[n("div",{class:"spinner-ring"},null,-1)]),6)}const is=Q(as,[["render",ns],["__scopeId","data-v-f8c69cd1"]]),ls={name:"DynamicForm",components:{FormField:at,LoadingSpinner:is},props:{fieldNames:{type:Array,required:!0},getFieldConfig:{type:Function,required:!0},formData:{type:Object,required:!0},isSubmitting:{type:Boolean,default:!1},isValid:{type:Boolean,default:!0},getFieldError:{type:Function,required:!0},setFieldTouched:{type:Function,required:!0},submitText:{type:String,default:"Soumettre"}},emits:["submit","field-blur","field-input"],setup(e,{emit:t}){return{handleSubmit:()=>{t("submit")},handleFieldBlur:({fieldName:i,event:o})=>{e.setFieldTouched(i),t("field-blur",{fieldName:i,event:o})},handleFieldInput:({fieldName:i,event:o})=>{t("field-input",{fieldName:i,event:o})}}}},cs={class:"form-fields"},us=["disabled"],ds={key:1};function ms(e,t,s,r,a,i){const o=Y("FormField"),c=Y("LoadingSpinner");return h(),S("form",{onSubmit:t[0]||(t[0]=qe((...u)=>r.handleSubmit&&r.handleSubmit(...u),["prevent"])),class:"dynamic-form"},[n("div",cs,[(h(!0),S(pe,null,ge(s.fieldNames,u=>(h(),ae(o,{key:u,"field-name":u,"field-config":s.getFieldConfig(u),modelValue:s.formData[u],"onUpdate:modelValue":p=>s.formData[u]=p,disabled:s.isSubmitting,"get-field-error":s.getFieldError,onBlur:r.handleFieldBlur,onInput:r.handleFieldInput},null,8,["field-name","field-config","modelValue","onUpdate:modelValue","disabled","get-field-error","onBlur","onInput"]))),128))]),De(e.$slots,"form-content",{},void 0,!0),n("button",{type:"submit",class:"form-submit-btn",disabled:s.isSubmitting||!s.isValid},[s.isSubmitting?(h(),ae(c,{key:0})):(h(),S("span",ds,O(s.submitText),1))],8,us),De(e.$slots,"form-actions",{},void 0,!0)],32)}const Ge=Q(ls,[["render",ms],["__scopeId","data-v-6fbd3fc3"]]),fs="/icons/google.svg",nt=[{key:"google",label:"Continuer avec Google",icon:fs,btnClass:"google-btn",color:"#e5e7eb"}];function Oe(e){if(e<=0)return{level:0,next_level_xp:10,xp_to_next:10};let t=0;for(;;){const a=(t+1)*(t+1)*10;if(e<a)break;t+=1}const s=(t+1)*(t+1)*10,r=s-e;return{level:t,next_level_xp:s,xp_to_next:r}}localStorage.removeItem("user");const se=he("user",{state:()=>({id:null,firstName:"",lastName:"",email:"",telephone:"",date_naissance:"",niveau_pays:null,pays:null,role:"student",xp:0,level:0,xp_to_next:0,isAdmin:!1,isAuthenticated:!1,isLoading:!1}),actions:{setUser(e){this.id=e.id||e.user_id||null,this.firstName=e.first_name||"",this.lastName=e.last_name||"",this.email=e.email||"",this.telephone=e.telephone||"",this.date_naissance=e.date_naissance||"",this.niveau_pays=e.niveau_pays||null,this.pays=e.pays||null,this.role=e.role||"student";const t=Number(e.xp??0),s=Oe(t);this.xp=t,this.level=Number(s.level),this.xp_to_next=Number(s.xp_to_next);const r=["anthonytabet.c@gmail.com","admin@optitab.com"];this.isAdmin=e.is_staff||e.isAdmin||r.includes(e.email)||!1,this.isAuthenticated=!0,this.isLoading=!1},clearUser(){ye.stopTokenMonitoring();const e=this.id;if(this.id=null,this.firstName="",this.lastName="",this.email="",this.telephone="",this.date_naissance="",this.niveau_pays=null,this.pays=null,this.role="student",this.xp=0,this.level=0,this.xp_to_next=0,this.isAdmin=!1,this.isAuthenticated=!1,this.isLoading=!1,e){const s=`configurationCompleted_${e}`;localStorage.removeItem(s)}["selectedMatieres","favoriteMatieresIds","activeMatiereId","selectedMatieresIds","access_token","refresh_token"].forEach(s=>localStorage.removeItem(s))},async fetchUser(){this.isLoading=!0;try{const e=localStorage.getItem("access_token"),t=localStorage.getItem("refresh_token"),s=await zs(),r=s.data?.data||s.data,a=this.pays&&this.niveau_pays,i=r.pays&&r.niveau_pays;if(a&&!i&&this.id){const o=`configurationCompleted_${this.id}`;localStorage.removeItem(o),["selectedMatieres","favoriteMatieresIds","activeMatiereId","selectedMatieresIds"].forEach(u=>localStorage.removeItem(u))}this.setUser(r),setTimeout(()=>{ye.startTokenMonitoring()},500)}catch(e){const t=e.response?.status,s=e.response?.data?.message||e.message;t===401?this.clearUser():t>=500?setTimeout(()=>{this.isAuthenticated||this.fetchUser()},5e3):this.clearUser()}finally{this.isLoading=!1}}}}),z={SELECTED_SUBJECT:"selected-subject",SELECTED_MATIERES:"selected-matieres-ids",FAVORITE_MATIERES:"favorite-matieres-ids",ACTIVE_MATIERE:"active-matiere-id"},Me={MAX_SELECTED_MATIERES:10,MAX_FAVORITE_MATIERES:20},de={INVALID_ID:"ID de matière invalide",LIMIT_REACHED:"Limite atteinte"},it={UNAUTHORIZED:401,NOT_FOUND:404},j=(e,t,s={})=>{const r={context:t,message:e.message,timestamp:new Date().toISOString(),...s};return e.response&&(e.response.status,it.NOT_FOUND),r},lt=e=>{if(e==null)return!1;const t=Number(e);return!isNaN(t)&&t>0&&Number.isInteger(t)},Z=e=>lt(e)?Number(e):null,$=()=>!!localStorage.getItem("access_token"),J=(e,t)=>{try{return localStorage.setItem(e,JSON.stringify(t)),!0}catch{return!1}},$e=(e,t,s=!0)=>{try{const r=localStorage.getItem(e);if(!r)return t;if(!s)return r;try{return JSON.parse(r)}catch{return r}}catch{return t}},Ie=e=>Array.isArray(e)?e.filter(lt).map(Z):[],Ee=(e,t)=>e.response?.status===it.UNAUTHORIZED,ct=(e,t)=>e<t,E=(e,t={},s="info")=>{const r={operation:e,timestamp:new Date().toISOString(),...t};switch(s){case"warn":break;case"error":break;default:}},ps=he("subjects-favorites",()=>{const e=M([]),t=M(!1),s=M(null),r=F(()=>e.value.length),a=F(()=>ct(r.value,Me.MAX_FAVORITE_MATIERES)),i=F(()=>d=>{const l=Z(d);return l!==null&&e.value.includes(l)}),o=async d=>{const l=Z(d);if(!l)return E("addFavoriteMatiere",{id:d,error:de.INVALID_ID},"warn"),!1;if(e.value.includes(l))return E("addFavoriteMatiere",{id:l,status:"already_favorite"}),!0;if(!a.value)return E("addFavoriteMatiere",{id:l,error:de.LIMIT_REACHED,currentCount:r.value,maxCount:Me.MAX_FAVORITE_MATIERES},"warn"),!1;if(e.value.push(l),J(z.FAVORITE_MATIERES,e.value),E("addFavoriteMatiere",{id:l,status:"local_update",authenticated:$()}),!$())return!0;try{return t.value=!0,s.value=null,await Ns(l),E("addFavoriteMatiere",{id:l,status:"backend_success"}),!0}catch(b){return Ee(b,"addFavoriteMatiere")?!0:(e.value=e.value.filter(C=>C!==l),J(z.FAVORITE_MATIERES,e.value),s.value=j(b,"addFavoriteMatiere",{matiereId:l}),!1)}finally{t.value=!1}},c=async d=>{const l=Z(d);if(!l)return E("removeFavoriteMatiere",{id:d,error:de.INVALID_ID},"warn"),!1;const b=e.value.indexOf(l);if(b===-1)return E("removeFavoriteMatiere",{id:l,status:"not_found"}),!0;if(e.value.splice(b,1),J(z.FAVORITE_MATIERES,e.value),E("removeFavoriteMatiere",{id:l,status:"local_update",authenticated:$()}),!$())return!0;try{return t.value=!0,s.value=null,await Ds(l),E("removeFavoriteMatiere",{id:l,status:"backend_success"}),!0}catch(C){return Ee(C,"removeFavoriteMatiere")?!0:(e.value.splice(b,0,l),J(z.FAVORITE_MATIERES,e.value),s.value=j(C,"removeFavoriteMatiere",{matiereId:l}),!1)}finally{t.value=!1}};return{favoriteMatieresIds:e,isSyncing:t,lastSyncError:s,favoriteMatieresCount:r,canAddMoreFavorites:a,isFavoriteMatiere:i,addFavoriteMatiere:o,removeFavoriteMatiere:c,toggleFavoriteMatiere:async d=>{const l=Z(d);if(!l)return E("toggleFavoriteMatiere",{matiereId:d,error:de.INVALID_ID},"warn"),!1;try{return e.value.includes(l)?await c(l):await o(l)}catch(b){return s.value=j(b,"toggleFavoriteMatiere",{matiereId:l}),!1}},loadFavoriteMatieresIds:async()=>{try{const d=$e(z.FAVORITE_MATIERES,[]),l=Ie(d);e.value=l,E("loadFavoriteMatieresIds",{loadedCount:l.length,totalStored:d.length})}catch(d){s.value=j(d,"loadFavoriteMatieresIds"),e.value=[]}},clearFavorites:async()=>{try{const d=[...e.value];for(const l of d)await c(l);return E("clearFavorites",{clearedCount:d.length}),!0}catch(d){return s.value=j(d,"clearFavorites"),!1}},setFavoriteMatieresIds:d=>{const l=Ie(d);e.value=l,J(z.FAVORITE_MATIERES,l),E("setFavoriteMatieresIds",{setCount:l.length,originalCount:d.length})}}}),gs=he("subjects-selected",()=>{const e=M([]),t=M(!1),s=M(null),r=F(()=>e.value.length),a=F(()=>ct(r.value,Me.MAX_SELECTED_MATIERES)),i=F(()=>d=>{const l=Z(d);return l!==null&&e.value.includes(l)}),o=async d=>{const l=Z(d);if(!l)return E("addMatiereId",{id:d,error:de.INVALID_ID},"warn"),!1;if(e.value.includes(l))return E("addMatiereId",{id:l,status:"already_selected"}),!0;if(!a.value)return E("addMatiereId",{id:l,error:de.LIMIT_REACHED,currentCount:r.value,maxCount:Me.MAX_SELECTED_MATIERES},"warn"),!1;if(e.value.push(l),J(z.SELECTED_MATIERES,e.value),E("addMatiereId",{id:l,status:"local_update",authenticated:$()}),!$())return!0;try{return t.value=!0,s.value=null,await Os(l),E("addMatiereId",{id:l,status:"backend_success"}),!0}catch(b){return Ee(b,"addMatiereId")?!0:(e.value=e.value.filter(C=>C!==l),J(z.SELECTED_MATIERES,e.value),s.value=j(b,"addMatiereId",{matiereId:l}),!1)}finally{t.value=!1}},c=async d=>{const l=Z(d);if(!l)return E("removeMatiereId",{id:d,error:de.INVALID_ID},"warn"),!1;const b=e.value.indexOf(l);if(b===-1)return E("removeMatiereId",{id:l,status:"not_found"}),!0;try{return e.value.splice(b,1),J(z.SELECTED_MATIERES,e.value),E("removeMatiereId",{id:l,status:"local_update",authenticated:$()}),$()&&(t.value=!0,s.value=null,await Vs(l),E("removeMatiereId",{id:l,status:"backend_success"})),!0}catch(C){return e.value.splice(b,0,l),J(z.SELECTED_MATIERES,e.value),s.value=j(C,"removeMatiereId",{matiereId:l}),!1}finally{t.value=!1}};return{selectedMatieresIds:e,isSyncing:t,lastSyncError:s,selectedMatieresCount:r,canAddMoreSelected:a,isSelectedMatiere:i,addMatiereId:o,removeMatiereId:c,loadSelectedMatieresIds:async()=>{try{const d=$e(z.SELECTED_MATIERES,[]),l=Ie(d);e.value=l,E("loadSelectedMatieresIds",{loadedCount:l.length,totalStored:d.length})}catch(d){s.value=j(d,"loadSelectedMatieresIds"),e.value=[]}},clearSelectedMatieres:async()=>{try{const d=[...e.value];for(const l of d)await c(l);return E("clearSelectedMatieres",{clearedCount:d.length}),!0}catch(d){return s.value=j(d,"clearSelectedMatieres"),!1}},setSelectedMatieresIds:d=>{const l=Ie(d);e.value=l,J(z.SELECTED_MATIERES,l),E("setSelectedMatieresIds",{setCount:l.length,originalCount:d.length})},addMultipleMatieres:async d=>{try{const l=Ie(d),C=(await Promise.all(l.map(y=>o(y)))).filter(Boolean).length,k=l.length;return E("addMultipleMatieres",{successCount:C,totalCount:k,successRate:`${(C/k*100).toFixed(1)}%`}),C===k}catch(l){return s.value=j(l,"addMultipleMatieres",{ids:d}),!1}}}}),hs=he("subjects-active",()=>{const e=M(null),t=M(!1),s=M(null),r=F(()=>m=>{const g=Z(m);return g!==null&&e.value===g}),a=F(()=>e.value!==null),i=async m=>{const g=Z(m);if(!g)return E("setActiveMatiere",{id:m,error:de.INVALID_ID},"warn"),!1;if(e.value===g)return E("setActiveMatiere",{id:g,status:"already_active"}),!0;try{const d=e.value;return e.value=g,J(z.ACTIVE_MATIERE,g),E("setActiveMatiere",{id:g,previousId:d,status:"local_update",authenticated:$()}),$()&&(t.value=!0,s.value=null,await qs(g),E("setActiveMatiere",{id:g,status:"backend_success"})),!0}catch(d){return e.value=previousId,previousId?J(z.ACTIVE_MATIERE,previousId):localStorage.removeItem(z.ACTIVE_MATIERE),s.value=j(d,"setActiveMatiere",{matiereId:g}),!1}finally{t.value=!1}};return{activeMatiereId:e,isSyncing:t,lastSyncError:s,isActiveMatiere:r,hasActiveMatiere:a,setActiveMatiere:i,clearActiveMatiere:async()=>{try{const m=e.value;return e.value=null,localStorage.removeItem(z.ACTIVE_MATIERE),E("clearActiveMatiere",{previousId:m,status:"cleared"}),!0}catch(m){return s.value=j(m,"clearActiveMatiere"),!1}},loadActiveMatiereId:async()=>{try{const m=$e(z.ACTIVE_MATIERE,null),g=m!==null?Z(m):null;e.value=g,E("loadActiveMatiereId",{loadedId:g,storedValue:m})}catch(m){s.value=j(m,"loadActiveMatiereId"),e.value=null}},getOrSetSmartActiveMatiere:async(m=[])=>{try{if(e.value)return e.value;if(m.length>0){const g=m[0];if(await i(g))return g}return E("getOrSetSmartActiveMatiere",{status:"no_matiere_available",selectedCount:m.length}),null}catch(g){return s.value=j(g,"getOrSetSmartActiveMatiere"),null}},setActiveMatiereId:m=>{const g=Z(m);e.value=g,g?J(z.ACTIVE_MATIERE,g):localStorage.removeItem(z.ACTIVE_MATIERE),E("setActiveMatiereId",{id:g,status:"direct_set"})}}}),vs=he("subjects-sync",()=>{const e=M(!1),t=M(null),s=M(null),r=async p=>{if(!$())return E("loadPreferencesFromServer",{status:"user_not_authenticated",message:"Utilisateur non connecté, chargement depuis localStorage uniquement"}),!1;try{e.value=!0,t.value=null,E("loadPreferencesFromServer",{status:"starting",authenticated:!0});const m=await Bs();return m?(p.selectedStore&&p.selectedStore.setSelectedMatieresIds(m.selectedIds||[]),p.favoritesStore&&p.favoritesStore.setFavoriteMatieresIds(m.favoriteIds||[]),p.activeStore&&p.activeStore.setActiveMatiereId(m.activeId||null),s.value=new Date().toISOString(),E("loadPreferencesFromServer",{status:"success",selectedCount:m.selectedIds?.length||0,favoritesCount:m.favoriteIds?.length||0,activeId:m.activeId}),!0):(E("loadPreferencesFromServer",{status:"no_data",message:"Aucune donnée reçue du backend"}),!1)}catch(m){return Ee(m,"loadPreferencesFromServer")||(t.value=j(m,"loadPreferencesFromServer")),!1}finally{e.value=!1}},a=async()=>{if(!$())return E("syncWithBackend",{status:"user_not_authenticated",message:"Synchronisation ignorée (utilisateur non connecté)"}),!0;try{e.value=!0,t.value=null,E("syncWithBackend",{status:"starting",authenticated:!0});const p=await Us();return p&&(s.value=new Date().toISOString(),E("syncWithBackend",{status:"success",timestamp:s.value})),p}catch(p){return Ee(p,"syncWithBackend")?!0:(t.value=j(p,"syncWithBackend"),!1)}finally{e.value=!1}};return{isSyncing:e,lastSyncError:t,lastSyncTimestamp:s,loadPreferencesFromServer:r,syncWithBackend:a,initializeAfterLogin:async p=>{if(!$())return E("initializeAfterLogin",{status:"user_not_authenticated",message:"initializeAfterLogin appelé sans authentification"},"warn"),!1;try{return E("initializeAfterLogin",{status:"starting",message:"Initialisation après connexion..."}),await r(p)||(p.selectedStore?.selectedMatieresCount>0||p.favoritesStore?.favoriteMatieresCount>0)&&(E("initializeAfterLogin",{status:"syncing_local_to_backend",message:"Synchronisation des données locales vers le backend..."}),await a()),E("initializeAfterLogin",{status:"completed",message:"Initialisation après connexion terminée"}),!0}catch(m){return E("initializeAfterLogin",{status:"error",error:m.message},"error"),!1}},getSyncStatus:()=>({isSyncing:e.value,lastSyncError:t.value,lastSyncTimestamp:s.value,isAuthenticated:$(),canSync:$()&&!e.value}),clearSyncErrors:()=>{t.value=null,E("clearSyncErrors",{status:"errors_cleared"})},forceSync:async p=>{try{E("forceSync",{status:"starting",message:"Synchronisation forcée..."});const m=await r(p),g=await a(),d=m||g;return E("forceSync",{status:d?"success":"partial_failure",loadSuccess:m,syncSuccess:g}),d}catch(m){return t.value=j(m,"forceSync"),!1}}}}),Le=he("subjects",()=>{const e=ps(),t=gs(),s=hs(),r=vs(),a=F(()=>G(e.favoriteMatieresIds)),i=F(()=>G(t.selectedMatieresIds)),o=F(()=>G(s.activeMatiereId)),c=F(()=>G(e.favoriteMatieresCount)),u=F(()=>G(t.selectedMatieresCount)),p=F(()=>e.isFavoriteMatiere),m=F(()=>t.isSelectedMatiere),g=F(()=>s.isActiveMatiere),d=F(()=>G(s.hasActiveMatiere)),l=F(()=>G(e.canAddMoreFavorites)),b=F(()=>G(t.canAddMoreSelected)),C=F(()=>G(e.isSyncing)||G(t.isSyncing)||G(s.isSyncing)||G(r.isSyncing)),k=F(()=>G(e.lastSyncError)||G(t.lastSyncError)||G(s.lastSyncError)||G(r.lastSyncError)),y=async D=>await e.addFavoriteMatiere(D),f=async D=>await e.removeFavoriteMatiere(D),_=async D=>await e.toggleFavoriteMatiere(D),T=async D=>await t.addMatiereId(D),R=async D=>await t.removeMatiereId(D),N=async D=>await t.addMultipleMatieres(D),X=async D=>await s.setActiveMatiere(D),le=async()=>await s.clearActiveMatiere(),L=async(D=[])=>await s.getOrSetSmartActiveMatiere(D),v=async()=>{const D={selectedStore:t,favoritesStore:e,activeStore:s};return await r.loadPreferencesFromServer(D)};return{favoriteMatieresIds:a,selectedMatieresIds:i,activeMatiereId:o,favoriteMatieresCount:c,selectedMatieresCount:u,isFavoriteMatiere:p,isSelectedMatiere:m,isActiveMatiere:g,hasActiveMatiere:d,canAddMoreFavorites:l,canAddMoreSelected:b,isSyncing:C,lastSyncError:k,addFavoriteMatiere:y,removeFavoriteMatiere:f,toggleFavoriteMatiere:_,addMatiereId:T,removeMatiereId:R,addMultipleMatieres:N,setActiveMatiere:X,clearActiveMatiere:le,getOrSetSmartActiveMatiere:L,loadPreferencesFromServer:v,syncWithBackend:async()=>{const D={selectedStore:t,favoritesStore:e,activeStore:s};return await r.syncWithBackend(D)},initializeAfterLogin:async()=>{const D={selectedStore:t,favoritesStore:e,activeStore:s};return await r.initializeAfterLogin(D)},initialize:async()=>{try{E("initialize",{status:"starting"}),await Promise.all([e.loadFavoriteMatieresIds(),t.loadSelectedMatieresIds(),s.loadActiveMatiereId()]),$()&&await v(),E("initialize",{status:"success",favoritesCount:c.value,selectedCount:u.value,activeId:o.value})}catch(D){throw j(D,"initialize"),D}},clearAll:async()=>{try{await Promise.all([e.clearFavorites(),t.clearSelectedMatieres(),s.clearActiveMatiere()]),E("clearAll",{status:"success"})}catch(D){throw j(D,"clearAll"),D}},getSyncStatus:()=>r.getSyncStatus(),clearSyncErrors:()=>{e.lastSyncError=null,t.lastSyncError=null,s.lastSyncError=null,r.clearSyncErrors()},getStats:()=>({hasActiveMatiere:d.value,activeMatiereId:o.value,favoritesCount:c.value,selectedCount:u.value,canAddMoreFavorites:l.value,canAddMoreSelected:b.value,isSyncing:C.value,lastSyncError:k.value,favoriteMatieresIds:a.value,selectedMatieresIds:i.value,isAuthenticated:$(),timestamp:new Date().toISOString()}),loadFavoriteMatieresIds:async()=>await e.loadFavoriteMatieresIds(),loadSelectedMatieresIds:async()=>await t.loadSelectedMatieresIds(),loadActiveMatiereId:async()=>await s.loadActiveMatiereId(),stores:{favorites:e,selected:t,active:s,sync:r}}}),_s=["Exercises","Quiz","Sheets","OnlineCourses"],ys={Exercises:e=>({name:"Notions",params:{matiereId:String(e)}}),Quiz:e=>({name:"QuizNotions",params:{matiereId:String(e)}}),Sheets:e=>({name:"Sheets",query:{matiereId:String(e)}}),OnlineCourses:e=>({name:"CourseNotions",params:{matiereId:String(e)}})},ke=(e,t,s)=>{try{const r=Le();if(!_s.includes(e.name)){Ce(e,r),s();return}const a=e.params.matiereId||e.query.matiereId;if(a&&ut(a)){Ce(e,r),s();return}const i=Ss(r);if(i){const o=ys[e.name];if(o){const c=o(i);s(c);return}}s()}catch{s()}},Ce=(e,t)=>{try{const s=e.params.matiereId||e.query.matiereId;if(ut(s)){const r=Number(s);t.selectedMatieresIds.includes(r)||t.addMatiereId(r),t.setActiveMatiere(r)}}catch{}},Ss=e=>{try{if(e.activeMatiereId)return e.activeMatiereId;if(e.selectedMatieresIds.length>0){const t=e.selectedMatieresIds[0];return e.setActiveMatiere(t),t}return null}catch{return null}},ut=e=>e!=null&&!isNaN(Number(e))&&Number(e)>0,Se=(e,t,s)=>{try{const r=Le();e.name==="Notions"&&e.params.matiereId&&Ce(e,r),s()}catch{s()}},Re=(e,t,s)=>{try{const r=Le();["QuizNotions","QuizChapitres","ChapterQuiz"].includes(e.name)&&e.params.matiereId&&Ce(e,r),s()}catch{s()}};function Is(e,t,s){const r=se();if(!r.isAuthenticated)return s();if(!r.niveau_pays&&e.name!=="Dashboard")return s({name:"Dashboard"});s()}const Es=["Cours","Exercises","Quiz","Sheets","Themes","Notions","Chapitres","ChapterExercises","ChapterQuiz","ThemeNotions","CourseChapitres","CourseChapitre","CourseNotions","QuizChapitres","QuizNotions","Progress","Calculator"];function bs(e){return Es.includes(e)}const ks=[{path:"/",name:"Home",component:()=>w(()=>import("./Home-IBvLRbaF.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))},{path:"/dashboard",name:"Dashboard",component:()=>w(()=>import("./Dashboard-CcYyKPeO.js"),__vite__mapDeps([12,13,2,3,4,8,14,15,9,16,17,18,10,19]))},{path:"/child/:childId",name:"ChildOverview",component:()=>w(()=>import("./ChildOverview-CSx3mnHM.js"),__vite__mapDeps([20,2,8,9,10,21])),meta:{requiresAuth:!0}},{path:"/account",name:"Account",component:()=>w(()=>import("./Account-DjkJinIJ.js"),__vite__mapDeps([22,2,13,3,4,8,14,23,9,24,10,25])),meta:{requiresAuth:!0}},{path:"/pricing",name:"Pricing",component:()=>w(()=>import("./Pricing-DybkC3-x.js"),__vite__mapDeps([26,13,2,3,4,8,14,9,10,27])),meta:{requiresAuth:!0}},{path:"/exercises",name:"Exercises",component:()=>w(()=>import("./Exercises-CA2haRve.js"),__vite__mapDeps([28,13,2,3,4,8,14,6,7,29,30,9,10,31])),meta:{requiresAuth:!0},beforeEnter:ke},{path:"/online-courses",name:"OnlineCourses",component:()=>w(()=>import("./OnlineCourses-DLDp89Pz.js"),__vite__mapDeps([32,13,2,3,4,8,14,6,7,30,9,10,33])),meta:{requiresAuth:!0},beforeEnter:ke},{path:"/quiz",name:"Quiz",component:()=>w(()=>import("./Quiz-DMGKt0qY.js"),__vite__mapDeps([34,13,2,3,4,8,14,6,7,30,9,10,35])),meta:{requiresAuth:!0},beforeEnter:ke},{path:"/quiz/:matiereId",name:"QuizNotions",component:()=>w(()=>import("./QuizNotions-DX8iy3tf.js"),__vite__mapDeps([36,2,13,3,4,8,14,37,29,38,39,40,41,42,9,10,43])),meta:{requiresAuth:!0},beforeEnter:Re},{path:"/quiz-chapitres/:notionId",name:"QuizChapitres",component:()=>w(()=>import("./QuizChapitres-C78YAuof.js"),__vite__mapDeps([44,2,13,3,4,8,14,45,41,42,46,15,9,10])),meta:{requiresAuth:!0},beforeEnter:Re},{path:"/quiz-exercices/:chapitreId",name:"ChapterQuiz",component:()=>w(()=>import("./ChapterQuiz-Cn5nOZD6.js"),__vite__mapDeps([47,2,13,3,4,8,14,17,15,9,18,10,41,42,48])),meta:{requiresAuth:!0},beforeEnter:Re},{path:"/course-notions/:matiereId",name:"CourseNotions",component:()=>w(()=>import("./CourseNotions-CG4uTmKU.js"),__vite__mapDeps([49,2,13,3,4,8,14,41,42,37,29,38,39,40,9,10,50])),meta:{requiresAuth:!0}},{path:"/course-chapitres/:notionId",name:"CourseChapitres",component:()=>w(()=>import("./CourseChapitres-DcAq0jDO.js"),__vite__mapDeps([51,2,13,3,4,8,14,45,41,42,46,15,9,10])),meta:{requiresAuth:!0}},{path:"/course/:chapitreId",name:"CourseChapitre",component:()=>w(()=>import("./CourseChapitre-DjUhaZ8i.js"),__vite__mapDeps([52,2,13,3,4,8,14,41,42,53,9,54,15,55,56,10,57])),meta:{requiresAuth:!0}},{path:"/cours/:matiereId/:notionId/:chapitreId",name:"Cours",component:()=>w(()=>import("./Cours-zhtU8-Fs.js"),__vite__mapDeps([58,2,13,3,4,8,14,41,42,55,56,9,10,59])),meta:{requiresAuth:!0}},{path:"/cours/:matiereId/:notionId/:chapitreId/:coursId",name:"CoursDetail",component:()=>w(()=>import("./CoursDetail-BcWA9CGE.js"),__vite__mapDeps([60,2,13,3,4,8,14,41,42,55,56,9,10,61])),meta:{requiresAuth:!0}},{path:"/sheets",name:"Sheets",component:()=>w(()=>import("./Sheets-DcKUS00h.js"),__vite__mapDeps([62,2,13,3,4,8,14,63,30,9,10,64])),meta:{requiresAuth:!0},beforeEnter:ke},{path:"/about",name:"About",component:()=>w(()=>import("./About-D5fE_jdt.js"),__vite__mapDeps([65,1,2,3,4,5,8,9,10,66]))},{path:"/password-reset",name:"PasswordReset",component:()=>w(()=>import("./PasswordReset-7w7CQseY.js"),__vite__mapDeps([67,2,8,9,10,68]))},{path:"/cgv",name:"CGV",component:()=>w(()=>import("./CGV-KgwIpEZZ.js"),__vite__mapDeps([69,1,2,3,4,5,8,9,10,70]))},{path:"/cgu",name:"CGU",component:()=>w(()=>import("./CGU-Cku2vGO7.js"),__vite__mapDeps([71,1,2,3,4,5,8,9,10,72]))},{path:"/confidentialite",name:"Confidentialite",component:()=>w(()=>import("./Confidentialite-DNNXTQLc.js"),__vite__mapDeps([73,1,2,3,4,5,8,9,10,74]))},{path:"/conditions",name:"Conditions",component:()=>w(()=>import("./Conditions-B03_1pbI.js"),__vite__mapDeps([75,1,2,3,4,5,8,9,10,76]))},{path:"/notions/:matiereId",name:"Notions",component:()=>w(()=>import("./Notions-Cl3flJTM.js"),__vite__mapDeps([77,2,13,3,4,8,14,78,29,79,41,42,9,10,80,39])),meta:{requiresAuth:!0},beforeEnter:Se},{path:"/themes/:matiereId",name:"Themes",component:()=>w(()=>import("./Themes-D85bukUo.js"),__vite__mapDeps([81,2,13,3,4,8,14,37,29,38,39,40,41,42,9,10,82])),meta:{requiresAuth:!0},beforeEnter:Se},{path:"/theme-notions/:themeId",name:"ThemeNotions",component:()=>w(()=>import("./ThemeNotions-DXihD8bD.js"),__vite__mapDeps([83,2,13,3,4,8,14,15,9,38,39,41,42,10,84])),meta:{requiresAuth:!0},beforeEnter:Se},{path:"/chapitres/:notionId",name:"Chapitres",component:()=>w(()=>import("./Chapitres-DgUWZgaH.js"),__vite__mapDeps([85,2,13,3,4,8,14,15,9,45,41,42,46,10,86])),meta:{requiresAuth:!0},beforeEnter:Se},{path:"/exercices/:chapitreId",name:"Exercices",component:()=>w(()=>import("./ChapterExercises-CQ-a2hhw.js"),__vite__mapDeps([87,9,2,13,3,4,8,14,15,16,88,89,41,42,53,54,10,90,91])),meta:{requiresAuth:!0},beforeEnter:Se},{path:"/exercice/:exerciceId",name:"ExerciceDetail",component:()=>w(()=>import("./ExerciceDetail-B96P97d9.js"),__vite__mapDeps([92,9,2,15,16,13,3,4,8,14,88,89,41,42,53,54,10,93])),meta:{requiresAuth:!0}},{path:"/progress",name:"Progress",component:()=>w(()=>import("./Progress-BXdRRTPx.js"),__vite__mapDeps([94,13,2,3,4,8,14,15,9,16,10,95,91])),meta:{requiresAuth:!0}},{path:"/calculator",name:"Calculator",component:()=>w(()=>import("./Calculator-DjWBUfOL.js"),__vite__mapDeps([96,2,13,3,4,8,14,97,79,98,9,10,99]))},{path:"/test-filtrage-strict",name:"TestFiltrageStrict",component:()=>w(()=>import("./TestFiltrageStrict-Bu0zZkHu.js"),__vite__mapDeps([100,4,2,8,9,10,101]))},{path:"/admin",component:()=>w(()=>import("./AdminLayout-DTVKoa79.js"),__vite__mapDeps([102,2,13,3,4,8,14,9,10,103])),meta:{requiresAdmin:!0},children:[{path:"matieres",name:"AdminMatieres",component:()=>w(()=>import("./AdminMatieres-BulrE3G4.js"),__vite__mapDeps([104,2,4,105,106,107,8,9,10,108]))},{path:"themes",name:"AdminThemes",component:()=>w(()=>import("./AdminThemes-BaH3Yjc2.js"),__vite__mapDeps([109,2,29,105,110,106,107,8,9,10,111]))},{path:"notions",name:"AdminNotions",component:()=>w(()=>import("./AdminNotions-7vrgC6jo.js"),__vite__mapDeps([112,2,78,29,105,113,110,106,107,8,9,10,114]))},{path:"chapitres",name:"AdminChapitres",component:()=>w(()=>import("./AdminChapitres-aw8lr7eG.js"),__vite__mapDeps([115,2,15,9,106,107,8,10,116]))},{path:"exercices",name:"AdminExercices",component:()=>w(()=>import("./AdminExercices-DTnMcpVc.js"),__vite__mapDeps([117,2,15,9,113,110,106,107,88,16,89,8,10,118]))},{path:"exercices-plus",name:"AdminExercicesPlus",component:()=>w(()=>import("./AdminExercicesPlus-Bcesb0sT.js"),__vite__mapDeps([119,2,15,9,16,88,89,8,10,120]))},{path:"cours",name:"AdminCours",component:()=>w(()=>import("./AdminCours-BrlL0vs7.js"),__vite__mapDeps([121,2,55,15,9,106,107,56,8,10,122]))},{path:"cours-plus",name:"AdminCoursPlus",component:()=>w(()=>import("./AdminCoursPlus-B8rJ3cvD.js"),__vite__mapDeps([123,2,15,9,55,56,8,10,124]))},{path:"sheets",name:"AdminSheets",component:()=>w(()=>import("./AdminSheets-DzVJIScs.js"),__vite__mapDeps([125,2,63,15,9,4,8,10,126]))},{path:"quiz",name:"AdminQuiz",component:()=>w(()=>import("./AdminQuiz-FYiw0Q4w.js"),__vite__mapDeps([127,2,17,15,9,106,107,8,10,128]))},{path:"quiz-plus",name:"AdminQuizPlus",component:()=>w(()=>import("./AdminQuizPlus-BUF304FX.js"),__vite__mapDeps([129,2,15,9,17,8,10,130]))},{path:"niveaux",name:"AdminNiveaux",component:()=>w(()=>import("./AdminNiveaux-gco-LQyU.js"),__vite__mapDeps([131,2,106,107,23,8,9,10,132]))},{path:"pays",name:"AdminPays",component:()=>w(()=>import("./AdminPays-CFr4h_7Z.js"),__vite__mapDeps([133,2,8,9,10,134]))},{path:"",redirect:{name:"AdminMatieres"}}]},{path:"/:pathMatch(.*)*",name:"NotFound",component:()=>w(()=>import("./NotFound-B3dI-a4V.js"),__vite__mapDeps([135,2,8,9,10,136]))}],Xe=vt({history:_t(),routes:ks,scrollBehavior(){return{top:0}}});Xe.beforeEach(async(e,t,s)=>{const r=localStorage.getItem("access_token");localStorage.getItem("refresh_token");const a=se();let i=a.isAuthenticated,o=a.isAdmin;const c=u=>{if(!u)return!0;try{let m=u.split(".")[1].replace(/-/g,"+").replace(/_/g,"/");const g=m.length%4;g&&(m+="=".repeat(4-g));const d=JSON.parse(atob(m)),l=Math.floor(Date.now()/1e3);return d.exp<l}catch{return!1}};if(r&&c(r)&&(localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),a.clearUser(),i=!1,o=!1),r&&!c(r)&&!i)try{await a.fetchUser(),i=a.isAuthenticated,o=a.isAdmin}catch{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),a.clearUser(),i=!1,o=!1}(e.meta.requiresAuth||e.name==="Dashboard")&&!i?s({name:"Home"}):e.meta.requiresAdmin&&(!i||!o)?s({name:"Home"}):i&&(e.name==="Home"||e.path==="/")?s({name:"Dashboard"}):i&&bs(e.name)?Is(e,t,s):s()});function ws(){let e="http://localhost:8000".trim();return e?(/^https:\/\/(127\.0\.0\.1|localhost)(:\d+)?/i.test(e)&&(e=e.replace(/^https:/i,"http:")),e.replace(/\/+$/,"")):"https://optitab-backend.onrender.com"}const dt=ws(),As=(dt||"").includes("onrender.com"),Je="".toLowerCase(),Ts=!1,Ms=["debug","info","warn","error"].includes(Je)?Je:"error",oe={BASE_URL:dt,REFRESH_ENDPOINT:"/api/users/token/refresh/",REQUEST_TIMEOUT:As?3e4:8e3,REFRESH_TIMEOUT:4e3,MAX_RETRIES:1,RETRY_DELAY:500,LOGGING:{ENABLED:Ts,LEVEL:Ms,SENSITIVE_FIELDS:["password","token","refresh","access"]},DEFAULT_HEADERS:{"Content-Type":"application/json",Accept:"application/json"}};class P{static isDevelopment(){return!1}static isProduction(){return!0}static log(t,s,r={}){if(!this.isDevelopment())return;const a=this.sanitizeData(r),o={timestamp:new Date().toISOString(),level:t,message:s,data:a,source:"api-client"};switch(t){case"error":break;case"warn":break;case"info":break;default:}}static sanitizeData(t){if(!t||typeof t!="object")return t;const s={...t},r=oe.LOGGING.SENSITIVE_FIELDS,a=i=>{for(const o in i)if(i.hasOwnProperty(o)){const c=o.toLowerCase();r.some(u=>c.includes(u))?i[o]="[MASKED]":typeof i[o]=="object"&&i[o]!==null&&a(i[o])}};return a(s),s}static error(t,s=null){if(this.isProduction())return;const r={message:s?.message,status:s?.response?.status,statusText:s?.response?.statusText,url:s?.config?.url,method:s?.config?.method};this.isDevelopment()&&(r.stack=s?.stack),this.log("error",t,r)}static warn(t,s={}){this.log("warn",t,s)}static info(t,s={}){this.log("info",t,s)}static debug(t,s={}){this.isDevelopment()&&this.log("debug",t,s)}static isLoggingEnabled(){return oe.LOGGING.ENABLED}static secureLog(t,s,r={}){if(!this.isLoggingEnabled())return;const a=["debug","info","warn","error"],i=a.indexOf(t),o=a.indexOf(oe.LOGGING.LEVEL);i>=o&&this.log(t,s,r)}}class Cs{constructor(){this.isRefreshing=!1,this.refreshSubscribers=[],this.refreshPromise=null}decodeJwt(t){try{if(!t)return null;const s=t.split(".");if(s.length<2)return null;let r=s[1].replace(/-/g,"+").replace(/_/g,"/");const a=r.length%4;a&&(r+="=".repeat(4-a));const i=atob(r);return JSON.parse(i)}catch(s){return P.warn("Impossible de décoder le token JWT",{error:s.message}),null}}getAccessToken(){return localStorage.getItem("access_token")}getRefreshToken(){return localStorage.getItem("refresh_token")}setTokens(t,s=null){t&&localStorage.setItem("access_token",t),s&&localStorage.setItem("refresh_token",s)}clearTokens(){localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}isTokenExpired(t){if(!t)return!0;const s=this.decodeJwt(t);if(!s||typeof s.exp!="number")return!1;const r=Math.floor(Date.now()/1e3);return s.exp<r}async refreshAccessToken(){if(this.isRefreshing)return this.refreshPromise;this.isRefreshing=!0,this.refreshPromise=this._performRefresh();try{return await this.refreshPromise}finally{this.isRefreshing=!1,this.refreshPromise=null}}async _performRefresh(t=3){const s=this.getRefreshToken();if(!s)throw new Error("Aucun token de rafraîchissement disponible");let r;for(let a=0;a<=t;a++)try{P.secureLog("info",`Tentative de rafraîchissement du token (essai ${a+1}/${t+1})`);const i=await ot.post(`${oe.BASE_URL}${oe.REFRESH_ENDPOINT}`,{refresh:s},{timeout:oe.REFRESH_TIMEOUT,headers:{"Content-Type":"application/json"}}),{access:o,refresh:c}=i.data;return this.setTokens(o,c),P.secureLog("info","Token rafraîchi avec succès"),o}catch(i){if(r=i,P.error(`Échec du rafraîchissement du token (essai ${a+1})`,i),i.response?.status>=400&&i.response?.status<500&&i.code!=="ECONNABORTED")break;if(a<t){const o=Math.min(1e3*Math.pow(2,a),1e4);P.secureLog("info",`Nouvelle tentative dans ${o}ms`),await this._sleep(o)}}throw this.clearTokens(),r}_sleep(t){return new Promise(s=>setTimeout(s,t))}onRefreshed(t){this.refreshSubscribers.forEach(s=>s(t)),this.refreshSubscribers=[]}addRefreshSubscriber(t){this.refreshSubscribers.push(t)}shouldRefreshToken(t,s=5){if(!t)return!1;const r=this.decodeJwt(t);if(!r||typeof r.exp!="number")return!1;const a=Math.floor(Date.now()/1e3),i=s*60;return r.exp-a<=i}async proactiveRefresh(){const t=this.getAccessToken(),s=this.getRefreshToken();if(!t||!s)return!1;if(this.shouldRefreshToken(t,5)){P.secureLog("info","Rafraîchissement proactif du token");try{return await this.refreshAccessToken(),!0}catch(r){return P.error("Échec du rafraîchissement proactif",r),!1}}return!1}}class mt{static async retryRequest(t,s=oe.MAX_RETRIES){let r;for(let a=0;a<=s;a++)try{return await t()}catch(i){if(r=i,this.shouldNotRetry(i))throw i;if(a<s){const o=this.calculateDelay(a);P.secureLog("warn",`Tentative ${a+1} échouée, nouvelle tentative dans ${o}ms`,{error:i.message,status:i.response?.status}),await this.sleep(o)}}throw r}static shouldNotRetry(t){const s=t.response?.status;return s>=400&&s<500&&s!==429?!0:(t.code==="ECONNABORTED",!1)}static calculateDelay(t){return Math.min(oe.RETRY_DELAY*Math.pow(2,t),1e4)}static sleep(t){return new Promise(s=>setTimeout(s,t))}}class Ve{static logout(t="Session expirée"){P.secureLog("info","Déconnexion utilisateur",{reason:t}),V.clearTokens();try{se().clearUser()}catch(s){P.secureLog("warn","Erreur lors du nettoyage du store utilisateur",{error:s.message})}Xe.push("/")}}const V=new Cs;let _e=null;const A=ot.create({baseURL:oe.BASE_URL,timeout:oe.REQUEST_TIMEOUT,headers:oe.DEFAULT_HEADERS,withCredentials:!0});A.interceptors.request.use(e=>{const t=V.getAccessToken();return t&&!V.isTokenExpired(t)&&(e.headers.Authorization=`Bearer ${t}`,P.secureLog("info","Token ajouté à la requête",{url:e.url,method:e.method})),e},e=>(P.error("Erreur dans l'intercepteur de requête",e),Promise.reject(e)));A.interceptors.response.use(e=>(P.secureLog("info","Requête réussie",{url:e.config.url,method:e.config.method,status:e.status}),e),async e=>{const{config:t,response:s}=e;if(t?.url?.includes("/api/users/notifications/")&&s?.status===404?P.debug("Notification introuvable (404)",{url:t.url,method:t.method,status:s.status}):P.error("Erreur de requête",e),(s?.status===401||s?.status===403)&&!t.__isRetryRequest){const a=!!V.getAccessToken(),i=!!V.getRefreshToken(),o=s?.data?.code==="token_not_valid"||s?.data?.detail?.includes("token")||s?.data?.messages?.some(u=>u?.token?.includes("expired")),c=s?.data?.detail?.includes("refresh")||s?.data?.messages?.some(u=>u?.token?.includes("refresh"));if(a&&i&&(o||s?.status===401))return P.secureLog("info","Erreur de token détectée, tentative de rafraîchissement",{status:s.status,url:t.url,isTokenExpiredError:o,isRefreshTokenError:c}),Ye(t,e);if(s?.status===403){if(P.secureLog("warn","Erreur 403 - Accès refusé",{url:t.url,hasAccessToken:a,hasRefreshToken:i}),a&&i&&!t.__isRetryRequest)return Ye(t,e)}else P.secureLog("warn",`Erreur ${s?.status} sans tokens valides ou erreur d'authentification`,{url:t.url,status:s?.status,hasAccessToken:a,hasRefreshToken:i})}return!s&&(e.code==="ECONNABORTED"||e.code==="NETWORK_ERROR")?Fs(t):Promise.reject(e)});async function Ye(e,t){try{if(!V.getRefreshToken())return P.secureLog("warn","Aucun token de rafraîchissement disponible"),Ve.logout("Aucun token de rafraîchissement disponible"),Promise.reject(t);P.secureLog("info","Tentative de rafraîchissement du token",{url:e.url});const r=await V.refreshAccessToken();if(!r)throw new Error("Aucun nouveau token reçu");return V.onRefreshed(r),e.headers.Authorization=`Bearer ${r}`,e.__isRetryRequest=!0,P.secureLog("info","Requête retry avec le nouveau token",{url:e.url}),A(e)}catch(s){P.error("Échec du rafraîchissement du token",s);const r=s.response?.status;let a="Échec du rafraîchissement du token";return r===401?a="Token de rafraîchissement invalide ou expiré":r===400?a="Requête de rafraîchissement malformée":s.response||(a="Erreur réseau lors du rafraîchissement"),Ve.logout(a),Promise.reject(t)}}async function Fs(e,t){return mt.retryRequest(()=>(P.secureLog("info","Retry de la requête réseau",{url:e.url}),A(e)))}const ye={async request(e){return mt.retryRequest(()=>A(e))},async cachedGet(e,{params:t={},ttl:s=3e5,signal:r}={}){const a=l=>l?Object.keys(l).sort().map(k=>`${encodeURIComponent(k)}=${encodeURIComponent(l[k]??"")}`).join("&"):"";let i="n",o="p";try{const l=se();i=l?.niveau_pays?.id??"n",o=l?.pays?.id??"p"}catch{}const c=typeof localStorage<"u"&&localStorage.getItem("access_token")||"",u=c?c.slice(0,12):"anon",p=`GET|${e}|${a(t)}|${i}|${o}|${u}`;window.__API_RESPONSE_CACHE__||(window.__API_RESPONSE_CACHE__=new Map),window.__API_INFLIGHT__||(window.__API_INFLIGHT__=new Map);const m=Date.now(),g=window.__API_RESPONSE_CACHE__.get(p);if(g&&m-g.t<s)return g.r;if(window.__API_INFLIGHT__.has(p))return window.__API_INFLIGHT__.get(p);const d=A.get(e,{params:t,signal:r}).then(l=>(window.__API_RESPONSE_CACHE__.set(p,{t:Date.now(),r:l}),window.__API_INFLIGHT__.delete(p),l)).catch(l=>{throw window.__API_INFLIGHT__.delete(p),l});return window.__API_INFLIGHT__.set(p,d),d},isAuthenticated(){const e=V.getAccessToken();return e&&!V.isTokenExpired(e)},async refreshToken(){return V.refreshAccessToken()},logout(e){Ve.logout(e)},getStats(){return{isRefreshing:V.isRefreshing,hasValidToken:this.isAuthenticated(),refreshSubscribersCount:V.refreshSubscribers.length}},cleanExpiredTokens(){const e=V.getAccessToken(),t=V.getRefreshToken();let s=!1;return e&&V.isTokenExpired(e)&&(P.secureLog("info","Nettoyage du token d'accès expiré"),localStorage.removeItem("access_token"),s=!0),t&&V.isTokenExpired(t)&&(P.secureLog("info","Nettoyage du token de rafraîchissement expiré"),localStorage.removeItem("refresh_token"),s=!0),s&&P.secureLog("info","Tokens expirés nettoyés automatiquement"),s},hasValidTokens(){const e=V.getAccessToken(),t=V.getRefreshToken(),s=e&&!V.isTokenExpired(e),r=t&&!V.isTokenExpired(t);return{hasAccess:s,hasRefresh:r,hasAnyValid:s||r}},startTokenMonitoring(){_e&&clearInterval(_e),_e=setInterval(async()=>{try{this.cleanExpiredTokens(),await V.proactiveRefresh()}catch(e){P.error("Erreur lors de la surveillance des tokens",e)}},3e4),P.secureLog("info","Surveillance automatique des tokens démarrée")},stopTokenMonitoring(){_e&&(clearInterval(_e),_e=null,P.secureLog("info","Surveillance automatique des tokens arrêtée"))},async proactiveTokenRefresh(){return V.proactiveRefresh()}},ga=Object.freeze(Object.defineProperty({__proto__:null,apiUtils:ye,default:A},Symbol.toStringTag,{value:"Module"}));class Ze{constructor(t){this.endpoint=t}async getAll(t={}){try{return(await ye.cachedGet(this.endpoint,{params:t,ttl:12e4})).data}catch(s){throw this.handleError("récupération",s),s}}async getById(t){try{return(await A.get(`${this.endpoint}${t}/`)).data}catch(s){throw this.handleError(`récupération de l'élément ${t}`,s),s}}async create(t){try{return(await A.post(this.endpoint,t)).data}catch(s){throw this.handleError("création",s),s}}async update(t,s){try{return(await A.patch(`${this.endpoint}${t}/`,s)).data}catch(r){throw this.handleError(`mise à jour de l'élément ${t}`,r),r}}async delete(t){try{await A.delete(`${this.endpoint}${t}/`)}catch(s){throw this.handleError(`suppression de l'élément ${t}`,s),s}}async getByFilter(t={}){return this.getAll(t)}async getByRelation(t,s,r={}){return this.getAll({...r,[t]:s})}async getHierarchical(t,s){try{return(await A.get(`${this.endpoint}${t}/${s}/`)).data}catch(r){throw this.handleError(`récupération hiérarchique ${s}`,r),r}}handleError(t,s){}async getHierarchy(t,s){try{const[r,a]=await Promise.all([this.getById(t),this.getHierarchical(t,s)]);return{parent:r,children:a}}catch(r){throw this.handleError(`récupération de la hiérarchie ${t}`,r),r}}}const ft={createEndpoint(e){return new Ze(e)},createCRUDFunctions(e){const t=new Ze(e);return{getAll:s=>t.getAll(s),getById:s=>t.getById(s),create:s=>t.create(s),update:(s,r)=>t.update(s,r),delete:s=>t.delete(s),getByFilter:s=>t.getByFilter(s),getByRelation:(s,r,a)=>t.getByRelation(s,r,a),getHierarchical:(s,r)=>t.getHierarchical(s,r),getHierarchy:(s,r)=>t.getHierarchy(s,r)}}},ee=()=>(ee._instance||(ee._instance=ft.createCRUDFunctions("/api/pays/")),ee._instance),ha=e=>ee().getAll(e),va=e=>ee().getById(e),_a=e=>ee().create(e),ya=(e,t)=>ee().update(e,t),Sa=e=>ee().delete(e),Ls=(e={})=>ee().getByFilter({...e,est_actif:!0}),Ia=(e,t={})=>ee().getByFilter({...t,search:e}),te=()=>(te._instance||(te._instance=ft.createCRUDFunctions("/api/niveaux/")),te._instance),Ea=e=>te().getAll(e),ba=e=>te().getById(e),ka=e=>te().create(e),wa=(e,t)=>te().update(e,t),Aa=e=>te().delete(e),Ta=(e,t={})=>te().getByRelation("pays_id",e,t),Ma=(e,t={})=>te().getByRelation("pays_id",e,{...t,est_actif:!0}),Rs=e=>ee().getHierarchical(e,"niveaux"),Ca=e=>te().getHierarchical(e,"matieres"),Fa=e=>ee().getHierarchy(e,"niveaux"),La=e=>te().getHierarchy(e,"matieres"),xs=()=>A.get("/api/users/preferences/"),Ps=e=>A.post("/api/users/preferences/bulk-update/",e),Ra=()=>A.get("/api/users/favorites/"),Ns=e=>A.post(`/api/users/favorites/add/${e}/`),Ds=e=>A.delete(`/api/users/favorites/remove/${e}/`),xa=()=>A.get("/api/users/selected/"),Os=e=>A.post(`/api/users/selected/add/${e}/`),Vs=e=>A.delete(`/api/users/selected/remove/${e}/`),qs=e=>A.post(`/api/users/selected/set-active/${e}/`),Us=async()=>{try{const e=JSON.parse(localStorage.getItem("selected-matieres-ids")||"[]"),t=JSON.parse(localStorage.getItem("favorite-matieres-ids")||"[]"),s=localStorage.getItem("active-matiere-id"),r={};return t.length>0&&(r.favorite_matiere_ids=t),e.length>0&&(r.selected_matieres=e.map((a,i)=>({matiere_id:parseInt(a),order:i,is_active:parseInt(a)===parseInt(s)}))),s&&(r.active_matiere_id=parseInt(s)),Object.keys(r).length>0&&await Ps(r),!0}catch{return!1}},Bs=async()=>{try{const{data:e}=await xs(),t=e.favorite_matieres?.map(a=>a.matiere.id)||[],s=e.selected_matieres||[],r=e.active_matiere_id;return localStorage.setItem("favorite-matieres-ids",JSON.stringify(t)),localStorage.setItem("selected-matieres-ids",JSON.stringify(s.map(a=>a.matiere.id))),r?localStorage.setItem("active-matiere-id",r.toString()):localStorage.removeItem("active-matiere-id"),{favoriteIds:t,selectedIds:s.map(a=>a.matiere.id),activeId:r,selectedMatieres:s}}catch{return null}},zs=()=>A.get("/api/users/me/"),Pa=e=>A.patch("/api/users/me/update/",e),Na=e=>A.patch("/api/users/me/niveau/",{niveau_pays_id:e}),Da=e=>A.patch("/api/users/me/pays/",{pays_id:e}),js=(e,t)=>{let s,r;return typeof e=="object"&&e!==null?(s=e.pays_id??e.pays,r=e.niveau_id??e.niveau_pays_id??e.niveau):(s=e,r=t),A.patch("/api/users/me/pays-niveau/",{pays_id:s,niveau_pays_id:r})},Gs=()=>A.get("/api/users/me/gamification/"),Oa=(e={})=>{const t=e.scope||"global",s=e.limit||20;return A.get("/api/users/leaderboard/",{params:{scope:t,limit:s}})},Va=()=>A.get("/api/users/me/overview/"),qa=()=>A.get("/api/users/me/streaks/"),Ua=()=>A.get("/api/users/me/recommendations/"),Ba=()=>A.get("/api/users/me/children/"),za=e=>A.post("/api/users/me/children/add/",e),ja=e=>A.delete(`/api/users/me/children/${e}/remove/`),$s=e=>A.post("/api/users/me/update-xp/",e),He=(e={})=>A.get("/api/users/notifications/",{params:e}),pt=async e=>{try{return await A.patch(`/api/users/notifications/${e}/`,{read:!0})}catch(t){return{success:!1,error:t.response?.status||"unknown"}}},Xs=async()=>{const t=(await He({unread:1}))?.data||[];return{count:(await Promise.allSettled(t.map(a=>pt(a.id)))).filter(a=>a.status==="fulfilled"&&a.value.success!==!1).length}},Hs=async e=>{try{return await A.delete(`/api/users/notifications/${e}/`)}catch(t){return{success:!1,error:t.response?.status||"unknown"}}},Ga=async()=>{const t=(await He())?.data||[];return{count:(await Promise.allSettled(t.map(a=>Hs(a.id)))).filter(a=>a.status==="fulfilled"&&a.value.success!==!1).length}},$a=()=>A.post("/api/users/email/send-code/"),Xa=e=>A.post("/api/users/email/verify-code/",{code:e}),Qs=e=>A.post("/api/users/register/",e,{timeout:2e4}),Ks=e=>({first_name:e.firstName?.trim(),last_name:e.lastName?.trim(),email:e.email?.trim().toLowerCase(),password:e.password,password_confirmation:e.confirmPassword}),Ws=e=>A.post("/api/users/login/",{email:(e?.email||"").trim().toLowerCase(),password:e?.password},{timeout:2e4}),Js=e=>({email:e.email?.trim().toLowerCase(),password:e.password}),Ha=e=>A.post("/api/users/verify-code/",e,{timeout:15e3}),Qa=e=>A.post("/api/users/logout/",e,{timeout:1e4}),Ys=e=>A.post("/api/users/auth/google/",e,{timeout:2e4}),Zs=e=>{const t=(e?.email||"").trim().toLowerCase();return A.post("/api/users/password/reset/",{email:t},{timeout:15e3})},Ka=({token:e,password:t})=>A.post("/api/users/password/reset/confirm/",{token:e,password:t},{timeout:15e3}),we=M([]);let er=1;function Qe(){const e=(o,c="info",u=5e3)=>{const p=er++,m={id:p,message:o,type:c,visible:!0};return we.value.push(m),setTimeout(()=>{t(p)},u),p},t=o=>{const c=we.value.findIndex(u=>u.id===o);c>-1&&we.value.splice(c,1)};return{toasts:we,showToast:e,removeToast:t,success:(o,c)=>e(o,"success",c),error:(o,c)=>e(o,"error",c),warning:(o,c)=>e(o,"warning",c),info:(o,c)=>e(o,"info",c)}}function tr(){const e=Be(),t=se(),{closeModal:s}=ze(),{showToast:r}=Qe(),a=M(!1),i="151259305565-a03g822b5qhoaia71gju8hl9cbnu9lp4.apps.googleusercontent.com",o=()=>{typeof google<"u"&&google.accounts.id.initialize({client_id:i,callback:c,context:"signin",ux_mode:"popup",auto_select:!1,cancel_on_tap_outside:!0,use_fedcm_for_prompt:!0})},c=async g=>{try{a.value=!0;const d=await Ys({access_token:g.credential}),{user:l,access:b,refresh:C}=d.data.data;localStorage.setItem("access_token",b),localStorage.setItem("refresh_token",C),t.setUser(l),await t.fetchUser(),s(re.LOGIN),e.push("/dashboard"),r("Connexion réussie !","success")}catch(d){const l=d.response?.data?.message||"Erreur de connexion";r(l,"error")}finally{a.value=!1}},u=()=>{typeof google<"u"?google.accounts.id.prompt():r("Google Sign-In non disponible","error")},p=()=>new Promise((g,d)=>{if(typeof google<"u"){g();return}const l=document.createElement("script");l.src="https://accounts.google.com/gsi/client",l.async=!0,l.defer=!0,l.onload=()=>{g()},l.onerror=()=>{d(new Error("Failed to load Google script"))},document.head.appendChild(l)});return{isGoogleLoading:a,signInWithGoogle:u,setupGoogleSignIn:async()=>{try{await p(),o()}catch{}},loadGoogleScript:p,initializeGoogleSignIn:o}}const sr={name:"LoginModal",components:{Modal:Fe,DynamicForm:Ge},props:{isOpen:{type:Boolean,default:!1}},emits:["close","login","signup","forgot-password"],setup(e,{emit:t}){const s=Be(),r=se(),{closeModal:a}=ze(),{setupGoogleSignIn:i,signInWithGoogle:o,isGoogleLoading:c}=tr(),{config:u,formData:p,isSubmitting:m,isValid:g,getFieldError:d,setFieldTouched:l,submitForm:b,getFieldConfig:C,getFieldNames:k}=je("LOGIN"),y=k(),f=M("");be(async()=>{await i();try{const v=localStorage.getItem("remember_me");if(v){const I=JSON.parse(v),x=Date.now();I?.expiresAt&&x<I.expiresAt&&I?.email&&I?.password?(p.email=I.email,p.password=I.password,p.rememberMe=!0):I?.expiresAt&&x>=I.expiresAt&&localStorage.removeItem("remember_me")}}catch{}});const _=()=>{f.value="",t("close")},T=()=>{f.value=""},R=async()=>{await b(N)},N=async v=>{const I=Js(v);try{const x=await Ws(I),q=x.data.data||x.data,ne=q.access,ce=q.refresh;if(!ne||!ce)throw new Error("Tokens d'authentification manquants");localStorage.setItem("access_token",ne),localStorage.setItem("refresh_token",ce);const W=q||x.data;(W.user_id||W.id)&&r.setUser(W);try{if(v.rememberMe){const ve={email:v.email,password:v.password,expiresAt:Date.now()+2592e6};localStorage.setItem("remember_me",JSON.stringify(ve))}else localStorage.removeItem("remember_me")}catch{}t("login",{email:v.email}),_(),a(re.LOGIN),s.push("/dashboard"),r.fetchUser().catch(ve=>{})}catch(x){const q=x.response?.data?.detail||x.response?.data?.error;f.value=q||"Erreur lors de la connexion"}};return{config:u,fieldNames:y,socialProviders:nt,formData:p,isSubmitting:m,isValid:g,isGoogleLoading:c,getFieldError:d,setFieldTouched:l,getFieldConfig:C,handleClose:_,handleFormSubmit:R,handleSocialLogin:v=>{v==="google"?o():t("login",{provider:v})},handleSignUp:()=>{t("signup")},handleForgotPassword:()=>{t("forgot-password")},loginError:f,handleInput:T}}},rr={class:"signup-link signup-link-top"},or={class:"form-options"},ar={key:0,class:"login-error"},nr={class:"social-login"},ir={class:"social-btn-group"},lr=["onClick","disabled"],cr=["src","alt"];function ur(e,t,s,r,a,i){const o=Y("DynamicForm"),c=Y("Modal");return h(),ae(c,{"is-open":s.isOpen,title:"Connexion",size:"small",onClose:r.handleClose},{default:ue(()=>[n("div",rr,[n("p",null,[t[2]||(t[2]=fe(" Pas encore de compte ? ")),n("button",{type:"button",class:"signup-btn",onClick:t[0]||(t[0]=(...u)=>r.handleSignUp&&r.handleSignUp(...u))}," Créer un compte ")])]),B(o,{"field-names":r.fieldNames,"get-field-config":r.getFieldConfig,"form-data":r.formData,"is-submitting":r.isSubmitting,"is-valid":r.isValid,"get-field-error":r.getFieldError,"set-field-touched":r.setFieldTouched,"submit-text":r.config.submitText,onSubmit:r.handleFormSubmit,onInput:r.handleInput},{"form-content":ue(()=>[n("div",or,[n("button",{type:"button",class:"forgot-password-btn",onClick:t[1]||(t[1]=(...u)=>r.handleForgotPassword&&r.handleForgotPassword(...u))}," Mot de passe oublié ? ")])]),_:1},8,["field-names","get-field-config","form-data","is-submitting","is-valid","get-field-error","set-field-touched","submit-text","onSubmit","onInput"]),r.loginError?(h(),S("div",ar,O(r.loginError),1)):U("",!0),t[3]||(t[3]=n("div",{class:"divider"},[n("span",{class:"divider-line"}),n("span",{class:"divider-text"},"ou"),n("span",{class:"divider-line"})],-1)),n("div",nr,[n("div",ir,[(h(!0),S(pe,null,ge(r.socialProviders,u=>(h(),S("button",{key:u.key,class:K(["social-btn",u.btnClass]),onClick:()=>r.handleSocialLogin(u.key),disabled:r.isSubmitting||u.key==="google"&&r.isGoogleLoading},[n("img",{src:u.icon,alt:u.key,class:"social-icon"},null,8,cr),fe(" "+O(u.label),1)],10,lr))),128))])])]),_:1,__:[3]},8,["is-open","onClose"])}const dr=Q(sr,[["render",ur],["__scopeId","data-v-5a3a77fd"]]),mr={name:"PasswordStrength",props:{password:{type:String,required:!0}},computed:{rules(){const e=this.password||"";return[{key:"length",label:"8+ caractères",passed:e.length>=8},{key:"uppercase",label:"Majuscule",passed:/[A-Z]/.test(e)},{key:"lowercase",label:"Minuscule",passed:/[a-z]/.test(e)},{key:"digit",label:"Chiffre",passed:/\d/.test(e)},{key:"special",label:"Caractère spécial",passed:/[^A-Za-z0-9]/.test(e)}]}}},fr={class:"password-strength"},pr={class:"icon"},gr={key:0,width:"16",height:"16",fill:"none",viewBox:"0 0 16 16"},hr={key:1,width:"16",height:"16",fill:"none",viewBox:"0 0 16 16"},vr={class:"label"};function _r(e,t,s,r,a,i){return h(),S("div",fr,[(h(!0),S(pe,null,ge(i.rules,o=>(h(),S("div",{key:o.key,class:K(["strength-box",{passed:o.passed}])},[n("span",pr,[o.passed?(h(),S("svg",gr,t[0]||(t[0]=[n("path",{d:"M4 8.5l3 3 5-5",stroke:"#10b981","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))):(h(),S("svg",hr,t[1]||(t[1]=[n("circle",{cx:"8",cy:"8",r:"7",stroke:"#d1d5db","stroke-width":"2"},null,-1)])))]),n("span",vr,O(o.label),1)],2))),128))])}const yr=Q(mr,[["render",_r],["__scopeId","data-v-5e920371"]]),Sr={name:"RegisterModal",components:{Modal:Fe,DynamicForm:Ge,FormField:at,PasswordStrength:yr},props:{isOpen:{type:Boolean,default:!1}},emits:["close","register","login","terms","privacy"],setup(e,{emit:t}){const{config:s,formData:r,isSubmitting:a,isValid:i,getFieldError:o,setFieldTouched:c,submitForm:u,getFieldConfig:p,getFieldNames:m}=je("REGISTER"),g=se(),d=["firstName","lastName"],l=m().filter(L=>!["firstName","lastName","acceptTerms","newsletter"].includes(L)),b=M(""),C=M("");function k(L,v="error"){b.value=L,C.value=v,setTimeout(()=>{b.value="",C.value=""},4e3)}const y=()=>{t("close")},f=async()=>{const L=await u(_)},_=async L=>{const v=Ks(L);try{const I=await Qs(v);if(I&&I.data){const x=I.data?.data||I.data,q=x.access,ne=x.refresh;q&&ne&&(localStorage.setItem("access_token",q),localStorage.setItem("refresh_token",ne)),g.setUser(x)}k("Compte créé avec succès!","success"),t("register",{...v}),setTimeout(y,1200)}catch(I){const x=I.response?.data;let q="";x?.errors&&typeof x.errors=="object"?q=Object.entries(x.errors).map(([ce,W])=>{if(Array.isArray(W))return`${ce}: ${W.join(", ")}`;if(typeof W=="object"&&W!==null){const ve=Object.values(W).flat();return`${ce}: ${ve.join(", ")}`}return`${ce}: ${String(W)}`}).join(" | ")||x.message:x?.message?q=x.message:q=I.message,k(q||"Erreur lors de la création du compte","error")}};return{config:s,formData:r,isSubmitting:a,isValid:i,getFieldError:o,setFieldTouched:c,submitForm:u,getFieldConfig:p,getFieldNames:m,nameFields:d,mainFieldNames:l,socialProviders:nt,handleClose:y,handleFormSubmit:f,handleFieldBlur:({fieldName:L,event:v})=>{c(L)},handleSocialRegister:L=>{t("register",{provider:L})},handleLogin:()=>{t("login")},handleTermsClick:()=>{t("terms")},handlePrivacyClick:()=>{t("privacy")},feedbackMessage:b,feedbackType:C,showFeedback:k}}},Ir={class:"login-link login-link-top"},Er={class:"top-fields"},br={class:"name-fields"},kr={key:0,class:"password-strength-row"},wr={class:"terms-section"},Ar={class:"newsletter-section"},Tr={class:"social-register"},Mr={class:"social-btn-group"},Cr=["onClick","disabled"],Fr=["src","alt"];function Lr(e,t,s,r,a,i){const o=Y("FormField"),c=Y("PasswordStrength"),u=Y("DynamicForm"),p=Y("Modal");return h(),ae(p,{"is-open":s.isOpen,title:"Créer un compte",size:"medium",onClose:r.handleClose},{default:ue(()=>[n("div",Ir,[n("p",null,[t[5]||(t[5]=fe(" Déjà un compte ? ")),n("button",{type:"button",class:"login-btn",onClick:t[0]||(t[0]=(...m)=>r.handleLogin&&r.handleLogin(...m))}," Se connecter ")])]),n("div",Er,[n("div",br,[B(o,{"field-name":"firstName","field-config":r.getFieldConfig("firstName"),modelValue:r.formData.firstName,"onUpdate:modelValue":t[1]||(t[1]=m=>r.formData.firstName=m),disabled:r.isSubmitting,"get-field-error":r.getFieldError,onBlur:r.handleFieldBlur},null,8,["field-config","modelValue","disabled","get-field-error","onBlur"]),B(o,{"field-name":"lastName","field-config":r.getFieldConfig("lastName"),modelValue:r.formData.lastName,"onUpdate:modelValue":t[2]||(t[2]=m=>r.formData.lastName=m),disabled:r.isSubmitting,"get-field-error":r.getFieldError,onBlur:r.handleFieldBlur},null,8,["field-config","modelValue","disabled","get-field-error","onBlur"])])]),B(u,{class:"register-dynamic-form","field-names":r.mainFieldNames,"get-field-config":r.getFieldConfig,"form-data":r.formData,"is-submitting":r.isSubmitting,"is-valid":r.isValid,"get-field-error":r.getFieldError,"set-field-touched":r.setFieldTouched,"submit-text":r.config.submitText,onSubmit:r.handleFormSubmit},{"form-content":ue(()=>[r.mainFieldNames.includes("password")?(h(),S("div",kr,[B(c,{password:r.formData.password},null,8,["password"])])):U("",!0),n("div",wr,[B(o,{"field-name":"acceptTerms","field-config":r.getFieldConfig("acceptTerms"),modelValue:r.formData.acceptTerms,"onUpdate:modelValue":t[3]||(t[3]=m=>r.formData.acceptTerms=m),disabled:r.isSubmitting,"get-field-error":r.getFieldError,onBlur:r.handleFieldBlur},null,8,["field-config","modelValue","disabled","get-field-error","onBlur"])]),n("div",Ar,[B(o,{"field-name":"newsletter","field-config":r.getFieldConfig("newsletter"),modelValue:r.formData.newsletter,"onUpdate:modelValue":t[4]||(t[4]=m=>r.formData.newsletter=m),disabled:r.isSubmitting,"get-field-error":r.getFieldError,onBlur:r.handleFieldBlur},null,8,["field-config","modelValue","disabled","get-field-error","onBlur"])])]),_:1},8,["field-names","get-field-config","form-data","is-submitting","is-valid","get-field-error","set-field-touched","submit-text","onSubmit"]),r.feedbackMessage?(h(),S("div",{key:0,class:K(["register-feedback",r.feedbackType])},O(r.feedbackMessage),3)):U("",!0),t[6]||(t[6]=n("div",{class:"divider"},[n("span",{class:"divider-line"}),n("span",{class:"divider-text"},"ou"),n("span",{class:"divider-line"})],-1)),n("div",Tr,[n("div",Mr,[(h(!0),S(pe,null,ge(r.socialProviders,m=>(h(),S("button",{key:m.key,class:K(["social-btn",m.btnClass]),onClick:()=>r.handleSocialRegister(m.key),disabled:r.isSubmitting},[n("img",{src:m.icon,alt:m.key,class:"social-icon"},null,8,Fr),fe(" "+O(m.label),1)],10,Cr))),128))])])]),_:1,__:[6]},8,["is-open","onClose"])}const Rr=Q(Sr,[["render",Lr],["__scopeId","data-v-f7c43139"]]),xr={name:"ForgotPasswordModal",components:{Modal:Fe,DynamicForm:Ge},props:{isOpen:{type:Boolean,default:!1}},emits:["close","forgot-password","login"],setup(e,{emit:t}){const s=M(!1),{config:r,formData:a,isSubmitting:i,isValid:o,getFieldError:c,setFieldTouched:u,submitForm:p,getFieldConfig:m,getFieldNames:g,resetForm:d}=je("FORGOT_PASSWORD"),l=g(),b=()=>{t("close"),d(),s.value=!1},C=async()=>{await p(async f=>{await Zs({email:f.email}),t("forgot-password",{...f}),s.value=!0},f=>{})};return{isSuccess:s,config:r,fieldNames:l,formData:a,isSubmitting:i,isValid:o,getFieldError:c,setFieldTouched:u,getFieldConfig:m,handleClose:b,handleFormSubmit:C,handleBackToLogin:()=>{t("login")},handleResend:async()=>{s.value=!1,await C()}}}},Pr={key:0,class:"success-state"},Nr={class:"success-message"},Dr={class:"success-actions"},Or={key:1},Vr={class:"back-to-login"};function qr(e,t,s,r,a,i){const o=Y("DynamicForm"),c=Y("Modal");return h(),ae(c,{"is-open":s.isOpen,title:"Mot de passe oublié",size:"small",onClose:r.handleClose},{default:ue(()=>[r.isSuccess?(h(),S("div",Pr,[t[4]||(t[4]=n("div",{class:"success-icon"},[n("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[n("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),n("polyline",{points:"22,4 12,14.01 9,11.01"})])],-1)),t[5]||(t[5]=n("h3",{class:"success-title"},"Email envoyé !",-1)),n("p",Nr,[t[3]||(t[3]=fe(" Nous avons envoyé un lien de réinitialisation à ")),n("strong",null,O(r.formData.email),1)]),n("div",Dr,[n("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=(...u)=>r.handleClose&&r.handleClose(...u))}," Fermer "),n("button",{type:"button",class:"btn btn-secondary",onClick:t[1]||(t[1]=(...u)=>r.handleResend&&r.handleResend(...u))}," Renvoyer l'email ")])])):(h(),S("div",Or,[t[6]||(t[6]=n("div",{class:"instructions"},[n("p",{class:"instruction-text"}," Entrez votre adresse email et nous vous enverrons un lien pour réinitialiser votre mot de passe. ")],-1)),B(o,{"field-names":r.fieldNames,"get-field-config":r.getFieldConfig,"form-data":r.formData,"is-submitting":r.isSubmitting,"is-valid":r.isValid,"get-field-error":r.getFieldError,"set-field-touched":r.setFieldTouched,"submit-text":r.config.submitText,onSubmit:r.handleFormSubmit},null,8,["field-names","get-field-config","form-data","is-submitting","is-valid","get-field-error","set-field-touched","submit-text","onSubmit"]),n("div",Vr,[n("p",null,[n("button",{type:"button",class:"back-btn",onClick:t[2]||(t[2]=(...u)=>r.handleBackToLogin&&r.handleBackToLogin(...u))}," ← Retour à la connexion ")])])]))]),_:1},8,["is-open","onClose"])}const Ur=Q(xr,[["render",qr],["__scopeId","data-v-da9e5044"]]),Br={class:"pays-niveau-selector"},zr={class:"modal-header"},jr={class:"progress-bar"},Gr={class:"modal-subtitle"},$r={key:0,class:"step-content"},Xr={key:0,class:"loading-state"},Hr={key:1,class:"error-state"},Qr={key:2,class:"pays-grid"},Kr=["onClick"],Wr={class:"pays-flag"},Jr={class:"pays-info"},Yr={key:0,class:"selected-indicator"},Zr={class:"step-actions"},eo=["disabled"],to={key:0},so={key:1},ro={key:1,class:"step-content"},oo={class:"section-header"},ao={key:0,class:"loading-state"},no={key:1,class:"empty-state"},io={key:2,class:"niveaux-grid"},lo=["onClick"],co={class:"niveau-info"},uo={key:0,class:"selected-indicator"},mo={class:"step-actions"},fo=["disabled"],po={key:0},go={key:1},ho={key:2,class:"step-content"},vo={class:"confirmation-content"},_o={class:"configuration-summary"},yo={class:"summary-item"},So={class:"value"},Io={class:"summary-item"},Eo={class:"value"},bo={__name:"PaysNiveauSelector",props:{isOpen:{type:Boolean,default:!1}},emits:["configuration-complete","close"],setup(e,{emit:t}){const s=e,r=t,a=se(),{showToast:i}=Qe(),o=M(1),c=M([]),u=M([]),p=M(null),m=M(null),g=M(!1),d=M(!1),l=M(!1),b=M(!1),C=F(()=>c.value.find(L=>L.id===p.value)),k=F(()=>u.value.find(L=>L.id===m.value)),y=()=>{switch(o.value){case 1:return"Étape 1 sur 2 - Choisissez votre pays";case 2:return"Étape 2 sur 2 - Choisissez votre niveau";case 3:return"Configuration terminée";default:return""}},f=async()=>{try{g.value=!0,l.value=!1;const L=await Ls();c.value=L.data||L}catch{l.value=!0,i("Erreur lors du chargement des pays","error")}finally{g.value=!1}},_=async L=>{if(!L){u.value=[];return}try{d.value=!0;const v=await Rs(L);u.value=v.data||v}catch{u.value=[],i("Erreur lors du chargement des niveaux","error")}finally{d.value=!1}},T=L=>{p.value=L.id,m.value=null},R=L=>{m.value=L.id},N=()=>{o.value===1&&p.value&&(o.value=2,_(p.value))},X=()=>{o.value===2&&(o.value=1,u.value=[],m.value=null)},le=async()=>{if(!(!p.value||!m.value))try{b.value=!0,await js(p.value,m.value),await a.fetchUser(),o.value=3,i("Configuration enregistrée avec succès !","success"),setTimeout(()=>{r("configuration-complete")},2e3)}catch{i("Erreur lors de l'enregistrement de la configuration","error")}finally{b.value=!1}};return Te(()=>s.isOpen,L=>{L&&c.value.length===0&&f()}),Te(p,L=>{L&&o.value===2&&_(L)}),be(()=>{s.isOpen&&f()}),(L,v)=>(h(),ae(Fe,{"is-open":e.isOpen,"can-close":!1,"show-header":!1},{default:ue(()=>[n("div",Br,[n("div",zr,[n("div",jr,[n("div",{class:K(["progress-step",{active:o.value>=1,completed:o.value>1}])},v[0]||(v[0]=[n("span",{class:"step-number"},"1",-1),n("span",{class:"step-label"},"Pays",-1)]),2),n("div",{class:K(["progress-line",{completed:o.value>1}])},null,2),n("div",{class:K(["progress-step",{active:o.value>=2,completed:o.value>2}])},v[1]||(v[1]=[n("span",{class:"step-number"},"2",-1),n("span",{class:"step-label"},"Niveau",-1)]),2)]),v[2]||(v[2]=n("h2",null,"🎓 Configuration de votre profil d'apprentissage",-1)),n("p",Gr,O(y()),1)]),o.value===1?(h(),S("div",$r,[v[7]||(v[7]=n("div",{class:"section-header"},[n("h3",null,"📍 Sélectionnez votre pays"),n("p",null,"Choisissez votre pays pour personnaliser le contenu selon votre système éducatif")],-1)),g.value?(h(),S("div",Xr,v[3]||(v[3]=[n("div",{class:"spinner"},null,-1),n("p",null,"Chargement des pays disponibles...",-1)]))):l.value?(h(),S("div",Hr,[v[4]||(v[4]=n("p",null,"❌ Erreur lors du chargement des pays",-1)),n("button",{onClick:f,class:"btn-retry"},"Réessayer")])):(h(),S("div",Qr,[(h(!0),S(pe,null,ge(c.value,I=>(h(),S("div",{key:I.id,class:K(["pays-card",{selected:p.value===I.id}]),onClick:x=>T(I)},[n("div",Wr,O(I.drapeau_emoji),1),n("div",Jr,[n("h4",null,O(I.nom),1),n("p",null,O(I.nombre_niveaux||0)+" niveaux disponibles",1)]),p.value===I.id?(h(),S("div",Yr,v[5]||(v[5]=[n("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none"},[n("path",{d:"M9 12L11 14L15 10",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]))):U("",!0)],10,Kr))),128))])),n("div",Zr,[n("button",{onClick:N,disabled:!p.value||d.value,class:"btn-primary"},[d.value?(h(),S("span",to,"Chargement...")):(h(),S("span",so,"Continuer")),v[6]||(v[6]=n("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none"},[n("path",{d:"M9 18L15 12L9 6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1))],8,eo)])])):U("",!0),o.value===2?(h(),S("div",ro,[n("div",oo,[v[8]||(v[8]=n("h3",null,"📚 Sélectionnez votre niveau scolaire",-1)),n("p",null,"Choisissez votre niveau pour "+O(C.value?.nom),1)]),d.value?(h(),S("div",ao,v[9]||(v[9]=[n("div",{class:"spinner"},null,-1),n("p",null,"Chargement des niveaux...",-1)]))):u.value.length===0?(h(),S("div",no,v[10]||(v[10]=[n("p",null,"Aucun niveau disponible pour ce pays",-1)]))):(h(),S("div",io,[(h(!0),S(pe,null,ge(u.value,I=>(h(),S("div",{key:I.id,class:K(["niveau-card",{selected:m.value===I.id}]),onClick:x=>R(I)},[n("div",{class:"niveau-color",style:tt({backgroundColor:I.couleur||"#667eea"})},null,4),n("div",co,[n("h4",null,O(I.nom_local||I.nom),1),v[11]||(v[11]=n("p",null,"Niveau scolaire",-1))]),m.value===I.id?(h(),S("div",uo,v[12]||(v[12]=[n("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none"},[n("path",{d:"M9 12L11 14L15 10",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]))):U("",!0)],10,lo))),128))])),n("div",mo,[n("button",{onClick:X,class:"btn-secondary"},v[13]||(v[13]=[n("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none"},[n("path",{d:"M15 18L9 12L15 6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),fe(" Retour ")])),n("button",{onClick:le,disabled:!m.value||b.value,class:"btn-primary"},[b.value?(h(),S("span",po,"Enregistrement...")):(h(),S("span",go,"Terminer la configuration"))],8,fo)])])):U("",!0),o.value===3?(h(),S("div",ho,[n("div",vo,[v[16]||(v[16]=n("div",{class:"success-icon"},"✅",-1)),v[17]||(v[17]=n("h3",null,"Configuration terminée !",-1)),v[18]||(v[18]=n("p",null,"Votre profil a été configuré avec succès.",-1)),n("div",_o,[n("div",yo,[v[14]||(v[14]=n("span",{class:"label"},"Pays:",-1)),n("span",So,O(C.value?.nom),1)]),n("div",Io,[v[15]||(v[15]=n("span",{class:"label"},"Niveau:",-1)),n("span",Eo,O(k.value?.nom_local||k.value?.nom),1)])]),v[19]||(v[19]=n("p",{class:"redirect-message"},"Vous allez être redirigé vers votre tableau de bord...",-1))])])):U("",!0)])]),_:1},8,["is-open"]))}},ko=Q(bo,[["__scopeId","data-v-d3ef1302"]]),wo={name:"Toast",setup(){const{toasts:e,removeToast:t}=Qe();return{toasts:e,removeToast:t}}},Ao={class:"toast-container"},To=["onClick"],Mo={class:"toast-content"},Co={class:"toast-message"},Fo=["onClick"];function Lo(e,t,s,r,a,i){return h(),S("div",Ao,[B(yt,{name:"toast",tag:"div",class:"toasts"},{default:ue(()=>[(h(!0),S(pe,null,ge(r.toasts,o=>(h(),S("div",{key:o.id,class:K(["toast",o.type]),onClick:c=>r.removeToast(o.id)},[n("div",Mo,[n("span",Co,O(o.message),1),n("button",{class:"toast-close",onClick:qe(c=>r.removeToast(o.id),["stop"])}," × ",8,Fo)])],10,To))),128))]),_:1})])}const Ro=Q(wo,[["render",Lo],["__scopeId","data-v-90fbbd54"]]),xo={key:0,class:"xp-notification-overlay"},Po={class:"xp-notification-card"},No={class:"xp-notification-content"},Do={class:"xp-message"},Oo={class:"xp-reward"},Vo={class:"xp-amount"},qo={__name:"XPRewardNotification",setup(e){const t=M(!1),s=M(""),r=M(0),a=c=>{s.value=`Objectif "${i(c.objectiveType)}" terminé !`,r.value=c.xpAmount,t.value=!0,setTimeout(()=>{t.value=!1},4e3)},i=c=>({quiz_easy:"Quiz simples",quiz_medium:"Quiz moyens",quiz_hard:"Quiz difficiles",quiz_perfect:"Quiz parfaits",quiz_streak:"Série de quiz"})[c]||"Objectif",o=c=>{a(c.detail)};return be(()=>{window.addEventListener("dailyObjectiveCompleted",o)}),st(()=>{window.removeEventListener("dailyObjectiveCompleted",o)}),(c,u)=>(h(),ae(Ue,{to:"body"},[B(rt,{name:"notification"},{default:ue(()=>[t.value?(h(),S("div",xo,[n("div",Po,[n("div",No,[u[1]||(u[1]=n("div",{class:"xp-icon"},"🎉",-1)),n("div",Do,[u[0]||(u[0]=n("h3",null,"Défi complété !",-1)),n("p",null,O(s.value),1)]),n("div",Oo,[n("span",Vo,"+"+O(r.value)+" XP",1)])]),u[2]||(u[2]=n("div",{class:"xp-progress-bar"},[n("div",{class:"xp-progress-fill",style:{width:"100%"}})],-1))])])):U("",!0)]),_:1})]))}},Uo=Q(qo,[["__scopeId","data-v-0e93c61c"]]),Bo={key:0,class:"unlock-notification-overlay"},zo={class:"unlock-notification-card"},jo={class:"unlock-notification-content"},Go={class:"unlock-message"},$o={class:"unlock-objective-icon"},Xo={__name:"ObjectiveUnlockedNotification",setup(e){const t=M(!1),s=M(""),r=M(""),a=o=>{s.value=`"${o.objective.name}" est maintenant disponible !`,r.value=o.objective.icon||"🎯",t.value=!0,setTimeout(()=>{t.value=!1},3e3)},i=o=>{a(o.detail)};return be(()=>{window.addEventListener("objectiveUnlocked",i)}),st(()=>{window.removeEventListener("objectiveUnlocked",i)}),(o,c)=>(h(),ae(Ue,{to:"body"},[B(rt,{name:"unlock-notification"},{default:ue(()=>[t.value?(h(),S("div",Bo,[n("div",zo,[n("div",jo,[c[1]||(c[1]=n("div",{class:"unlock-icon"},"🔓",-1)),n("div",Go,[c[0]||(c[0]=n("h3",null,"Nouvel objectif débloqué !",-1)),n("p",null,O(s.value),1)]),n("div",$o,O(r.value),1)]),c[2]||(c[2]=n("div",{class:"unlock-progress-bar"},[n("div",{class:"unlock-progress-fill",style:{width:"100%"}})],-1))])])):U("",!0)]),_:1})]))}},Ho=Q(Xo,[["__scopeId","data-v-25a66a03"]]),Qo={},Ko={class:"fullpage-spinner"};function Wo(e,t){return h(),S("div",Ko,t[0]||(t[0]=[n("span",{class:"spinner"},null,-1)]))}const Jo=Q(Qo,[["render",Wo],["__scopeId","data-v-b5fd4076"]]),Ke=he("notifications",()=>{const e=M([]),t=M(1),s=F(()=>e.value.filter(f=>!f.read).length),r=F(()=>s.value>0),a={XP_GAINED:"xp_gained",LEVEL_UP:"level_up",EXERCISE_UNLOCKED:"exercise_unlocked",CHAPTER_COMPLETED:"chapter_completed",ACHIEVEMENT:"achievement",DAILY_STREAK:"daily_streak"},i={XP_GAINED:4e3,LEVEL_UP:6e3,EXERCISE_UNLOCKED:5e3,CHAPTER_COMPLETED:5e3,ACHIEVEMENT:7e3,DAILY_STREAK:5e3};function o({type:f,title:_,message:T,data:R={},autoRemove:N=!1}){const X={id:t.value++,type:f,title:_,message:T,data:R,read:!1,timestamp:new Date,autoRemove:N};if(e.value.unshift(X),N){const le=i[f]||5e3;setTimeout(()=>{C(X.id)},le)}return X}function c(f,_,T=1){const R=T===1,N=R?"🎉 XP Gagnés !":"🔄 Tentative Supplémentaire";let X;return R&&f>0?X=`+${f} XP pour "${_}"`:X=`Quiz "${_}" terminé (cooldown 1h30)`,o({type:a.XP_GAINED,title:N,message:X,data:{xpAmount:f,quizTitle:_,attempt:T,isFirstAttempt:R}})}function u(f,_,T){return o({type:a.LEVEL_UP,title:"🏆 Niveau Supérieur !",message:`Félicitations ! Vous êtes maintenant niveau ${f}`,data:{newLevel:f,totalXP:_,xpToNext:T}})}function p(f,_){return o({type:a.EXERCISE_UNLOCKED,title:"🔓 Nouvel Exercice !",message:`"${f}" disponible dans ${_}`,data:{exerciseTitle:f,chapterTitle:_}})}function m(f,_){return o({type:a.CHAPTER_COMPLETED,title:"✅ Chapitre Terminé !",message:`"${f}" complété à ${_}%`,data:{chapterTitle:f,completionRate:_}})}function g(f,_,T="🏅"){return o({type:a.ACHIEVEMENT,title:`${T} Réussite Débloquée !`,message:`${f}: ${_}`,data:{achievementTitle:f,description:_,icon:T}})}function d(f,_){const T=N=>N===1?"Première connexion aujourd'hui !":N<=5?`${N} jours consécutifs ! Bravo !`:`${N} jours de suite ! Incroyable série !`,R=N=>N===1?"🌟":N===2?"⭐":N===3?"🔥":N===4?"💫":N>=5?"🏆":"🌟";return o({type:a.DAILY_STREAK,title:`${R(f)} Série Quotidienne !`,message:`${T(f)} +${_} XP`,data:{streakDays:f,xpGained:_}})}async function l(f){const _=e.value.find(T=>T.id===f);if(_){_.read=!0;try{await pt(f)}catch{}}}async function b(){e.value.forEach(f=>f.read=!0);try{const f=await Xs()}catch{}}function C(f){const _=e.value.findIndex(T=>T.id===f);_>-1&&e.value.splice(_,1)}function k(){e.value=[]}function y(){e.value.length>20&&(e.value=e.value.sort((f,_)=>new Date(_.timestamp)-new Date(f.timestamp)).slice(0,20))}return{notifications:F(()=>e.value),unreadCount:s,hasUnread:r,NOTIFICATION_TYPES:a,loadFromServer:async()=>{try{const f=await He(),_=Array.isArray(f?.data)?f.data:f?.data?.results||[];e.value=_.map(R=>({id:R.id,type:R.type,title:R.title,message:R.message,data:R.data||{},read:!!R.read,timestamp:R.created_at?new Date(R.created_at):new Date}));const T=_.reduce((R,N)=>Math.max(R,Number(N.id||0)),0);t.value=Math.max(t.value,T+1)}catch{}},addNotification:o,markAsRead:l,markAllAsRead:b,removeNotification:C,clearAll:k,cleanupOld:y,notifyXPGained:c,notifyLevelUp:u,notifyExerciseUnlocked:p,notifyChapterCompleted:m,notifyAchievement:g,notifyDailyStreak:d}}),xe=M(!1),Pe=M(0),Ne=M("");function Yo(){const e=se(),t=Ke();function s(c=0,u="XP gagné !"){Pe.value=c,Ne.value=u,xe.value=!0}function r(){xe.value=!1,Pe.value=0,Ne.value=""}async function a(c=!1){try{const u=await Gs(),p=u?.data?.data||u?.data||null;if(p){const m=Number(e.xp||0),g=Number(p.xp??e.xp??0),d=p.level,l=p.xp_to_next??p.next_level_xp??null,b=Oe(g),C=Number(d??b.level),k=Number(l??b.xp_to_next);return c||(e.xp=g,e.level=C,e.xp_to_next=k),{success:!0,gainedXp:g-m,newXp:g,newLevel:C,newXpToNext:k}}}catch(u){return{success:!1,error:u}}}async function i(c,u="streak_daily"){if(c==null)return{success:!1};const p=Number(e.xp||0),m=Number(e.level||0),g=p+Number(c),{level:d,xp_to_next:l}=Oe(g);e.xp=g,e.level=d,e.xp_to_next=l,await St();try{await $s({xp_delta:c,reason:u})}catch{}const b=d>m;return b&&t.notifyLevelUp(d,g,l),{success:!0,oldXp:p,newXp:g,oldLevel:m,newLevel:d,levelUp:b}}async function o(c,u,p=1,m="Quiz"){if(t.notifyXPGained(u,m,p),u>0){let g="Quiz réussi !";p===1&&(g="Premier essai réussi !"),s(u,g);const d=await i(u,"quiz_completion");return await a(!0)}else p>1&&s(0,"Tentative supplémentaire (cooldown 1h30)");return{success:!0,gainedXp:0}}return{showXpNotification:xe,xpGained:Pe,xpMessage:Ne,showXpGain:s,hideXpNotification:r,refreshUserXP:a,updateUserXPInstantly:i,handleQuizCompletion:o}}function Zo(){const e=se(),t=Ke(),{updateUserXPInstantly:s}=Yo(),r=M(0),a=M(null),i=M(!1);function o(k){return k<=0?0:k<=5?k:5}function c(k){if(!k)return!0;const y=new Date,f=new Date(k),_=y.toDateString(),T=f.toDateString();return _!==T}function u(k){if(!k)return!1;const y=new Date,f=new Date(k),_=y-f;return Math.floor(_/(1e3*60*60*24))<=1}async function p(){try{if(i.value)return{success:!0,alreadyChecked:!0};const k=new Date().toISOString().split("T")[0],y=localStorage.getItem("lastLoginDate"),f=parseInt(localStorage.getItem("currentStreak")||"0");if(!c(y))return i.value=!0,r.value=f,{success:!0,alreadyChecked:!0};let _=1;u(y)&&(_=f+1);const T=o(_);return r.value=_,a.value=k,i.value=!0,localStorage.setItem("currentStreak",_.toString()),localStorage.setItem("lastLoginDate",k),localStorage.setItem("streakCheckedToday","true"),T>0&&await s(T,"streak_daily"),t.notifyDailyStreak(_,T),{success:!0,streakDays:_,xpGained:T,isNewStreak:_===1&&!u(y)}}catch(k){return{success:!1,error:k}}}function m(){try{const k=parseInt(localStorage.getItem("currentStreak")||"0"),y=localStorage.getItem("lastLoginDate"),f=localStorage.getItem("streakCheckedToday")==="true";r.value=k,a.value=y,c(y)?(i.value=!1,localStorage.removeItem("streakCheckedToday")):i.value=f}catch{r.value=0,a.value=null,i.value=!1}}function g(){r.value=0,a.value=null,i.value=!1,localStorage.removeItem("currentStreak"),localStorage.removeItem("lastLoginDate"),localStorage.removeItem("streakCheckedToday")}async function d(){return e.isAuthenticated?(m(),await p()):{success:!1,reason:"not_authenticated"}}const l=F(()=>o(r.value+1)),b=F(()=>o(r.value)),C=F(()=>r.value===0?"Connectez-vous quotidiennement pour gagner des XP !":r.value<=5?`${r.value} jour${r.value>1?"s":""} de suite ! Prochain: +${l.value} XP`:`${r.value} jours consécutifs ! +5 XP quotidiens`);return{currentStreak:F(()=>r.value),lastLoginDate:F(()=>a.value),isStreakCheckedToday:F(()=>i.value),nextStreakXP:l,todayStreakXP:b,streakMessage:C,checkDailyStreak:d,updateStreak:p,initializeStreak:m,resetStreak:g,calculateStreakXP:o,isNewDay:c,isStreakValid:u}}const ea={key:1,id:"app"},ta={__name:"App",setup(e){const t=se(),s=Le(),r=Be(),{isModalOpen:a,closeModal:i,openModal:o}=ze(),{checkDailyStreak:c}=Zo(),u=Ke(),p=M(!1),m=F(()=>a(re.LOGIN)),g=F(()=>a(re.REGISTER)),d=F(()=>a(re.FORGOT_PASSWORD)),l=()=>i(re.LOGIN),b=()=>i(re.REGISTER),C=()=>i(re.FORGOT_PASSWORD),k=()=>{p.value=!1},y=async()=>{if(t.isAuthenticated&&t.pays&&t.niveau_pays)try{await s.initialize()}catch{}},f=()=>{if(t.id){const I=`configurationCompleted_${t.id}`;localStorage.setItem(I,"true")}k(),t.fetchUser().then(()=>{y()})},_=I=>{I.provider==="google"||l()},T=()=>{l(),o(re.REGISTER)},R=()=>{l(),o(re.FORGOT_PASSWORD)},N=async I=>{I.provider==="google"||(b(),r.push("/dashboard"))},X=()=>{b(),C(),o(re.LOGIN)},le=()=>{},L=()=>{},v=()=>{if(t.isLoading||!t.isAuthenticated||!t.id)return;const I=t.pays!==null&&t.pays!==void 0,x=t.niveau_pays!==null&&t.niveau_pays!==void 0;if(!I||!x){const q=`configurationCompleted_${t.id}`;localStorage.getItem(q)==="true"&&(!I||!x)&&localStorage.removeItem(q),!localStorage.getItem(q)&&!p.value&&(p.value=!0)}};return Te(()=>t.isAuthenticated,I=>{I&&setTimeout(async()=>{try{await c()}catch{}v();try{await u.loadFromServer()}catch{}},200)},{immediate:!0}),Te([()=>t.pays,()=>t.niveau_pays,()=>t.isLoading],([I,x,q])=>{if(!q&&t.isAuthenticated&&t.id){const ne=I!=null,ce=x!=null;if(ne&&ce){p.value=!1;const W=`configurationCompleted_${t.id}`;localStorage.setItem(W,"true"),y()}else v()}}),be(async()=>{try{await c()}catch{}if(t.isAuthenticated){v(),t.pays&&t.niveau_pays&&y();try{await u.loadFromServer()}catch{}}}),(I,x)=>{const q=Y("router-view");return G(t).isLoading?(h(),ae(Jo,{key:0})):(h(),S("div",ea,[B(q),B(dr,{"is-open":m.value,onClose:l,onLogin:_,onSignup:T,onForgotPassword:R},null,8,["is-open"]),B(Rr,{"is-open":g.value,onClose:b,onRegister:N,onLogin:X,onTerms:le,onPrivacy:L},null,8,["is-open"]),B(Ur,{"is-open":d.value,onClose:C,onForgotPassword:R,onLogin:X},null,8,["is-open"]),B(ko,{"is-open":p.value,onConfigurationComplete:f,onClose:k},null,8,["is-open"]),B(Ro),B(Uo),B(Ho)]))}}},sa={};if(typeof document<"u"){const e=document.createElement("style");e.textContent=`
    /* Cache le bouton menu (≡) et le toggle clavier virtuel */
    math-field::part(menu-toggle),
    math-field::part(virtual-keyboard-toggle) {
      display: none !important;
    }
  `,document.head.appendChild(e)}const ra=It(),We=Et(ta);We.use(ra);We.use(Xe);const oa=se(),aa=ye.cleanExpiredTokens(),na=localStorage.getItem("access_token");if(import.meta&&sa){const e=()=>{};console.log=e,console.debug=e,console.info=e,console.warn=e}na&&(oa.fetchUser(),setTimeout(()=>{ye.startTokenMonitoring()},1e3));We.mount("#app");export{ka as $,$s as A,Ea as B,Mt as C,Ze as D,Sa as E,Kt as F,ya as G,_a as H,qs as I,Vs as J,Os as K,is as L,re as M,xa as N,Ds as O,Ns as P,Ra as Q,Bs as R,Us as S,Ps as T,xs as U,La as V,Ca as W,Uo as X,Aa as Y,wa as Z,Q as _,Zo as a,Ma as a0,Ta as a1,ba as a2,Fa as a3,Rs as a4,Ia as a5,Ls as a6,va as a7,Na as a8,Da as a9,qa as aa,Ua as ab,He as ac,pt as ad,Xs as ae,Qs as af,Ks as ag,Ws as ah,Js as ai,Ha as aj,Ys as ak,Zs as al,ga as am,A as b,Yo as c,Le as d,Gs as e,Oa as f,Va as g,Ba as h,za as i,js as j,Pa as k,Qe as l,ha as m,zs as n,Ka as o,ze as p,Ke as q,ja as r,$a as s,Qa as t,se as u,Xa as v,ye as w,Ga as x,Hs as y,ft as z};
