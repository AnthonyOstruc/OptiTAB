import{D as Le}from"./DashboardLayout-DmmXvv68.js";import{_ as ee,q as de,h as m,m as R,s as Ae,p as se,c as a,o as t,a as e,j as O,b as $,d as K,u as X,t as i,F as Q,e as V,x as Ne,y as qe,n as xe,f as Se,w as re,T as Oe,k as Z,z as he,l as $e,A as J,B as Pe,C as ke,r as be,D as Xe,i as ne,X as Qe,E as Ve,G as He,H as Be,I as Ue,J as Re,v as Ce,K as Fe,L as Je,g as Ge}from"./index-C20tTf3S.js";import{g as je,a as ce,b as Me,c as We}from"./curriculum-C6dJwtfd.js";import{g as Ie}from"./matieres-Ce1WeeoH.js";import{g as Ke}from"./exercices-D5_EwlUY.js";import{c as Ye}from"./quiz-BenXfgLR.js";import{useDailyObjectives as Ze}from"./useDailyObjectives-B4lktBMi.js";import"./menuItems-zei-A9he.js";const et={class:"leaderboard-card"},tt={class:"leaderboard-header"},st={class:"leaderboard-tabs"},at=["disabled"],it={key:0,class:"flag"},ot=["disabled"],nt={key:0,class:"leaderboard-body"},lt={class:"leaderboard-content"},rt={key:0,class:"leaderboard-item me-item"},ct={class:"rank"},dt={class:"me-rank"},ut={class:"me-sub"},vt={class:"user"},pt={class:"info"},mt={class:"meta"},_t={key:0,class:"flag"},ht={key:1,class:"niveau"},ft={class:"xp"},gt={class:"me-xp"},yt={class:"me-percent"},bt={class:"leaderboard-list"},$t={class:"rank"},kt={key:0,class:"trophy gold"},wt={key:1,class:"trophy silver"},Ct={key:2,class:"trophy bronze"},xt={key:3},St={class:"user"},Pt={class:"avatar"},jt={class:"info"},Dt={class:"name"},zt={key:0,class:"flag"},At={key:0,class:"meta"},It={class:"xp"},Et={key:1,class:"expanded-section"},Tt={class:"expanded-header"},Rt={class:"expanded-count"},qt={class:"leaderboard-list"},Mt={class:"rank"},Lt={class:"user"},Nt={class:"avatar"},Ot={class:"info"},Xt={class:"name"},Qt={key:0,class:"flag"},Vt={key:0,class:"meta"},Ht={class:"xp"},Bt={key:0,class:"leaderboard-actions"},Ut=["disabled"],Ft={key:1,class:"empty-state"},Jt={key:1,class:"leaderboard-loading"},Gt={__name:"LeaderboardWidget",setup(B){const w=de(),g=m("global"),x=m(!0);m([]);const C=m(null),S=m(!1),P=m([]),M=R(()=>!!w?.pays?.id),f=R(()=>!!w?.niveau_pays?.id);function h(y){y==="pays"&&!M.value||y==="niveau"&&!f.value||(g.value=y)}function E(y){if(!y)return"U";const d=String(y).trim().split(/\s+/);return d.length===1?d[0].substring(0,2).toUpperCase():(d[0].substring(0,1)+d[1].substring(0,1)).toUpperCase()}async function j(){x.value=!0;try{const d=(await Ne({scope:g.value,limit:50}))?.data?.data||{},c=d.leaderboard||[];P.value=c.slice(0,50),C.value=d.me||null,S.value=!1}catch{P.value=[],C.value=null}finally{x.value=!1}}async function D(){S.value=!0}function A(){S.value=!1}return Ae(g,()=>j()),se(()=>j()),(y,d)=>(t(),a("div",et,[e("div",tt,[d[4]||(d[4]=e("h3",{class:"leaderboard-title"},"Classement",-1)),e("div",st,[e("button",{class:O(["tab",{active:g.value==="global"}]),onClick:d[0]||(d[0]=c=>h("global"))},"Global",2),e("button",{class:O(["tab",{active:g.value==="pays"}]),onClick:d[1]||(d[1]=c=>h("pays")),disabled:!M.value},[X(w).pays?.drapeau_emoji?(t(),a("span",it,i(X(w).pays?.drapeau_emoji),1)):$("",!0),d[3]||(d[3]=K(" Pays "))],10,at),e("button",{class:O(["tab",{active:g.value==="niveau"}]),onClick:d[2]||(d[2]=c=>h("niveau")),disabled:!f.value}," Niveau ",10,ot)])]),x.value?(t(),a("div",Jt,[d[10]||(d[10]=e("div",{class:"skeleton me"},null,-1)),(t(),a(Q,null,V(6,c=>e("div",{class:"skeleton row",key:c})),64))])):(t(),a("div",nt,[e("div",lt,[C.value?(t(),a("div",rt,[e("div",ct,[e("div",dt,"#"+i(C.value.rank),1),e("div",ut,"sur "+i(C.value.total),1)]),e("div",vt,[e("div",pt,[d[5]||(d[5]=e("div",{class:"name"},"Vous",-1)),e("div",mt,[C.value.pays_flag?(t(),a("span",_t,i(C.value.pays_flag),1)):$("",!0),C.value.niveau?(t(),a("span",ht,i(C.value.niveau),1)):$("",!0)])])]),e("div",ft,[e("div",gt,i(C.value.xp)+" XP",1),e("div",yt,"Top "+i(C.value.percentile)+"%",1)])])):$("",!0),e("ul",bt,[(t(!0),a(Q,null,V(P.value.slice(0,5),c=>(t(),a("li",{key:c.id,class:"leaderboard-item"},[e("div",$t,[c.rank===1?(t(),a("span",kt,"ü•á")):c.rank===2?(t(),a("span",wt,"ü•à")):c.rank===3?(t(),a("span",Ct,"ü•â")):(t(),a("span",xt,"#"+i(c.rank),1))]),e("div",St,[e("div",Pt,i(E(c.display_name)),1),e("div",jt,[e("div",Dt,[c.pays_flag?(t(),a("span",zt,i(c.pays_flag),1)):$("",!0),K(" "+i(c.display_name),1)]),c.niveau?(t(),a("div",At,i(c.niveau),1)):$("",!0)])]),e("div",It,i(c.xp)+" XP",1)]))),128))]),S.value&&P.value.length>5?(t(),a("div",Et,[e("div",Tt,[d[6]||(d[6]=e("span",{class:"expanded-title"},"Autres class√©s",-1)),e("span",Rt,i(Math.min(P.value.length-5,45))+" utilisateurs",1)]),e("ul",qt,[(t(!0),a(Q,null,V(P.value.slice(5,50),c=>(t(),a("li",{key:c.id,class:"leaderboard-item expanded-item"},[e("div",Mt," #"+i(c.rank),1),e("div",Lt,[e("div",Nt,i(E(c.display_name)),1),e("div",Ot,[e("div",Xt,[c.pays_flag?(t(),a("span",Qt,i(c.pays_flag),1)):$("",!0),K(" "+i(c.display_name),1)]),c.niveau?(t(),a("div",Vt,i(c.niveau),1)):$("",!0)])]),e("div",Ht,i(c.xp)+" XP",1)]))),128))])])):$("",!0)]),P.value.length>0?(t(),a("div",Bt,[!S.value&&P.value.length>5?(t(),a("button",{key:0,onClick:D,class:"btn-see-more",disabled:x.value},d[7]||(d[7]=[e("span",{class:"btn-text"},"Voir plus",-1)]),8,Ut)):S.value?(t(),a("button",{key:1,onClick:A,class:"btn-see-less"},d[8]||(d[8]=[e("span",{class:"btn-text"},"Voir moins",-1)]))):$("",!0)])):$("",!0),P.value.length?$("",!0):(t(),a("div",Ft,d[9]||(d[9]=[e("div",null,"Pas encore de classement pour ce filtre.",-1)])))]))]))}},Wt=ee(Gt,[["__scopeId","data-v-cd1b608f"]]),Kt={class:"xp-card"},Yt={class:"xp-header"},Zt={class:"xp-level"},es={class:"xp-ring"},ts={viewBox:"0 0 36 36",class:"circular-chart"},ss=["stroke-dasharray"],as={x:"18",y:"20.35",class:"percentage"},is={class:"xp-next"},os={class:"streak-section"},ns={class:"streak-header"},ls={class:"streak-icon-container"},rs={key:0,class:"streak-badge"},cs={class:"streak-info"},ds={class:"streak-subtitle"},us={key:0,class:"streak-next-xp"},vs={class:"streak-xp-display"},ps={class:"xp-icon"},ms={class:"xp-value"},_s={class:"streak-progress-container"},hs={class:"streak-progress-bar"},fs={class:"streak-progress-text"},gs={key:0,class:"streak-motivation"},ys={class:"motivation-text"},bs={__name:"XPBadges",setup(B){const w=de(),{initializeStreak:g,currentStreak:x,nextStreakXP:C}=qe(),S=R(()=>w.level||0),P=R(()=>w.xp||0),M=R(()=>w.xp_to_next||0),f=R(()=>x.value),h=R(()=>f.value===0?0:f.value<=7?f.value/7*100:((f.value-1)%7+1)/7*100),E=R(()=>{if(f.value===0)return"Commencez votre streak !";if(f.value<=7)return`${f.value}/7 jours`;const c=(f.value-1)%7+1,z=Math.floor((f.value-1)/7)+1;return`${c}/7 jours (semaine ${z})`}),j=()=>f.value===0?"Connectez-vous chaque jour pour gagner des XP":f.value===1?"Excellent d√©but ! Continuez demain":f.value<7?`${f.value} jours cons√©cutifs`:f.value<30?`${f.value} jours - Vous √™tes r√©gulier !`:`${f.value} jours - Vous √™tes un champion !`,D=()=>{const c=["Continuez comme √ßa ! Chaque jour compte.","Vous construisez une habitude d'apprentissage solide !","Impressionnant ! Votre pers√©v√©rance paie.","Vous √™tes sur la bonne voie vers la ma√Ætrise !","Chaque jour d'apprentissage vous rapproche de vos objectifs."],z=Math.min(Math.floor(f.value/5),c.length-1);return c[z]},A=()=>f.value===0?1:f.value<=5?f.value:5,y=()=>{const c=A();return c>=5?"üëë":c>=3?"üèÜ":c>=2?"‚≠ê":"üíé"},d=R(()=>{const c=Number(S.value||0),z=Number(P.value||0),b=c*c*10,l=(c+1)*(c+1)*10,k=Math.max(z,b)-b,U=Math.max(1,l-b);return`${Math.min(100,Math.round(k/U*100))}, 100`});return se(()=>{g()}),(c,z)=>(t(),a("div",Kt,[e("div",Yt,[z[0]||(z[0]=e("div",{class:"xp-title"},"Progression XP",-1)),e("div",Zt,"Niveau "+i(S.value),1)]),e("div",es,[(t(),a("svg",ts,[z[1]||(z[1]=e("path",{class:"circle-bg",d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"},null,-1)),e("path",{class:"circle","stroke-dasharray":d.value,d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"},null,8,ss),e("text",as,i(P.value)+" XP",1)]))]),e("div",is,i(M.value)+" XP pour le prochain niveau",1),e("div",os,[e("div",ns,[e("div",ls,[e("span",{class:O(["streak-icon",{"streak-active":f.value>0}])},"üî•",2),f.value>0?(t(),a("div",rs,i(f.value),1)):$("",!0)]),e("div",cs,[z[2]||(z[2]=e("h4",{class:"streak-title"},"Streak Quotidien",-1)),e("p",ds,i(j()),1),f.value>0?(t(),a("p",us,"Prochain: +"+i(X(C))+" XP",1)):$("",!0)]),e("div",vs,[e("span",ps,i(y()),1),e("span",ms,"+"+i(A())+" XP",1)])]),e("div",_s,[e("div",hs,[e("div",{class:"streak-progress-fill",style:xe({width:h.value+"%"})},null,4)]),e("div",fs,i(E.value),1)]),f.value>0?(t(),a("div",gs,[e("p",ys,i(D()),1)])):$("",!0)])]))}},$s=ee(bs,[["__scopeId","data-v-3295ee29"]]),ks={key:0,class:"game-reset-notification"},ws={__name:"GameResetNotification",props:{autoHide:{type:Number,default:8e3}},setup(B){const w=B,g=m(!1);function x(){g.value=!1,localStorage.setItem("game-reset-notification-seen","true")}return se(()=>{localStorage.getItem("game-reset-notification-seen")||(g.value=!0,w.autoHide>0&&setTimeout(()=>{g.value&&x()},w.autoHide))}),(C,S)=>(t(),Se(Oe,{name:"notification",appear:""},{default:re(()=>[g.value?(t(),a("div",ks,[S[0]||(S[0]=e("div",{class:"notification-icon"},[e("span",null,"üéÆ")],-1)),S[1]||(S[1]=e("div",{class:"notification-content"},[e("div",{class:"notification-title"}," Syst√®me de gamification mis √† jour ! "),e("div",{class:"notification-message"},[e("p",null,[K("üéØ "),e("strong",null,"Nouveau :"),K(" Seuls les "),e("strong",null,"quiz"),K(" donnent maintenant des XP")]),e("p",null,"üìö Les exercices guid√©s restent √©ducatifs (0 XP)"),e("p",null,"üèÜ Tous les compteurs ont √©t√© remis √† z√©ro pour un restart √©quitable")])],-1)),e("button",{onClick:x,class:"notification-close"}," ‚úï ")])):$("",!0)]),_:1}))}},Cs=ee(ws,[["__scopeId","data-v-64a66099"]]),xs={class:"quiz-history"},Ss={class:"quiz-header"},Ps={class:"quiz-filters"},js=["value"],Ds=["disabled"],zs=["value"],As=["disabled"],Is=["value"],Es={key:0,class:"stats-section"},Ts={class:"stats-grid"},Rs={class:"stat-card quiz-completed"},qs={class:"stat-value"},Ms={class:"stat-card quiz-average"},Ls={class:"stat-value"},Ns={class:"stat-card quiz-notions"},Os={class:"stat-value"},Xs={key:1,class:"matiere-stats"},Qs={class:"matiere-grid"},Vs={class:"matiere-name"},Hs={class:"matiere-info"},Bs={class:"matiere-average"},Us={class:"matiere-count"},Fs={key:2,class:"quiz-list-section"},Js={class:"section-subtitle"},Gs={class:"inline-mastery-filters"},Ws=["onClick"],Ks={key:0,class:"inline-mastery-icon"},Ys={class:"inline-mastery-label"},Zs={key:0,class:"quiz-list-content"},ea={key:0,class:"empty-state"},ta={key:1,class:"quiz-grid"},sa=["onClick"],aa={class:"quiz-card-title-section"},ia=["onClick","title"],oa={key:0,class:"cooldown-lock",title:"Quiz en cooldown"},na={key:1,class:"navigation-icon",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},la={class:"quiz-breadcrumb-compact"},ra={class:"quiz-card-actions"},ca={key:0,class:"retry-indicator"},da={key:0,class:"quiz-card-details"},ua={class:"quiz-breadcrumb"},va={class:"breadcrumb-item"},pa={class:"breadcrumb-item"},ma={class:"breadcrumb-item"},_a={class:"quiz-meta"},ha={class:"quiz-attempt"},fa={key:0,class:"total-attempts"},ga={class:"quiz-date"},ya={key:0,class:"quiz-time"},ba={key:0,class:"quiz-cooldown-info"},$a={class:"cooldown-warning"},ka={class:"cooldown-text"},wa={key:2,class:"pagination-container"},Ca=["disabled"],xa={class:"pagination-pages"},Sa=["onClick"],Pa=["disabled"],ja={key:3,class:"loading-state"},ze=12,Da={__name:"QuizHistory",setup(B){const w=de(),g=ke(),x=m(!0),C=m({completed:0,average:0,masteredNotions:0}),S=m([]),P=m([]),M=m([]),f=m([]),h=m([]),E=m({}),j=m(""),D=m(""),A=m(""),y=m("all"),d=m(1),c=m(new Set),z=m(!0),b=m(new Map),l=m(!1),r=R(()=>{if(!j.value)return[];const o=parseInt(j.value);return f.value.filter(s=>{const _=typeof s.theme=="object"?s.theme?.id:s.theme;let q=null;return typeof s.theme=="object"&&(q=s.theme?.matiere_id||s.theme?.matiere?.id||null),!q&&_&&E.value[_]&&(q=E.value[_].matiere_id||E.value[_].matiere),parseInt(q)===o})}),k=R(()=>{if(!D.value)return[];const o=parseInt(D.value);return h.value.filter(n=>{const s=n.notion_id??n.notion?.id??(typeof n.notion=="number"?n.notion:null);return parseInt(s)===o})}),U=R(()=>{let o=S.value;return y.value!=="all"&&(o=o.filter(n=>{const s=n.score_on_10;switch(y.value){case"mastered":return s>=7;case"average":return s>=5&&s<7;case"poor":return s<5;default:return!0}})),o}),F=R(()=>Math.ceil(U.value.length/ze)),ae=R(()=>{const o=(d.value-1)*ze,n=o+ze;return U.value.slice(o,n)}),ue=R(()=>M.value||[]),fe=R(()=>{const o=[],n=F.value,s=d.value;if(n<=7)for(let _=1;_<=n;_++)o.push(_);else if(s<=4){for(let _=1;_<=5;_++)o.push(_);n>5&&o.push("..."),o.push(n)}else if(s>=n-3){o.push(1),n>6&&o.push("...");for(let _=n-4;_<=n;_++)_>1&&o.push(_)}else{o.push(1),o.push("...");for(let _=s-1;_<=s+1;_++)o.push(_);o.push("..."),o.push(n)}return o}),ve=[{value:"all",label:"Tous",icon:"",class:"all"},{value:"mastered",label:"Ma√Ætris√©s",icon:"‚úÖ",class:"mastered"},{value:"average",label:"Moyens",icon:"‚ö†Ô∏è",class:"average"},{value:"poor",label:"Non ma√Ætris√©s",icon:"‚ùå",class:"poor"}],pe=async()=>{if(S.value.length){l.value=!0;try{for(const o of S.value)try{const n=await Ye(o.quiz_id);b.value.set(o.quiz_id,n)}catch(n){console.warn(`Erreur cooldown pour quiz ${o.quiz_id}:`,n),b.value.set(o.quiz_id,{can_attempt:!0})}}catch(o){console.error("Erreur lors du chargement des cooldowns:",o)}finally{l.value=!1}}},Y=o=>b.value.get(o)||{can_attempt:!0},G=o=>!Y(o).can_attempt,ie=async()=>{try{const[o,n,s,_]=await Promise.all([J.get("/api/matieres/user_matieres/"),J.get("/api/themes/notions-pour-utilisateur/"),je({}).catch(()=>J.get("/api/notions/pour-utilisateur/")),ce({})]);let q=[];o?.data?.matieres_disponibles?q=o.data.matieres_disponibles:o?.data?.data?q=o.data.data:Array.isArray(o?.data)&&(q=o.data);let W=[];s?.data?.notions_disponibles?W=s.data.notions_disponibles:s?.data?.data?W=s.data.data:Array.isArray(s?.data)?W=s.data:s?.data?.results&&(W=s.data.results);const te=n?.data?.themes||[],N=n?.data?.notions||[],ge={};te.forEach(ye=>{const Te=ye.matiere_id||ye.matiere&&(ye.matiere.id||ye.matiere);ge[ye.id]={matiere_id:Te,matiere:Te}}),E.value=ge,Array.isArray(N)&&N.length>0&&(W=N);const Ee=Array.isArray(_?.data)?_.data:_?.results||[];M.value=Array.isArray(q)?q:[],f.value=Array.isArray(W)?W:[],h.value=Array.isArray(Ee)?Ee:[],await Pe()}catch(o){console.error("Erreur lors du chargement des donn√©es de r√©f√©rence:",o);try{const[n,s,_]=await Promise.all([Ie({}),je({}),ce({})]);M.value=Array.isArray(n?.data)?n.data:n?.results||[],f.value=Array.isArray(s?.data)?s.data:s?.results||[],h.value=Array.isArray(_?.data)?_.data:_?.results||[],await Pe()}catch(n){console.error("Erreur fallback:",n)}}},oe=async()=>{x.value=!0;try{const o={};j.value&&(o.matiere=j.value),D.value&&(o.notion=D.value),A.value&&(o.chapitre=A.value);const s=(await J.get("/api/suivis/quiz/stats/",{params:o})).data;C.value=s.global_stats||{completed:0,average:0,masteredNotions:0},S.value=s.quiz_list||[],P.value=s.matiere_stats||[],S.value.length>0&&await pe()}catch(o){console.error("Erreur lors du chargement des quiz:",o)}finally{x.value=!1}},me=async()=>{if(D.value="",A.value="",I(),j.value&&r.value.length===0){console.log("üîÑ Rechargement des notions pour mati√®re:",j.value);try{const o=await J.get("/api/themes/notions-pour-utilisateur/",{params:{matiere:j.value}}),n=o?.data?.themes||[],s=o?.data?.notions||[],_={};n.forEach(N=>{const ge=N.matiere_id||N.matiere&&(N.matiere.id||N.matiere);_[N.id]={matiere_id:ge,matiere:ge}}),E.value={...E.value,..._};let q=s;if(!Array.isArray(q)||q.length===0){const N=await J.get("/api/notions/pour-utilisateur/",{params:{matiere:j.value}});N?.data?.notions_disponibles?q=N.data.notions_disponibles:N?.data?.data?q=N.data.data:Array.isArray(N?.data)?q=N.data:N?.data?.results&&(q=N.data.results)}const W=f.value.map(N=>N.id),te=q.filter(N=>!W.includes(N.id));f.value=[...f.value,...te]}catch(o){console.error("Erreur lors du rechargement des notions:",o)}}oe()},T=async()=>{if(A.value="",I(),D.value)try{let o=await Me(D.value),n=[];if(Array.isArray(o?.data)?n=o.data:o?.data?.results&&(n=o.data.results),n.length===0){const s=await ce({notion:D.value});Array.isArray(s?.data)?n=s.data:s?.data?.results&&(n=s.data.results)}if(n.length===0){const s=await J.get(`/api/notions/${D.value}/chapitres/`);Array.isArray(s?.data)?n=s.data:s?.data?.results&&(n=s.data.results)}if(n.length>0){const s=h.value.map(q=>q.id),_=n.filter(q=>!s.includes(q.id));h.value=[...h.value,..._]}}catch(o){console.error("Erreur lors du rechargement des chapitres:",o)}oe()},L=()=>{I(),oe()},H=o=>o>=7?"score-good":o>=5?"score-average":"score-poor",le=o=>new Date(o).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),_e=o=>{const n=Math.floor(o/60),s=o%60;return`${n}:${s.toString().padStart(2,"0")}`},De=o=>{c.value.has(o)?c.value.delete(o):c.value.add(o)},we=o=>c.value.has(o),v=()=>{z.value=!z.value},p=async o=>{try{if(G(o.quiz_id)){const _=Y(o.quiz_id);alert(`‚è∞ Ce quiz est en cooldown. ${_.message}`);return}console.log(`[QuizHistory] üöÄ Navigation rapide vers quiz: ${o.quiz_titre}`);const n=o.chapitre.id,s=o.quiz_id;await g.push({path:`/quiz-exercices/${n}`,query:{quizId:s,autoStart:"true"}}),console.log("[QuizHistory] ‚úÖ Navigation compl√©t√©e")}catch(n){console.error("[QuizHistory] ‚ùå Erreur de navigation:",n)}},u=o=>{typeof o=="number"&&o>=1&&o<=F.value&&(d.value=o)},I=()=>{d.value=1};return se(async()=>{if(w.isLoading||!w.isAuthenticated&&!w.id){let o=0;for(;(w.isLoading||!w.isAuthenticated)&&o<30;)await new Promise(n=>setTimeout(n,100)),o++}await ie(),await oe()}),(o,n)=>(t(),a("div",xs,[e("div",Ss,[n[8]||(n[8]=e("h3",{class:"quiz-title"},"üß† Historique des Quiz",-1)),e("div",Ps,[Z((t(),a("select",{"onUpdate:modelValue":n[0]||(n[0]=s=>j.value=s),onChange:me,class:"filter-select",key:"matieres-"+ue.value.length},[n[5]||(n[5]=e("option",{value:""},"Toutes les mati√®res",-1)),(t(!0),a(Q,null,V(ue.value,s=>(t(),a("option",{key:`matiere-${s.id}`,value:s.id},i(s.titre||s.nom),9,js))),128))],32)),[[he,j.value]]),Z(e("select",{"onUpdate:modelValue":n[1]||(n[1]=s=>D.value=s),onChange:T,class:"filter-select",disabled:!j.value},[n[6]||(n[6]=e("option",{value:""},"Toutes les notions",-1)),(t(!0),a(Q,null,V(r.value,s=>(t(),a("option",{key:s.id,value:s.id},i(s.titre),9,zs))),128))],40,Ds),[[he,D.value]]),Z(e("select",{"onUpdate:modelValue":n[2]||(n[2]=s=>A.value=s),onChange:L,class:"filter-select",disabled:!D.value},[n[7]||(n[7]=e("option",{value:""},"Tous les chapitres",-1)),(t(!0),a(Q,null,V(k.value,s=>(t(),a("option",{key:s.id,value:s.id},i(s.titre),9,Is))),128))],40,As),[[he,A.value]])])]),x.value?$("",!0):(t(),a("div",Es,[e("div",Ts,[e("div",Rs,[n[9]||(n[9]=e("span",{class:"stat-label"},"Quiz effectu√©s",-1)),e("span",qs,i(C.value.completed),1)]),e("div",Ms,[n[10]||(n[10]=e("span",{class:"stat-label"},"Note moyenne",-1)),e("span",Ls,i(C.value.average)+"/10",1)]),e("div",Ns,[n[11]||(n[11]=e("span",{class:"stat-label"},"Notions ma√Ætris√©es",-1)),e("span",Os,i(C.value.masteredNotions),1)])])])),!x.value&&P.value.length>0?(t(),a("div",Xs,[n[12]||(n[12]=e("h4",{class:"section-subtitle"},"üìä Moyennes par mati√®re",-1)),e("div",Qs,[(t(!0),a(Q,null,V(P.value,s=>(t(),a("div",{key:s.id,class:"matiere-card"},[e("div",Vs,i(s.titre),1),e("div",Hs,[e("span",Bs,i(s.average)+"/10",1),e("span",Us,i(s.quiz_count)+" quiz",1)])]))),128))])])):$("",!0),x.value?$("",!0):(t(),a("div",Fs,[e("div",{class:"quiz-list-header",onClick:v},[e("h4",Js,"üìù Quiz effectu√©s ("+i(U.value.length)+")",1),e("div",Gs,[(t(),a(Q,null,V(ve,s=>e("button",{key:s.value,onClick:$e(_=>y.value=s.value,["stop"]),class:O(["inline-mastery-btn",{active:y.value===s.value},s.class])},[s.icon?(t(),a("span",Ks,i(s.icon),1)):$("",!0),e("span",Ys,i(s.label),1)],10,Ws)),64))]),e("button",{class:O(["section-toggle",{expanded:z.value}])},n[13]||(n[13]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"6,9 12,15 18,9"})],-1)]),2)]),z.value?(t(),a("div",Zs,[U.value.length===0?(t(),a("div",ea,n[14]||(n[14]=[e("p",null,"Aucun quiz trouv√© avec ces filtres",-1)]))):(t(),a("div",ta,[(t(!0),a(Q,null,V(ae.value,s=>(t(),a("div",{key:s.id,class:O(["quiz-card",{"multiple-attempts":s.total_attempts>1,cooldown:G(s.quiz_id)}])},[e("div",{class:"quiz-card-header",onClick:_=>De(s.id)},[e("div",aa,[e("h5",{class:O(["quiz-card-title clickable-title",{"cooldown-title":G(s.quiz_id)}]),onClick:$e(_=>p(s),["stop"]),title:G(s.quiz_id)?"Quiz en cooldown - Acc√®s temporairement bloqu√©":"Acc√©der au quiz: "+s.quiz_titre},[G(s.quiz_id)?(t(),a("span",oa,"üîí")):$("",!0),K(" "+i(s.quiz_titre)+" ",1),G(s.quiz_id)?$("",!0):(t(),a("svg",na,n[15]||(n[15]=[e("path",{d:"M7 17l9.2-9.2M17 17V7H7"},null,-1)])))],10,ia),e("div",la,i(s.matiere.titre)+" ‚Üí "+i(s.notion.titre),1)]),e("div",ra,[e("div",{class:O(["quiz-score",H(s.score_on_10)])},[K(i(s.score_on_10)+"/10 ",1),s.total_attempts>1?(t(),a("span",ca,"‚Üª")):$("",!0)],2),e("button",{class:O(["expand-toggle",{expanded:we(s.id)}])},n[16]||(n[16]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"6,9 12,15 18,9"})],-1)]),2)])],8,sa),we(s.id)?(t(),a("div",da,[e("div",ua,[e("span",va,i(s.matiere.titre),1),n[17]||(n[17]=e("span",{class:"breadcrumb-separator"},"‚Üí",-1)),e("span",pa,i(s.notion.titre),1),n[18]||(n[18]=e("span",{class:"breadcrumb-separator"},"‚Üí",-1)),e("span",ma,i(s.chapitre.titre),1)]),e("div",_a,[e("span",ha,[K(" Tentative #"+i(s.tentative_numero)+" ",1),s.total_attempts>1?(t(),a("span",fa," ("+i(s.total_attempts)+" au total) ",1)):$("",!0)]),e("span",ga,i(le(s.date_creation)),1),s.temps_total_seconde?(t(),a("span",ya,i(_e(s.temps_total_seconde)),1)):$("",!0)]),G(s.quiz_id)?(t(),a("div",ba,[e("div",$a,[n[19]||(n[19]=e("span",{class:"cooldown-icon"},"‚è∞",-1)),e("span",ka," Prochaine tentative possible dans "+i(Y(s.quiz_id).time_remaining_formatted),1)])])):$("",!0)])):$("",!0)],2))),128))])),F.value>1?(t(),a("div",wa,[e("button",{onClick:n[3]||(n[3]=s=>u(d.value-1)),disabled:d.value<=1,class:"pagination-btn"}," ‚Äπ Pr√©c√©dent ",8,Ca),e("div",xa,[(t(!0),a(Q,null,V(fe.value,s=>(t(),a("button",{key:s,onClick:_=>u(s),class:O(["pagination-page",{active:s===d.value}])},i(s),11,Sa))),128))]),e("button",{onClick:n[4]||(n[4]=s=>u(d.value+1)),disabled:d.value>=F.value,class:"pagination-btn"}," Suivant ‚Ä∫ ",8,Pa)])):$("",!0)])):$("",!0)])),x.value?(t(),a("div",ja,n[20]||(n[20]=[e("div",{class:"spinner"},null,-1),e("p",null,"Chargement des quiz...",-1)]))):$("",!0)]))}},za=ee(Da,[["__scopeId","data-v-c9b8fbbd"]]),Aa={class:"base-history"},Ia={class:"history-header"},Ea={class:"history-title"},Ta={class:"history-filters"},Ra=["value"],qa=["disabled"],Ma=["value"],La=["disabled"],Na=["value"],Oa={key:0,class:"stats-section"},Xa={key:1,class:"matiere-stats"},Qa={key:2,class:"items-list-section"},Va={class:"section-subtitle"},Ha={key:0,class:"inline-filters"},Ba={key:0,class:"items-list-content"},Ua={key:0,class:"empty-state"},Fa={key:1,class:"items-grid"},Ja={key:2,class:"pagination-container"},Ga=["disabled"],Wa={class:"pagination-pages"},Ka=["onClick"],Ya=["disabled"],Za={key:3,class:"loading-state"},ei={__name:"BaseHistory",props:{title:{type:String,required:!0},listTitle:{type:String,required:!0},loadingText:{type:String,default:"Chargement..."},apiEndpoint:{type:String,required:!0},customFilters:{type:Array,default:()=>[]},navigationHandler:{type:Function,default:null},itemsPerPage:{type:Number,default:12},filteredItems:{type:Array,default:null}},emits:["data-loaded","filter-changed"],setup(B,{expose:w,emit:g}){const x=B,C=g,S=de();ke();const P=m(!0),M=m({}),f=m([]),h=m([]),E=m([]),j=m([]),D=m([]),A=m({}),y=m(""),d=m(""),c=m(""),z=m("all"),b=m(1),l=m(new Set),r=m(!0),k=R(()=>{if(!y.value)return[];const v=parseInt(y.value);return j.value.filter(u=>{const I=typeof u.theme=="object"?u.theme?.id:u.theme;let o=null;return typeof u.theme=="object"&&(o=u.theme?.matiere_id||u.theme?.matiere?.id||null),!o&&I&&A.value[I]&&(o=A.value[I].matiere_id||A.value[I].matiere),parseInt(o)===v})}),U=R(()=>{if(!d.value)return[];const v=parseInt(d.value);return D.value.filter(p=>{const u=p.notion_id??p.notion?.id??(typeof p.notion=="number"?p.notion:null);return parseInt(u)===v})}),F=R(()=>x.filteredItems?x.filteredItems:f.value),ae=R(()=>Math.ceil(F.value.length/x.itemsPerPage)),ue=R(()=>{const v=(b.value-1)*x.itemsPerPage,p=v+x.itemsPerPage;return F.value.slice(v,p)}),fe=R(()=>{const v=[],p=ae.value,u=b.value;if(p<=7)for(let I=1;I<=p;I++)v.push(I);else if(u<=4){for(let I=1;I<=5;I++)v.push(I);p>5&&v.push("..."),v.push(p)}else if(u>=p-3){v.push(1),p>6&&v.push("...");for(let I=p-4;I<=p;I++)I>1&&v.push(I)}else{v.push(1),v.push("...");for(let I=u-1;I<=u+1;I++)v.push(I);v.push("..."),v.push(p)}return v}),ve=R(()=>E.value||[]),pe=async()=>{try{const[v,p,u,I]=await Promise.all([J.get("/api/matieres/user_matieres/"),J.get("/api/themes/notions-pour-utilisateur/"),je({}).catch(()=>J.get("/api/notions/pour-utilisateur/")),ce({})]);let o=[];v?.data?.matieres_disponibles?o=v.data.matieres_disponibles:v?.data?.data?o=v.data.data:Array.isArray(v?.data)&&(o=v.data);let n=[];u?.data?.notions_disponibles?n=u.data.notions_disponibles:u?.data?.data?n=u.data.data:Array.isArray(u?.data)?n=u.data:u?.data?.results&&(n=u.data.results);const s=p?.data?.themes||[],_=p?.data?.notions||[],q={};s.forEach(te=>{const N=te.matiere_id||te.matiere&&(te.matiere.id||te.matiere);q[te.id]={matiere_id:N,matiere:N}}),A.value=q,Array.isArray(_)&&_.length>0&&(n=_);const W=Array.isArray(I?.data)?I.data:I?.results||[];E.value=Array.isArray(o)?o:[],j.value=Array.isArray(n)?n:[],D.value=Array.isArray(W)?W:[],await Pe()}catch(v){console.error("Erreur lors du chargement des donn√©es de r√©f√©rence:",v);try{const[p,u,I]=await Promise.all([Ie({}),je({}),ce({})]);E.value=Array.isArray(p?.data)?p.data:p?.results||[],j.value=Array.isArray(u?.data)?u.data:u?.results||[],D.value=Array.isArray(I?.data)?I.data:I?.results||[],await Pe()}catch(p){console.error("Erreur fallback:",p)}}},Y=async()=>{P.value=!0;try{const v={};y.value&&(v.matiere=y.value),d.value&&(v.notion=d.value),c.value&&(v.chapitre=c.value);const u=(await J.get(x.apiEndpoint,{params:v})).data;M.value=u.global_stats||{},f.value=u.quiz_list||u.exercice_list||[],h.value=u.matiere_stats||[],C("data-loaded",u)}catch(v){console.error("Erreur lors du chargement des donn√©es:",v)}finally{P.value=!1}},G=async()=>{if(d.value="",c.value="",_e(),y.value&&k.value.length===0)try{const v=await J.get("/api/themes/notions-pour-utilisateur/",{params:{matiere:y.value}}),p=v?.data?.themes||[],u=v?.data?.notions||[],I={};p.forEach(_=>{const q=_.matiere_id||_.matiere&&(_.matiere.id||_.matiere);I[_.id]={matiere_id:q,matiere:q}}),A.value={...A.value,...I};let o=u;if(!Array.isArray(o)||o.length===0){const _=await J.get("/api/notions/pour-utilisateur/",{params:{matiere:y.value}});_?.data?.notions_disponibles?o=_.data.notions_disponibles:_?.data?.data?o=_.data.data:Array.isArray(_?.data)?o=_.data:_?.data?.results&&(o=_.data.results)}const n=j.value.map(_=>_.id),s=o.filter(_=>!n.includes(_.id));j.value=[...j.value,...s]}catch(v){console.error("Erreur lors du rechargement des notions:",v)}Y(),C("filter-changed",{matiere:y.value,notion:d.value,chapitre:c.value})},ie=async()=>{if(c.value="",_e(),d.value)try{let v=await Me(d.value),p=[];if(Array.isArray(v?.data)?p=v.data:v?.data?.results&&(p=v.data.results),p.length===0){const u=await ce({notion:d.value});Array.isArray(u?.data)?p=u.data:u?.data?.results&&(p=u.data.results)}if(p.length===0){const u=await J.get(`/api/notions/${d.value}/chapitres/`);Array.isArray(u?.data)?p=u.data:u?.data?.results&&(p=u.data.results)}if(p.length>0){const u=D.value.map(o=>o.id),I=p.filter(o=>!u.includes(o.id));D.value=[...D.value,...I]}}catch(v){console.error("Erreur lors du rechargement des chapitres:",v)}Y(),C("filter-changed",{matiere:y.value,notion:d.value,chapitre:c.value})},oe=()=>{_e(),Y(),C("filter-changed",{matiere:y.value,notion:d.value,chapitre:c.value})},me=v=>{l.value.has(v)?l.value.delete(v):l.value.add(v)},T=v=>l.value.has(v),L=()=>{r.value=!r.value},H=v=>{x.navigationHandler&&x.navigationHandler(v)},le=v=>{typeof v=="number"&&v>=1&&v<=ae.value&&(b.value=v)},_e=()=>{b.value=1},De=v=>new Date(v).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),we=v=>{const p=Math.floor(v/60),u=v%60;return`${p}:${u.toString().padStart(2,"0")}`};return se(async()=>{if(S.isLoading||!S.isAuthenticated&&!S.id){let v=0;for(;(S.isLoading||!S.isAuthenticated)&&v<30;)await new Promise(p=>setTimeout(p,100)),v++}await pe(),await Y()}),w({formatDate:De,formatTime:we,toggleItemDetails:me,isItemExpanded:T,navigateToItem:H,selectedCustomFilter:z,resetPagination:_e}),(v,p)=>(t(),a("div",Aa,[e("div",Ia,[e("h3",Ea,i(B.title),1),e("div",Ta,[Z((t(),a("select",{"onUpdate:modelValue":p[0]||(p[0]=u=>y.value=u),onChange:G,class:"filter-select",key:"matieres-"+ve.value.length},[p[5]||(p[5]=e("option",{value:""},"Toutes les mati√®res",-1)),(t(!0),a(Q,null,V(ve.value,u=>(t(),a("option",{key:`matiere-${u.id}`,value:u.id},i(u.titre||u.nom),9,Ra))),128))],32)),[[he,y.value]]),Z(e("select",{"onUpdate:modelValue":p[1]||(p[1]=u=>d.value=u),onChange:ie,class:"filter-select",disabled:!y.value},[p[6]||(p[6]=e("option",{value:""},"Toutes les notions",-1)),(t(!0),a(Q,null,V(k.value,u=>(t(),a("option",{key:u.id,value:u.id},i(u.titre),9,Ma))),128))],40,qa),[[he,d.value]]),Z(e("select",{"onUpdate:modelValue":p[2]||(p[2]=u=>c.value=u),onChange:oe,class:"filter-select",disabled:!d.value},[p[7]||(p[7]=e("option",{value:""},"Tous les chapitres",-1)),(t(!0),a(Q,null,V(U.value,u=>(t(),a("option",{key:u.id,value:u.id},i(u.titre),9,Na))),128))],40,La),[[he,c.value]])])]),P.value?$("",!0):(t(),a("div",Oa,[be(v.$slots,"global-stats",{stats:M.value,loading:P.value},void 0,!0)])),!P.value&&h.value.length>0?(t(),a("div",Xa,[be(v.$slots,"matiere-stats",{stats:h.value},void 0,!0)])):$("",!0),P.value?$("",!0):(t(),a("div",Qa,[e("div",{class:"items-list-header",onClick:L},[e("h4",Va,i(B.listTitle)+" ("+i(F.value.length)+")",1),B.customFilters&&B.customFilters.length>0?(t(),a("div",Ha,[be(v.$slots,"custom-filters",{filters:B.customFilters,selected:z.value},void 0,!0)])):$("",!0),e("button",{class:O(["section-toggle",{expanded:r.value}])},p[8]||(p[8]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"6,9 12,15 18,9"})],-1)]),2)]),r.value?(t(),a("div",Ba,[F.value.length===0?(t(),a("div",Ua,[be(v.$slots,"empty-state",{},()=>[p[9]||(p[9]=e("p",null,"Aucun √©l√©ment trouv√© avec ces filtres",-1))],!0)])):(t(),a("div",Fa,[be(v.$slots,"items-list",{items:ue.value,toggleDetails:me,isExpanded:T,navigateToItem:H},void 0,!0)])),ae.value>1?(t(),a("div",Ja,[e("button",{onClick:p[3]||(p[3]=u=>le(b.value-1)),disabled:b.value<=1,class:"pagination-btn"}," ‚Äπ Pr√©c√©dent ",8,Ga),e("div",Wa,[(t(!0),a(Q,null,V(fe.value,u=>(t(),a("button",{key:u,onClick:I=>le(u),class:O(["pagination-page",{active:u===b.value}])},i(u),11,Ka))),128))]),e("button",{onClick:p[4]||(p[4]=u=>le(b.value+1)),disabled:b.value>=ae.value,class:"pagination-btn"}," Suivant ‚Ä∫ ",8,Ya)])):$("",!0)])):$("",!0)])),P.value?(t(),a("div",Za,[p[10]||(p[10]=e("div",{class:"spinner"},null,-1)),e("p",null,i(B.loadingText),1)])):$("",!0)]))}},ti=ee(ei,[["__scopeId","data-v-685ade94"]]),si={class:"stats-grid"},ai={class:"stat-card exercice-completed"},ii={class:"stat-value"},oi={class:"stat-card exercice-correct"},ni={class:"stat-value"},li={class:"stat-card exercice-percentage"},ri={class:"stat-value"},ci={class:"stat-card exercice-notions"},di={class:"stat-value"},ui={class:"matiere-grid"},vi={class:"matiere-name"},pi={class:"matiere-info"},mi={class:"matiere-average"},_i={class:"matiere-count"},hi={class:"inline-mastery-filters"},fi=["onClick"],gi={class:"inline-mastery-icon"},yi={class:"inline-mastery-label"},bi=["onClick"],$i={class:"exercice-card-title-section"},ki=["onClick","title"],wi={class:"exercice-breadcrumb-compact"},Ci={class:"exercice-card-actions"},xi={key:0,class:"exercice-card-details"},Si={class:"exercice-breadcrumb"},Pi={class:"breadcrumb-item"},ji={class:"breadcrumb-item"},Di={class:"breadcrumb-item"},zi={class:"exercice-meta"},Ai={class:"exercice-date"},Ii={key:0,class:"exercice-time"},Ei={key:1,class:"exercice-points"},Ti={__name:"ExercicesHistory",setup(B,{expose:w}){const g=ke(),x=m(null),C=[{value:"all",label:"Tous",icon:"",class:"all"},{value:"correct",label:"R√©ussis",icon:"‚úÖ",class:"correct"},{value:"incorrect",label:"Rat√©s",icon:"‚ùå",class:"incorrect"}],S=m("all"),P=m([]),M=R(()=>{let d=P.value;return S.value!=="all"&&(d=d.filter(c=>{switch(S.value){case"correct":return c.est_correct===!0;case"incorrect":return c.est_correct===!1;default:return!0}})),d}),f=d=>{P.value=d.exercice_list||[]},h=d=>{console.log("Filtres chang√©s:",d)},E=d=>d?"status-correct":"status-incorrect",j=async d=>{try{console.log(`[ExercicesHistory] üöÄ Navigation vers exercice: ${d.exercice_titre}`);const c=d.exercice_id;await g.push({name:"ExerciceDetail",params:{exerciceId:String(c)}}),console.log("[ExercicesHistory] ‚úÖ Navigation compl√©t√©e")}catch(c){console.error("[ExercicesHistory] ‚ùå Erreur de navigation:",c)}},D=d=>new Date(d).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),A=d=>{const c=Math.floor(d/60),z=d%60;return`${c}:${z.toString().padStart(2,"0")}`},y=d=>{S.value=d};return w({updateSelectedMastery:y}),(d,c)=>(t(),Se(ti,{ref_key:"baseHistoryRef",ref:x,title:"üß≠ Historique des Exercices","list-title":"üìù Exercices effectu√©s","loading-text":"Chargement des exercices...","api-endpoint":"/api/suivis/exercices/stats/","custom-filters":C,"navigation-handler":j,"items-per-page":12,"filtered-items":M.value,onDataLoaded:f,onFilterChanged:h},{"global-stats":re(({stats:z})=>[e("div",si,[e("div",ai,[c[0]||(c[0]=e("span",{class:"stat-label"},"Exercices effectu√©s",-1)),e("span",ii,i(z.completed||0),1)]),e("div",oi,[c[1]||(c[1]=e("span",{class:"stat-label"},"Exercices r√©ussis",-1)),e("span",ni,i(z.correct||0),1)]),e("div",li,[c[2]||(c[2]=e("span",{class:"stat-label"},"Taux de r√©ussite",-1)),e("span",ri,i(z.percentage||0)+"%",1)]),e("div",ci,[c[3]||(c[3]=e("span",{class:"stat-label"},"Notions ma√Ætris√©es",-1)),e("span",di,i(z.masteredNotions||0),1)])])]),"matiere-stats":re(({stats:z})=>[c[4]||(c[4]=e("h4",{class:"section-subtitle"},"üìä Moyennes par mati√®re",-1)),e("div",ui,[(t(!0),a(Q,null,V(z,b=>(t(),a("div",{key:b.id,class:"matiere-card"},[e("div",vi,i(b.titre),1),e("div",pi,[e("span",mi,i(b.average)+"/10",1),e("span",_i,i(b.exercice_count)+" exercices",1)])]))),128))])]),"custom-filters":re(({filters:z,selected:b})=>[e("div",hi,[(t(!0),a(Q,null,V(z,l=>(t(),a("button",{key:l.value,onClick:$e(r=>y(l.value),["stop"]),class:O(["inline-mastery-btn",l.class,{active:S.value===l.value}])},[e("span",gi,i(l.icon),1),e("span",yi,i(l.label),1)],10,fi))),128))])]),"items-list":re(({items:z,toggleDetails:b,isExpanded:l,navigateToItem:r})=>[(t(!0),a(Q,null,V(z,k=>(t(),a("div",{key:k.id,class:O(["exercice-card",{correct:k.est_correct,incorrect:!k.est_correct}])},[e("div",{class:"exercice-card-header",onClick:U=>b(k.id)},[e("div",$i,[e("h5",{class:"exercice-card-title clickable-title",onClick:$e(U=>r(k),["stop"]),title:"Acc√©der √† l'exercice: "+k.exercice_titre},[K(i(k.exercice_titre)+" ",1),c[5]||(c[5]=e("svg",{class:"navigation-icon",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M7 17l9.2-9.2M17 17V7H7"})],-1))],8,ki),e("div",wi,i(k.matiere.titre)+" ‚Üí "+i(k.notion.titre),1)]),e("div",Ci,[e("div",{class:O(["exercice-status",E(k.est_correct)])},i(k.est_correct?"‚úÖ":"‚ùå"),3),e("button",{class:O(["expand-toggle",{expanded:l(k.id)}])},c[6]||(c[6]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"6,9 12,15 18,9"})],-1)]),2)])],8,bi),l(k.id)?(t(),a("div",xi,[e("div",Si,[e("span",Pi,i(k.matiere.titre),1),c[7]||(c[7]=e("span",{class:"breadcrumb-separator"},"‚Üí",-1)),e("span",ji,i(k.notion.titre),1),c[8]||(c[8]=e("span",{class:"breadcrumb-separator"},"‚Üí",-1)),e("span",Di,i(k.chapitre.titre),1)]),e("div",zi,[e("span",Ai,i(D(k.date_creation)),1),k.temps_seconde?(t(),a("span",Ii,i(A(k.temps_seconde)),1)):$("",!0),k.points_obtenus?(t(),a("span",Ei,i(k.points_obtenus)+" points ",1)):$("",!0)])])):$("",!0)],2))),128))]),"empty-state":re(()=>c[9]||(c[9]=[e("p",null,"Aucun exercice trouv√© avec ces filtres",-1),e("p",{class:"empty-hint"},"Essayez de modifier vos filtres ou commencez √† faire des exercices !",-1)])),_:1},8,["filtered-items"]))}},Ri=ee(Ti,[["__scopeId","data-v-7d5fc64f"]]),qi={class:"daily-objectives-card"},Mi={class:"objective-icon"},Li={class:"objective-content"},Ni={class:"objective-text"},Oi={class:"objective-progress"},Xi={class:"progress-bar"},Qi={class:"progress-text"},Vi={key:1,class:"no-objective"},Hi={key:2,class:"completion-badge"},Bi={class:"objectives-list"},Ui={class:"objective-info"},Fi={class:"objective-icon-small"},Ji={class:"objective-details"},Gi={class:"objective-text-small"},Wi={class:"objective-description"},Ki={class:"objective-reward"},Yi={class:"objective-status"},Zi={class:"progress-info"},eo={class:"progress-bar-modal"},to={key:0,class:"status-completed"},so={class:"modal-footer"},ao={class:"daily-summary"},io={class:"summary-stat"},oo={class:"stat-value"},no={class:"summary-stat"},lo={class:"stat-value"},ro={__name:"DailyObjectives",setup(B){const w=m(!1),{currentObjective:g,unlockedObjectivesList:x,unlockedObjectives:C,allObjectives:S,userStats:P,loadTodayStats:M,simulateQuizEasy:f,simulateQuizMedium:h,simulateQuizHard:E,simulateQuizPerfect:j,simulateExerciseCompleted:D,simulateQuizStreak:A}=Ze(),y=m(0),d=R(()=>(y.value,x.value.filter(T=>T.isCompleted).length)),c=R(()=>(y.value,x.value.filter(T=>T.isCompleted).reduce((T,L)=>T+L.xpReward,0))),z=()=>{w.value=!0},b=()=>{w.value=!1},l=R(()=>{if(y.value,!g.value)return console.log("üéØ [DailyObjectives] Aucun objectif actuel"),0;const T=g.value.progress,L=g.value.target,H=Math.min(T/L*100,100);return console.log(`üéØ [DailyObjectives] Calcul pourcentage r√©actif: ${T}/${L} = ${H}%`),console.log("üéØ [DailyObjectives] Objectif actuel:",g.value),console.log("üéØ [DailyObjectives] forceUpdate:",y.value),H}),r=()=>l.value,k=T=>T>=100?"completed":T>=75?"almost-done":T>=25?"half-way":T>0?"starting":"",U=()=>f(),F=()=>h(),ae=()=>E(),ue=()=>j(),fe=()=>D(),ve=()=>A(Math.floor(Math.random()*8)+1),pe=T=>{console.log("üéØ [DailyObjectives] Progression mise √† jour:",T.detail),y.value++,M(),setTimeout(()=>{g.value&&console.log("üéØ [DailyObjectives] Objectif apr√®s mise √† jour:",{progress:g.value.progress,target:g.value.target,percentage:g.value.percentage,calculatedPercentage:r()})},100)},Y=T=>{console.log("üéØ [DailyObjectives] Nouvel objectif d√©bloqu√©:",T.detail),y.value++},G=T=>{console.log("üéØ [DailyObjectives] Objectif compl√©t√©:",T.detail),y.value++};Ae(P,(T,L)=>{console.log("üéØ [DailyObjectives] userStats chang√©:",{newStats:T,oldStats:L}),y.value++},{deep:!0}),Ae(C,(T,L)=>{console.log("üéØ [DailyObjectives] unlockedObjectives chang√©:",{newUnlocked:T,oldUnlocked:L}),y.value++},{deep:!0});let ie=null;const oe=()=>{ie=setInterval(()=>{M(),y.value++},2e3)},me=()=>{ie&&(clearInterval(ie),ie=null)};return se(()=>{window.addEventListener("dailyObjectiveProgress",pe),window.addEventListener("objectiveUnlocked",Y),window.addEventListener("dailyObjectiveCompleted",G),console.log("üéØ [DailyObjectives] Composant mont√©:",{userStats:P.value,currentObjective:g.value,unlockedObjectives:C.value}),oe()}),Xe(()=>{window.removeEventListener("dailyObjectiveProgress",pe),window.removeEventListener("objectiveUnlocked",Y),window.removeEventListener("dailyObjectiveCompleted",G),me()}),window.testDailyObjectives={quizEasy:U,quizMedium:F,quizHard:ae,quizPerfect:ue,exerciseCompleted:fe,quizStreak:ve},(T,L)=>(t(),a(Q,null,[e("div",qi,[e("div",{class:"objective-header"},[L[1]||(L[1]=e("div",{class:"objective-title"},"üéØ D√©fi du jour",-1)),e("button",{class:"see-more-btn",onClick:z}," Voir tous les d√©fis ")]),X(g)?(t(),a("div",{class:"current-objective",key:y.value},[e("div",Mi,i(X(g).icon),1),e("div",Li,[e("div",Ni,i(X(g).text),1),e("div",Oi,[e("div",Xi,[e("div",{class:O(["progress-fill",k(l.value)]),style:xe({width:l.value+"%"})},null,6)]),e("div",Qi,i(X(g).progress)+" / "+i(X(g).target),1)])])])):(t(),a("div",Vi," üéâ Tous les d√©fis du jour sont termin√©s ! Revenez demain pour de nouveaux d√©fis. ")),X(g)&&X(g).isCompleted?(t(),a("div",Hi," ‚úÖ D√©fi compl√©t√© ! +"+i(X(g).xpReward)+" XP ",1)):$("",!0)]),w.value?(t(),a("div",{key:0,class:"modal-overlay",onClick:b},[e("div",{class:"modal-content",onClick:L[0]||(L[0]=$e(()=>{},["stop"]))},[e("div",{class:"modal-header"},[L[2]||(L[2]=e("h3",null,"üéØ Vos d√©fis journaliers",-1)),e("button",{class:"close-btn",onClick:b},"√ó")]),e("div",Bi,[(t(!0),a(Q,null,V(X(S),(H,le)=>(t(),a("div",{key:le,class:O(["objective-item",{completed:H.isCompleted,locked:!H.isUnlocked}])},[e("div",Ui,[e("div",Fi,i(H.icon),1),e("div",Ji,[e("div",Gi,i(H.name),1),e("div",Wi,i(H.text),1),e("div",Ki,"+"+i(H.xpReward)+" XP",1)])]),e("div",Yi,[e("div",Zi,i(H.progress)+" / "+i(H.target),1),e("div",eo,[e("div",{class:O(["progress-fill-modal",{completed:H.isCompleted}]),style:xe({width:H.percentage+"%"})},null,6)]),H.isCompleted?(t(),a("div",to," ‚úÖ Termin√© ")):$("",!0)])],2))),128))]),e("div",so,[e("div",ao,[e("div",io,[L[3]||(L[3]=e("span",{class:"stat-label"},"D√©fis compl√©t√©s :",-1)),e("span",oo,i(d.value)+" / "+i(X(S).length),1)]),e("div",no,[L[4]||(L[4]=e("span",{class:"stat-label"},"XP gagn√©s aujourd'hui :",-1)),e("span",lo,"+"+i(c.value),1)])]),L[5]||(L[5]=e("p",{class:"modal-note"}," Tous les d√©fis se r√©initialisent chaque jour √† minuit. Bonne chance ! ",-1))])])])):$("",!0),ne(Qe)],64))}},co=ee(ro,[["__scopeId","data-v-93456603"]]),uo={class:"streak-test-container"},vo={class:"status-grid"},po={class:"status-card"},mo={class:"status-content"},_o={class:"status-value"},ho={class:"status-card"},fo={class:"status-content"},go={class:"status-value"},yo={class:"status-card"},bo={class:"status-content"},$o={class:"status-value"},ko={class:"status-card"},wo={class:"status-content"},Co={class:"simulation-section"},xo={class:"simulation-buttons"},So={key:0,class:"test-results"},Po={class:"results-list"},jo={class:"result-time"},Do={class:"result-message"},zo={__name:"StreakTestButton",setup(B){const w=de(),{currentStreak:g,isStreakCheckedToday:x,checkDailyStreak:C,resetStreak:S,initializeStreak:P}=qe(),{updateUserXPInstantly:M}=Ve(),f=m([]),h=(l,r="info")=>{const k=new Date().toLocaleTimeString();f.value.unshift({timestamp:k,message:l,type:r}),f.value.length>8&&(f.value=f.value.slice(0,8))},E=l=>{try{h(`üé≠ Simulation du jour ${l}...`,"info");const r=new Date,k=new Date(r);k.setDate(r.getDate()-1);const U=k.toISOString().split("T")[0],F=l-1;localStorage.setItem("lastLoginDate",U),localStorage.setItem("currentStreak",F.toString()),localStorage.removeItem("streakCheckedToday"),g.value=F,x.value=!1,h(`‚úÖ Streak de ${l} jours simul√© (derni√®re connexion: ${U})`,"success"),setTimeout(()=>{A()},500)}catch(r){h(`‚ùå Erreur simulation jour ${l}: ${r.message}`,"error")}},j=()=>{try{h("üíî Simulation rupture de streak...","warning");const l=new Date,r=new Date(l);r.setDate(l.getDate()-3);const k=r.toISOString().split("T")[0];localStorage.setItem("lastLoginDate",k),localStorage.setItem("currentStreak","0"),localStorage.removeItem("streakCheckedToday"),g.value=0,x.value=!1,h("‚úÖ Rupture de streak simul√©e (3 jours d'√©cart)","warning"),setTimeout(()=>{A()},500)}catch(l){h(`‚ùå Erreur simulation rupture: ${l.message}`,"error")}},D=()=>{try{h("üîÑ Reset de la simulation...","info");const l=new Date().toISOString().split("T")[0];localStorage.setItem("lastLoginDate",l),localStorage.setItem("currentStreak","0"),localStorage.removeItem("streakCheckedToday"),g.value=0,x.value=!1,h("‚úÖ Simulation remise √† aujourd'hui (streak: 0)","success")}catch(l){h(`‚ùå Erreur reset simulation: ${l.message}`,"error")}},A=async()=>{try{h("üîÑ V√©rification du streak...","info");const l=await C();l.success?l.alreadyChecked?h("‚úÖ Streak d√©j√† v√©rifi√© aujourd'hui","success"):h(`üéâ Streak: ${l.streakDays} jours, +${l.xpGained} XP`,"success"):h(`‚ùå Erreur: ${l.reason||"inconnue"}`,"error")}catch(l){h(`‚ùå Erreur: ${l.message}`,"error")}},y=async()=>{try{h("‚ûï Test +5 XP...","info");const l=w.xp||0;if((await M(5,"test_manual")).success){const k=w.xp||0;h(`‚úÖ XP: ${l} ‚Üí ${k} (+5)`,"success")}else h("‚ùå √âchec mise √† jour XP","error")}catch(l){h(`‚ùå Erreur: ${l.message}`,"error")}},d=async()=>{try{h("‚ûñ Test -5 XP...","info");const l=w.xp||0;if((await M(-5,"test_manual_decrease")).success){const k=w.xp||0;h(`‚úÖ XP: ${l} ‚Üí ${k} (-5)`,"success")}else h("‚ùå √âchec diminution XP","error")}catch(l){h(`‚ùå Erreur: ${l.message}`,"error")}},c=()=>{try{S(),h("üóëÔ∏è Streak remis √† z√©ro","warning")}catch(l){h(`‚ùå Erreur reset: ${l.message}`,"error")}},z=async()=>{try{h("üîÑ Rafra√Æchissement...","info"),P(),h("‚úÖ Donn√©es rafra√Æchies","success")}catch(l){h(`‚ùå Erreur: ${l.message}`,"error")}},b=()=>{f.value=[]};return se(()=>{h("üöÄ Test Badges & Streak charg√©","info")}),(l,r)=>(t(),a("div",uo,[r[18]||(r[18]=e("div",{class:"test-header"},[e("h3",null,"üß™ Test Badges & Streak"),e("p",{class:"test-subtitle"},"Interface de test pour administrateur")],-1)),e("div",vo,[e("div",po,[r[8]||(r[8]=e("span",{class:"status-icon"},"üî•",-1)),e("div",mo,[r[7]||(r[7]=e("span",{class:"status-label"},"Streak",-1)),e("span",_o,i(X(g))+" jours",1)])]),e("div",ho,[r[10]||(r[10]=e("span",{class:"status-icon"},"‚≠ê",-1)),e("div",fo,[r[9]||(r[9]=e("span",{class:"status-label"},"XP",-1)),e("span",go,i(X(w).xp||0),1)])]),e("div",yo,[r[12]||(r[12]=e("span",{class:"status-icon"},"üèÜ",-1)),e("div",bo,[r[11]||(r[11]=e("span",{class:"status-label"},"Niveau",-1)),e("span",$o,i(X(w).level||0),1)])]),e("div",ko,[r[14]||(r[14]=e("span",{class:"status-icon"},"üìÖ",-1)),e("div",wo,[r[13]||(r[13]=e("span",{class:"status-label"},"V√©rifi√©",-1)),e("span",{class:O(["status-value",{checked:X(x)}])},i(X(x)?"Oui":"Non"),3)])])]),e("div",Co,[r[15]||(r[15]=e("h4",null,"üé≠ Simulation de Jours",-1)),r[16]||(r[16]=e("p",{class:"simulation-info"},"Simulez diff√©rents jours pour tester le streak",-1)),e("div",xo,[e("button",{onClick:r[0]||(r[0]=k=>E(1)),class:"sim-btn day-1"}," üìÖ Jour 1 "),e("button",{onClick:r[1]||(r[1]=k=>E(2)),class:"sim-btn day-2"}," üìÖ Jour 2 "),e("button",{onClick:r[2]||(r[2]=k=>E(3)),class:"sim-btn day-3"}," üìÖ Jour 3 "),e("button",{onClick:r[3]||(r[3]=k=>E(4)),class:"sim-btn day-4"}," üìÖ Jour 4 "),e("button",{onClick:r[4]||(r[4]=k=>E(5)),class:"sim-btn day-5"}," üìÖ Jour 5 "),e("button",{onClick:r[5]||(r[5]=k=>E(7)),class:"sim-btn day-7"}," üìÖ Jour 7 "),e("button",{onClick:r[6]||(r[6]=k=>E(10)),class:"sim-btn day-10"}," üìÖ Jour 10 ")]),e("div",{class:"simulation-controls"},[e("button",{onClick:j,class:"sim-btn break"}," üíî Casser le Streak "),e("button",{onClick:D,class:"sim-btn reset"}," üîÑ Reset Simulation ")])]),e("div",{class:"test-actions"},[e("button",{onClick:A,class:"test-btn primary"}," üîÑ V√©rifier Streak "),e("button",{onClick:y,class:"test-btn success"}," ‚ûï +5 XP "),e("button",{onClick:d,class:"test-btn danger"}," ‚ûñ -5 XP "),e("button",{onClick:c,class:"test-btn warning"}," üóëÔ∏è Reset "),e("button",{onClick:z,class:"test-btn info"}," üîÑ Refresh ")]),f.value.length>0?(t(),a("div",So,[e("div",{class:"results-header"},[r[17]||(r[17]=e("h4",null,"üìä R√©sultats des tests",-1)),e("button",{onClick:b,class:"clear-btn"},"üóëÔ∏è")]),e("div",Po,[(t(!0),a(Q,null,V(f.value,(k,U)=>(t(),a("div",{key:U,class:O(["result-item",k.type])},[e("span",jo,i(k.timestamp),1),e("span",Do,i(k.message),1)],2))),128))])])):$("",!0)]))}},Ao=ee(zo,[["__scopeId","data-v-d8c0f382"]]),Io={class:"dashboard-content"},Eo={class:"dashboard-center-top"},To={key:0,class:"dashboard-spinner"},Ro={key:1},qo={class:"section leaderboard-section"},Mo={class:"leaderboard-grid"},Lo={class:"leaderboard-container"},No={class:"level-container"},Oo={key:0},Xo={key:1},Qo={key:2,class:"dashboard-spinner"},Vo={key:3,class:"section"},Ho={__name:"DashboardStudent",setup(B){const w=de();He(),ke();const g=m({done:0,acquired:0,not_acquired:0}),x=m(!0),C=m([]),S=m([]),P=m([]),M=m({}),f=m({}),h=m([]),E=m(null);R(()=>C.value.length?[...C.value].sort((A,y)=>new Date(y.date_creation)-new Date(A.date_creation))[0]:null);function j(){M.value=Object.fromEntries(S.value.map(D=>[D.id,D])),f.value=Object.fromEntries(P.value.map(D=>[D.id,D]))}return se(async()=>{try{const[D,A,y,d,c,z]=await Promise.all([We({}),ce({}),Ke(),Ie(),Be().catch(()=>null),Ue().catch(()=>null)]),b=r=>Array.isArray(r)?r:r?.results||[];S.value=b(D),P.value=b(A),C.value=b(y?.data),h.value=b(d?.data??d),E.value=z?.data?.data||null;const l=c?.data?.data;l&&(w.xp=l.xp??w.xp,w.level=l.level??w.level,w.xp_to_next=l.xp_to_next??l.next_level_xp-l.xp),j(),g.value.done=C.value.length,g.value.acquired=C.value.filter(r=>r.est_correct===!0).length,g.value.not_acquired=C.value.filter(r=>r.est_correct===!1).length}catch{}x.value=!1}),(D,A)=>(t(),a("div",Io,[ne(Cs),e("div",Eo,[X(w).isLoading?(t(),a("div",To,A[0]||(A[0]=[e("span",{class:"spinner"},null,-1)]))):(t(),a("h1",Ro," Bienvenue "+i(X(w).firstName)+" sur votre tableau de bord ",1))]),e("div",qo,[e("div",Mo,[e("div",Lo,[ne(Wt)]),e("div",No,[ne($s),ne(co)])])]),x.value?$("",!0):(t(),a("div",Oo,[ne(za)])),x.value?$("",!0):(t(),a("div",Xo,[ne(Ri)])),x.value?(t(),a("div",Qo,A[1]||(A[1]=[e("span",{class:"spinner"},null,-1)]))):$("",!0),X(w).isAdmin?(t(),a("div",Vo,[A[2]||(A[2]=e("div",{class:"section-header"},[e("h3",{class:"section-title"},"üß™ Tests (Admin uniquement)")],-1)),ne(Ao)])):$("",!0)]))}},Bo=ee(Ho,[["__scopeId","data-v-1d784f6f"]]),Uo={class:"parent-dashboard"},Fo={class:"add-child"},Jo=["disabled"],Go={key:0,class:"hint"},Wo={class:"create-child"},Ko={class:"form-row"},Yo={class:"form-row"},Zo=["disabled"],en={key:0,class:"hint"},tn={key:1,class:"temp-pass"},sn={key:0,class:"loading"},an={key:1},on={key:0,class:"empty"},nn={key:1,class:"children-grid"},ln={class:"child-header"},rn={class:"avatar"},cn={class:"child-info"},dn={class:"name"},un={key:0,class:"flag"},vn={class:"meta"},pn={key:0},mn={class:"xp"},_n={class:"xp-value"},hn={class:"level"},fn={class:"child-body"},gn={class:"metrics-grid"},yn={class:"metric"},bn={class:"bar"},$n={class:"hint"},kn={class:"metric small"},wn={class:"kpi"},Cn={class:"metric small ok"},xn={class:"kpi"},Sn={class:"metric small ko"},Pn={class:"kpi"},jn={key:0,class:"last-activity"},Dn={class:"activity-line"},zn={class:"activity-title"},An={key:0,class:"activity-meta"},In={class:"actions"},En=["onClick"],Tn=["onClick","disabled"],Rn={__name:"DashboardParent",setup(B){const w=m(!0),g=m([]),x=ke(),C=m(""),S=m(!1),P=m(""),M=m(null),f=m(!1),h=m(""),E=m(""),j=m({first_name:"",last_name:"",email:""});function D(b){if(!b)return"E";const l=String(b).trim().split(/\s+/);return l.length===1?l[0].substring(0,2).toUpperCase():(l[0].substring(0,1)+l[1].substring(0,1)).toUpperCase()}function A(b){x.push({name:"ChildOverview",params:{childId:String(b)}})}se(async()=>{try{const l=(await Re())?.data?.data||{};g.value=l.children||[]}catch{g.value=[]}finally{w.value=!1}});async function y(){try{const l=(await Re())?.data?.data||{};g.value=l.children||[]}catch{g.value=[]}}async function d(){P.value="";const b=String(C.value||"").trim();if(!b){P.value="Renseignez l'email de l'√©l√®ve";return}S.value=!0;try{await Fe({email:b}),C.value="",P.value="√âl√®ve ajout√© ‚úÖ",await y()}catch{P.value="Impossible d'ajouter cet √©l√®ve"}finally{S.value=!1,setTimeout(()=>{P.value=""},2500)}}async function c(b){M.value=b;try{await Je(b),await y()}catch{}M.value=null}async function z(){h.value="",E.value="";const b={first_name:String(j.value.first_name||"").trim(),last_name:String(j.value.last_name||"").trim(),email:String(j.value.email||"").trim().toLowerCase()};if(!b.first_name||!b.last_name||!b.email){h.value="Renseignez pr√©nom, nom et email";return}f.value=!0;try{const r=(await J.post("/api/users/me/children/create/",b))?.data?.data||{};E.value=r.temp_password||"",h.value="Compte cr√©√© et li√© ‚úÖ",j.value={first_name:"",last_name:"",email:""},await y()}catch{h.value="Cr√©ation impossible (email d√©j√† utilis√©?)"}finally{f.value=!1,setTimeout(()=>{h.value=""},3e3)}}return(b,l)=>(t(),a("div",Uo,[l[13]||(l[13]=e("div",{class:"header"},[e("h1",null,"Tableau de bord Parent"),e("p",{class:"subtitle"},"Suivez la progression de vos enfants, simplement.")],-1)),e("div",Fo,[Z(e("input",{"onUpdate:modelValue":l[0]||(l[0]=r=>C.value=r),type:"email",placeholder:"Email de l'√©l√®ve",class:"input"},null,512),[[Ce,C.value]]),e("button",{class:"btn",disabled:S.value,onClick:d},"Ajouter",8,Jo),P.value?(t(),a("span",Go,i(P.value),1)):$("",!0)]),e("div",Wo,[e("details",null,[l[5]||(l[5]=e("summary",null,"Cr√©er un compte pour un enfant",-1)),e("div",Ko,[Z(e("input",{"onUpdate:modelValue":l[1]||(l[1]=r=>j.value.first_name=r),class:"input",placeholder:"Pr√©nom"},null,512),[[Ce,j.value.first_name]]),Z(e("input",{"onUpdate:modelValue":l[2]||(l[2]=r=>j.value.last_name=r),class:"input",placeholder:"Nom"},null,512),[[Ce,j.value.last_name]])]),e("div",Yo,[Z(e("input",{"onUpdate:modelValue":l[3]||(l[3]=r=>j.value.email=r),class:"input",placeholder:"Email"},null,512),[[Ce,j.value.email]])]),e("button",{class:"btn",disabled:f.value,onClick:z},"Cr√©er le compte",8,Zo),h.value?(t(),a("div",en,i(h.value),1)):$("",!0),E.value?(t(),a("div",tn,[l[4]||(l[4]=K("Mot de passe temporaire: ")),e("code",null,i(E.value),1)])):$("",!0)])]),w.value?(t(),a("div",sn,l[6]||(l[6]=[e("span",{class:"spinner"},null,-1)]))):(t(),a("div",an,[g.value.length===0?(t(),a("div",on,l[7]||(l[7]=[e("p",null,"Aucun enfant rattach√© pour le moment.",-1)]))):(t(),a("div",nn,[(t(!0),a(Q,null,V(g.value,r=>(t(),a("div",{class:"child-card",key:r.id},[e("div",ln,[e("div",rn,i(D(r.display_name)),1),e("div",cn,[e("div",dn,[r.pays_flag?(t(),a("span",un,i(r.pays_flag),1)):$("",!0),K(" "+i(r.display_name),1)]),e("div",vn,[r.niveau?(t(),a("span",pn,i(r.niveau),1)):$("",!0)])]),e("div",mn,[e("div",_n,i(r.xp)+" XP",1),e("div",hn,"Niveau "+i(r.level),1)])]),e("div",fn,[e("div",gn,[e("div",yn,[l[8]||(l[8]=e("div",{class:"label"},"Objectif hebdo",-1)),e("div",bn,[e("div",{class:"fill",style:xe({width:(r.metrics?.weekly_progress||0)+"%"})},null,4)]),e("div",$n,i(r.metrics?r.metrics.weekly_done+" / "+r.metrics.weekly_goal:"‚Äî"),1)]),e("div",kn,[e("div",wn,i(r.metrics?.done_total??"‚Äî"),1),l[9]||(l[9]=e("div",{class:"kpi-label"},"Exercices",-1))]),e("div",Cn,[e("div",xn,i(r.metrics?.acquired_count??"‚Äî"),1),l[10]||(l[10]=e("div",{class:"kpi-label"},"Acquis",-1))]),e("div",Sn,[e("div",Pn,i(r.metrics?.not_acquired_count??"‚Äî"),1),l[11]||(l[11]=e("div",{class:"kpi-label"},"√Ä revoir",-1))])]),r.last_activity?(t(),a("div",jn,[l[12]||(l[12]=e("div",{class:"label"},"Derni√®re activit√©",-1)),e("div",Dn,[e("span",zn,i(r.last_activity.exercice_title),1),r.last_activity.chapitre_title?(t(),a("span",An,"‚Ä¢ "+i(r.last_activity.chapitre_title),1)):$("",!0)])])):$("",!0),e("div",In,[e("button",{class:"btn",onClick:k=>A(r.id)},"Voir d√©tails",8,En),e("button",{class:"btn secondary",onClick:k=>c(r.id),disabled:M.value===r.id},"Retirer",8,Tn)])])]))),128))]))]))]))}},qn=ee(Rn,[["__scopeId","data-v-e116edd0"]]),Bn={__name:"Dashboard",setup(B){const w=de(),g=R(()=>w.role==="parent"?qn:Bo);return(x,C)=>(t(),Se(Le,null,{default:re(()=>[(t(),Se(Ge(g.value)))]),_:1}))}};export{Bn as default};
