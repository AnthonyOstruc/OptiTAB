import{a as x,c as H,C as W,B as N,b as n,d as e,g as v,n as p,t as g,a1 as y,w as V,z as D,o}from"./vendor-D171CWhe.js";import{_ as G}from"./index-lv_OcPRH.js";import{a as j}from"./exercices-alxWkPRG.js";const Q={class:"progress-indicator"},F={class:"progress-status"},K={key:0,class:"status-text success"},O={key:1,class:"status-text warning"},X={key:2,class:"status-text pending"},Y={class:"exercice-header"},Z={class:"exercice-title-section"},P={class:"title-row"},tt={key:0,class:"exercice-title"},et={class:"difficulty-indicator"},st={key:1,class:"difficulty-text"},it={class:"exercice-meta"},at={class:"exercice-number"},nt={class:"problem-section"},ot=["innerHTML"],lt={class:"learning-path"},ct={class:"solution-toggle"},rt={class:"toggle-content"},dt={class:"toggle-icon"},ut={class:"toggle-text-group"},vt={class:"toggle-text"},pt={class:"toggle-subtext"},gt={key:0,class:"solution-content"},mt={key:0,class:"solution-section steps-section"},ft={class:"steps-container"},ht=["innerHTML"],bt={key:1,class:"solution-section answer-section"},xt=["innerHTML"],yt={class:"assessment-section"},wt={class:"assessment-buttons"},Mt=["src","alt"],It={class:"modal-caption"},kt={class:"modal-image-type"},St={key:0,class:"modal-position"},Lt={__name:"ExerciceQCM",props:{eid:{type:[String,Number],required:!0},titre:{type:String,default:""},instruction:{type:String,default:""},solution:{type:String,default:""},etapes:{type:String,default:""},difficulty:{type:String,default:"medium"},current:{type:String,default:null},previewImages:{type:Array,default:()=>[]}},emits:["status-changed","xp-gained"],setup(a,{emit:q}){const i=a,S=q,c=x(!1),d=x([]),w=x(!1),m=x(null),E=H(()=>({easy:"Facile",medium:"Moyen",hard:"Difficile"}));function T(){c.value=!c.value,c.value&&I()}function L(s){S("status-changed",{exerciceId:i.eid,status:s})}function B(){S("status-changed",{exerciceId:i.eid,status:null})}function R(s){if(!s)return"";let t=s.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/\\/g,"\\").replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+)\*/g,"<em>$1</em>");return t=t.split(`
`).map((l,h)=>{if(l.trim()==="")return"<br/>";const b=l.match(/^(?:(\s*))\s*‚óè\s+(.+)$/);if(b)return`<div class="step-bullet" style="margin-left: ${Math.max(b[1]?b[1].length:0,4)*6}px;"><span class="bullet-symbol">‚óè</span> <span class="bullet-text">${b[2]}</span></div>`;const f=l.match(/^(\s+)(.+)$/);return f&&!f[2].includes("<div")&&!f[2].includes("<strong")&&!f[2].includes("‚óè")?`<div class="step-line" style="margin-left: ${f[1].length*6}px;">${f[2]}</div>`:l.trim()?`<div class="step-title">${l}</div>`:l}).join(""),t=t.replace(/(<br\/>\s*){3,}/g,"<br/><br/>").replace(/  +/g,"&nbsp;&nbsp;"),t}function M(s){if(!s)return"";let t=R(s);if(!d.value||d.value.length===0)return t;const r={};return d.value.forEach(u=>{u.position&&(r[u.position]=u)}),t=t.replace(/\[IMAGE_(\d+)\]/g,(u,l)=>{const h=r[parseInt(l)];return h?`
        <div class="exercice-image-container inline-image" data-image-position="${l}">
          <img 
            src="${C(h.image)}" 
            alt="Image ${h.image_type==="donnee"?"donn√©e":"solution"} - position ${l}"
            class="exercice-image inline"
            style="cursor: pointer;"
          />
        </div>
      `:u}),t}function I(){D(()=>{if(window.MathJax&&window.MathJax.typesetPromise)window.MathJax.typesetPromise();else{let t=0;const r=()=>{window.MathJax&&window.MathJax.typesetPromise?window.MathJax.typesetPromise():t++<10&&setTimeout(r,150)};setTimeout(r,100)}})}function C(s){if(!i.eid||i.eid.toString().startsWith("preview-"),i.eid&&i.eid.toString().startsWith("preview-")&&s&&(s.startsWith("blob:")||s.startsWith("data:")))return s;if(s&&s.startsWith("/media/")){const t=`http://localhost:8000${s}`;return!i.eid||i.eid.toString().startsWith("preview-"),t}if(s&&s.startsWith("exercice_images/")){const t=`http://localhost:8000/media/${s}`;return!i.eid||i.eid.toString().startsWith("preview-"),t}if(s&&!s.startsWith("/")&&!s.includes("/")){const t=`http://localhost:8000/media/exercice_images/${s}`;return!i.eid||i.eid.toString().startsWith("preview-"),t}return!i.eid||i.eid.toString().startsWith("preview-"),s||""}function $(s){m.value=s,w.value=!0}function _(){w.value=!1,m.value=null}function k(s){if(s.target.classList.contains("exercice-image")&&s.target.classList.contains("inline")){const t=s.target.closest(".inline-image");if(t){const r=t.dataset.imagePosition,u=d.value.find(l=>l.position===parseInt(r));u&&$(u)}return}s.target&&s.target.tagName==="IMG"&&$({image:s.target.src,image_type:"aper√ßu",position:null})}function U(){return[i.instruction,i.etapes,i.solution].filter(Boolean).some(t=>/\[IMAGE_\d+\]/.test(t))}async function z(){if(i.eid&&i.eid.toString().startsWith("preview-")){d.value=i.previewImages||[];return}if(!U()){d.value=[];return}try{const{data:s}=await j(i.eid);d.value=s}catch{d.value=[]}}return W(()=>[i.instruction,i.etapes,i.solution],I,{immediate:!0}),W(()=>i.previewImages,()=>{i.eid&&i.eid.toString().startsWith("preview-")&&(d.value=i.previewImages||[])},{immediate:!0}),N(()=>{(U()||i.previewImages&&i.previewImages.length>0)&&z(),I()}),(s,t)=>(o(),n("div",{class:p(["exercice-card",{completed:a.current}])},[e("div",Q,[e("div",{class:p(["progress-bar",{completed:a.current}])},null,2),e("div",F,[a.current==="acquired"?(o(),n("span",K,"‚úÖ Ma√Ætris√©")):a.current==="not_acquired"?(o(),n("span",O,"‚ùå √Ä revoir")):(o(),n("span",X,"‚è≥ En cours"))])]),e("div",Y,[e("div",Z,[e("div",P,[a.titre?(o(),n("h3",tt,g(a.titre),1)):v("",!0),e("div",et,[a.difficulty?(o(),n("span",{key:0,class:p(["difficulty-dot",a.difficulty])},null,2)):v("",!0),a.difficulty?(o(),n("span",st,g(E.value[a.difficulty]||a.difficulty),1)):v("",!0)])]),e("div",it,[e("span",at,"Exercice #"+g(a.eid),1),t[3]||(t[3]=e("span",{class:"exercice-type"},"Exercice guid√©",-1))])]),a.current?(o(),n("button",{key:0,class:"reset-status-btn",onClick:B,title:"R√©initialiser le statut"},t[4]||(t[4]=[y('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-23abb896><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" data-v-23abb896></path><path d="M21 3v5h-5" data-v-23abb896></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" data-v-23abb896></path><path d="M3 21v-5h5" data-v-23abb896></path></svg>',1)]))):v("",!0)]),e("div",nt,[t[5]||(t[5]=y('<div class="section-header" data-v-23abb896><div class="section-icon-wrapper" data-v-23abb896><div class="section-icon" data-v-23abb896>üìù</div></div><div class="section-info" data-v-23abb896><h4 class="section-title" data-v-23abb896>√ânonc√© du probl√®me</h4><p class="section-description" data-v-23abb896>Lisez attentivement l&#39;√©nonc√© avant de commencer</p></div></div>',1)),e("div",{class:"problem-content",innerHTML:M(a.instruction),onClick:k},null,8,ot)]),e("div",lt,[t[8]||(t[8]=e("div",{class:"path-step active"},[e("div",{class:"step-indicator"},"1"),e("span",{class:"step-text"},"Lecture de l'√©nonc√©")],-1)),e("div",{class:p(["path-step",{active:c.value}])},t[6]||(t[6]=[e("div",{class:"step-indicator"},"2",-1),e("span",{class:"step-text"},"Analyse de la solution",-1)]),2),e("div",{class:p(["path-step",{active:a.current}])},t[7]||(t[7]=[e("div",{class:"step-indicator"},"3",-1),e("span",{class:"step-text"},"Auto-√©valuation",-1)]),2)]),e("div",ct,[e("button",{class:p(["toggle-btn",{expanded:c.value}]),onClick:T},[e("div",rt,[e("span",dt,g(c.value?"‚àí":"+"),1),e("div",ut,[e("span",vt,g(c.value?"Masquer la solution":"Voir la solution"),1),e("span",pt,g(c.value?"Cliquez pour replier":"Cliquez pour d√©couvrir la m√©thode"),1)])]),e("div",{class:p(["toggle-arrow",{rotated:c.value}])},t[9]||(t[9]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"m6 9 6 6 6-6"})],-1)]),2)],2)]),c.value?(o(),n("div",gt,[a.etapes?(o(),n("div",mt,[t[10]||(t[10]=y('<div class="section-header" data-v-23abb896><div class="section-icon-wrapper" data-v-23abb896><div class="section-icon" data-v-23abb896>üî¢</div></div><div class="section-info" data-v-23abb896><h4 class="section-title" data-v-23abb896>M√©thode de r√©solution</h4><p class="section-description" data-v-23abb896>Suivez ces √©tapes pour comprendre la d√©marche</p></div></div>',1)),e("div",ft,[e("div",{class:"steps-content",innerHTML:M(a.etapes),onClick:k},null,8,ht)])])):v("",!0),a.solution?(o(),n("div",bt,[t[11]||(t[11]=y('<div class="section-header" data-v-23abb896><div class="section-icon-wrapper" data-v-23abb896><div class="section-icon" data-v-23abb896>‚úÖ</div></div><div class="section-info" data-v-23abb896><h4 class="section-title" data-v-23abb896>R√©ponse</h4><p class="section-description" data-v-23abb896>La solution compl√®te √† l&#39;exercice</p></div></div>',1)),e("div",{class:"answer-content",innerHTML:M(a.solution),onClick:k},null,8,xt)])):v("",!0)])):v("",!0),e("div",yt,[t[14]||(t[14]=e("div",{class:"assessment-header"},[e("h4",{class:"assessment-title"},"Auto-√©valuation"),e("p",{class:"assessment-description"},"√âvaluez votre compr√©hension de cet exercice")],-1)),e("div",wt,[e("button",{class:p(["assessment-btn acquired",{active:a.current==="acquired"}]),onClick:t[0]||(t[0]=r=>L("acquired"))},t[12]||(t[12]=[e("span",{class:"btn-icon"},"‚úÖ",-1),e("span",{class:"btn-text"},"J'ai compris",-1)]),2),e("button",{class:p(["assessment-btn not-acquired",{active:a.current==="not_acquired"}]),onClick:t[1]||(t[1]=r=>L("not_acquired"))},t[13]||(t[13]=[e("span",{class:"btn-icon"},"‚ùå",-1),e("span",{class:"btn-text"},"√Ä revoir",-1)]),2)])]),w.value?(o(),n("div",{key:1,class:"image-modal-overlay",onClick:_},[e("div",{class:"image-modal",onClick:t[2]||(t[2]=V(()=>{},["stop"]))},[e("button",{class:"modal-close-btn",onClick:_},"√ó"),e("img",{src:C(m.value.image),alt:`Image ${m.value.image_type==="donnee"?"donn√©e":"solution"}`,class:"modal-image"},null,8,Mt),e("div",It,[e("span",kt,g(m.value.image_type==="donnee"?"Donn√©e":"Solution"),1),m.value.position?(o(),n("span",St,"Position "+g(m.value.position),1)):v("",!0)])])])):v("",!0)],2))}},Ut=G(Lt,[["__scopeId","data-v-23abb896"]]);export{Ut as E};
