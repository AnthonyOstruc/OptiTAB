import{a as p,c as C,B as N,b as i,d as o,t as l,w as D,k as a,K as d,L as T,F as _,p as b,o as u,g as M,m as F,h as L,u as B}from"./vendor-D171CWhe.js";import{g as z,u as $,c as V,d as O}from"./themes-dlkqBthf.js";import{g as q}from"./matiere-contextes-CM4d_5-c.js";import"./PaysNiveauxDisplay.vue_vue_type_style_index_0_scoped_821033d6_lang-l0sNRNKZ.js";import{_ as I}from"./index-D9PhsPPd.js";import{A as P}from"./AdminActionsButtons-BTlG4wzv.js";import"./ui-jaH5oyHW.js";import"./pdf-B39ievqC.js";import"./mathlive-B5k0jhbN.js";const R={class:"admin-themes"},G={class:"admin-form"},K={class:"form-group"},W=["value"],H={class:"form-group"},J={class:"form-group"},Q={class:"form-group"},X={class:"color-input-group"},Y={class:"form-group"},Z={class:"form-actions"},ee={type:"submit",class:"btn-primary"},te={class:"admin-list"},oe={class:"filters"},re={class:"filter-group"},ne=["value"],se={class:"themes-grid"},le={class:"theme-header"},ie={class:"theme-name"},ae={key:0,class:"context-chip"},ue={key:1,class:"theme-description"},de={class:"theme-meta"},me={class:"theme-ordre"},ce={class:"theme-actions"},ve={__name:"AdminThemes",setup(pe){const v=p([]),f=p([]),m=p(""),r=p({id:null,contexte:"",nom:"",description:"",couleur:"#3b82f6",ordre:0}),x=p({contexte:""});C(()=>[]);const h=C(()=>{if(!m.value)return v.value;const n=m.value.toLowerCase();return v.value.filter(e=>e.matiere_nom.toLowerCase().includes(n)||e.pays?.nom.toLowerCase().includes(n)||e.niveau?.nom.toLowerCase().includes(n)||`${e.matiere_nom} ‚Äî ${e.pays?.nom} - ${e.niveau?.nom}`.toLowerCase().includes(n))}),E=()=>{let e=Array.isArray(f.value)?f.value:[];return x.value.contexte&&(e=e.filter(t=>String(t.contexte)===String(x.value.contexte))),e.sort((t,c)=>(t.ordre||0)-(c.ordre||0))};async function g(){try{const[n,e]=await Promise.all([q(),z()]);v.value=Array.isArray(n)?n:n?.data||[],f.value=Array.isArray(e)?e:e?.data||[]}catch{}}function A(){r.value={id:null,contexte:"",nom:"",description:"",couleur:"#3b82f6",ordre:0}}async function k(){if(!(!r.value.contexte||!r.value.nom))try{const n=v.value.find(s=>s.id===Number(r.value.contexte));if(!n)return;if(!n.matiere){alert("Erreur: Impossible de r√©cup√©rer la mati√®re associ√©e √† ce contexte.");return}if(f.value.find(s=>String(s.contexte)===String(r.value.contexte)&&(s.nom===r.value.nom||s.titre===r.value.nom)&&s.id!==r.value.id)){const s=v.value.find(y=>y.id===Number(r.value.contexte)),w=s?`${s.matiere_nom} ‚Äî ${s.pays?.nom} - ${s.niveau?.nom}`:"ce contexte";alert(`Un th√®me avec le nom "${r.value.nom}" existe d√©j√† dans ${w}.

Vous pouvez cr√©er un th√®me avec le m√™me nom dans un contexte diff√©rent (autre niveau ou pays).`);return}const t={contexte:Number(r.value.contexte),nom:r.value.nom,description:r.value.description,couleur:r.value.couleur,ordre:r.value.ordre};try{r.value.id?await $(r.value.id,t):await V(t)}catch(s){if(!!(s?.response?.data&&(s.response.data.matiere||s.response.data.Matiere))&&n?.matiere){const y={...t,matiere:n.matiere};r.value.id?await $(r.value.id,y):await V(y)}else throw s}const c=r.value.contexte;A(),r.value.contexte=c,await g()}catch(n){if(n.response?.data){const e=n.response.data;if(e.non_field_errors)alert(`Erreur: ${e.non_field_errors.join(", ")}`);else if(e.titre){const t=Array.isArray(e.titre)?e.titre:[e.titre];alert(`${t.join(`
`)}`)}else if(e.matiere)alert(`Erreur sur la mati√®re: ${e.matiere.join(", ")}`);else{const t=[];for(const[c,s]of Object.entries(e))Array.isArray(s)?t.push(`${c}: ${s.join(", ")}`):t.push(`${c}: ${s}`);alert(`Erreur de validation:
${t.join(`
`)}`)}}else alert("Erreur lors de la sauvegarde. V√©rifiez les donn√©es saisies.")}}function S(n){r.value={id:n.id,contexte:n.contexte||"",nom:n.nom||n.titre||"",description:n.description||"",couleur:n.couleur||"#3b82f6",ordre:n.ordre||0}}async function U(n){try{await O(n),await g()}catch{}}function j(n){U(n.id)}return N(g),(n,e)=>(u(),i("div",R,[e[19]||(e[19]=o("h1",{class:"admin-title"},"Gestion des Th√®mes",-1)),o("div",G,[o("h2",null,l(r.value.id?"Modifier":"Ajouter")+" un th√®me",1),o("form",{onSubmit:D(k,["prevent"])},[o("div",K,[e[10]||(e[10]=o("label",null,"Contexte (Mati√®re + Niveau):",-1)),a(o("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>m.value=t),type:"text",placeholder:"Filtrer les contextes...",class:"filter-input"},null,512),[[d,m.value]]),a(o("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>r.value.contexte=t),required:""},[e[9]||(e[9]=o("option",{value:""},"Choisir un contexte",-1)),(u(!0),i(_,null,b(h.value,t=>(u(),i("option",{key:t.id,value:t.id},l(t.matiere_nom)+" ‚Äî "+l(t.pays.nom)+" - "+l(t.niveau.nom),9,W))),128))],512),[[T,r.value.contexte]])]),o("div",H,[e[11]||(e[11]=o("label",null,"Nom du th√®me:",-1)),a(o("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>r.value.nom=t),type:"text",required:""},null,512),[[d,r.value.nom]]),e[12]||(e[12]=o("div",{class:"help-text"},' üí° Vous pouvez cr√©er des th√®mes avec le m√™me nom dans des contextes diff√©rents (par exemple "Alg√®bre" pour Maths CE2 et Maths Terminal). ',-1))]),o("div",J,[e[13]||(e[13]=o("label",null,"Description:",-1)),a(o("textarea",{"onUpdate:modelValue":e[3]||(e[3]=t=>r.value.description=t),rows:"3"},null,512),[[d,r.value.description]])]),o("div",Q,[e[14]||(e[14]=o("label",null,"Couleur:",-1)),o("div",X,[a(o("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>r.value.couleur=t),type:"color"},null,512),[[d,r.value.couleur]]),a(o("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>r.value.couleur=t),type:"text",placeholder:"#3b82f6"},null,512),[[d,r.value.couleur]])])]),o("div",Y,[e[15]||(e[15]=o("label",null,"Ordre d'affichage:",-1)),a(o("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>r.value.ordre=t),type:"number",min:"0"},null,512),[[d,r.value.ordre,void 0,{number:!0}]])]),o("div",Z,[o("button",ee,l(r.value.id?"Modifier":"Ajouter"),1),o("button",{type:"button",onClick:A,class:"btn-secondary"},"Annuler")])],32)]),o("div",te,[e[18]||(e[18]=o("h2",null,"Th√®mes existants",-1)),o("div",oe,[o("div",re,[e[17]||(e[17]=o("label",null,"Filtrer par contexte:",-1)),a(o("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>m.value=t),type:"text",placeholder:"Filtrer les contextes...",class:"filter-input"},null,512),[[d,m.value]]),a(o("select",{"onUpdate:modelValue":e[8]||(e[8]=t=>x.value.contexte=t)},[e[16]||(e[16]=o("option",{value:""},"Tous les contextes",-1)),(u(!0),i(_,null,b(h.value,t=>(u(),i("option",{key:t.id,value:t.id},l(t.matiere_nom)+" ‚Äî "+l(t.pays.nom)+" - "+l(t.niveau.nom),9,ne))),128))],512),[[T,x.value.contexte]])])]),o("div",se,[(u(!0),i(_,null,b(E(),t=>(u(),i("div",{key:t.id,class:"theme-card"},[o("div",le,[o("div",{class:"theme-color",style:F({backgroundColor:t.couleur})},null,4),o("h4",ie,l(t.titre||t.nom),1)]),t.contexte_detail?(u(),i("div",ae,l(t.contexte_detail.matiere_nom)+" ‚Äî "+l(t.contexte_detail.pays?.nom)+" - "+l(t.contexte_detail.niveau?.nom),1)):M("",!0),t.description?(u(),i("p",ue,l(t.description),1)):M("",!0),o("div",de,[o("span",me,"Ordre: "+l(t.ordre||0),1)]),o("div",ce,[L(B(P),{item:t,actions:["edit","delete"],"edit-label":"Modifier","confirm-message":"√ätes-vous s√ªr de vouloir supprimer ce th√®me ?",onEdit:S,onDelete:j},null,8,["item"])])]))),128))])])]))}},Ce=I(ve,[["__scopeId","data-v-c1b69b87"]]);export{Ce as default};
